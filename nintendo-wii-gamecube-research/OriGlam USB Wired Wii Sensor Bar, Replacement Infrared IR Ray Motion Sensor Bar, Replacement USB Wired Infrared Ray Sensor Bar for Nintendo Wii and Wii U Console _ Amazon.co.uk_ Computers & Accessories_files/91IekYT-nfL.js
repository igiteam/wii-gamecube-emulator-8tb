////////////////////////////////////////////
;(function (packageFunction) {
  /* istanbul ignore next */
  var p = window.AmazonUIPageJS || window.P;
  /* istanbul ignore next */
  var attribute = p._namespace || p.attributeErrors;
  /* istanbul ignore next */
  var namespacedP = attribute ? attribute("RufusPanelWebAssetsBuild@legacy", "RufusPanelWebAssetsBuild") : p;

  /* istanbul ignore next */
  if (namespacedP.guardFatal) {
    namespacedP.guardFatal(packageFunction)(namespacedP, window);
  } else {
    namespacedP.execute(function () {
      packageFunction(namespacedP, window);
    });
  }
}(function(P, window, undefined){
// BEGIN ASSET RufusPanelWebAssetsBuild@legacy - 1.0
/////////////////////////
// BEGIN FILE legacy_bundle.js
/////////////////////////
/*


Full source (including license, if applicable) included below.
*/
/*! For license information please see legacy_bundle.js.LICENSE.txt */
!function(){var t={214(e){"use strict";e.exports=JSON.parse('{"de":{"strings":{"completed_generating_a_response":"Rufus hat die Generierung einer Antwort abgeschlossen","currently_generating_a_response":"Rufus generiert gerade eine Antwort","customer_question":"Frage des Kunden","default_error_message":"Etwas ist schief gelaufen. Bitte versuch es später erneut.","general_error_message":"Es tut uns leid, aber etwas ist schief gelaufen.","oam_modal_header":"Du verlässt Amazon","offline_error_message":"Oh nein, wir haben die Verbindung verloren.\\nÜberprüfe noch einmal dein Internet und lass es uns dann noch einmal versuchen.","rufus_panel_close":"Rufus-Panel schließen","rufus_panel_dock":"Dock Rufus panel","rufus_panel_open":"Rufus-Panel öffnen","rufus_panel_undock":"Undock Rufus panel"}}}')},254(e){"use strict";e.exports=JSON.parse('{"und":{"strings":{"completed_generating_a_response":"Rufus has completed generating a response","currently_generating_a_response":"Rufus is currently generating a response","customer_question":"Customer question","default_error_message":"Something went wrong. Please try again later.","general_error_message":"Sorry, but something went wrong.","oam_modal_header":"You\'re leaving Amazon","offline_error_message":"Oh no, we lost connection.\\nDouble check your internet, then let\'s try this again.","rufus_panel_close":"Close Rufus panel","rufus_panel_dock":"Dock Rufus panel","rufus_panel_open":"Open Rufus panel","rufus_panel_undock":"Undock Rufus panel"}}}')},602(e){"use strict";e.exports=JSON.parse('{"he":{"strings":{"completed_generating_a_response":"Rufus סיים לייצר תגובה","currently_generating_a_response":"Rufus מייצר עכשיו תגובה","customer_question":"שאלת לקוחות","default_error_message":"משהו השתבש. נא לנסות שוב מאוחר יותר.","general_error_message":"מצטערים, אבל משהו השתבש.","oam_modal_header":"פעולה זו תביא ליציאה מ-Amazon","offline_error_message":"אוי לא, החיבור אבד.\\nיש לבדוק שוב את האינטרנט שלך, וננסה את זה שוב.","rufus_panel_close":"סגור את חלונית Rufus","rufus_panel_dock":"Dock Rufus panel","rufus_panel_open":"פתח את חלונית Rufus","rufus_panel_undock":"Undock Rufus panel"}}}')},1045(e){"use strict";e.exports=JSON.parse('{"es":{"strings":{"customer_question":"Pregunta del cliente","default_error_message":"Algo salió mal. Inténtalo de nuevo más tarde.","general_error_message":"Lo siento, pero algo salió mal.","rufus_panel_dock":"Dock Rufus panel","rufus_panel_undock":"Undock Rufus panel"}},"es-ES":{"strings":{"completed_generating_a_response":"Rufus ha terminado de generar una respuesta","currently_generating_a_response":"Rufus está generando una respuesta","oam_modal_header":"Vas a salir de Amazon","offline_error_message":"Oh, no, hemos perdido la conexión.\\nComprueba tu conexión a Internet y, a continuación, volvamos a intentarlo.","rufus_panel_close":"Cerrar el panel Rufus","rufus_panel_open":"Abrir el panel Rufus"}},"es-US":{"strings":{"completed_generating_a_response":"Rufus terminó de generar una respuesta","currently_generating_a_response":"Rufus está generando una respuesta actualmente","oam_modal_header":"Está saliendo de Amazon","offline_error_message":"Oh, no. Se perdió la conexión.\\nVuelve a verificar tu internet e intenta de nuevo.","rufus_panel_close":"Cerrar panel Rufus","rufus_panel_open":"Abrir panel Rufus"}}}')},1052(e,t,n){"use strict";var r=n(4438),i=n(2784),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=i.useSyncExternalStore,s=r.useRef,u=r.useEffect,c=r.useMemo,l=r.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,r,i){var d=s(null);if(null===d.current){var h={hasValue:!1,value:null};d.current=h}else h=d.current;d=c(function(){function e(e){if(!u){if(u=!0,o=e,e=r(e),void 0!==i&&h.hasValue){var t=h.value;if(i(t,e))return s=t}return s=e}if(t=s,a(o,e))return t;var n=r(e);return void 0!==i&&i(t,n)?t:(o=e,s=n)}var o,s,u=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,n,r,i]);var f=o(e,d[0],d[1]);return u(function(){h.hasValue=!0,h.value=f},[f]),l(f),f}},1458(t){"use strict";t.exports.contains=function(t,n){return t.some(function(t){if(n.equals&&n.equals(e)||t===n)return!0})},t.exports.containsKey=function(e,t){if("string"==typeof t){var n=t.toLowerCase();return e.some(function(e,t){if(n===t||"string"==typeof t&&n===t.toLowerCase())return!0})}return!1},t.exports.middleware=function(e,t,n){switch(e.url){case"/esapi/esapi.js":t.sendfile("//public/esapi.js");break;case"/esapi/esapi-compressed.js":t.sendfile("//public/esapi-compressed.js");break;case"/esapi/resources/Base.esapi.properties.js":t.sendfile("//public/resources/Base.esapi.properties.js");break;case"/esapi/resources/i18n/ESAPI_Standard_en_US.properties.js":t.sendfile("//public/resources/i18n/ESAPI_Standard_en_US.properties.js");break;default:n()}}},2032(e,t,n){var r=n(4134),i=n(4326);e.exports=function(e,t,n,a,o){return new i(r().w(e,t,n,a),o||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports},2061(e){"use strict";e.exports=JSON.parse('{"pt":{"strings":{"customer_question":"Pergunta do cliente","rufus_panel_dock":"Dock Rufus panel","rufus_panel_open":"Abrir painel Rufus","rufus_panel_undock":"Undock Rufus panel"}},"pt-BR":{"strings":{"completed_generating_a_response":"Rufus concluiu a geração de uma resposta","currently_generating_a_response":"Rufus está gerando uma resposta no momento","default_error_message":"Algo deu errado. Tente novamente mais tarde.","general_error_message":"Desculpe, ocorreu um erro.","oam_modal_header":"Você está saindo da Amazon","offline_error_message":"Ah, não, perdemos a conexão.\\nVerifique sua Internet e, em seguida, vamos tentar novamente.","rufus_panel_close":"Fechar painel Rufus"}},"pt-PT":{"strings":{"completed_generating_a_response":"O Rufus acabou de gerar uma resposta","currently_generating_a_response":"O Rufus está atualmente a gerar uma resposta","default_error_message":"Ocorreu um erro. Tente novamente mais tarde.","general_error_message":"Lamentamos, mas ocorreu um erro.","oam_modal_header":"Está a sair da Amazon","offline_error_message":"Perdemos a ligação.\\nVerifique novamente a ligação à Internet e, em seguida, vamos tentar novamente.","rufus_panel_close":"Fechar painel do Rufus"}}}')},2300(e){"use strict";e.exports=JSON.parse('{"ja":{"strings":{"completed_generating_a_response":"ルーファスは応答の生成を完了しました","currently_generating_a_response":"Rufusは現在応答を生成しています","customer_question":"お客様の質問","default_error_message":"問題が発生しました。 しばらくしてから、もう一度お試しください。","general_error_message":"申し訳ありませんが、問題が発生しました。","oam_modal_header":"Amazonから移動します","offline_error_message":"申し訳ありませんが、接続が切断されました。\\nインターネットを再確認してから、もう一度試してみましょう。","rufus_panel_close":"ルーファスパネルを閉じる","rufus_panel_dock":"Dock Rufus panel","rufus_panel_open":"ルーファスパネルを開く","rufus_panel_undock":"Undock Rufus panel"}}}')},2784(e,t,n){"use strict";e.exports=n(8279)},2960(e,t,n){var r=n(3303).default;e.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(r(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports},3007(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}var i=n(7520)();e.exports=i;try{regeneratorRuntime=i}catch(e){"object"===("undefined"==typeof globalThis?"undefined":r(globalThis))?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}},3132(e,t,n){var r=n(2032);e.exports=function(e,t,n,i,a){var o=r(e,t,n,i,a);return o.next().then(function(e){return e.done?e.value:o.next()})},e.exports.__esModule=!0,e.exports.default=e.exports},3278(e){"use strict";e.exports=JSON.parse('{"ar":{"strings":{"completed_generating_a_response":"أكمل Rufus توليد الاستجابة","currently_generating_a_response":"يقوم Rufus حاليًا بتوليد استجابة","customer_question":"سؤال العميل","default_error_message":"حدث خطأ ما. يرجى المحاولة مرة أخرى لاحقًا.","general_error_message":"عذرًا، لقد حدث خطأ ما.","oam_modal_header":"أنت تغادر أمازون","offline_error_message":"عذرًا، فقدنا الاتصال.\\nتحقّق مرة أخرى من الإنترنت الخاص بك، ثم دعنا نجرّب ذلك مرة أخرى.","rufus_panel_close":"أغلق لوحة Rufus","rufus_panel_dock":"Dock Rufus panel","rufus_panel_open":"افتح لوحة Rufus","rufus_panel_undock":"Undock Rufus panel"}}}')},3303(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},3743(e){"use strict";e.exports=JSON.parse('{"ko":{"strings":{"completed_generating_a_response":"Rufus가 응답 생성을 완료했습니다.","currently_generating_a_response":"Rufus가 현재 응답을 생성 중입니다.","customer_question":"고객 질문","default_error_message":"문제가 발생했습니다. 나중에 다시 시도하세요.","general_error_message":"죄송하지만 문제가 발생했습니다.","oam_modal_header":"아마존을 종료합니다","offline_error_message":"이런, 연결이 끊겼네요.\\n인터넷을 다시 한 번 확인한 다음 다시 시도해 보죠.","rufus_panel_close":"Rufus 패널 닫기","rufus_panel_dock":"Dock Rufus panel","rufus_panel_open":"Rufus 패널 열기","rufus_panel_undock":"Undock Rufus panel"}}}')},3798(e){e.exports=function(e){var t=Object(e),n=[];for(var r in t)n.unshift(r);return function e(){for(;n.length;)if((r=n.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports},3847(e){"use strict";e.exports=JSON.parse('{"zh":{"strings":{"rufus_panel_dock":"Dock Rufus panel","rufus_panel_undock":"Undock Rufus panel"}},"zh-CN":{"strings":{"completed_generating_a_response":"Rufus 已完成生成回复","currently_generating_a_response":"Rufus 目前正在生成回复","customer_question":"客户问题","default_error_message":"出错了。 请稍后再试。","general_error_message":"抱歉，出错了。","oam_modal_header":"您即将离开亚马逊","offline_error_message":"抱歉，我们的连接中断了。\\n仔细检查您的互联网连接，然后再试一次。","rufus_panel_close":"关闭 Rufus 面板","rufus_panel_open":"打开 Rufus 面板"}},"zh-TW":{"strings":{"completed_generating_a_response":"Rufus 已完成產生回應","currently_generating_a_response":"Rufus 目前正在產生回應","customer_question":"客戶問題","default_error_message":"發生錯誤。 請稍後再試一次。","general_error_message":"很抱歉，發生錯誤。","oam_modal_header":"您將離開 Amazon","offline_error_message":"哦不，我們的連線中斷了。\\n再次檢查您的網際網路，然後再試一次。","rufus_panel_close":"關閉 Rufus 面板","rufus_panel_open":"打開 Rufus 面板"}}}')},3907(e){e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports},4134(e,t,n){var r=n(7021);function i(){var t,n,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.toStringTag||"@@toStringTag";function u(e,i,a,o){var s=i&&i.prototype instanceof l?i:l,u=Object.create(s.prototype);return r(u,"_invoke",function(e,r,i){var a,o,s,u=0,l=i||[],d=!1,h={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return a=e,o=0,s=t,h.n=n,c}};function f(e,r){for(o=e,s=r,n=0;!d&&u&&!i&&n<l.length;n++){var i,a=l[n],f=h.p,v=a[2];e>3?(i=v===r)&&(s=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=t):a[0]<=f&&((i=e<2&&f<a[1])?(o=0,h.v=r,h.n=a[1]):f<v&&(i=e<3||a[0]>r||r>v)&&(a[4]=e,a[5]=r,h.n=v,o=0))}if(i||e>1)return c;throw d=!0,r}return function(i,l,v){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&f(l,v),o=l,s=v;(n=o<2?t:s)||!d;){a||(o?o<3?(o>1&&(h.n=-1),f(o,s)):h.n=s:h.v=s);try{if(u=2,a){if(o||(i="next"),n=a[i]){if(!(n=n.call(a,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,o<2&&(o=0)}else 1===o&&(n=a.return)&&n.call(a),o<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),o=1);a=t}else if((n=(d=h.n<0)?s:e.call(r,h))!==c)break}catch(e){a=t,o=1,s=e}finally{u=1}}return{value:n,done:d}}}(e,a,o),!0),u}var c={};function l(){}function d(){}function h(){}n=Object.getPrototypeOf;var f=[][o]?n(n([][o]())):(r(n={},o,function(){return this}),n),v=h.prototype=l.prototype=Object.create(f);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e}return d.prototype=h,r(v,"constructor",h),r(h,"constructor",d),d.displayName="GeneratorFunction",r(h,s,"GeneratorFunction"),r(v),r(v,s,"Generator"),r(v,o,function(){return this}),r(v,"toString",function(){return"[object Generator]"}),(e.exports=i=function(){return{w:u,m:p}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},4326(e,t,n){var r=n(3907),i=n(7021);e.exports=function e(t,n){function a(e,i,o,s){try{var u=t[e](i),c=u.value;return c instanceof r?n.resolve(c.v).then(function(e){a("next",e,o,s)},function(e){a("throw",e,o,s)}):n.resolve(c).then(function(e){u.value=e,o(u)},function(e){return a("throw",e,o,s)})}catch(e){s(e)}}var o;this.next||(i(e.prototype),i(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),i(this,"_invoke",function(e,t,r){function i(){return new n(function(t,n){a(e,r,t,n)})}return o=o?o.then(i,i):i()},!0)},e.exports.__esModule=!0,e.exports.default=e.exports},4438(e,t,n){"use strict";e.exports=n(5008)},5008(e,t,n){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}var i=n(5609),a=60103,o=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var s=60109,u=60110,c=60112;t.Suspense=60113;var l=60115,d=60116;if("function"==typeof Symbol&&Symbol.for){var h=Symbol.for;a=h("react.element"),o=h("react.portal"),t.Fragment=h("react.fragment"),t.StrictMode=h("react.strict_mode"),t.Profiler=h("react.profiler"),s=h("react.provider"),u=h("react.context"),c=h("react.forward_ref"),t.Suspense=h("react.suspense"),l=h("react.memo"),d=h("react.lazy")}var f="function"==typeof Symbol&&Symbol.iterator;function v(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m={};function E(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}function g(){}function _(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}E.prototype.isReactComponent={},E.prototype.setState=function(e,t){if("object"!==r(e)&&"function"!=typeof e&&null!=e)throw Error(v(85));this.updater.enqueueSetState(this,e,t,"setState")},E.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},g.prototype=E.prototype;var y=_.prototype=new g;y.constructor=_,i(y,E.prototype),y.isPureReactComponent=!0;var C={current:null},R=Object.prototype.hasOwnProperty,T={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,n){var r,i={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)R.call(t,r)&&!T.hasOwnProperty(r)&&(i[r]=t[r]);var u=arguments.length-2;if(1===u)i.children=n;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];i.children=c}if(e&&e.defaultProps)for(r in u=e.defaultProps)void 0===i[r]&&(i[r]=u[r]);return{$$typeof:a,type:e,key:o,ref:s,props:i,_owner:C.current}}function I(e){return"object"===r(e)&&null!==e&&e.$$typeof===a}var A=/\/+/g;function O(e,t){return"object"===r(e)&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function b(e,t,n,i,s){var u=r(e);"undefined"!==u&&"boolean"!==u||(e=null);var c=!1;if(null===e)c=!0;else switch(u){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case a:case o:c=!0}}if(c)return s=s(c=e),e=""===i?"."+O(c,0):i,Array.isArray(s)?(n="",null!=e&&(n=e.replace(A,"$&/")+"/"),b(s,t,n,"",function(e){return e})):null!=s&&(I(s)&&(s=function(e,t){return{$$typeof:a,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,n+(!s.key||c&&c.key===s.key?"":(""+s.key).replace(A,"$&/")+"/")+e)),t.push(s)),1;if(c=0,i=""===i?".":i+":",Array.isArray(e))for(var l=0;l<e.length;l++){var d=i+O(u=e[l],l);c+=b(u,t,n,d,s)}else if(d=function(e){return null===e||"object"!==r(e)?null:"function"==typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"==typeof d)for(e=d.call(e),l=0;!(u=e.next()).done;)c+=b(u=u.value,t,n,d=i+O(u,l++),s);else if("object"===u)throw t=""+e,Error(v(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return c}function L(e,t,n){if(null==e)return e;var r=[],i=0;return b(e,r,"","",function(e){return t.call(n,e,i++)}),r}function P(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then(function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)},function(t){0===e._status&&(e._status=2,e._result=t)})}if(1===e._status)return e._result;throw e._result}var N={current:null};function k(){var e=N.current;if(null===e)throw Error(v(321));return e}var U={ReactCurrentDispatcher:N,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:C,IsSomeRendererActing:{current:!1},assign:i};t.Children={map:L,forEach:function(e,t,n){L(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return L(e,function(){t++}),t},toArray:function(e){return L(e,function(e){return e})||[]},only:function(e){if(!I(e))throw Error(v(143));return e}},t.Component=E,t.PureComponent=_,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=U,t.cloneElement=function(e,t,n){if(null==e)throw Error(v(267,e));var r=i({},e.props),o=e.key,s=e.ref,u=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,u=C.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)R.call(t,l)&&!T.hasOwnProperty(l)&&(r[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)r.children=n;else if(1<l){c=Array(l);for(var d=0;d<l;d++)c[d]=arguments[d+2];r.children=c}return{$$typeof:a,type:e.type,key:o,ref:s,props:r,_owner:u}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:u,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=S,t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=I,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:P}},t.memo=function(e,t){return{$$typeof:l,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return k().useCallback(e,t)},t.useContext=function(e,t){return k().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return k().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return k().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return k().useLayoutEffect(e,t)},t.useMemo=function(e,t){return k().useMemo(e,t)},t.useReducer=function(e,t,n){return k().useReducer(e,t,n)},t.useRef=function(e){return k().useRef(e)},t.useState=function(e){return k().useState(e)},t.version="17.0.1"},5609(e){"use strict";var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,i){for(var a,o,s=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),u=1;u<arguments.length;u++){for(var c in a=Object(arguments[u]))n.call(a,c)&&(s[c]=a[c]);if(t){o=t(a);for(var l=0;l<o.length;l++)r.call(a,o[l])&&(s[o[l]]=a[o[l]])}}return s}},7021(e){function t(n,r,i,a){var o=Object.defineProperty;try{o({},"",{})}catch(n){o=0}e.exports=t=function(e,n,r,i){function a(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?o?o(e,n,{value:r,enumerable:!i,configurable:!i,writable:!i}):e[n]=r:(a("next",0),a("throw",1),a("return",2))},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r,i,a)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},7520(e,t,n){var r=n(3907),i=n(4134),a=n(3132),o=n(2032),s=n(4326),u=n(3798),c=n(2960);function l(){"use strict";var t=i(),n=t.m(l),d=(Object.getPrototypeOf?Object.getPrototypeOf(n):n.__proto__).constructor;function h(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))}var f={throw:1,return:2,break:3,continue:3};function v(e){var t,n;return function(r){t||(t={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(e,t){return n(r.a,f[e],t)},delegateYield:function(e,i,a){return t.resultName=i,n(r.d,c(e),a)},finish:function(e){return n(r.f,e)}},n=function(e,n,i){r.p=t.prev,r.n=t.next;try{return e(n,i)}finally{t.next=r.n}}),t.resultName&&(t[t.resultName]=r.v,t.resultName=void 0),t.sent=r.v,t.next=r.n;try{return e.call(this,t)}finally{r.p=t.prev,r.n=t.next}}}return(e.exports=l=function(){return{wrap:function(e,n,r,i){return t.w(v(e),n,r,i&&i.reverse())},isGeneratorFunction:h,mark:t.m,awrap:function(e,t){return new r(e,t)},AsyncIterator:s,async:function(e,t,n,r,i){return(h(t)?o:a)(v(e),t,n,r,i)},keys:u,values:c}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=l,e.exports.__esModule=!0,e.exports.default=e.exports},7992(e){"use strict";e.exports=JSON.parse('{"it":{"strings":{"completed_generating_a_response":"Rufus ha completato la generazione di una risposta","currently_generating_a_response":"Rufus sta attualmente generando una risposta","customer_question":"Domanda del cliente","default_error_message":"Si è verificato un errore. Riprova più tardi.","general_error_message":"Siamo spiacenti, ma si è verificato un problema.","oam_modal_header":"Stai uscendo da Amazon","offline_error_message":"Oh no, abbiamo perso la connessione.\\nRicontrolla la connessione internet, poi riproviamo.","rufus_panel_close":"Chiudi il pannello Rufus","rufus_panel_dock":"Dock Rufus panel","rufus_panel_open":"Apri il pannello Rufus","rufus_panel_undock":"Undock Rufus panel"}}}')},8090(e,t,n){"use strict";e.exports=n(1052)},8279(e,t,n){"use strict";var r=n(4438),i="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=r.useState,o=r.useEffect,s=r.useLayoutEffect,u=r.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!i(e,n)}catch(e){return!0}}var l="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=a({inst:{value:n,getSnapshot:t}}),i=r[0].inst,l=r[1];return s(function(){i.value=n,i.getSnapshot=t,c(i)&&l({inst:i})},[e,n,t]),o(function(){return c(i)&&l({inst:i}),e(function(){c(i)&&l({inst:i})})},[e]),u(n),n};t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:l},8295(e,t,n){"use strict";var r=n(1458),i={codecs:{}};i.codecs.Codec=function(){return{encode:function(e,t){for(var n="",r=0;r<t.length;r++){var i=t.charAt(r);n+=this.encodeCharacter(e,i)}return n},encodeCharacter:function(e,t){return t},decode:function(e){for(var t="",n=new i.codecs.PushbackString(e);n.hasNext();){var r=this.decodeCharacter(n);t+=null!=r?r:n.next()}return t},decodeCharacter:function(e){return e.next()}}},i.codecs.Codec.getHexForNonAlphanumeric=function(e){return e.charCodeAt(0)<256?i.codecs.Codec.hex[e.charCodeAt(0)]:e.charCodeAt(0).toString(16)},i.codecs.Codec.hex=[];for(var a=0;a<255;a++)i.codecs.Codec.hex[a]=a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122?null:a.toString(16);i.codecs.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){if(!e)return null;for(var t,n,r,a,o,s,u,c="",l=0,d=i.codecs.UTF8.encode(e);l<d.length;)a=(t=d.charCodeAt(l++))>>2,o=(3&t)<<4|(n=d.charCodeAt(l++))>>4,s=(15&n)<<2|(r=d.charCodeAt(l++))>>6,u=63&r,isNaN(n)?s=u=64:isNaN(r)&&(u=64),c+=this._keyStr.charAt(a)+this._keyStr.charAt(o)+this._keyStr.charAt(s)+this._keyStr.charAt(u);return c},decode:function(e){if(!e)return null;for(var t,n,r,a,o,s,u="",c=0,l=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<l.length;)t=this._keyStr.indexOf(l.charAt(c++))<<2|(a=this._keyStr.indexOf(l.charAt(c++)))>>4,n=(15&a)<<4|(o=this._keyStr.indexOf(l.charAt(c++)))>>2,r=(3&o)<<6|(s=this._keyStr.indexOf(l.charAt(c++))),u+=String.fromCharCode(t),64!=o&&(u+=String.fromCharCode(n)),64!=s&&(u+=String.fromCharCode(r));return i.codecs.UTF8.decode(u)}},i.codecs.CSSCodec=function(){var e=new i.codecs.Codec;return{encode:e.encode,decode:e.decode,encodeCharacter:function(e,t){if(r.contains(e,t))return t;var n=i.codecs.Codec.getHexForNonAlphanumeric(t);return null==n?t:"\\"+n+" "},decodeCharacter:function(e){e.mark();var t=e.next();if(null==t)return e.reset(),null;if("\\"!=t)return e.reset(),null;var n=e.next();if(null==n)return e.reset(),null;if(e.isHexDigit(n)){for(var r=n,i=0;i<6;i++){var a=e.next();if(null==a||32==a.charCodeAt(0))break;if(!e.isHexDigit(a)){input.pushback(a);break}r+=a}try{var o=parseInt(r,16);return String.fromCharCode(o)}catch(t){return e.reset(),null}}return n}}};var o=[];o["&quot"]="34",o["&amp"]="38",o["&lt"]="60",o["&gt"]="62",o["&nbsp"]="160",o["&iexcl"]="161",o["&cent"]="162",o["&pound"]="163",o["&curren"]="164",o["&yen"]="165",o["&brvbar"]="166",o["&sect"]="167",o["&uml"]="168",o["&copy"]="169",o["&ordf"]="170",o["&laquo"]="171",o["&not"]="172",o["&shy"]="173",o["&reg"]="174",o["&macr"]="175",o["&deg"]="176",o["&plusmn"]="177",o["&sup2"]="178",o["&sup3"]="179",o["&acute"]="180",o["&micro"]="181",o["&para"]="182",o["&middot"]="183",o["&cedil"]="184",o["&sup1"]="185",o["&ordm"]="186",o["&raquo"]="187",o["&frac14"]="188",o["&frac12"]="189",o["&frac34"]="190",o["&iquest"]="191",o["&Agrave"]="192",o["&Aacute"]="193",o["&Acirc"]="194",o["&Atilde"]="195",o["&Auml"]="196",o["&Aring"]="197",o["&AElig"]="198",o["&Ccedil"]="199",o["&Egrave"]="200",o["&Eacute"]="201",o["&Ecirc"]="202",o["&Euml"]="203",o["&Igrave"]="204",o["&Iacute"]="205",o["&Icirc"]="206",o["&Iuml"]="207",o["&ETH"]="208",o["&Ntilde"]="209",o["&Ograve"]="210",o["&Oacute"]="211",o["&Ocirc"]="212",o["&Otilde"]="213",o["&Ouml"]="214",o["&times"]="215",o["&Oslash"]="216",o["&Ugrave"]="217",o["&Uacute"]="218",o["&Ucirc"]="219",o["&Uuml"]="220",o["&Yacute"]="221",o["&THORN"]="222",o["&szlig"]="223",o["&agrave"]="224",o["&aacute"]="225",o["&acirc"]="226",o["&atilde"]="227",o["&auml"]="228",o["&aring"]="229",o["&aelig"]="230",o["&ccedil"]="231",o["&egrave"]="232",o["&eacute"]="233",o["&ecirc"]="234",o["&euml"]="235",o["&igrave"]="236",o["&iacute"]="237",o["&icirc"]="238",o["&iuml"]="239",o["&eth"]="240",o["&ntilde"]="241",o["&ograve"]="242",o["&oacute"]="243",o["&ocirc"]="244",o["&otilde"]="245",o["&ouml"]="246",o["&divide"]="247",o["&oslash"]="248",o["&ugrave"]="249",o["&uacute"]="250",o["&ucirc"]="251",o["&uuml"]="252",o["&yacute"]="253",o["&thorn"]="254",o["&yuml"]="255",o["&OElig"]="338",o["&oelig"]="339",o["&Scaron"]="352",o["&scaron"]="353",o["&Yuml"]="376",o["&fnof"]="402",o["&circ"]="710",o["&tilde"]="732",o["&Alpha"]="913",o["&Beta"]="914",o["&Gamma"]="915",o["&Delta"]="916",o["&Epsilon"]="917",o["&Zeta"]="918",o["&Eta"]="919",o["&Theta"]="920",o["&Iota"]="921",o["&Kappa"]="922",o["&Lambda"]="923",o["&Mu"]="924",o["&Nu"]="925",o["&Xi"]="926",o["&Omicron"]="927",o["&Pi"]="928",o["&Rho"]="929",o["&Sigma"]="931",o["&Tau"]="932",o["&Upsilon"]="933",o["&Phi"]="934",o["&Chi"]="935",o["&Psi"]="936",o["&Omega"]="937",o["&alpha"]="945",o["&beta"]="946",o["&gamma"]="947",o["&delta"]="948",o["&epsilon"]="949",o["&zeta"]="950",o["&eta"]="951",o["&theta"]="952",o["&iota"]="953",o["&kappa"]="954",o["&lambda"]="955",o["&mu"]="956",o["&nu"]="957",o["&xi"]="958",o["&omicron"]="959",o["&pi"]="960",o["&rho"]="961",o["&sigmaf"]="962",o["&sigma"]="963",o["&tau"]="964",o["&upsilon"]="965",o["&phi"]="966",o["&chi"]="967",o["&psi"]="968",o["&omega"]="969",o["&thetasym"]="977",o["&upsih"]="978",o["&piv"]="982",o["&ensp"]="8194",o["&emsp"]="8195",o["&thinsp"]="8201",o["&zwnj"]="8204",o["&zwj"]="8205",o["&lrm"]="8206",o["&rlm"]="8207",o["&ndash"]="8211",o["&mdash"]="8212",o["&lsquo"]="8216",o["&rsquo"]="8217",o["&sbquo"]="8218",o["&ldquo"]="8220",o["&rdquo"]="8221",o["&bdquo"]="8222",o["&dagger"]="8224",o["&Dagger"]="8225",o["&bull"]="8226",o["&hellip"]="8230",o["&permil"]="8240",o["&prime"]="8242",o["&Prime"]="8243",o["&lsaquo"]="8249",o["&rsaquo"]="8250",o["&oline"]="8254",o["&frasl"]="8260",o["&euro"]="8364",o["&image"]="8365",o["&weierp"]="8472",o["&real"]="8476",o["&trade"]="8482",o["&alefsym"]="8501",o["&larr"]="8592",o["&uarr"]="8593",o["&rarr"]="8594",o["&darr"]="8595",o["&harr"]="8596",o["&crarr"]="8629",o["&lArr"]="8656",o["&uArr"]="8657",o["&rArr"]="8658",o["&dArr"]="8659",o["&hArr"]="8660",o["&forall"]="8704",o["&part"]="8706",o["&exist"]="8707",o["&empty"]="8709",o["&nabla"]="8711",o["&isin"]="8712",o["&notin"]="8713",o["&ni"]="8715",o["&prod"]="8719",o["&sum"]="8721",o["&minus"]="8722",o["&lowast"]="8727",o["&radic"]="8730",o["&prop"]="8733",o["&infin"]="8734",o["&ang"]="8736",o["&and"]="8743",o["&or"]="8744",o["&cap"]="8745",o["&cup"]="8746",o["&int"]="8747",o["&there4"]="8756",o["&sim"]="8764",o["&cong"]="8773",o["&asymp"]="8776",o["&ne"]="8800",o["&equiv"]="8801",o["&le"]="8804",o["&ge"]="8805",o["&sub"]="8834",o["&sup"]="8835",o["&nsub"]="8836",o["&sube"]="8838",o["&supe"]="8839",o["&oplus"]="8853",o["&otimes"]="8855",o["&perp"]="8869",o["&sdot"]="8901",o["&lceil"]="8968",o["&rceil"]="8969",o["&lfloor"]="8970",o["&rfloor"]="8971",o["&lang"]="9001",o["&rang"]="9002",o["&loz"]="9674",o["&spades"]="9824",o["&clubs"]="9827",o["&hearts"]="9829",o["&diams"]="9830";var s=[];for(var u in o)s[o[u]]=u;i.codecs.HTMLEntityCodec=function(){var e=new i.codecs.Codec;return{encode:e.encode,decode:e.decode,encodeCharacter:function(e,t){if(r.contains(e,t))return t;var n=i.codecs.Codec.getHexForNonAlphanumeric(t);if(null==n)return t;var a=t.charCodeAt(0);if(a<=31&&"\t"!=t&&"\n"!=t&&"\r"!=t||a>=127&&a<=159||" "==t)return" ";var o=s[a];return null!=o?o+";":"&#x"+n+";"},decodeCharacter:function(e){var t=e;t.mark();var n=t.next();if(null==n||"&"!=n)return t.reset(),null;var i=t.next();if(null==i)return t.reset(),null;if("#"==i){var a=function(e){var t=e.peek();return null==t?null:"x"==t||"X"==t?(e.next(),function(e){for(var t="";e.hasNext();){var n=e.peek();if(!n.match(/[0-9A-Fa-f]/)){if(";"==n){e.next();break}break}t+=n,e.next()}try{return parseInt(t,16)}catch(e){return null}}(e)):function(e){for(var t="";e.hasNext();){var n=e.peek();if(!n.match(/[0-9]/)){if(";"==n){e.next();break}break}t+=n,e.next()}try{return parseInt(t)}catch(e){return null}}(e)}(t);if(null!=a)return a}else if(i.match(/[A-Za-z]/)&&(t.pushback(i),a=function(e){for(var t="";e.hasNext();){var n=e.peek();if(n.match(/[A-Za-z]/)){if(t+=n,e.next(),r.containsKey(o,"&"+t)){e.peek(";")&&e.next();break}}else{if(";"!=n)break;e.next()}}return String.fromCharCode(o.getCaseInsensitive("&"+t))}(t),null!=a))return a;return t.reset(),null}}},i.codecs.JavascriptCodec=function(){return{encode:function(e,t){for(var n="",a=0;a<t.length;a++){var o=t.charAt(a);if(r.contains(e,o))n+=o;else if(null==i.codecs.Codec.getHexForNonAlphanumeric(o))n+=o;else{var s=o.charCodeAt(0).toString(16);if(o.charCodeAt(0)<256){var u="00".substr(s.length);n+="\\x"+u+s.toUpperCase()}else n+="\\u"+(u="0000".substr(s.length))+s.toUpperCase()}}return n},decode:(new i.codecs.Codec).decode,decodeCharacter:function(e){e.mark();var t=e.next();if(null==t)return e.reset(),null;if("\\"!=t)return e.reset(),null;var n=e.next();if(null==n)return e.reset(),null;if("b"==n)return 8;if("t"==n)return 9;if("n"==n)return 10;if("v"==n)return 11;if("f"==n)return 12;if("r"==n)return 13;if('"'==n)return 34;if("'"==n)return 39;if("\\"==n)return 92;if("x"==n.toLowerCase()){o="";for(var r=0;r<2;r++){var i=e.nextHex();if(null==i)return input.reset(),null;o+=i}try{return a=parseInt(o,16),String.fromCharCode(a)}catch(t){return e.reset(),null}}else if("u"==n.toLowerCase()){for(o="",r=0;r<4;r++){if(null==(i=e.nextHex()))return input.reset(),null;o+=i}try{var a=parseInt(o,16);return String.fromCharCode(a)}catch(t){return e.reset(),null}}else if(e.isOctalDigit(n)){var o=n,s=e.next();if(e.isOctalDigit(s)){o+=s;var u=e.next();e.isOctalDigit(u)?o+=u:e.pushback(u)}else e.pushback(s);try{return a=parseInt(o,8),String.fromCharCode(a)}catch(t){return e.reset(),null}}return n}}},i.codecs.PercentCodec=function(){var e=new i.codecs.Codec,t=function(e){var t="";if(e<-128||e>127)throw new IllegalArgumentException("b is not a byte (was "+e+")");return(e&=255)<16&&(t+="0"),t+e.toString(16).toUpperCase()};return{encode:e.encode,decode:e.decode,encodeCharacter:function(e,n){if("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".indexOf(n)>-1)return n;for(var r=i.codecs.UTF8.encode(n),a="",o=0;o<r.length;o++)a+="%"+t(r.charCodeAt(o));return a},decodeCharacter:function(e){e.mark();var t=e.next();if(null==t||"%"!=t)return e.reset(),null;for(var n="",r=0;r<2;r++){var i=e.nextHex();null!=i&&(n+=i)}if(2==n.length)try{var a=parseInt(n,16);return String.fromCharCode(a)}catch(e){}return e.reset(),null}}},i.codecs.PushbackString=function(e){var t=e,n="",r="",i=0,a=0;return{pushback:function(e){n=e},index:function(){return i},hasNext:function(){return null!=n||!(null==t||0==t.length||i>=t.length)},next:function(){if(null!=n){var e=n;return n=null,e}return null==t||0==t.length||i>=t.length?null:t.charAt(i++)},nextHex:function(){var e=this.next();return this.isHexDigit(e)?e:null},nextOctal:function(){var e=this.next();return this.isOctalDigit(e)?e:null},isHexDigit:function(e){return null!=e&&(e>="0"&&e<="9"||e>="a"&&e<="f"||e>="A"&&e<="F")},isOctalDigit:function(e){return null!=e&&e>="0"&&e<="7"},peek:function(e){return e?null!=n&&n==e||!(null==t||0==t.length||i>=t.length)&&t.charAt(i)==e:null!=n?n:null==t||0==t.length||i>=t.length?null:t.charAt(i)},mark:function(){r=n,a=i},reset:function(){n=r,i=a},remainder:function(){var e=t.substr(i);return null!=n&&(e=n+e),e}}},i.codecs.UTF8={encode:function(e){for(var t=e.replace(/\r\n/g,"\n"),n="",r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?n+=String.fromCharCode(i):i>127&&i<2048?(n+=String.fromCharCode(i>>6|192),n+=String.fromCharCode(63&i|128)):(n+=String.fromCharCode(i>>12|224),n+=String.fromCharCode(i>>6&63|128),n+=String.fromCharCode(63&i|128))}return n},decode:function(e){var t,n,r,i,a="";for(t=n=r=0;t<e.length;)(n=e.charCodeAt(t))<128?(a+=String.fromCharCode(n),t++):n>191&&n<224?(r=e.charCodeAt(t+1),a+=String.fromCharCode((31&n)<<6|63&r),t+=2):(r=utftext.charCodeAt(t+1),i=utftext.charCodeAt(t+2),String.fromCharCode((15&n)<<12|(63&r)<<6|63&i),t+=3);return a}},i.DefaultEncoder=function(e){var t=[],n=new i.codecs.HTMLEntityCodec,r=new i.codecs.JavascriptCodec,a=new i.codecs.CSSCodec,o=new i.codecs.PercentCodec;e?t=e:(t.push(n),t.push(r),t.push(a),t.push(o));var s=new Array(",",".","-","_"," "),u=new Array(",",".","-","_"),c=new Array,l=new Array(",",".","_");return{cananicalize:function(e,n){if(!e)return null;for(var r=e,a=null,o=1,s=0,u=!1;!u;)u=!0,t.each(function(e){r!=(r=e.decode(r))&&(null!=a&&a!=e&&o++,a=e,u&&s++,u=!1)});if(s>=2&&o>1){if(n)throw new i.IntrusionException("Input validation failure","Multiple ("+s+"x) and mixed encoding ("+o+"x) detected in "+e)}else if(s>=2){if(n)throw new i.IntrusionException("Input validation failure","Multiple ("+s+"x) encoding detected in "+e)}else if(o>1&&n)throw new i.IntrusionException("Input validation failure","Mixed ("+o+"x) encoding detected in "+e);return r},normalize:function(e){return e.replace(/[^\x00-\x7F]/g,"")},encodeForHTML:function(e){return e?n.encode(s,e):null},decodeForHTML:function(e){return e?n.decode(e):null},encodeForHTMLAttribute:function(e){return e?n.encode(u,e):null},encodeForCSS:function(e){return e?a.encode(c,e):null},encodeForJavaScript:function(e){return e?r.encode(l,e):null},encodeForJavascript:this.encodeForJavaScript,encodeForJS:this.encodeForJavascript,encodeForURL:function(e){return e?escape(e):null},decodeFromURL:function(e){return e?unescape(e):null},encodeForBase64:function(e){return e?i.codecs.Base64.encode(e):null},decodeFromBase64:function(e){return e?i.codecs.Base64.decode(e):null}}},e.exports={encoder:function(){return i.DefaultEncoder()},middleware:function(){return r.middleware}}},8494(e){"use strict";e.exports=JSON.parse('{"en":{"strings":{"completed_generating_a_response":"Rufus has completed generating a response","currently_generating_a_response":"Rufus is currently generating a response","customer_question":"Customer question","default_error_message":"Something went wrong. Please try again later.","general_error_message":"Sorry, but something went wrong.","oam_modal_header":"You\'re leaving Amazon","offline_error_message":"Oh no, we lost connection.\\nDouble check your internet, then let\'s try this again.","rufus_panel_close":"Close Rufus panel","rufus_panel_dock":"Dock Rufus panel","rufus_panel_open":"Open Rufus panel","rufus_panel_undock":"Undock Rufus panel"}},"en-CA":{"strings":{}},"en-GB":{"strings":{}},"en-IN":{"strings":{}},"en-US":{"strings":{}}}')},8925(e){"use strict";e.exports=JSON.parse('{"fr":{"strings":{"customer_question":"Question du client","general_error_message":"Nous sommes désolés, une erreur s’est produite.","oam_modal_header":"Vous quittez Amazon","rufus_panel_close":"Fermer le panneau Rufus","rufus_panel_dock":"Dock Rufus panel","rufus_panel_open":"Ouvrir le panneau Rufus","rufus_panel_undock":"Undock Rufus panel"}},"fr-CA":{"strings":{"completed_generating_a_response":"Rufus a terminé de générer une réponse","currently_generating_a_response":"Rufus génère actuellement une réponse","default_error_message":"Une erreur s’est produite. Veuillez réessayer plus tard.","offline_error_message":"Oh non, nous avons perdu la connexion.\\nVérifiez votre connexion Internet, puis essayons à nouveau."}},"fr-FR":{"strings":{"completed_generating_a_response":"Rufus a fini de générer une réponse","currently_generating_a_response":"Rufus est en train de générer une réponse","default_error_message":"Une erreur s\'est produite. Réessayez ultérieurement.","offline_error_message":"Oh non, nous avons perdu la connexion.\\nVérifiez à nouveau votre connexion Internet, puis réessayez."}}}')}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,r),a.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}function n(e,n,r){return(n=t(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function i(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function a(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function s(e){i(o,r,a,s,u,"next",e)}function u(e){i(o,r,a,s,u,"throw",e)}s(void 0)})}}var o=r(3007),s=r.n(o);function u(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,t(i.key),i)}}function c(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(t,n){if(n&&("object"==e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}var p=c(function e(){l(this,e)});n(p,"RUFUS_PANEL_STATE_PREFIX","RUFUS_PANEL_"),n(p,"RUFUS_PANEL_INFOCUS","RUFUS_PANEL_INFOCUS"),n(p,"RUFUS_PANEL_OUTFOCUS","RUFUS_PANEL_OUTFOCUS"),n(p,"RUFUS_THUMBSUP_CLICKED","RUFUS_THUMBSUP_CLICKED"),n(p,"RUFUS_PANEL_EXPANDED_BY_CX_ZEN","RUFUS_PANEL_EXPANDED_BY_CX_ZEN"),n(p,"RUFUS_THUMBSDOWN_CLICKED","RUFUS_THUMBSDOWN_CLICKED"),n(p,"RUFUS_CLOSE_CLICK_FROM_EXPANDED","RUFUS_CLOSE_CLICK_FROM_EXPANDED"),n(p,"RUFUS_CLOSE_CLICK_FROM_MINIMIZED","RUFUS_CLOSE_CLICK_FROM_MINIMIZED"),n(p,"RUFUS_ENTER_PRESSED_ON_INPUT_TEXT","RUFUS_ENTER_PRESSED_ON_INPUT_TEXT"),n(p,"RUFUS_SUBMIT_ON_INPUT_TEXT","RUFUS_SUBMIT_ON_INPUT_TEXT"),n(p,"RUFUS_PANEL_CONTAINER_INSTANTIATED","RUFUS_PANEL_CONTAINER_INSTANTIATED"),n(p,"RUFUS_FEEDBACK_OPTION_SUBMITTED","RUFUS_FEEDBACK_OPTION_SUBMITTED"),n(p,"RUFUS_FEEDBACK_TEXT_SUBMITTED","RUFUS_FEEDBACK_TEXT_SUBMITTED"),n(p,"RUFUS_SCROLL_DOWN_CLICKED","RUFUS_SCROLL_DOWN_CLICKED"),n(p,"RUFUS_TAB_ID_GENERATED","RUFUS_TAB_ID_GENERATED"),n(p,"RUFUS_STREAM_INTERRUPT","RUFUS_STREAM_INTERRUPT"),n(p,"RUFUS_RQ_CLICK","RUFUS_RQ_CLICK"),n(p,"RUFUS_OPEN_URL_CLICK_PREFIX","RUFUS_OPEN_URL_CLICK_"),n(p,"RUFUS_HYPERLINK_CLICK_PREFIX","RUFUS_HYPERLINK_CLICK_"),n(p,"RUFUS_PANEL_CACHE_INVALID","RUFUS_PANEL_CACHE_INVALID"),n(p,"RUFUS_PANEL_CACHE_VALID","RUFUS_PANEL_CACHE_VALID"),n(p,"RUFUS_BEGINNING_HISTORY_SHOWN","RUFUS_BEGINNING_HISTORY_SHOWN"),n(p,"RUFUS_HISTORY_BUTTON_SHOWN","RUFUS_HISTORY_BUTTON_SHOWN"),n(p,"RUFUS_SCROLL_TO_TOP","RUFUS_SCROLL_TO_TOP"),n(p,"FETCH_HISTORY","FETCH_HISTORY"),n(p,"FETCH_HISTORY_INTERRUPTION_RECOVERY","RUFUS_FETCH_HISTORY_INTERRUPTION_RECOVERY"),n(p,"FIRST_TIME_FETCH_HISTORY","FIRST_TIME_FETCH_HISTORY"),n(p,"LOAD_HISTORY_BUTTON_CLICK","LOAD_HISTORY_BUTTON_CLICK"),n(p,"RUFUS_NEW_CHAT_CLICK","RUFUS_NEW_CHAT_CLICK"),n(p,"RUFUS_SIGN_OUT","RUFUS_SIGN_OUT"),n(p,"RUFUS_ACTIVE_CONVERSATION_CONTAINER_IN_HISTORY_NULL","RUFUS_ACTIVE_CONVERSATION_CONTAINER_IN_HISTORY_NULL"),n(p,"RUFUS_HISTORY_CONTAINER_IN_HISTORY_NULL","RUFUS_HISTORY_CONTAINER_IN_HISTORY_NULL"),n(p,"RUFUS_HISTORY_OVERLAY_GO_BACK","RUFUS_HISTORY_OVERLAY_GO_BACK"),n(p,"RUFUS_HISTORY_OVERLAY_NEW_CHAT","RUFUS_HISTORY_OVERLAY_NEW_CHAT"),n(p,"RUFUS_PANEL_OVERFLOW_MENU_AUTO_MINIMIZE","RUFUS_PANEL_OVERFLOW_MENU_AUTO_MINIMIZE"),n(p,"RUFUS_PANEL_OVERFLOW_MENU_CHAT_HISTORY","RUFUS_PANEL_OVERFLOW_MENU_CHAT_HISTORY"),n(p,"RUFUS_PANEL_OVERFLOW_MENU_NEW_CHAT","RUFUS_PANEL_OVERFLOW_MENU_NEW_CHAT"),n(p,"RUFUS_PANEL_OVERFLOW_MENU_GET_STARTED","RUFUS_PANEL_OVERFLOW_MENU_GET_STARTED"),n(p,"RUFUS_DEALS_PILL_PRESENTED","RUFUS_DEALS_PILL_PRESENTED"),n(p,"RUFUS_DEALS_RQ_CLICK","RUFUS_DEALS_RQ_CLICK"),n(p,"RUFUS_WDCS_RQ_CLICK","RUFUS_WDCS_RQ_CLICK"),n(p,"RUFUS_RECOVERY_TEASER_CX_CLICK","RUFUS_RECOVERY_TEASER_CX_CLICK"),n(p,"RUFUS_RECOVERY_TEASER_CX_OPEN_PANEL","RUFUS_RECOVERY_TEASER_CX_OPEN_PANEL"),n(p,"INPUT_QUERY_MAX_LIMIT_REACHED","INPUT_QUERY_MAX_LIMIT_REACHED"),n(p,"RENDERED_ERROR_CODE_PREFIX","RENDERED_ERROR_CODE_"),n(p,"RUFUS_SECTION_WITHOUT_GROUP_SECTION_ID","RUFUS_SECTION_WITHOUT_GROUP_SECTION_ID"),n(p,"RUFUS_MULTIMODAL_IMAGE_SHOWN","RUFUS_MULTIMODAL_IMAGE_SHOWN"),n(p,"RUFUS_MULTIMODAL_IMAGE_CLICKED","RUFUS_MULTIMODAL_IMAGE_CLICKED"),n(p,"INTERRUPTION_RECOVERY_BUTTON_CLICK","INTERRUPTION_RECOVERY_BUTTON_CLICK"),n(p,"INTERRUPTION_RECOVERY_BUTTON_SHOWN","RUFUS_INTERRUPTION_RECOVERY_BUTTON_SHOWN"),n(p,"INTERRUPTION_RECOVERY_FAILED","RUFUS_INTERRUPTION_RECOVERY_FAILED"),n(p,"RUFUS_CLIENT_WEBLAB_TREATMENTS_PARSED","RUFUS_CLIENT_WEBLAB_TREATMENTS_PARSED"),n(p,"RUFUS_CSAI_OPENED","RUFUS_CSAI_OPENED"),n(p,"RUFUS_MULTIMODAL_DISMISS_BUTTON_CLICKED","RUFUS_MULTIMODAL_DISMISS_BUTTON_CLICKED"),n(p,"RUFUS_MULTIMODAL_POPOVER_SHOWN","RUFUS_MULTIMODAL_POPOVER_SHOWN"),n(p,"ERROR_ON_LOADING_HIGH_RES_IMAGE","ERROR_ON_LOADING_HIGH_RES_IMAGE"),n(p,"ERROR_ON_LOADING_LOW_RES_IMAGE","ERROR_ON_LOADING_LOW_RES_IMAGE"),n(p,"RUFUS_INSUFFICIENT_BROWSER_CAPABILITIES","RUFUS_INSUFFICIENT_BROWSER_CAPABILITIES"),n(p,"RUFUS_UNDEFINED_EVENT_SOURCE","RUFUS_UNDEFINED_EVENT_SOURCE"),n(p,"RUFUS_SSE_HANDLER_ERROR","RUFUS_SSE_HANDLER_ERROR"),n(p,"RUFUS_TIMEOUT","RUFUS_TIMEOUT"),n(p,"RUFUS_OFFLINE","RUFUS_OFFLINE"),n(p,"RUFUS_HANDLE_CONTEXT_CHUNK_ERROR","RUFUS_HANDLE_CONTEXT_CHUNK_ERROR"),n(p,"ERROR_ON_RENDERING_HIGH_RES_IMAGE","ERROR_ON_RENDERING_HIGH_RES_IMAGE"),n(p,"ERROR_ON_RENDERING_LOW_RES_IMAGE","ERROR_ON_RENDERING_LOW_RES_IMAGE"),n(p,"RUFUS_TEASER_AUTO_EXPANDS_CL","RUFUS_TEASER_AUTO_EXPANDS_CL"),n(p,"RUFUS_TEASER_WIDGET_BSR_SENT_TO_SEARCH","RUFUS_TEASER_WIDGET_BSR_SENT_TO_SEARCH"),n(p,"RUFUS_TEASER_RECOVERY_WIDGET_SENT_TO_SEARCH","RUFUS_TEASER_RECOVERY_WIDGET_SENT_TO_SEARCH"),n(p,"SECTION_REMOVED","SECTION_REMOVED"),n(p,"BULLET_POINT_VERTICAL_COLLAPSE","BULLET_POINT_VERTICAL_COLLAPSE"),n(p,"RUFUS_TWISTER_STREAMING_REQUEST","RUFUS_TWISTER_STREAMING_REQUEST"),n(p,"UNKNOWN_PATCH_ID_IN_BACKFILL_DATA","UNKNOWN_PATCH_ID_IN_BACKFILL_DATA"),n(p,"RUFUS_PRICING_INVALID_DATA","RUFUS_PRICING_INVALID_DATA"),n(p,"RUFUS_PRICING_RENDERING_ERROR","RUFUS_PRICING_RENDERING_ERROR"),n(p,"RUFUS_PRICING_CLIENT_NOT_LOADED","RUFUS_PRICING_CLIENT_NOT_LOADED"),n(p,"RASIN_INITIALIZE_SUCCESS","RASIN_INITIALIZE_SUCCESS"),n(p,"RASIN_INITIALIZATION_ERROR","RASIN_INITIALIZATION_ERROR"),n(p,"RASIN_CONVERSATION_REFINEMENT_SET","RASIN_CONVERSATION_REFINEMENT_SET"),n(p,"RASIN_CONVERSATION_REFINEMENT_CLEARED","RASIN_CONVERSATION_REFINEMENT_CLEARED"),n(p,"RASIN_CONVERSATION_REFINEMENT_SWAPPED","RASIN_CONVERSATION_REFINEMENT_SWAPPED"),n(p,"RASIN_FILTER_PILL_CLICK","RASIN_FILTER_PILL_CLICK"),n(p,"RASIN_FILTER_PILL_DISMISS_CLICK","RASIN_FILTER_PILL_DISMISS_CLICK"),n(p,"RASIN_RQ_PILL_CLICK","RASIN_RQ_PILL_CLICK"),n(p,"RASIN_CL_INPUT_QUERY","RASIN_CL_INPUT_QUERY"),n(p,"RUFUS_CART_COUNT_UPDATED","RUFUS_CART_COUNT_UPDATED"),n(p,"RUFUS_CART_PAGE_REFRESHED","RUFUS_CART_PAGE_REFRESHED"),n(p,"RUFUS_ATC_ACTION_UPDATE_CART_COUNT","RUFUS_ATC_ACTION_UPDATE_CART_COUNT"),n(p,"RUFUS_ATC_ACTION_REFRESH_CART_PAGE","RUFUS_ATC_ACTION_REFRESH_CART_PAGE"),n(p,"EXPANDABLE_PILLS_TOGGLE_CLICK","EXPANDABLE_PILLS_TOGGLE_CLICK"),n(p,"EXPANDABLE_PILLS_WEB_SEARCH_PILL_CLICK","EXPANDABLE_PILLS_WEB_SEARCH_PILL_CLICK"),n(p,"RUFUS_MOVABLE_CL_MOVED","RUFUS_MOVABLE_CL_MOVED"),n(p,"RUFUS_MOVABLE_CL_RESIZED","RUFUS_MOVABLE_CL_RESIZED"),n(p,"RUFUS_PANEL_RESIZE_START","RUFUS_PANEL_RESIZE_START"),n(p,"RUFUS_PANEL_RESIZE_END","RUFUS_PANEL_RESIZE_END"),n(p,"RUFUS_DOCKED_PANEL_WIDTH","RUFUS_DOCKED_PANEL_WIDTH"),n(p,"REACT_RENDERING_FAILURE","REACT_RENDERING_FAILURE"),n(p,"REACT_CHAT_HISTORY_RENDERING_FAILURE","REACT_CHAT_HISTORY_RENDERING_FAILURE"),n(p,"RUFUS_SHOP_DIRECT_CLICK","RUFUS_SHOP_DIRECT_CLICK"),n(p,"RUFUS_SHOP_DIRECT_MISSING_PAYLOAD","RUFUS_SHOP_DIRECT_MISSING_PAYLOAD"),n(p,"RUFUS_SHOP_DIRECT_MISSING_URL","RUFUS_SHOP_DIRECT_MISSING_URL"),n(p,"RUFUS_SHOP_DIRECT_MISSING_MERCHANT","RUFUS_SHOP_DIRECT_MISSING_MERCHANT"),n(p,"RUFUS_SHOP_DIRECT_MODAL_OPENED","RUFUS_SHOP_DIRECT_MODAL_OPENED"),n(p,"RUFUS_SHOP_DIRECT_MODAL_CLOSED","RUFUS_SHOP_DIRECT_MODAL_CLOSED"),n(p,"RUFUS_SHOP_DIRECT_FAILED_TO_SHOW_MODAL","RUFUS_SHOP_DIRECT_FAILED_TO_SHOW_MODAL"),n(p,"RUFUS_SHOP_DIRECT_FAILED_TO_CREATE_MODAL","RUFUS_SHOP_DIRECT_FAILED_TO_CREATE_MODAL"),n(p,"RUFUS_SHOP_DIRECT_EXCEPTION_WITH_MODAL","RUFUS_SHOP_DIRECT_EXCEPTION_WITH_MODAL"),n(p,"RUFUS_SHOP_DIRECT_TRANSLATION_ERROR","RUFUS_SHOP_DIRECT_TRANSLATION_ERROR"),n(p,"RUFUS_SHOP_DIRECT_MISSING_TEMPLATE","RUFUS_SHOP_DIRECT_MISSING_TEMPLATE"),n(p,"RUFUS_SHOP_DIRECT_HANDLER_ERROR","RUFUS_SHOP_DIRECT_HANDLER_ERROR"),n(p,"RUFUS_BUY_FOR_ME_CLICK","RUFUS_BUY_FOR_ME_CLICK"),n(p,"RUFUS_BUY_FOR_ME_HANDLER_ERROR","RUFUS_BUY_FOR_ME_HANDLER_ERROR"),n(p,"RUFUS_BUY_FOR_ME_MISSING_PAYLOAD","RUFUS_BUY_FOR_ME_MISSING_PAYLOAD"),n(p,"RUFUS_BUY_FOR_ME_INVALID_ASIN","RUFUS_BUY_FOR_ME_INVALID_ASIN"),n(p,"RUFUS_BUY_FOR_ME_SUCCESS","RUFUS_BUY_FOR_ME_SUCCESS"),n(p,"RUFUS_ATC_AJAX_FAILURE","RUFUS_ATC_AJAX_FAILURE"),n(p,"RUFUS_ATC_AJAX_SUCCESS","RUFUS_ATC_AJAX_SUCCESS"),n(p,"RUFUS_THREAD_ID_UNDEFINED","RUFUS_THREAD_ID_UNDEFINED"),n(p,"ASK_RUFUS_TOOLTIP_SHOWN","ASK_RUFUS_TOOLTIP_SHOWN"),n(p,"ASK_RUFUS_TOOLTIP_CLICK_INSIDE_PANEL","ASK_RUFUS_TOOLTIP_CLICK_INSIDE_PANEL"),n(p,"ASK_RUFUS_TOOLTIP_CLICK_OUTSIDE_PANEL","ASK_RUFUS_TOOLTIP_CLICK_OUTSIDE_PANEL"),n(p,"QUERY_SENT_WITH_SELECTED_TEXT_CONTEXT","QUERY_SENT_WITH_SELECTED_TEXT_CONTEXT");var m=c(function e(){l(this,e)});n(m,"PREFIX","rufus-dsk-section"),n(m,"GROUP_ID","data-csa-c-group-id"),n(m,"CONTENT_ID","data-csa-c-content-id"),n(m,"SLOT_ID","data-csa-c-slot-id"),n(m,"TYPE_ID","data-csa-c-type"),n(m,"SEQUENCE_ID","data-csa-c-sequence-id"),n(m,"REQUEST_ID","data-csa-c-nile-request-id"),n(m,"ACTION_ID","data-csa-c-nile-action-id");var E=c(function e(){l(this,e)});n(E,"STREAM_ERROR","STREAM_ERROR"),n(E,"STREAM_WITHOUT_ACTION","STREAM_WITHOUT_ACTION"),n(E,"STREAM_INTERRUPTION","STREAM_INTERRUPTION"),n(E,"STREAM_START","STREAM_START"),n(E,"SSE_STREAM_OPEN","SSE_STREAM_OPEN"),n(E,"SSE_STREAM_CLOSE","SSE_STREAM_CLOSE"),n(E,"STREAM_LAST_RENDERED_CHUNK","STREAM_LAST_RENDERED_CHUNK"),n(E,"RENDER_SUFFIX","-render"),n(E,"RECEIVE_SUFFIX","-receive"),n(E,"CHUNK_FIRST_SECTION_RENDER_SUFFIX","-chunk-first-section-render"),n(E,"CHUNK_LAST_SECTION_RENDER_SUFFIX","-chunk-last-section-render"),n(E,"FIRST_INFERENCE_CHUNK_RENDER_SUFFIX","first-inference-chunk-render");var g=c(function e(){l(this,e)});n(g,"RUFUS_FEEDBACK_LATENCY","RUFUS_FEEDBACK"),n(g,"RUFUS_HISTORY_LATENCY","RUFUS_HISTORY"),n(g,"RUFUS_INTERRUPTION_RECOVERY_LATENCY","RUFUS_HISTORY_INTERRUPTION_RECOVERY"),n(g,"RUFUS_LOW_RESOLUTION_IMAGE_LOADED_LATENCY","RUFUS_LOW_RESOLUTION_IMAGE_LOADED_LATENCY"),n(g,"RUFUS_HIGH_RESOLUTION_IMAGE_LOADED_LATENCY","RUFUS_HIGH_RESOLUTION_IMAGE_LOADED_LATENCY"),n(g,"RUFUS_LOW_RESOLUTION_IMAGE_RENDERED_LATENCY","RUFUS_LOW_RESOLUTION_IMAGE_RENDERED_LATENCY"),n(g,"RUFUS_HIGH_RESOLUTION_IMAGE_RENDERED_LATENCY","RUFUS_HIGH_RESOLUTION_IMAGE_RENDERED_LATENCY"),n(g,"UPDATE_CL_IMAGE_URL_TO_LOW_RES","UPDATE_CL_IMAGE_URL_TO_LOW_RES"),n(g,"RUFUS_PAPYRUS_DEPENDENCY_LOAD_LATENCY","RUFUS_PAPYRUS_DEPENDENCY_LOAD"),n(g,"RUFUS_PAPYRUS_CHAT_HISTORY_DEPENDENCY_LOAD_LATENCY","RUFUS_PAPYRUS_CHAT_HISTORY_DEPENDENCY_LOAD_LATENCY"),n(g,"RUFUS_PAPYRUS_DEPENDENCY_LAZY_LOAD_LATENCY","RUFUS_PAPYRUS_DEPENDENCY_LAZY_LOAD"),n(g,"RUFUS_PAPYRUS_CACHE_LOAD_LATENCY","RUFUS_PAPYRUS_CACHE_LOAD_LATENCY"),n(g,"RUFUS_PANEL_DRAG_LATENCY","RUFUS_PANEL_DRAG_LATENCY"),n(g,"RUFUS_PANEL_RESIZE_LATENCY","RUFUS_PANEL_RESIZE_LATENCY");var _=c(function e(){l(this,e)});n(_,"PANEL_RESIZE","PANEL_RESIZE"),n(_,"PANEL_RESIZE_RUFUS","PANEL_RESIZE_RUFUS"),n(_,"PANEL_CLOSE_CLICK","PANEL_CLOSE_CLICK"),n(_,"PANEL_MINIMIZE_CLICK","PANEL_MINIMIZE_CLICK"),n(_,"PANEL_EXPAND_CLICK","PANEL_EXPAND_CLICK"),n(_,"SCROLL_VIEW","SCROLL_VIEW"),n(_,"SCROLL_VIEW_END","SCROLL_VIEW_END"),n(_,"MAIN_FEEDBACK_REQUEST","MAIN_FEEDBACK_REQUEST"),n(_,"DETAIL_FEEDBACK_REQUEST","DETAIL_FEEDBACK_REQUEST"),n(_,"RUFUS_PANEL_OVERFLOW_MENU","RUFUS_PANEL_OVERFLOW_MENU"),n(_,"RUFUS_THREAD_HISTORY_OVERLAY","RUFUS_THREAD_HISTORY_OVERLAY"),n(_,"INPUT_TEXT_FOCUS","INPUT_TEXT_FOCUS"),n(_,"INPUT_TEXT_TRIGGER","INPUT_TEXT_TRIGGER"),n(_,"INPUT_TEXT_ERASE","INPUT_TEXT_ERASE"),n(_,"LOAD_HISTORY","LOAD_HISTORY"),n(_,"INVOKE_NILE","INVOKE_NILE"),n(_,"RUFUS_OPEN","RUFUS_OPEN"),n(_,"RUFUS_CLOSE","RUFUS_CLOSE"),n(_,"CONVERSATION_ABANDONMENT","CONVERSATION_ABANDONMENT"),n(_,"BACK_NAVIGATION","BACK_NAVIGATION"),n(_,"INTERRUPTION_RECOVERY_BUTTON_CLICK","INTERRUPTION_RECOVERY_BUTTON_CLICK"),n(_,"INTERRUPTION_RECOVERY_BUTTON_SHOWN","INTERRUPTION_RECOVERY_BUTTON_SHOWN"),n(_,"OPEN_MEDIA","OPEN_MEDIA"),n(_,"CLOSE_MEDIA","CLOSE_MEDIA"),n(_,"TEASER_AUTO_EXPANDS_CL","TEASER_AUTO_EXPANDS_CL"),n(_,"TEASER_WIDGET_BSR_SENT_TO_SEARCH","TEASER_WIDGET_BSR_SENT_TO_SEARCH"),n(_,"TEASER_RECOVERY_WIDGET_SENT_TO_SEARCH","TEASER_RECOVERY_WIDGET_SENT_TO_SEARCH"),n(_,"REMOVE_SECTION","REMOVE_SECTION"),n(_,"BULLET_POINT_VERTICAL_COLLAPSE","BULLET_POINT_VERTICAL_COLLAPSE"),n(_,"RUFUS_TWISTER_STREAMING_REQUEST_SENT","RUFUS_TWISTER_STREAMING_REQUEST_SENT"),n(_,"CONVERSATION_REFINEMENT_SET","CONVERSATION_REFINEMENT_SET"),n(_,"CONVERSATION_REFINEMENT_CLEARED","CONVERSATION_REFINEMENT_CLEARED"),n(_,"FILTER_PILL_CLICK","FILTER_PILL_CLICK"),n(_,"FILTER_PILL_DISMISS_CLICK","FILTER_PILL_DISMISS"),n(_,"RUFUS_MOVABLE_CL_MOVED","RUFUS_MOVABLE_CL_MOVED"),n(_,"RUFUS_MOVABLE_CL_RESIZED","RUFUS_MOVABLE_CL_RESIZED"),n(_,"ASK_RUFUS_TOOLTIP_CLICK","ASK_RUFUS_TOOLTIP_CLICK"),n(_,"QUERY_SENT_WITH_SELECTED_TEXT_CONTEXT","QUERY_SENT_WITH_SELECTED_TEXT_CONTEXT");var y=c(function e(){l(this,e)});n(y,"THUMBS_UP","THUMBS_UP"),n(y,"THUMBS_DOWN","THUMBS_DOWN"),n(y,"AUTO_MINIMIZE_ENABLE","AUTO_MINIMIZE_ENABLE"),n(y,"AUTO_MINIMIZE_DISABLE","AUTO_MINIMIZE_DISABLE"),n(y,"CHAT_HISTORY","CHAT_HISTORY"),n(y,"NEW_CHAT","NEW_CHAT"),n(y,"GET_STARTED","GET_STARTED"),n(y,"OVERFLOW_MENU_CLOSE","CLOSE"),n(y,"OVERFLOW_MENU_OPEN","OPEN"),n(y,"OVERLAY_CLOSE","OVERLAY_CLOSE"),n(y,"RUFUS_ICON_TAP","RUFUS_ICON_TAP"),n(y,"EXPANDED_TO_MINIMIZED","expanded_to_minimized"),n(y,"ASIN_REFINEMENT","asin_refinement"),n(y,"FILTER_PILL_INGRESS_PREFIX","filter_pill_ingress_"),n(y,"INSIDE_PANEL","inside_panel"),n(y,"OUTSIDE_PANEL","outside_panel");var C="rufus_panel",R=function(e){return e.FATAL="FATAL",e.ERROR="ERROR",e.WARN="WARN",e.DEBUG="DEBUG",e}({}),T=function(e){return e.ClickToATF="af",e.ClickToCF="cf",e.ClickToPageLoaded="ld",e.ClickToBodyBegin="bb",e.ClickToBodyEnd="be",e}({}),S=function(){function e(){l(this,e)}return c(e,null,[{key:"logErrorWithLevelWithException",value:function(e,t,n){var r=n?"".concat(n," ").concat(t.message):"".concat(t.message);if(window.ueLogError&&e!=R.DEBUG){var i={logLevel:e,attribution:C,message:"error occurred with following message ".concat(r)};window.ueLogError(t,i)}else console.error(t.message)}},{key:"logErrorWithLevel",value:function(e,t,n){if(window.ueLogError&&e!=R.DEBUG){var r={logLevel:e,attribution:C,message:"error occurred with following message: ".concat(t)};window.ueLogError(new Error(t),r)}else console.error(t);n&&this.addCount(n,1)}},{key:"recordTrigger",value:function(e,t,n){window.ue&&(n?window.ue.trigger(e,t,n):window.ue.trigger(e,t))}},{key:"setCount",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;window.ue&&window.ue.count(e,t)}},{key:"getCount",value:function(e){return window.ue&&window.ue.count&&null!=window.ue.count(e)?window.ue.count(e):0}},{key:"addCount",value:function(e,t){this.setCount(e,this.getCount(e)+t)}},{key:"logEvent",value:function(e,t,n){var r;null===(r=window.ue)||void 0===r||r.event(e,t,n)}},{key:"sendCsmFeatureLatency",value:function(e,t){window.uex&&(t?window.uex(T.ClickToPageLoaded,e,{wb:1},t):window.uex(T.ClickToPageLoaded,e,{wb:1}))}},{key:"logCsmFeatureLatency",value:function(e,t,n){window.uet&&(n?window.uet(e,t,{wb:1},n):window.uet(e,t,{wb:1}))}},{key:"fetchRequestIdFromCSMData",value:function(){return window.ue&&window.ue.id?window.ue.id:""}},{key:"widgetBodyBegin",value:function(t,n){e.logCsmFeatureLatency(T.ClickToBodyBegin,t,n)}},{key:"widgetBodyEnd",value:function(t,n,r){n||e.logCsmFeatureLatency(T.ClickToBodyEnd,t,r),e.sendCsmFeatureLatency(t,r)}}])}();function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function A(e,t){if(e){if("string"==typeof e)return I(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(e,t):void 0}}function O(e){return function(e){if(Array.isArray(e))return I(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||A(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var b=function(e){return e.HTML_CONTENT_TURN_START="html-content-turn-start",e.HTML_CONTENT="html-content",e.HTML_CONTENT_CONTEXTUAL_PILLS="html-content-contextual-pills",e.HTML_CONTENT_NEW_CHAT="html-content-new-chat",e.HTML_CONTENT_INTERRUPTION_RECOVERY="html-content-interruption-recovery",e.HTML_LOADER="html-loader",e}({}),L="rufus-conversation-container",N="rufus-conversation-loader-container",k="rufus-loader-avatar",U=36,D="rufus-scroll-button",M="rufus-active-conversation-container",w="rufus-history-container",F="conversation-turn-container",x="rufus-remove-section",H="rufus-initial-stream-container",B="rufus-contextual-pills-container",W="rufus-load-history-spinner-container",V=320,G=320,z="rufus-docked-resize-handle",j="https://m.media-amazon.com/images/G/01/Rufus_Desktop/thumbs_up_click-9ca6525e-fc19-41b9-b951-5c5f7bcb3f5a._CB559251617_._SY200_.png",Y="https://m.media-amazon.com/images/G/01/Rufus_Desktop/thumbs_down_click-a00e7dd1-e695-495e-b9f8-b462ef9adc71._CB559251617_._SY200_.png",K="nav-rufus-content",q="nav-flyout-rufus",X="nav-rufus-disco",Z="nav-rufus-disco-text",Q="nav-rufus-disco-avatar",J="rufus-panel-header-minimize",$="rufus-panel-header-close",ee="rufus-panel-resize-handle-unified",te="rufus-container-overlay",ne="rufus-container-main-view-overlay",re="rufus-panel-resize-handle-unified-overlay",ie="rufus-panel-overlay-header-content-row",ae=360,oe=400,se="ew-resize",ue="ns-resize",ce="nesw-resize",le="nwse-resize",de="grab",he="/rufus/cl/",fe=500,ve="rufus-panel-container-persistent-hover",pe="rufus-panel-expanded-to-closed",me=new Map([["docked-left_closed","rufus-panel-docked-left-to-closed"],["docked-right_closed","rufus-panel-docked-right-to-closed"],["closed_docked-left","rufus-panel-closed-to-docked-left"],["closed_docked-right","rufus-panel-closed-to-docked-right"],["docked-left_expanded","rufus-panel-docked-left-to-expanded"],["docked-right_expanded","rufus-panel-docked-right-to-expanded"],["expanded_docked-left","rufus-panel-expanded-to-docked-left"],["expanded_docked-right","rufus-panel-expanded-to-docked-right"]]),Ee=new Map([["expanded_minimized","rufus-panel-expanded-to-minimized"],["expanded_closed",pe],["minimized_expanded","rufus-panel-minimized-to-expanded"],["minimized_closed",pe],["closed_expanded","rufus-panel-closed-to-expanded"]]),ge=new Map([["expanded_minimized","rufus-panel-expanded-to-minimized-movable"],["expanded_closed","rufus-panel-expanded-to-closed-movable"],["minimized_expanded","rufus-panel-minimized-to-expanded-movable"],["minimized_closed",pe],["closed_expanded","rufus-panel-closed-to-expanded-movable"],["expanded_closed_right_ingress","rufus-panel-expanded-to-closed-movable-right-ingress"],["closed_expanded_right_ingress","rufus-panel-closed-to-expanded-movable-right-ingress"]]),_e=new Map([].concat(O(Ee),O(me))),ye=new Map([].concat(O(ge),O(me))),Ce=new Map([["¬¨‚àû","&deg;"],["¬¨‚àü","&trade;"],["¬¨‚àö","&reg;"],["¬¨‚àö©","&copy;"],["¬¨‚àû‚àö√≤","&hellip;"],["¬¨‚àû‚àö√ñ","&mdash;"],["¬¨‚àû‚àö√í","&ndash;"],["¬¨‚àö√∫","&lsquo;"],["¬¨‚àö√≠","&rsquo;"],["¬¨‚àö√¢","&ldquo;"],["¬¨‚àö√£","&rdquo;"]]),Re="rufus-overflow-menu-container",Te="rufus-overflow-menu-container-webapp",Se="rufus-overflow-menu-auto-minimize-toggle",Ie="rufus-new-chat-message-container",Ae="marketplaceId",Oe="IMPRESSIONS_CONTEXT_KEY",be="impressionsContextKey",Le=function(e){return e.HIDDEN="hidden",e.COLLAPSED="collapsed",e.EXPANDED="expanded",e.DOCKED_RIGHT="docked-right",e.DOCKED_LEFT="docked-left",e}({}),Pe=function(e){return e.FEEDBACK="nl_cl_dsk_fb",e.HISTORY="nl_cl_dsk_hist",e.CUSTOMER_SUBMITTED_QUERY="nl_cl_dsk_csq",e.RASIN_INGRESS_BUTTON_CLICK="nl_bp_ra_cl_ing",e.DP_FROM_FILTER_PILL="nl_cl_ra_fp",e}({}),Ne='[id^="section_groupId_"]',ke="data-rufus-sequenceid",Ue="data-section-class",De="development.amazon.com",Me="pre-prod.amazon.com",we="www.amazon.com",Fe="https://".concat(De,"/"),xe="https://".concat(Me,"/"),He="https://".concat(we,"/"),Be="api/marketplaces/ATVPDKIKX0DER/cart/carts/retail/items",We="https://".concat("data-us.integ.amazon.com","/").concat(Be),Ve="https://".concat("data-us-pre-prod.iad.corp.amazon.com","/").concat(Be),Ge="https://".concat("data.amazon.com","/").concat(Be),ze="rufus-thumbs-up",je="rufus-feedback-text",Ye="rufus-thumbs-down-feedback-box",Ke="rufus-submit-feedback-button",qe="rufus-submit-feedback-button-announce",Xe="rufus-thumbs-up-actions",Ze="rufus-thumbs-down-actions",Qe="MAIN_FEEDBACK",Je="THUMBS_DOWN",$e="rufus-conversation-papyrus-container",et="papyrus-wrapper",tt="suggestionList",nt="rufusIntroMessage-",rt="rufus-visibility-hidden",it="animation-complete",at="rufus-panel-container-dragging",ot=["dockedToExpandedScale","slideInFromRight","slideInFromLeft"],st="PlaceholderMessage",ut="CustomerText",ct="ReviewAspectPillCarousel",lt="AsinFaceoutList",dt="ReviewAspectFlow",ht="section_groupId_customer_text",ft=n(n(n(n(n(n({},b.HTML_CONTENT_CONTEXTUAL_PILLS,"rufus-html-turn-contextual-pills"),b.HTML_CONTENT_TURN_START,"rufus-html-turn-start"),b.HTML_CONTENT,"rufus-html-turn"),b.HTML_CONTENT_NEW_CHAT,"rufus-new-chat-message-container"),b.HTML_CONTENT_INTERRUPTION_RECOVERY,"rufus-html-turn-interruption-recovery"),b.HTML_LOADER,"rufus-html-loader"),vt=["Up","Down","ArrowUp","ArrowDown"],pt="Sorry, something went wrong.",mt="offline_error_message",Et="rufus-error-container",gt="initial_chunk_timeout",_t="midstream_timeout",yt="rufus-interrupted-stream-affordance-container",Ct="rufus-asin-filter-pill",Rt="rufus-asin-filter-pill-show",Tt="rufus-asin-filter-pill-hide",St="rufus-asin-filter-shade",It="rufus-asin-filter-shade-show",At="rufus-asin-filter-shade-hide",Ot="aok-hidden",bt="rufus-papyrus-ftux-enabled",Lt="rufus-papyrus-enabled",Pt="rufus-papyrus-mixed-rendering-enabled",Nt="rufus-papyrus-caching-enabled",kt="rufus-top-content-anchoring",Ut="rufus-docking-mode",Dt="rufus-papyrus-turn",Mt="rufus-papyrus-active-turn";function wt(e){var t=document.getElementById(q);if(t){var n=t.getElementsByTagName("input"),r=Array.from(n).find(function(t){return t.name===e});return r&&r.value?r.value:""}}function Ft(){return crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function xt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||A(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ht(){for(var e,t=navigator.userAgent,n="",r="",i=0,a=Object.entries({Chrome:/Chrome\/(\d+\.\d+\.\d+\.\d+)/i,Firefox:/Firefox\/(\d+\.\d+)/i,Safari:/Version\/(\d+(\.\d+)+)\s+Safari\/(\d+(\.\d+)+)/i,Edge:/Edge\/(\d+\.\d+\.\d+)/i,IE:/(MSIE |Trident\/\d+\.\d+;.*rv:(\d+\.\d+))/i});i<a.length;i++){var o=xt(a[i],2),s=o[0],u=o[1],c=t.match(u);if(c&&c.length>=2){n=s,r=c[1];break}}e=t.match(/Win(?:dows)?\s?(\d+\.\d+)?/)?"Windows":t.match(/Mac(?:intosh| OS X)?\s?(\d+_\d+(_\d+)?)?/)?"MacOS":t.match(/Linux/)?"Linux":"Other",Bt.getInstance().browserVersion="".concat(r),Wt.getInstance().browserName="".concat(n),Vt.getInstance().osType="".concat(e),Gt.getInstance().deviceVersion="".concat(e,"_").concat(n,"_").concat(r)}var Bt=function(){function e(){l(this,e),n(this,"_browserVersion","")}return c(e,[{key:"browserVersion",get:function(){return this._browserVersion},set:function(e){this._browserVersion=e}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}(),Wt=function(){function e(){l(this,e),n(this,"_browserName","")}return c(e,[{key:"browserName",get:function(){return this._browserName},set:function(e){this._browserName=e}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}(),Vt=function(){function e(){l(this,e),n(this,"_osType","")}return c(e,[{key:"osType",get:function(){return this._osType},set:function(e){this._osType=e}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}(),Gt=function(){function e(){l(this,e),n(this,"_deviceVersion","")}return c(e,[{key:"deviceVersion",get:function(){return this._deviceVersion},set:function(e){this._deviceVersion=e}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}(),zt=function(){function e(){l(this,e),n(this,"_tabId","")}return c(e,[{key:"tabId",get:function(){return this._tabId},set:function(e){this._tabId=e}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}(),jt=function(){function e(){l(this,e),n(this,"_nileRequestId","")}return c(e,[{key:"nileRequestId",get:function(){return this._nileRequestId},set:function(e){this._nileRequestId=e}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}();function Yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Kt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Yt(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yt(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var qt=function(e){return e.EVENT_SCHEMA="mshop.nile.events.5",e.LATENCY_SCHEMA_V2="mshop.nile.latency.6",e.IMPRESSION_SCHEMA="mshop.nile.impressions.1",e}({});function Xt(e){return{timestamp:(new Date).toISOString(),messageId:Ft(),nileRequestId:jt.getInstance().nileRequestId,clickstreamRequestId:jt.getInstance().nileRequestId,metadata:Zt(e),isBeta:!1,deviceTypeId:"",directedCustomerId:"",appVersion:Gt.getInstance().deviceVersion,locale:wt("locale"),marketplaceId:wt(Ae),uxSessionId:zt.getInstance().tabId,sessionId:Qt(),obfuscatedCustomerId:wt("customerId")}}function Zt(){var e=Kt({program:"nile-classic-desktop"},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return JSON.stringify(e)}function Qt(){var e="";try{var t=document.cookie.match(/(?:^|;)\s*session-id\s*=\s*([^\s;]+)/);t&&(e=t[1])}catch(t){e=""}return e}function Jt(e,t,n){var r=Kt(Kt({},Xt(n)),{},{eventName:e,eventDetail:t,eventTimeUTC:(new Date).toISOString()});S.logEvent(function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var r=t[n],i=e[r];null==i?i="":"number"==typeof i&&(i=i.toString()),e[r]=i}return e}(r),"desktop-nile",qt.EVENT_SCHEMA)}var $t,en=c(function e(t,n,r,i,a){l(this,e),this.action=t,this.query=n,this.sectionId=r,this.clickEventName=i,this.triggerElement=a}),tn=function(e){return e.POPUP="POPUP",e.SELF="SELF",e}({}),nn=function(e){return e.OPEN_URL="OPEN_URL",e.DISMISS="DISMISS",e.OPEN_MEDIA="OPEN_MEDIA",e.BOTTOM_SHEET_NAVIGATE="BOTTOM_SHEET_NAVIGATE",e.INVOKE_NILE_BACKEND_API="INVOKE_NILE_BACKEND_API",e.NEW_SEARCH_REQUEST="NEW_SEARCH_REQUEST",e.MAIN_FEEDBACK_REQUEST="MAIN_FEEDBACK_REQUEST",e.DETAILED_FEEDBACK_REQUEST="DETAILED_FEEDBACK_REQUEST",e.AD_FEEDBACK_REQUEST="AD_FEEDBACK_REQUEST",e.EXPAND_TO_CONTENT="EXPAND_TO_CONTENT",e.UPDATE_CART_COUNTER="UPDATE_CART_COUNTER",e.SHOP_DIRECT="SHOP_DIRECT",e.ADD_TO_CART="ADD_TO_CART",e.INVOKE_HISTORY_API="INVOKE_HISTORY_API",e.BUY_FOR_ME="BUY_FOR_ME",e}({}),rn=function(e){return e.SWIPE_UP="SWIPE_UP",e.ASIN_CLICK="ASIN_CLICK",e.SEARCH="SEARCH",e.CLOSE="CLOSE",e.UNKNOWN="UNKNOWN",e}({}),an=function(e){return e.FIRST_TIME_USER_MESSAGE_SEEN_STATUS="FIRST_TIME_USER_MESSAGE_SEEN_STATUS",e.MOVABLE_PANEL_TOOLTIP_SEEN_STATUS="MOVABLE_PANEL_TOOLTIP_SEEN_STATUS",e}({}),on=function(e){return e.SEEN="SEEN",e}({}),sn=function(e){return e.NILE_CL_TEXT_INPUT="NileCLTextInput",e.NILE_RELATED_QUESTION="NileRelatedQuestion",e.NILE_DEALS_RELATED_QUESTION="NileDealsRelatedQuestion",e.NILE_NDSWDCS_RELATED_QUESTION="NileNDSWDCSRelatedQuestion",e.NILE_ASIN_INGRESS="NileAsinIngress",e}({}),un=function(e){return e.NILE_OPTION_IN_AUTOCOMPLETE="NileOptionInAutocomplete",e.NILE_TEASER_CX_RECOVERY="NileTeaserRecovery",e.NILE_INGRESS_LINK="NileIngressLink",e}({}),cn=function(e,t){for(var n=e.children.length-t,r=0;r<n&&e.firstChild;r++)e.removeChild(e.firstChild)},ln=function(e){Array.from(e.children).forEach(function(t){0===t.children.length&&e.removeChild(t)})},dn=function(){var e=document.querySelector("#nav-flyout-rufus meta[name='anti-csrftoken-a2z']");return e&&e.getAttribute("content")||""},hn=function(){var e=document.querySelector('meta[name="flow-closure-id"]');if(e instanceof HTMLMetaElement&&e.content)return e.content},fn=function(e,t){var n=e.firstElementChild;if(n){e.style.width=t?"".concat(t,"px"):"100%";var r=n.getBoundingClientRect();r.width>0&&(e.style.width="".concat(r.width,"px"))}},vn=c(function e(){l(this,e)});function pn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}n(vn,"TEASER_CX_CUSTOMER_QUERY","tcxcq");var mn=function(){return c(function e(){l(this,e)},null,[{key:"extractQueryFromUrl",value:function(e){var t=this.capture(e,/[?&]k=([^&/]*)/i);return t?decodeURIComponent(t.replace(/\+/g," ")):void 0}},{key:"extractAsinFromUrl",value:function(e){var t=new RegExp("(?:/gp/aw/d/|/gp/product/|/dp/product/|/exec/obidos/ASIN/|/gp/video/detail/|/o/asin/|/exec/obidos/tg/detail/-/|.*?/dp/|.*?/d/|.*?%2Fdp%2F|[?&]asin=|.*?/vindp/)(?:[^/?]*?/)*(\\w{10}\\b)","i");return this.capture(e,t)}},{key:"extractGtiFromUrl",value:function(e){var t=new RegExp("/gp/video/detail/(\\w{26}|[\\w.]+gti.[0-9a-f]{8}-([0-9a-f]{4}-){3}[0-9a-f]{12})\\b","i");return this.capture(e,t)}},{key:"extractNileReftagFromUrl",value:function(e){if(void 0!==e){var t,n=/^(ref|ref_)(.*)$/,r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return pn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(new URL(e).searchParams.entries());try{for(r.s();!(t=r.n()).done;){var i=xt(t.value,2),a=i[0],o=i[1];if(n.exec(a)&&o.startsWith("nl_cl_"))return o}}catch(e){r.e(e)}finally{r.f()}}}},{key:"getOriginUrl",value:function(){return document.referrer}},{key:"getCurrentPageUrl",value:function(){return window.location.href}},{key:"extractQis",value:function(e){return this.capture(e,/[?&]qis=([^&]*)/)}},{key:"setReftagAndQisInTargetUrl",value:function(e,t){if(!t)return e;try{var n=new URL(e),r=new URL(t),i=r.searchParams.get("ref"),a=r.searchParams.get("qis");return i&&n.searchParams.set("ref",i),a&&n.searchParams.set("qis",a),n.toString()}catch(e){S.logErrorWithLevelWithException(R.ERROR,e,"Error updating targetUrl with metadata qis and ref: ".concat(e instanceof Error?"(".concat(e.message,")"):""))}return e}},{key:"capture",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(e.match(t)||[])[n]}},{key:"extractBaseUrl",value:function(e){if(e){var t=e.match(/^(https?:\/\/[^/]+)/);return t?t[1]:e}}}])}();$t=mn,n(mn,"metadataParsers",{DETAIL_PAGE:function(e){var t=$t.extractAsinFromUrl(e);if(t)return[{type:"ASIN",value:t}];var n=$t.extractGtiFromUrl(e);return n?[{type:"GTI",value:n}]:void 0},SEARCH_RESULTS:function(e){var t=$t.extractQueryFromUrl(e);if(void 0!==t)return[{type:"KEYWORDS",value:t}]}}),n(mn,"HOST_NAME_DOMAIN_MAPPING",n(n(n({},De,Fe),Me,xe),we,He)),n(mn,"AAPI_ENDPOINT_DOMAIN_MAPPING",n(n(n({},De,We),Me,Ve),we,Ge)),n(mn,"getUrlByDomain",function(e,t){return $t.HOST_NAME_DOMAIN_MAPPING[e]?"".concat($t.HOST_NAME_DOMAIN_MAPPING[e]).concat(t):void 0}),n(mn,"getAtcEndpointByDomain",function(e){if(e in $t.AAPI_ENDPOINT_DOMAIN_MAPPING)return $t.AAPI_ENDPOINT_DOMAIN_MAPPING[e]}),n(mn,"isDevoDomain",function(){return window.location.hostname===De}),n(mn,"getTeaserCXCustomerQueryFromURLQueryParam",function(e){var t,n=new URL(e);return decodeURIComponent(null!==(t=n.searchParams.get(vn.TEASER_CX_CUSTOMER_QUERY))&&void 0!==t?t:"")});var En,gn=function(e){return e.SEARCH_RESULTS="SEARCH_RESULTS",e.DETAIL_PAGE="DETAIL_PAGE",e.GATEWAY="GATEWAY",e.CART="CART",e.UNKNOWN="UNKNOWN",e}({}),_n=(En=n(n(n(n(n({},gn.DETAIL_PAGE,["ATVDetail","Detail","MASDetailPage","MoneraDetailPage","vindp"]),gn.SEARCH_RESULTS,["Search"]),gn.GATEWAY,["Gateway"]),gn.CART,["ShoppingCart"]),gn.UNKNOWN,["Unknown"]),Object.fromEntries(Object.entries(En).flatMap(function(e){var t=xt(e,2),n=t[0];return t[1].map(function(e){return[e,n]})})));function yn(e){return e in _n?"ATVDetail"===e&&mn.extractGtiFromUrl(mn.getCurrentPageUrl())?gn.UNKNOWN:_n[e]:gn.UNKNOWN}var Cn=r(4438),Rn="data-csa-c-group-id",Tn=new(function(){return c(function e(){var t=this;l(this,e),n(this,"triggerCallback",null),n(this,"atcContainerId",null),n(this,"handleClick",function(e){var n,r=e.target,i=r.closest('[role="button"]');if(null!=i&&null!==(n=i.textContent)&&void 0!==n&&n.includes("Add to cart")){var a=r.closest("[".concat(Rn,"]")),o=null==a?void 0:a.getAttribute(Rn);o&&t.setAtcContainerId(o)}})},[{key:"setTriggerCallback",value:function(e){this.triggerCallback=e}},{key:"setAtcContainerId",value:function(e){this.atcContainerId=e}},{key:"triggerAtcToast",value:function(){this.triggerCallback&&this.atcContainerId&&(this.triggerCallback(this.atcContainerId),this.atcContainerId=null)}},{key:"duration",get:function(){return 1e3}}])}()),Sn=function(e,t){var n;t===gn.CART?(window.location.reload(),S.addCount(p.RUFUS_ATC_ACTION_REFRESH_CART_PAGE,1)):null!==(n=window.navbar)&&void 0!==n&&n.setCartCount&&Number.isFinite(e)&&(window.navbar.setCartCount(e),S.addCount(p.RUFUS_ATC_ACTION_UPDATE_CART_COUNT,1))},In=function(){return c(function e(){l(this,e),n(this,"listeners",new Map)},[{key:"on",value:function(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}},{key:"off",value:function(e,t){var n=this.listeners.get(e);n&&this.listeners.set(e,n.filter(function(e){return e!==t}))}},{key:"dispatch",value:function(e,t){var n=this.listeners.get(e);n&&n.forEach(function(e){e(t)})}}])}(),An=function(){return c(function e(){l(this,e)},null,[{key:"extractAsinFromActionId",value:function(e,t){if(!e||!t||!e.startsWith(t))return"";var n=t.length,r=e.indexOf("_",n);return-1===r?e.substring(n):e.substring(n,r)}}])}(),On=function(){function e(){var t=this;l(this,e),n(this,"handleBuyForMeAction",function(){var n=a(s().mark(function n(r){var i,a;return s().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r.payload){n.next=1;break}return S.addCount(p.RUFUS_BUY_FOR_ME_MISSING_PAYLOAD,1),S.logErrorWithLevel(R.ERROR,"Missing payload in buy for me action"),n.abrupt("return");case 1:if(i=An.extractAsinFromActionId(r.actionId||"",e.BFM_ACTION_ID_PREFIX)){n.next=2;break}return S.addCount(p.RUFUS_BUY_FOR_ME_INVALID_ASIN,1),S.logErrorWithLevel(R.ERROR,"Failed to extract ASIN from action ID"),n.abrupt("return");case 2:if(t.isValidAsin(i)){n.next=3;break}return S.addCount(p.RUFUS_BUY_FOR_ME_INVALID_ASIN,1),S.logErrorWithLevel(R.ERROR,"Invalid ASIN format: ".concat(i)),n.abrupt("return");case 3:a=t.buildBuyForMeUrl(i),S.addCount(p.RUFUS_BUY_FOR_ME_SUCCESS,1),window.location.href=a;case 4:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}())}return c(e,[{key:"isValidAsin",value:function(t){return"string"==typeof t&&e.ASIN_PATTERN.test(t.trim())}},{key:"buildBuyForMeUrl",value:function(t){return e.BUY_FOR_ME_PATH+encodeURIComponent(t.trim())}}])}();function bn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Ln(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){bn(a,r,i,o,s,"next",e)}function s(e){bn(a,r,i,o,s,"throw",e)}o(void 0)})}}function Pn(e){var t="function"==typeof Map?new Map:void 0;return Pn=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return Nn(e,arguments,Gn(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),jn(n,e)},Pn(e)}function Nn(e,t,n){if(Wn())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&jn(i,n.prototype),i}function kn(e,t,n){return(t=Zn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Un(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return Dn(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],d=!1,h={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return a=t,s=0,u=e,h.n=n,o}};function f(n,r){for(s=n,u=r,t=0;!d&&c&&!i&&t<l.length;t++){var i,a=l[t],f=h.p,v=a[2];n>3?(i=v===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=f&&((i=n<2&&f<a[1])?(s=0,h.v=r,h.n=a[1]):f<v&&(i=n<3||a[0]>r||r>v)&&(a[4]=n,a[5]=r,h.n=v,s=0))}if(i||n>1)return o;throw d=!0,r}return function(i,l,v){if(c>1)throw TypeError("Generator is already running");for(d&&1===l&&f(l,v),s=l,u=v;(t=s<2?e:u)||!d;){a||(s?s<3?(s>1&&(h.n=-1),f(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),t=a[i]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=e}else if((t=(d=h.n<0)?u:n.call(r,h))!==o)break}catch(t){a=e,s=1,u=t}finally{c=1}}return{value:t,done:d}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Dn(t={},r,function(){return this}),t),d=c.prototype=s.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Dn(e,i,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,Dn(d,"constructor",c),Dn(c,"constructor",u),u.displayName="GeneratorFunction",Dn(c,i,"GeneratorFunction"),Dn(d),Dn(d,i,"Generator"),Dn(d,r,function(){return this}),Dn(d,"toString",function(){return"[object Generator]"}),(Un=function(){return{w:a,m:h}})()}function Dn(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}Dn=function(e,t,n,r){function a(t,n){Dn(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Dn(e,t,n,r)}function Mn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||xn(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=xn(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Fn(e){return function(e){if(Array.isArray(e))return Hn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||xn(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xn(e,t){if(e){if("string"==typeof e)return Hn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Hn(e,t):void 0}}function Hn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Bn(e,t,n){return t=Gn(t),function(e,t){if(t&&("object"==Yn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Wn()?Reflect.construct(t,n||[],Gn(e).constructor):t.apply(e,n))}function Wn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Wn=function(){return!!e})()}function Vn(){return Vn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=Gn(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},Vn.apply(null,arguments)}function Gn(e){return Gn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Gn(e)}function zn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&jn(e,t)}function jn(e,t){return jn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},jn(e,t)}function Yn(e){return Yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yn(e)}function Kn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Zn(r.key),r)}}function Xn(e,t,n){return t&&qn(e.prototype,t),n&&qn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Zn(e){var t=function(e){if("object"!=Yn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Yn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Yn(t)?t:t+""}n(On,"BFM_ACTION_ID_PREFIX","asin_cards_oam_bfm_"),n(On,"ASIN_PATTERN",/^[A-Za-z0-9]{10}$/),n(On,"BUY_FOR_ME_PATH","/buy-for-me/product/");var Qn="locale",Jn="defaultLocale",$n="timeZone",er="i18nDomain",tr=function(){function e(t){Kn(this,e),this._key=t}return Xn(e,[{key:"asString",value:function(){return this._key}}],[{key:"of",value:function(t){if(this.KEY_REGISTRY.has(t))throw new Error("Key with name ".concat(t," already exist. AttributeKeys ").concat(JSON.stringify(this.KEY_REGISTRY)," must only be created once."));return this.KEY_REGISTRY.add(t),new e(t)}}])}();tr.KEY_REGISTRY=new Set;var nr=Xn(function e(){Kn(this,e)});nr.LOCALE_KEY=tr.of(Qn),nr.DEFAULT_LOCALE_KEY=tr.of(Jn),nr.TIME_ZONE_KEY=tr.of($n),nr.I18N_DOMAIN_KEY=tr.of(er),nr.CX_TUPLE_KEY=tr.of("cxTuple"),nr.CURRENCY_KEY=tr.of("currency"),nr.DEFAULT_CURRENCY_KEY=tr.of("defaultCurrency");var rr=function(){return Xn(function e(t){Kn(this,e),this._locale=t.locale,this._defaultLocale=t.defaultLocale,this._timeZone=t.timeZone,this._i18nDomain=t.i18nDomain},[{key:"getTimeZone",value:function(){return this._timeZone}},{key:"getLocale",value:function(){return this._locale}},{key:"getDefaultLocale",value:function(){return this._defaultLocale}},{key:"getI18nDomain",value:function(){return this._i18nDomain}},{key:"asAttributesMap",value:function(){return new Map([[Qn,this._locale],[Jn,this._defaultLocale],[$n,this._timeZone],[er,this._i18nDomain]])}},{key:"toString",value:function(){var e="LocalizationContext[";return e+="".concat(Qn,"=").concat(this.getLocale(),","),e+="".concat($n,"=").concat(this.getTimeZone(),","),(e+="".concat(Jn,"=").concat(this.getDefaultLocale(),","))+"".concat(er,"=").concat(this.getI18nDomain(),"]")}},{key:"getAttribute",value:function(e){switch(e){case nr.LOCALE_KEY:return this.getLocale();case nr.DEFAULT_LOCALE_KEY:return this.getDefaultLocale();case nr.TIME_ZONE_KEY:case nr.I18N_DOMAIN_KEY:return this.getTimeZone();default:return}}}])}(),ir=function(){function e(){Kn(this,e),this._locale=e.DEFAULT_LOCALE,this._defaultLocale=void 0,this._timeZone=e.DEFAULT_TIME_ZONE,this._i18nDomain=""}return Xn(e,[{key:"locale",get:function(){return this._locale}},{key:"defaultLocale",get:function(){return this._defaultLocale}},{key:"timeZone",get:function(){return this._timeZone}},{key:"i18nDomain",get:function(){return this._i18nDomain}},{key:"withLocale",value:function(t){try{this._locale=Intl.getCanonicalLocales(t)[0]}catch(n){console.error("Provided Locale is invalid: locale=".concat(t,". Using default runtime locale: ").concat(e.DEFAULT_LOCALE))}return this}},{key:"withDefaultLocale",value:function(e){try{this._defaultLocale=Intl.getCanonicalLocales(e)[0]}catch(t){console.error("Provided DefaultLocale is invalid: defaultLocale:".concat(e,"."))}return this}},{key:"withI18nDomain",value:function(e){return this._i18nDomain=e,this}},{key:"withTimeZone",value:function(t){try{var n=new Intl.DateTimeFormat(void 0,{timeZone:t});this._timeZone=n.resolvedOptions().timeZone}catch(n){console.error("Provided TimeZone is invalid: timeZone=".concat(t,". Using default TimeZone: ").concat(e.DEFAULT_TIME_ZONE))}return this}},{key:"build",value:function(){return new rr(this)}}])}();ir.DATE_TIME_OPTIONS=(new Intl.DateTimeFormat).resolvedOptions(),ir.DEFAULT_LOCALE=ir.DATE_TIME_OPTIONS.locale,ir.DEFAULT_TIME_ZONE=ir.DATE_TIME_OPTIONS.timeZone;var ar=function(){return Xn(function e(t){Kn(this,e),this.provideContext=t},[{key:"getLocalizationContext",value:function(){return this.provideContext()}}])}(),or="marketplace",sr=function(e){function t(){return Kn(this,t),Bn(this,t,arguments)}return zn(t,e),Xn(t)}(function(){return Xn(function e(){Kn(this,e)},[{key:"getObfuscatedMarketplaceId",value:function(){}},{key:"getDefaultLocale",value:function(){return Intl.DateTimeFormat().resolvedOptions().locale}},{key:"getDefaultCurrency",value:function(){}}])}()),ur=function(){function e(){Kn(this,e)}return Xn(e,[{key:"getMarketplace",value:function(){return e.emptyMarketplace}}])}();ur.emptyMarketplace=new sr,(function(){function e(){Kn(this,e)}return Xn(e,null,[{key:"setProvider",value:function(t){e.marketplaceProvider=t}},{key:"provider",value:function(){return e.marketplaceProvider||(e.marketplaceProvider=new ur),e.marketplaceProvider}}])}()).marketplaceProvider=void 0;var cr,lr=function(){function e(t){Kn(this,e),this._programs=Fn(t),this._programs.sort()}return Xn(e,[{key:"has",value:function(e){return this._programs.includes(e)}},{key:"isEmpty",value:function(){return 0==this._programs.length}},{key:"toString",value:function(){var t=this._programs.join(e.DELIMITER);return e.OPENING_CHAR+t+e.CLOSING_CHAR}},{key:"equals",value:function(e){return!!e&&this.toString()===e.toString()}}],[{key:"of",value:function(t){return new e(t)}},{key:"fromString",value:function(t){if(!t.startsWith(e.OPENING_CHAR)||!t.endsWith(e.CLOSING_CHAR))throw new Error("Invalid fully qualified CXProgram: ".concat(t,". Valid example: [exports]."));var n=t.substring(1,t.length-1).trim();if(0==n.length)return e.EMPTY;var r,i=[],a=wn(n.split(e.DELIMITER));try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o.trim().toLowerCase();if(!Object.values(cr).includes(s))throw new Error("Unrecognized program ".concat(o));i.push(s)}}catch(e){a.e(e)}finally{a.f()}return new e(i)}}])}();lr.EMPTY=lr.of([]),lr.DELIMITER=",",lr.OPENING_CHAR="[",lr.CLOSING_CHAR="]",function(e){e.EXPORTS="exports",e.B2B="b2b"}(cr||(cr={}));var dr="/",hr=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:lr.EMPTY;Kn(this,e),this._cxFamily=e.validateString("cxFamily",t),this._cxId=e.validateString("cxId",n),this._cxProgram=r}return Xn(e,[{key:"cxFamily",get:function(){return this._cxFamily}},{key:"cxId",get:function(){return this._cxId}},{key:"cxProgram",get:function(){return this._cxProgram}},{key:"toString",value:function(){return this._cxProgram.isEmpty()?this._cxFamily+dr+this._cxId:this._cxFamily+dr+this._cxId+dr+this._cxProgram.toString()}},{key:"equals",value:function(e){return this._cxFamily===e._cxFamily&&this._cxId==this._cxId&&this._cxProgram===e._cxProgram}}],[{key:"of",value:function(t,n,r){return new e(t,n,r)}},{key:"fromString",value:function(t){var n=t.split(dr);if(2!=n.length&&3!=n.length)throw new Error("Invalid fully qualified CXTuple: ".concat(t));var r=n[0],i=n[1];return 3==n.length?new e(r,i,lr.fromString(n[2])):new e(r,i)}},{key:"validateString",value:function(e,t){if(!t)throw new Error("".concat(e," must not be empty"));for(var n=0;n<t.length;n++){var r=t.charAt(n);if(!("."===r||"-"===r||r>="A"&&r<="Z"||r>="a"&&r<="z"||r>="0"&&r<="9"))throw new Error("Invalid character ".concat(r," in ").concat(e,": ").concat(t))}return t}}])}();hr.UNKNOWN=new hr("unknown","unknown");var fr=function(){return Xn(function e(t){Kn(this,e),this._attributes=t},[{key:"getAttribute",value:function(e){return this._attributes.get(e)}},{key:"asAttributesMap",value:function(){var e,t=new Map,n=wn(this._attributes.keys());try{for(n.s();!(e=n.n()).done;){var r=e.value;t.set(r.asString(),this._attributes.get(r))}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"getDefaultLocale",value:function(){return this.getAttribute(nr.DEFAULT_LOCALE_KEY)}},{key:"getI18nDomain",value:function(){return this.getAttribute(nr.I18N_DOMAIN_KEY)}},{key:"getLocale",value:function(){return this.getAttribute(nr.LOCALE_KEY)}},{key:"getTimeZone",value:function(){return this.getAttribute(nr.TIME_ZONE_KEY)}}])}(),vr=function(){return Xn(function e(t,n){Kn(this,e),this.attributeKey=t,this.value=n},[{key:"getAttribute",value:function(e){return this.value}},{key:"getProvidedAttributes",value:function(){var e=new Set;return e.add(this.attributeKey),e}}])}(),pr=function(){return Xn(function e(){Kn(this,e);for(var t=new Map,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];for(var a=0,o=r;a<o.length;a++){var s,u=o[a],c=wn(u.getProvidedAttributes());try{for(c.s();!(s=c.n()).done;){var l=s.value;if(t.has(l))throw new Error("Attribute ".concat(l.asString()," is already provided by ").concat(t.get(l),"."));t.set(l,u)}}catch(e){c.e(e)}finally{c.f()}}t.has(nr.LOCALE_KEY)||t.set(nr.LOCALE_KEY,e.JVM_LOCALE_PROVIDER),t.has(nr.TIME_ZONE_KEY)||t.set(nr.TIME_ZONE_KEY,e.JVM_TIME_ZONE_PROVIDER),t.has(nr.I18N_DOMAIN_KEY)||t.set(nr.I18N_DOMAIN_KEY,e.DEFAULT_I18N_DOMAIN_PROVIDER),this._attributeProviders=t},[{key:"getLocalizationContext",value:function(){var e,t=new Map,n=wn(this._attributeProviders);try{for(n.s();!(e=n.n()).done;){var r=Mn(e.value,2),i=r[0],a=r[1];t.set(i,a.getAttribute(i))}}catch(e){n.e(e)}finally{n.f()}return new fr(t)}}])}();pr.DATE_TIME_OPTIONS=(new Intl.DateTimeFormat).resolvedOptions(),pr.JVM_LOCALE_PROVIDER=new vr(nr.LOCALE_KEY,pr.DATE_TIME_OPTIONS.locale),pr.JVM_TIME_ZONE_PROVIDER=new vr(nr.TIME_ZONE_KEY,pr.DATE_TIME_OPTIONS.timeZone),pr.DEFAULT_I18N_DOMAIN_PROVIDER=new vr(nr.TIME_ZONE_KEY,"");var mr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{};function Er(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}),t}var gr=function(){return Xn(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Kn(this,e),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=t.maxSize,this.onEviction=t.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0},[{key:"_set",value:function(e,t){if(this.cache.set(e,t),this._size++,this._size>=this.maxSize){if(this._size=0,"function"==typeof this.onEviction){var n,r=wn(this.oldCache.entries());try{for(r.s();!(n=r.n()).done;){var i=Mn(n.value,2),a=i[0],o=i[1];this.onEviction(a,o)}}catch(e){r.e(e)}finally{r.f()}}this.oldCache=this.cache,this.cache=new Map}}},{key:"get",value:function(e){if(this.cache.has(e))return this.cache.get(e);if(this.oldCache.has(e)){var t=this.oldCache.get(e);return this.oldCache.delete(e),this._set(e,t),t}}},{key:"set",value:function(e,t){return this.cache.has(e)?this.cache.set(e,t):this._set(e,t),this}},{key:"has",value:function(e){return this.cache.has(e)||this.oldCache.has(e)}},{key:"peek",value:function(e){return this.cache.has(e)?this.cache.get(e):this.oldCache.has(e)?this.oldCache.get(e):void 0}},{key:"delete",value:function(e){var t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}},{key:"clear",value:function(){this.cache.clear(),this.oldCache.clear(),this._size=0}},{key:"keys",value:Un().m(function e(){var t,n,r,i,a;return Un().w(function(e){for(;;)switch(e.p=e.n){case 0:t=wn(this),e.p=1,t.s();case 2:if((n=t.n()).done){e.n=4;break}return r=Mn(n.value,1),i=r[0],e.n=3,i;case 3:e.n=2;break;case 4:e.n=6;break;case 5:e.p=5,a=e.v,t.e(a);case 6:return e.p=6,t.f(),e.f(6);case 7:return e.a(2)}},e,this,[[1,5,6,7]])})},{key:"values",value:Un().m(function e(){var t,n,r,i,a;return Un().w(function(e){for(;;)switch(e.p=e.n){case 0:t=wn(this),e.p=1,t.s();case 2:if((n=t.n()).done){e.n=4;break}return r=Mn(n.value,2),i=r[1],e.n=3,i;case 3:e.n=2;break;case 4:e.n=6;break;case 5:e.p=5,a=e.v,t.e(a);case 6:return e.p=6,t.f(),e.f(6);case 7:return e.a(2)}},e,this,[[1,5,6,7]])})},{key:Symbol.iterator,value:Un().m(function e(){var t,n,r,i,a,o,s,u,c,l;return Un().w(function(e){for(;;)switch(e.p=e.n){case 0:t=wn(this.cache),e.p=1,t.s();case 2:if((n=t.n()).done){e.n=4;break}return r=n.value,e.n=3,r;case 3:e.n=2;break;case 4:e.n=6;break;case 5:e.p=5,c=e.v,t.e(c);case 6:return e.p=6,t.f(),e.f(6);case 7:i=wn(this.oldCache),e.p=8,i.s();case 9:if((a=i.n()).done){e.n=11;break}if(o=a.value,s=Mn(o,1),u=s[0],this.cache.has(u)){e.n=10;break}return e.n=10,o;case 10:e.n=9;break;case 11:e.n=13;break;case 12:e.p=12,l=e.v,i.e(l);case 13:return e.p=13,i.f(),e.f(13);case 14:return e.a(2)}},e,this,[[8,12,13,14],[1,5,6,7]])})},{key:"size",get:function(){var e,t=0,n=wn(this.oldCache.keys());try{for(n.s();!(e=n.n()).done;){var r=e.value;this.cache.has(r)||t++}}catch(e){n.e(e)}finally{n.f()}return Math.min(this._size+t,this.maxSize)}}])}(),_r=gr,yr=function(e){return String(e)},Cr=function(){return Xn(function e(t,n){Kn(this,e),this.loader=t,this.storage=new _r(n),this.serializeKeyFn=void 0!==n.keyFn?n.keyFn:yr},[{key:"get",value:function(e){var t=this.serializeKeyFn(e),n=this.storage.get(t);if(n)return n;var r=this.loader(e);return void 0!==r?(this.storage.set(t,r),r):void 0}},{key:"size",value:function(){return this.storage.size}},{key:"has",value:function(e){return this.storage.has(this.serializeKeyFn(e))}}])}(),Rr=function(){function e(t,n){Kn(this,e),this._bundle=t,this._context=n}return Xn(e,[{key:"bundle",get:function(){return this._bundle}},{key:"context",get:function(){return this._context}}],[{key:"generateCacheKey",value:function(t){var n,r=t.bundle,i=t.context.asAttributesMap(),a=wn(e.LOCALIZATION_CONTEXT_ATTRIBUTES_FOR_CACHE_KEY);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=i.get(o);s&&(r+="#".concat(o,"#").concat(s))}}catch(e){a.e(e)}finally{a.f()}return r}}])}();Rr.LOCALIZATION_CONTEXT_ATTRIBUTES_FOR_CACHE_KEY=[Qn,Jn,er];var Tr,Sr,Ir,Ar=function(){return Xn(function e(t,n,r){Kn(this,e),this._bundle=t,this._variants=r,this._locale=n},[{key:"bundle",get:function(){return this._bundle}},{key:"variants",get:function(){return this._variants}},{key:"locale",get:function(){return this._locale}}],[{key:"cacheKey",value:function(e){var t=e.bundle;return e.variants&&e.variants.forEach(function(e,n){t+="#var-".concat(n,"#").concat(e)}),t+="#".concat(e.locale)}}])}(),Or=function(){function e(){Kn(this,e)}return Xn(e,[{key:"getFallbackChains",value:function(e,t,n){var r=this.createLocaleFallbackChain(n.getLocale(),n.getDefaultLocale()),i=this.getVariantFallbackChain(t,n);return kn({},Symbol.iterator,Un().m(function t(){var n,a,o,s,u,c,l,d,h,f,v,p,m,E,g,_;return Un().w(function(t){for(;;)switch(t.p=t.n){case 0:n=wn(i),t.p=1,n.s();case 2:if((a=n.n()).done){t.n=16;break}o=a.value,s=wn(o),t.p=3,s.s();case 4:if((u=s.n()).done){t.n=12;break}c=u.value,l=wn(r),t.p=5,l.s();case 6:if((d=l.n()).done){t.n=8;break}return h=d.value,t.n=7,new Ar(e,h,c);case 7:t.n=6;break;case 8:t.n=10;break;case 9:t.p=9,m=t.v,l.e(m);case 10:return t.p=10,l.f(),t.f(10);case 11:t.n=4;break;case 12:t.n=14;break;case 13:t.p=13,E=t.v,s.e(E);case 14:return t.p=14,s.f(),t.f(14);case 15:t.n=2;break;case 16:t.n=18;break;case 17:t.p=17,g=t.v,n.e(g);case 18:return t.p=18,n.f(),t.f(18);case 19:f=wn(r),t.p=20,f.s();case 21:if((v=f.n()).done){t.n=23;break}return p=v.value,t.n=22,new Ar(e,p,void 0);case 22:t.n=21;break;case 23:t.n=25;break;case 24:t.p=24,_=t.v,f.e(_);case 25:return t.p=25,f.f(),t.f(25);case 26:return t.a(2)}},t,null,[[20,24,25,26],[5,9,10,11],[3,13,14,15],[1,17,18,19]])}))}},{key:"getVariantFallbackChain",value:function(e,t){var n=t.asAttributesMap();return kn({},Symbol.iterator,Un().m(function t(){var r,i,a,o,s,u,c,l,d;return Un().w(function(t){for(;;)switch(t.n){case 0:r=0;case 1:if(!(r<e.length)){t.n=9;break}i=[],r<e.length-1&&(i=e[r+1]),a=e[r],o=!0,s=[],u=new Map,c=0;case 2:if(!(c<a.length)){t.n=7;break}if(n){t.n=3;break}return t.a(3,6);case 3:if(l=a[c],d=n.get(l)){t.n=4;break}return t.a(3,6);case 4:if(u.set(l,d),!(o&&c<i.length&&i[c]===a[c])){t.n=5;break}return t.a(3,6);case 5:o=!1,s.push(new Map(u));case 6:c++,t.n=2;break;case 7:return t.n=8,s.reverse();case 8:r++,t.n=1;break;case 9:return t.a(2)}},t)}))}},{key:"createLocaleFallbackChain",value:function(e,t){var n=Intl.getCanonicalLocales(e)[0],r=void 0!==t?Intl.getCanonicalLocales(t)[0]:t,i=this.getFallbackChain(n);if(r&&!i.includes(r)){var a=this.getFallbackChain(r);i.push.apply(i,Fn(a))}return i.push("und"),i}},{key:"getFallbackChain",value:function(t){var n=[],r=new Intl.Locale(t).baseName;if("und"!==r){n.push(r);for(var i=r.lastIndexOf(e.LOCALE_TAG_SEPARATOR);i>0;)r=r.substr(0,i),n.push(r),i=r.lastIndexOf(e.LOCALE_TAG_SEPARATOR)}return n}}])}();function br(e){return e.type===Sr.literal}function Lr(e){return e.type===Sr.argument}function Pr(e){return e.type===Sr.number}function Nr(e){return e.type===Sr.date}function kr(e){return e.type===Sr.time}function Ur(e){return e.type===Sr.select}function Dr(e){return e.type===Sr.plural}function Mr(e){return e.type===Sr.pound}function wr(e){return e.type===Sr.tag}function Fr(e){return!(!e||"object"!==Yn(e)||e.type!==Ir.number)}function xr(e){return!(!e||"object"!==Yn(e)||e.type!==Ir.dateTime)}function Hr(e){return e.type===Sr.price}Or.LOCALE_TAG_SEPARATOR="-",function(e){e[e.EXPECT_ARGUMENT_CLOSING_BRACE=1]="EXPECT_ARGUMENT_CLOSING_BRACE",e[e.EMPTY_ARGUMENT=2]="EMPTY_ARGUMENT",e[e.MALFORMED_ARGUMENT=3]="MALFORMED_ARGUMENT",e[e.EXPECT_ARGUMENT_TYPE=4]="EXPECT_ARGUMENT_TYPE",e[e.INVALID_ARGUMENT_TYPE=5]="INVALID_ARGUMENT_TYPE",e[e.EXPECT_ARGUMENT_STYLE=6]="EXPECT_ARGUMENT_STYLE",e[e.INVALID_NUMBER_SKELETON=7]="INVALID_NUMBER_SKELETON",e[e.INVALID_DATE_TIME_SKELETON=8]="INVALID_DATE_TIME_SKELETON",e[e.EXPECT_NUMBER_SKELETON=9]="EXPECT_NUMBER_SKELETON",e[e.EXPECT_DATE_TIME_SKELETON=10]="EXPECT_DATE_TIME_SKELETON",e[e.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE=11]="UNCLOSED_QUOTE_IN_ARGUMENT_STYLE",e[e.EXPECT_SELECT_ARGUMENT_OPTIONS=12]="EXPECT_SELECT_ARGUMENT_OPTIONS",e[e.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE=13]="EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE",e[e.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE=14]="INVALID_PLURAL_ARGUMENT_OFFSET_VALUE",e[e.EXPECT_SELECT_ARGUMENT_SELECTOR=15]="EXPECT_SELECT_ARGUMENT_SELECTOR",e[e.EXPECT_PLURAL_ARGUMENT_SELECTOR=16]="EXPECT_PLURAL_ARGUMENT_SELECTOR",e[e.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT=17]="EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT",e[e.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT=18]="EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT",e[e.INVALID_PLURAL_ARGUMENT_SELECTOR=19]="INVALID_PLURAL_ARGUMENT_SELECTOR",e[e.DUPLICATE_PLURAL_ARGUMENT_SELECTOR=20]="DUPLICATE_PLURAL_ARGUMENT_SELECTOR",e[e.DUPLICATE_SELECT_ARGUMENT_SELECTOR=21]="DUPLICATE_SELECT_ARGUMENT_SELECTOR",e[e.MISSING_OTHER_CLAUSE=22]="MISSING_OTHER_CLAUSE",e[e.INVALID_TAG=23]="INVALID_TAG",e[e.INVALID_TAG_NAME=25]="INVALID_TAG_NAME",e[e.UNMATCHED_CLOSING_TAG=26]="UNMATCHED_CLOSING_TAG",e[e.UNCLOSED_TAG=27]="UNCLOSED_TAG"}(Tr||(Tr={})),function(e){e[e.literal=0]="literal",e[e.argument=1]="argument",e[e.number=2]="number",e[e.date=3]="date",e[e.time=4]="time",e[e.select=5]="select",e[e.plural=6]="plural",e[e.pound=7]="pound",e[e.tag=8]="tag",e[e.price=9]="price"}(Sr||(Sr={})),function(e){e[e.number=0]="number",e[e.dateTime=1]="dateTime"}(Ir||(Ir={}));var Br=/[ \xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/,Wr=/(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvVxX]{1,4})(?=([^']*'[^']*')*[^']*$)/g;function Vr(e){var t={};return e.replace(Wr,function(e){var n=e.length;switch(e[0]){case"G":t.era=4===n?"long":5===n?"narrow":"short";break;case"y":t.year=2===n?"2-digit":"numeric";break;case"Y":case"u":case"U":case"r":throw new RangeError("`Y/u/U/r` (year) patterns are not supported, use `y` instead");case"q":case"Q":throw new RangeError("`q/Q` (quarter) patterns are not supported");case"M":case"L":t.month=["numeric","2-digit","short","long","narrow"][n-1];break;case"w":case"W":throw new RangeError("`w/W` (week) patterns are not supported");case"d":t.day=["numeric","2-digit"][n-1];break;case"D":case"F":case"g":throw new RangeError("`D/F/g` (day) patterns are not supported, use `d` instead");case"E":t.weekday=4===n?"short":5===n?"narrow":"short";break;case"e":if(n<4)throw new RangeError("`e..eee` (weekday) patterns are not supported");t.weekday=["short","long","narrow","short"][n-4];break;case"c":if(n<4)throw new RangeError("`c..ccc` (weekday) patterns are not supported");t.weekday=["short","long","narrow","short"][n-4];break;case"a":t.hour12=!0;break;case"b":case"B":throw new RangeError("`b/B` (period) patterns are not supported, use `a` instead");case"h":t.hourCycle="h12",t.hour=["numeric","2-digit"][n-1];break;case"H":t.hourCycle="h23",t.hour=["numeric","2-digit"][n-1];break;case"K":t.hourCycle="h11",t.hour=["numeric","2-digit"][n-1];break;case"k":t.hourCycle="h24",t.hour=["numeric","2-digit"][n-1];break;case"j":case"J":case"C":throw new RangeError("`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead");case"m":t.minute=["numeric","2-digit"][n-1];break;case"s":t.second=["numeric","2-digit"][n-1];break;case"S":case"A":throw new RangeError("`S/A` (second) patterns are not supported, use `s` instead");case"z":t.timeZoneName=n<4?"short":"long";break;case"Z":case"O":case"v":case"V":case"X":case"x":throw new RangeError("`Z/O/v/V/X/x` (timeZone) patterns are not supported, use `z` instead")}return""}),t}var Gr=function(){return Gr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Gr.apply(this,arguments)},zr=/[\t-\r \x85\u200E\u200F\u2028\u2029]/i;function jr(e){return e.replace(/^(.*?)-/,"")}var Yr=/^\.(?:(0+)(\*)?|(#+)|(0+)(#+))$/g,Kr=/^(@+)?(\+|#+)?[rs]?$/g,qr=/(\*)(0+)|(#+)(0+)|(0+)/g,Xr=/^(0+)$/;function Zr(e){var t={};return"r"===e[e.length-1]?t.roundingPriority="morePrecision":"s"===e[e.length-1]&&(t.roundingPriority="lessPrecision"),e.replace(Kr,function(e,n,r){return"string"!=typeof r?(t.minimumSignificantDigits=n.length,t.maximumSignificantDigits=n.length):"+"===r?t.minimumSignificantDigits=n.length:"#"===n[0]?t.maximumSignificantDigits=n.length:(t.minimumSignificantDigits=n.length,t.maximumSignificantDigits=n.length+("string"==typeof r?r.length:0)),""}),t}function Qr(e){switch(e){case"sign-auto":return{signDisplay:"auto"};case"sign-accounting":case"()":return{currencySign:"accounting"};case"sign-always":case"+!":return{signDisplay:"always"};case"sign-accounting-always":case"()!":return{signDisplay:"always",currencySign:"accounting"};case"sign-except-zero":case"+?":return{signDisplay:"exceptZero"};case"sign-accounting-except-zero":case"()?":return{signDisplay:"exceptZero",currencySign:"accounting"};case"sign-never":case"+_":return{signDisplay:"never"}}}function Jr(e){var t;if("E"===e[0]&&"E"===e[1]?(t={notation:"engineering"},e=e.slice(2)):"E"===e[0]&&(t={notation:"scientific"},e=e.slice(1)),t){var n=e.slice(0,2);if("+!"===n?(t.signDisplay="always",e=e.slice(2)):"+?"===n&&(t.signDisplay="exceptZero",e=e.slice(2)),!Xr.test(e))throw new Error("Malformed concise eng/scientific notation");t.minimumIntegerDigits=e.length}return t}function $r(e){return Qr(e)||{}}function ei(e){for(var t={},n=0,r=e;n<r.length;n++){var i=r[n];switch(i.stem){case"percent":case"%":t.style="percent";continue;case"%x100":t.style="percent",t.scale=100;continue;case"currency":t.style="currency",t.currency=i.options[0];continue;case"group-off":case",_":t.useGrouping=!1;continue;case"precision-integer":case".":t.maximumFractionDigits=0;continue;case"measure-unit":case"unit":t.style="unit",t.unit=jr(i.options[0]);continue;case"compact-short":case"K":t.notation="compact",t.compactDisplay="short";continue;case"compact-long":case"KK":t.notation="compact",t.compactDisplay="long";continue;case"scientific":t=Gr(Gr(Gr({},t),{notation:"scientific"}),i.options.reduce(function(e,t){return Gr(Gr({},e),$r(t))},{}));continue;case"engineering":t=Gr(Gr(Gr({},t),{notation:"engineering"}),i.options.reduce(function(e,t){return Gr(Gr({},e),$r(t))},{}));continue;case"notation-simple":t.notation="standard";continue;case"unit-width-narrow":t.currencyDisplay="narrowSymbol",t.unitDisplay="narrow";continue;case"unit-width-short":t.currencyDisplay="code",t.unitDisplay="short";continue;case"unit-width-full-name":t.currencyDisplay="name",t.unitDisplay="long";continue;case"unit-width-iso-code":t.currencyDisplay="symbol";continue;case"scale":t.scale=parseFloat(i.options[0]);continue;case"integer-width":if(i.options.length>1)throw new RangeError("integer-width stems only accept a single optional option");i.options[0].replace(qr,function(e,n,r,i,a,o){if(n)t.minimumIntegerDigits=r.length;else{if(i&&a)throw new Error("We currently do not support maximum integer digits");if(o)throw new Error("We currently do not support exact integer digits")}return""});continue}if(Xr.test(i.stem))t.minimumIntegerDigits=i.stem.length;else if(Yr.test(i.stem)){if(i.options.length>1)throw new RangeError("Fraction-precision stems only accept a single optional option");i.stem.replace(Yr,function(e,n,r,i,a,o){return"*"===r?t.minimumFractionDigits=n.length:i&&"#"===i[0]?t.maximumFractionDigits=i.length:a&&o?(t.minimumFractionDigits=a.length,t.maximumFractionDigits=a.length+o.length):(t.minimumFractionDigits=n.length,t.maximumFractionDigits=n.length),""});var a=i.options[0];"w"===a?t=Gr(Gr({},t),{trailingZeroDisplay:"stripIfInteger"}):a&&(t=Gr(Gr({},t),Zr(a)))}else if(Kr.test(i.stem))t=Gr(Gr({},t),Zr(i.stem));else{var o=Qr(i.stem);o&&(t=Gr(Gr({},t),o));var s=Jr(i.stem);s&&(t=Gr(Gr({},t),s))}}return t}var ti={AX:["H"],BQ:["H"],CP:["H"],CZ:["H"],DK:["H"],FI:["H"],ID:["H"],IS:["H"],ML:["H"],NE:["H"],RU:["H"],SE:["H"],SJ:["H"],SK:["H"],AS:["h","H"],BT:["h","H"],DJ:["h","H"],ER:["h","H"],GH:["h","H"],IN:["h","H"],LS:["h","H"],PG:["h","H"],PW:["h","H"],SO:["h","H"],TO:["h","H"],VU:["h","H"],WS:["h","H"],"001":["H","h"],AL:["h","H","hB"],TD:["h","H","hB"],"ca-ES":["H","h","hB"],CF:["H","h","hB"],CM:["H","h","hB"],"fr-CA":["H","h","hB"],"gl-ES":["H","h","hB"],"it-CH":["H","h","hB"],"it-IT":["H","h","hB"],LU:["H","h","hB"],NP:["H","h","hB"],PF:["H","h","hB"],SC:["H","h","hB"],SM:["H","h","hB"],SN:["H","h","hB"],TF:["H","h","hB"],VA:["H","h","hB"],CY:["h","H","hb","hB"],GR:["h","H","hb","hB"],CO:["h","H","hB","hb"],DO:["h","H","hB","hb"],KP:["h","H","hB","hb"],KR:["h","H","hB","hb"],NA:["h","H","hB","hb"],PA:["h","H","hB","hb"],PR:["h","H","hB","hb"],VE:["h","H","hB","hb"],AC:["H","h","hb","hB"],AI:["H","h","hb","hB"],BW:["H","h","hb","hB"],BZ:["H","h","hb","hB"],CC:["H","h","hb","hB"],CK:["H","h","hb","hB"],CX:["H","h","hb","hB"],DG:["H","h","hb","hB"],FK:["H","h","hb","hB"],GB:["H","h","hb","hB"],GG:["H","h","hb","hB"],GI:["H","h","hb","hB"],IE:["H","h","hb","hB"],IM:["H","h","hb","hB"],IO:["H","h","hb","hB"],JE:["H","h","hb","hB"],LT:["H","h","hb","hB"],MK:["H","h","hb","hB"],MN:["H","h","hb","hB"],MS:["H","h","hb","hB"],NF:["H","h","hb","hB"],NG:["H","h","hb","hB"],NR:["H","h","hb","hB"],NU:["H","h","hb","hB"],PN:["H","h","hb","hB"],SH:["H","h","hb","hB"],SX:["H","h","hb","hB"],TA:["H","h","hb","hB"],ZA:["H","h","hb","hB"],"af-ZA":["H","h","hB","hb"],AR:["H","h","hB","hb"],CL:["H","h","hB","hb"],CR:["H","h","hB","hb"],CU:["H","h","hB","hb"],EA:["H","h","hB","hb"],"es-BO":["H","h","hB","hb"],"es-BR":["H","h","hB","hb"],"es-EC":["H","h","hB","hb"],"es-ES":["H","h","hB","hb"],"es-GQ":["H","h","hB","hb"],"es-PE":["H","h","hB","hb"],GT:["H","h","hB","hb"],HN:["H","h","hB","hb"],IC:["H","h","hB","hb"],KG:["H","h","hB","hb"],KM:["H","h","hB","hb"],LK:["H","h","hB","hb"],MA:["H","h","hB","hb"],MX:["H","h","hB","hb"],NI:["H","h","hB","hb"],PY:["H","h","hB","hb"],SV:["H","h","hB","hb"],UY:["H","h","hB","hb"],JP:["H","h","K"],AD:["H","hB"],AM:["H","hB"],AO:["H","hB"],AT:["H","hB"],AW:["H","hB"],BE:["H","hB"],BF:["H","hB"],BJ:["H","hB"],BL:["H","hB"],BR:["H","hB"],CG:["H","hB"],CI:["H","hB"],CV:["H","hB"],DE:["H","hB"],EE:["H","hB"],FR:["H","hB"],GA:["H","hB"],GF:["H","hB"],GN:["H","hB"],GP:["H","hB"],GW:["H","hB"],HR:["H","hB"],IL:["H","hB"],IT:["H","hB"],KZ:["H","hB"],MC:["H","hB"],MD:["H","hB"],MF:["H","hB"],MQ:["H","hB"],MZ:["H","hB"],NC:["H","hB"],NL:["H","hB"],PM:["H","hB"],PT:["H","hB"],RE:["H","hB"],RO:["H","hB"],SI:["H","hB"],SR:["H","hB"],ST:["H","hB"],TG:["H","hB"],TR:["H","hB"],WF:["H","hB"],YT:["H","hB"],BD:["h","hB","H"],PK:["h","hB","H"],AZ:["H","hB","h"],BA:["H","hB","h"],BG:["H","hB","h"],CH:["H","hB","h"],GE:["H","hB","h"],LI:["H","hB","h"],ME:["H","hB","h"],RS:["H","hB","h"],UA:["H","hB","h"],UZ:["H","hB","h"],XK:["H","hB","h"],AG:["h","hb","H","hB"],AU:["h","hb","H","hB"],BB:["h","hb","H","hB"],BM:["h","hb","H","hB"],BS:["h","hb","H","hB"],CA:["h","hb","H","hB"],DM:["h","hb","H","hB"],"en-001":["h","hb","H","hB"],FJ:["h","hb","H","hB"],FM:["h","hb","H","hB"],GD:["h","hb","H","hB"],GM:["h","hb","H","hB"],GU:["h","hb","H","hB"],GY:["h","hb","H","hB"],JM:["h","hb","H","hB"],KI:["h","hb","H","hB"],KN:["h","hb","H","hB"],KY:["h","hb","H","hB"],LC:["h","hb","H","hB"],LR:["h","hb","H","hB"],MH:["h","hb","H","hB"],MP:["h","hb","H","hB"],MW:["h","hb","H","hB"],NZ:["h","hb","H","hB"],SB:["h","hb","H","hB"],SG:["h","hb","H","hB"],SL:["h","hb","H","hB"],SS:["h","hb","H","hB"],SZ:["h","hb","H","hB"],TC:["h","hb","H","hB"],TT:["h","hb","H","hB"],UM:["h","hb","H","hB"],US:["h","hb","H","hB"],VC:["h","hb","H","hB"],VG:["h","hb","H","hB"],VI:["h","hb","H","hB"],ZM:["h","hb","H","hB"],BO:["H","hB","h","hb"],EC:["H","hB","h","hb"],ES:["H","hB","h","hb"],GQ:["H","hB","h","hb"],PE:["H","hB","h","hb"],AE:["h","hB","hb","H"],"ar-001":["h","hB","hb","H"],BH:["h","hB","hb","H"],DZ:["h","hB","hb","H"],EG:["h","hB","hb","H"],EH:["h","hB","hb","H"],HK:["h","hB","hb","H"],IQ:["h","hB","hb","H"],JO:["h","hB","hb","H"],KW:["h","hB","hb","H"],LB:["h","hB","hb","H"],LY:["h","hB","hb","H"],MO:["h","hB","hb","H"],MR:["h","hB","hb","H"],OM:["h","hB","hb","H"],PH:["h","hB","hb","H"],PS:["h","hB","hb","H"],QA:["h","hB","hb","H"],SA:["h","hB","hb","H"],SD:["h","hB","hb","H"],SY:["h","hB","hb","H"],TN:["h","hB","hb","H"],YE:["h","hB","hb","H"],AF:["H","hb","hB","h"],LA:["H","hb","hB","h"],CN:["H","hB","hb","h"],LV:["H","hB","hb","h"],TL:["H","hB","hb","h"],"zu-ZA":["H","hB","hb","h"],CD:["hB","H"],IR:["hB","H"],"hi-IN":["hB","h","H"],"kn-IN":["hB","h","H"],"ml-IN":["hB","h","H"],"te-IN":["hB","h","H"],KH:["hB","h","H","hb"],"ta-IN":["hB","h","hb","H"],BN:["hb","hB","h","H"],MY:["hb","hB","h","H"],ET:["hB","hb","h","H"],"gu-IN":["hB","hb","h","H"],"mr-IN":["hB","hb","h","H"],"pa-IN":["hB","hb","h","H"],TW:["hB","hb","h","H"],KE:["hB","hb","H","h"],MM:["hB","hb","H","h"],TZ:["hB","hb","H","h"],UG:["hB","hb","H","h"]};function ni(e){var t=e.hourCycle;if(void 0===t&&e.hourCycles&&e.hourCycles.length&&(t=e.hourCycles[0]),t)switch(t){case"h24":return"k";case"h23":return"H";case"h12":return"h";case"h11":return"K";default:throw new Error("Invalid hourCycle")}var n,r=e.language;return"root"!==r&&(n=e.maximize().region),(ti[n||""]||ti[r||""]||ti["".concat(r,"-001")]||ti["001"])[0]}var ri=new RegExp("^".concat(Br.source,"*")),ii=new RegExp("".concat(Br.source,"*$"));function ai(e,t){return{start:e,end:t}}var oi=!!String.prototype.startsWith,si=!!String.fromCodePoint,ui=!!Object.fromEntries,ci=!!String.prototype.codePointAt,li=!!String.prototype.trimStart,di=!!String.prototype.trimEnd,hi=Number.isSafeInteger?Number.isSafeInteger:function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e&&Math.abs(e)<=9007199254740991},fi=!0;try{var vi=Ri("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu").exec("a");fi="a"===(vi&&vi[0])}catch(Ff){fi=!1}var pi,mi=oi?function(e,t,n){return e.startsWith(t,n)}:function(e,t,n){return e.slice(n,n+t.length)===t},Ei=si?String.fromCodePoint:function(){for(var e,t="",n=arguments.length,r=0;n>r;){var i;if((e=(i=r++)<0||arguments.length<=i?void 0:arguments[i])>1114111)throw RangeError(e+" is not a valid code point");t+=e<65536?String.fromCharCode(e):String.fromCharCode(55296+((e-=65536)>>10),e%1024+56320)}return t},gi=ui?Object.fromEntries:function(e){var t,n={},r=wn(e);try{for(r.s();!(t=r.n()).done;){var i=Mn(t.value,2),a=i[0],o=i[1];n[a]=o}}catch(e){r.e(e)}finally{r.f()}return n},_i=ci?function(e,t){return e.codePointAt(t)}:function(e,t){var n=e.length;if(!(t<0||t>=n)){var r,i=e.charCodeAt(t);return i<55296||i>56319||t+1===n||(r=e.charCodeAt(t+1))<56320||r>57343?i:r-56320+(i-55296<<10)+65536}},yi=li?function(e){return e.trimStart()}:function(e){return e.replace(ri,"")},Ci=di?function(e){return e.trimEnd()}:function(e){return e.replace(ii,"")};function Ri(e,t){return new RegExp(e,t)}if(fi){var Ti=Ri("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");pi=function(e,t){Ti.lastIndex=t;var n=Ti.exec(e);return n&&void 0!==n[1]&&null!==n[1]?n[1]:""}}else pi=function(e,t){for(var n=[];;){var r=_i(e,t);if(void 0===r||Oi(r)||bi(r))break;n.push(r),t+=r>=65536?2:1}return Ei.apply(void 0,n)};var Si=function(){return Xn(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Kn(this,e),this.message=t,this.position={offset:0,line:1,column:1},this.ignoreTag=!!n.ignoreTag,this.locale=n.locale,this.requiresOtherClause=!!n.requiresOtherClause,this.shouldParseSkeletons=!!n.shouldParseSkeletons},[{key:"parse",value:function(){if(0!==this.offset())throw Error("parser can only be used once");return this.parseMessage(0,"",!1)}},{key:"parseMessage",value:function(e,t,n){for(var r=[];!this.isEOF();){var i=this.char();if(123===i){var a=this.parseArgument(e,n);if(a.err)return a;r.push(a.val)}else{if(125===i&&e>0)break;if(35!==i||"plural"!==t&&"selectordinal"!==t){if(60===i&&!this.ignoreTag&&47===this.peek()){if(n)break;return this.error(Tr.UNMATCHED_CLOSING_TAG,ai(this.clonePosition(),this.clonePosition()))}if(60===i&&!this.ignoreTag&&Ii(this.peek()||0)){var o=this.parseTag(e,t);if(o.err)return o;r.push(o.val)}else{var s=this.parseLiteral(e,t);if(s.err)return s;r.push(s.val)}}else{var u=this.clonePosition();this.bump(),r.push({type:Sr.pound,location:ai(u,this.clonePosition())})}}}return{val:r,err:null}}},{key:"parseTag",value:function(e,t){var n=this.clonePosition();this.bump();var r=this.parseTagName();if(this.bumpSpace(),this.bumpIf("/>"))return{val:{type:Sr.literal,value:"<".concat(r,"/>"),location:ai(n,this.clonePosition())},err:null};if(this.bumpIf(">")){var i=this.parseMessage(e+1,t,!0);if(i.err)return i;var a=i.val,o=this.clonePosition();if(this.bumpIf("</")){if(this.isEOF()||!Ii(this.char()))return this.error(Tr.INVALID_TAG,ai(o,this.clonePosition()));var s=this.clonePosition();return r!==this.parseTagName()?this.error(Tr.UNMATCHED_CLOSING_TAG,ai(s,this.clonePosition())):(this.bumpSpace(),this.bumpIf(">")?{val:{type:Sr.tag,value:r,children:a,location:ai(n,this.clonePosition())},err:null}:this.error(Tr.INVALID_TAG,ai(o,this.clonePosition())))}return this.error(Tr.UNCLOSED_TAG,ai(n,this.clonePosition()))}return this.error(Tr.INVALID_TAG,ai(n,this.clonePosition()))}},{key:"parseTagName",value:function(){var e=this.offset();for(this.bump();!this.isEOF()&&Ai(this.char());)this.bump();return this.message.slice(e,this.offset())}},{key:"parseLiteral",value:function(e,t){for(var n=this.clonePosition(),r="";;){var i=this.tryParseQuote(t);if(i)r+=i;else{var a=this.tryParseUnquoted(e,t);if(a)r+=a;else{var o=this.tryParseLeftAngleBracket();if(!o)break;r+=o}}}var s=ai(n,this.clonePosition());return{val:{type:Sr.literal,value:r,location:s},err:null}}},{key:"tryParseLeftAngleBracket",value:function(){return this.isEOF()||60!==this.char()||!this.ignoreTag&&(Ii(e=this.peek()||0)||47===e)?null:(this.bump(),"<");var e}},{key:"tryParseQuote",value:function(e){if(this.isEOF()||39!==this.char())return null;switch(this.peek()){case 39:return this.bump(),this.bump(),"'";case 123:case 60:case 62:case 125:break;case 35:if("plural"===e||"selectordinal"===e)break;return null;default:return null}this.bump();var t=[this.char()];for(this.bump();!this.isEOF();){var n=this.char();if(39===n){if(39!==this.peek()){this.bump();break}t.push(39),this.bump()}else t.push(n);this.bump()}return Ei.apply(void 0,t)}},{key:"tryParseUnquoted",value:function(e,t){if(this.isEOF())return null;var n=this.char();return 60===n||123===n||35===n&&("plural"===t||"selectordinal"===t)||125===n&&e>0?null:(this.bump(),Ei(n))}},{key:"parseArgument",value:function(e,t){var n=this.clonePosition();if(this.bump(),this.bumpSpace(),this.isEOF())return this.error(Tr.EXPECT_ARGUMENT_CLOSING_BRACE,ai(n,this.clonePosition()));if(125===this.char())return this.bump(),this.error(Tr.EMPTY_ARGUMENT,ai(n,this.clonePosition()));var r=this.parseIdentifierIfPossible().value;if(!r)return this.error(Tr.MALFORMED_ARGUMENT,ai(n,this.clonePosition()));if(this.bumpSpace(),this.isEOF())return this.error(Tr.EXPECT_ARGUMENT_CLOSING_BRACE,ai(n,this.clonePosition()));switch(this.char()){case 125:return this.bump(),{val:{type:Sr.argument,value:r,location:ai(n,this.clonePosition())},err:null};case 44:return this.bump(),this.bumpSpace(),this.isEOF()?this.error(Tr.EXPECT_ARGUMENT_CLOSING_BRACE,ai(n,this.clonePosition())):this.parseArgumentOptions(e,t,r,n);default:return this.error(Tr.MALFORMED_ARGUMENT,ai(n,this.clonePosition()))}}},{key:"parseIdentifierIfPossible",value:function(){var e=this.clonePosition(),t=this.offset(),n=pi(this.message,t),r=t+n.length;return this.bumpTo(r),{value:n,location:ai(e,this.clonePosition())}}},{key:"parseArgumentOptions",value:function(e,t,n,r){var i=this.clonePosition(),a=this.parseIdentifierIfPossible().value,o=this.clonePosition();switch(a){case"":return this.error(Tr.EXPECT_ARGUMENT_TYPE,ai(i,o));case"number":case"price":case"date":case"time":this.bumpSpace();var s=null;if(this.bumpIf(",")){this.bumpSpace();var u=this.clonePosition(),c=this.parseSimpleArgStyleIfPossible();if(c.err)return c;var l=Ci(c.val);if(0===l.length)return this.error(Tr.EXPECT_ARGUMENT_STYLE,ai(this.clonePosition(),this.clonePosition()));s={style:l,styleLocation:ai(u,this.clonePosition())}}var d=this.tryParseArgumentClose(r);if(d.err)return d;var h=ai(r,this.clonePosition());if(s&&s.style&&mi(s.style,"::",0)){var f=yi(s.style.slice(2));if("number"===a){var v=this.parseNumberSkeletonFromString(f,s.styleLocation);return v.err?v:{val:{type:Sr.number,value:n,location:h,style:v.val},err:null}}if(0===f.length)return this.error(Tr.EXPECT_DATE_TIME_SKELETON,h);var p=f;this.locale&&(p=function(e,t){for(var n="",r=0;r<e.length;r++){var i=e.charAt(r);if("j"===i){for(var a=0;r+1<e.length&&e.charAt(r+1)===i;)a++,r++;var o=1+(1&a),s=a<2?1:3+(a>>1),u=ni(t);for("H"!=u&&"k"!=u||(s=0);s-- >0;)n+="a";for(;o-- >0;)n=u+n}else n+="J"===i?"H":i}return n}(f,this.locale));var m={type:Ir.dateTime,pattern:p,location:s.styleLocation,parsedOptions:this.shouldParseSkeletons?Vr(p):{}};return{val:{type:"date"===a?Sr.date:Sr.time,value:n,location:h,style:m},err:null}}return{val:{type:"number"===a?Sr.number:"price"===a?Sr.price:"date"===a?Sr.date:Sr.time,value:n,location:h,style:s&&void 0!==s.style&&null!==s.style?s.style:null},err:null};case"plural":case"selectordinal":case"select":var E=this.clonePosition();if(this.bumpSpace(),!this.bumpIf(","))return this.error(Tr.EXPECT_SELECT_ARGUMENT_OPTIONS,ai(E,Object.assign({},E)));this.bumpSpace();var g=this.parseIdentifierIfPossible(),_=0;if("select"!==a&&"offset"===g.value){if(!this.bumpIf(":"))return this.error(Tr.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,ai(this.clonePosition(),this.clonePosition()));this.bumpSpace();var y=this.tryParseDecimalInteger(Tr.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,Tr.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE);if(y.err)return y;this.bumpSpace(),g=this.parseIdentifierIfPossible(),_=y.val}var C=this.tryParsePluralOrSelectOptions(e,a,t,g);if(C.err)return C;var R=this.tryParseArgumentClose(r);if(R.err)return R;var T=ai(r,this.clonePosition());return"select"===a?{val:{type:Sr.select,value:n,options:gi(C.val),location:T},err:null}:{val:{type:Sr.plural,value:n,options:gi(C.val),offset:_,pluralType:"plural"===a?"cardinal":"ordinal",location:T},err:null};default:return this.error(Tr.INVALID_ARGUMENT_TYPE,ai(i,o))}}},{key:"tryParseArgumentClose",value:function(e){return this.isEOF()||125!==this.char()?this.error(Tr.EXPECT_ARGUMENT_CLOSING_BRACE,ai(e,this.clonePosition())):(this.bump(),{val:!0,err:null})}},{key:"parseSimpleArgStyleIfPossible",value:function(){for(var e=0,t=this.clonePosition();!this.isEOF();)switch(this.char()){case 39:this.bump();var n=this.clonePosition();if(!this.bumpUntil("'"))return this.error(Tr.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE,ai(n,this.clonePosition()));this.bump();break;case 123:e+=1,this.bump();break;case 125:if(!(e>0))return{val:this.message.slice(t.offset,this.offset()),err:null};e-=1;break;default:this.bump()}return{val:this.message.slice(t.offset,this.offset()),err:null}}},{key:"parseNumberSkeletonFromString",value:function(e,t){var n=[];try{n=function(e){if(0===e.length)throw new Error("Number skeleton cannot be empty");for(var t=e.split(zr).filter(function(e){return e.length>0}),n=[],r=0,i=t;r<i.length;r++){var a=i[r].split("/");if(0===a.length)throw new Error("Invalid number skeleton");for(var o=a[0],s=a.slice(1),u=0,c=s;u<c.length;u++)if(0===c[u].length)throw new Error("Invalid number skeleton");n.push({stem:o,options:s})}return n}(e)}catch(e){return this.error(Tr.INVALID_NUMBER_SKELETON,t)}return{val:{type:Ir.number,tokens:n,location:t,parsedOptions:this.shouldParseSkeletons?ei(n):{}},err:null}}},{key:"tryParsePluralOrSelectOptions",value:function(e,t,n,r){for(var i=!1,a=[],o=new Set,s=r.value,u=r.location;;){if(0===s.length){var c=this.clonePosition();if("select"===t||!this.bumpIf("="))break;var l=this.tryParseDecimalInteger(Tr.EXPECT_PLURAL_ARGUMENT_SELECTOR,Tr.INVALID_PLURAL_ARGUMENT_SELECTOR);if(l.err)return l;u=ai(c,this.clonePosition()),s=this.message.slice(c.offset,this.offset())}if(o.has(s))return this.error("select"===t?Tr.DUPLICATE_SELECT_ARGUMENT_SELECTOR:Tr.DUPLICATE_PLURAL_ARGUMENT_SELECTOR,u);"other"===s&&(i=!0),this.bumpSpace();var d=this.clonePosition();if(!this.bumpIf("{"))return this.error("select"===t?Tr.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT:Tr.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT,ai(this.clonePosition(),this.clonePosition()));var h=this.parseMessage(e+1,t,n);if(h.err)return h;var f=this.tryParseArgumentClose(d);if(f.err)return f;a.push([s,{value:h.val,location:ai(d,this.clonePosition())}]),o.add(s),this.bumpSpace();var v=this.parseIdentifierIfPossible();s=v.value,u=v.location}return 0===a.length?this.error("select"===t?Tr.EXPECT_SELECT_ARGUMENT_SELECTOR:Tr.EXPECT_PLURAL_ARGUMENT_SELECTOR,ai(this.clonePosition(),this.clonePosition())):this.requiresOtherClause&&!i?this.error(Tr.MISSING_OTHER_CLAUSE,ai(this.clonePosition(),this.clonePosition())):{val:a,err:null}}},{key:"tryParseDecimalInteger",value:function(e,t){var n=1,r=this.clonePosition();this.bumpIf("+")||this.bumpIf("-")&&(n=-1);for(var i=!1,a=0;!this.isEOF();){var o=this.char();if(!(o>=48&&o<=57))break;i=!0,a=10*a+(o-48),this.bump()}var s=ai(r,this.clonePosition());return i?hi(a*=n)?{val:a,err:null}:this.error(t,s):this.error(e,s)}},{key:"offset",value:function(){return this.position.offset}},{key:"isEOF",value:function(){return this.offset()===this.message.length}},{key:"clonePosition",value:function(){return{offset:this.position.offset,line:this.position.line,column:this.position.column}}},{key:"char",value:function(){var e=this.position.offset;if(e>=this.message.length)throw Error("out of bound");var t=_i(this.message,e);if(void 0===t)throw Error("Offset ".concat(e," is at invalid UTF-16 code unit boundary"));return t}},{key:"error",value:function(e,t){return{val:null,err:{kind:e,message:this.message,location:t}}}},{key:"bump",value:function(){if(!this.isEOF()){var e=this.char();10===e?(this.position.line+=1,this.position.column=1,this.position.offset+=1):(this.position.column+=1,this.position.offset+=e<65536?1:2)}}},{key:"bumpIf",value:function(e){if(mi(this.message,e,this.offset())){for(var t=0;t<e.length;t++)this.bump();return!0}return!1}},{key:"bumpUntil",value:function(e){var t=this.offset(),n=this.message.indexOf(e,t);return n>=0?(this.bumpTo(n),!0):(this.bumpTo(this.message.length),!1)}},{key:"bumpTo",value:function(e){if(this.offset()>e)throw Error("targetOffset ".concat(e," must be greater than or equal to the current offset ").concat(this.offset()));for(e=Math.min(e,this.message.length);;){var t=this.offset();if(t===e)break;if(t>e)throw Error("targetOffset ".concat(e," is at invalid UTF-16 code unit boundary"));if(this.bump(),this.isEOF())break}}},{key:"bumpSpace",value:function(){for(;!this.isEOF()&&Oi(this.char());)this.bump()}},{key:"peek",value:function(){if(this.isEOF())return null;var e=this.char(),t=this.offset(),n=this.message.charCodeAt(t+(e>=65536?2:1));return null!=n?n:null}}])}();function Ii(e){return e>=97&&e<=122||e>=65&&e<=90}function Ai(e){return 45===e||46===e||e>=48&&e<=57||95===e||e>=97&&e<=122||e>=65&&e<=90||183==e||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8255&&e<=8256||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039}function Oi(e){return e>=9&&e<=13||32===e||133===e||e>=8206&&e<=8207||8232===e||8233===e}function bi(e){return e>=33&&e<=35||36===e||e>=37&&e<=39||40===e||41===e||42===e||43===e||44===e||45===e||e>=46&&e<=47||e>=58&&e<=59||e>=60&&e<=62||e>=63&&e<=64||91===e||92===e||93===e||94===e||96===e||123===e||124===e||125===e||126===e||161===e||e>=162&&e<=165||166===e||167===e||169===e||171===e||172===e||174===e||176===e||177===e||182===e||187===e||191===e||215===e||247===e||e>=8208&&e<=8213||e>=8214&&e<=8215||8216===e||8217===e||8218===e||e>=8219&&e<=8220||8221===e||8222===e||8223===e||e>=8224&&e<=8231||e>=8240&&e<=8248||8249===e||8250===e||e>=8251&&e<=8254||e>=8257&&e<=8259||8260===e||8261===e||8262===e||e>=8263&&e<=8273||8274===e||8275===e||e>=8277&&e<=8286||e>=8592&&e<=8596||e>=8597&&e<=8601||e>=8602&&e<=8603||e>=8604&&e<=8607||8608===e||e>=8609&&e<=8610||8611===e||e>=8612&&e<=8613||8614===e||e>=8615&&e<=8621||8622===e||e>=8623&&e<=8653||e>=8654&&e<=8655||e>=8656&&e<=8657||8658===e||8659===e||8660===e||e>=8661&&e<=8691||e>=8692&&e<=8959||e>=8960&&e<=8967||8968===e||8969===e||8970===e||8971===e||e>=8972&&e<=8991||e>=8992&&e<=8993||e>=8994&&e<=9e3||9001===e||9002===e||e>=9003&&e<=9083||9084===e||e>=9085&&e<=9114||e>=9115&&e<=9139||e>=9140&&e<=9179||e>=9180&&e<=9185||e>=9186&&e<=9254||e>=9255&&e<=9279||e>=9280&&e<=9290||e>=9291&&e<=9311||e>=9472&&e<=9654||9655===e||e>=9656&&e<=9664||9665===e||e>=9666&&e<=9719||e>=9720&&e<=9727||e>=9728&&e<=9838||9839===e||e>=9840&&e<=10087||10088===e||10089===e||10090===e||10091===e||10092===e||10093===e||10094===e||10095===e||10096===e||10097===e||10098===e||10099===e||10100===e||10101===e||e>=10132&&e<=10175||e>=10176&&e<=10180||10181===e||10182===e||e>=10183&&e<=10213||10214===e||10215===e||10216===e||10217===e||10218===e||10219===e||10220===e||10221===e||10222===e||10223===e||e>=10224&&e<=10239||e>=10240&&e<=10495||e>=10496&&e<=10626||10627===e||10628===e||10629===e||10630===e||10631===e||10632===e||10633===e||10634===e||10635===e||10636===e||10637===e||10638===e||10639===e||10640===e||10641===e||10642===e||10643===e||10644===e||10645===e||10646===e||10647===e||10648===e||e>=10649&&e<=10711||10712===e||10713===e||10714===e||10715===e||e>=10716&&e<=10747||10748===e||10749===e||e>=10750&&e<=11007||e>=11008&&e<=11055||e>=11056&&e<=11076||e>=11077&&e<=11078||e>=11079&&e<=11084||e>=11085&&e<=11123||e>=11124&&e<=11125||e>=11126&&e<=11157||11158===e||e>=11159&&e<=11263||e>=11776&&e<=11777||11778===e||11779===e||11780===e||11781===e||e>=11782&&e<=11784||11785===e||11786===e||11787===e||11788===e||11789===e||e>=11790&&e<=11798||11799===e||e>=11800&&e<=11801||11802===e||11803===e||11804===e||11805===e||e>=11806&&e<=11807||11808===e||11809===e||11810===e||11811===e||11812===e||11813===e||11814===e||11815===e||11816===e||11817===e||e>=11818&&e<=11822||11823===e||e>=11824&&e<=11833||e>=11834&&e<=11835||e>=11836&&e<=11839||11840===e||11841===e||11842===e||e>=11843&&e<=11855||e>=11856&&e<=11857||11858===e||e>=11859&&e<=11903||e>=12289&&e<=12291||12296===e||12297===e||12298===e||12299===e||12300===e||12301===e||12302===e||12303===e||12304===e||12305===e||e>=12306&&e<=12307||12308===e||12309===e||12310===e||12311===e||12312===e||12313===e||12314===e||12315===e||12316===e||12317===e||e>=12318&&e<=12319||12320===e||12336===e||64830===e||64831===e||e>=65093&&e<=65094}function Li(e){e.forEach(function(e){if(delete e.location,Ur(e)||Dr(e))for(var t in e.options)delete e.options[t].location,Li(e.options[t].value);else Pr(e)&&Fr(e.style)||(Nr(e)||kr(e))&&xr(e.style)?delete e.style.location:wr(e)&&Li(e.children)})}function Pi(e,t){var n=t&&t.cache?t.cache:xi,r=t&&t.serializer?t.serializer:Mi;return(t&&t.strategy?t.strategy:Di)(e,{cache:n,serializer:r})}function Ni(e,t,n,r){var i,a=null==(i=r)||"number"==typeof i||"boolean"==typeof i?r:n(r),o=t.get(a);return void 0===o&&(o=e.call(this,r),t.set(a,o)),o}function ki(e,t,n){var r=Array.prototype.slice.call(arguments,3),i=n(r),a=t.get(i);return void 0===a&&(a=e.apply(this,r),t.set(i,a)),a}function Ui(e,t,n,r,i){return n.bind(t,e,r,i)}function Di(e,t){return Ui(e,this,1===e.length?Ni:ki,t.cache.create(),t.serializer)}var Mi=function(){return JSON.stringify(arguments)};function wi(){this.cache=Object.create(null)}wi.prototype.get=function(e){return this.cache[e]},wi.prototype.set=function(e,t){this.cache[e]=t};var Fi,xi={create:function(){return new wi}},Hi={variadic:function(e,t){return Ui(e,this,ki,t.cache.create(),t.serializer)},monadic:function(e,t){return Ui(e,this,Ni,t.cache.create(),t.serializer)}};!function(e){e.MISSING_VALUE="MISSING_VALUE",e.INVALID_VALUE="INVALID_VALUE",e.MISSING_INTL_API="MISSING_INTL_API"}(Fi||(Fi={}));var Bi=function(e){function t(e,n,r){var i;return Kn(this,t),(i=Bn(this,t,[e])).code=n,i.originalMessage=r,i}return zn(t,e),Xn(t,[{key:"toString",value:function(){return"[formatjs Error: ".concat(this.code,"] ").concat(this.message)}}])}(Pn(Error)),Wi=function(e){function t(e,n,r,i){return Kn(this,t),Bn(this,t,['Invalid values for "'.concat(e,'": "').concat(n,'". Options are "').concat(Object.keys(r).join('", "'),'"'),Fi.INVALID_VALUE,i])}return zn(t,e),Xn(t)}(Bi),Vi=function(e){function t(e,n,r){return Kn(this,t),Bn(this,t,['Value for "'.concat(e,'" must be of type ').concat(n),Fi.INVALID_VALUE,r])}return zn(t,e),Xn(t)}(Bi),Gi=function(e){function t(e,n){return Kn(this,t),Bn(this,t,['The intl string context variable "'.concat(e,'" was not provided to the string "').concat(n,'"'),Fi.MISSING_VALUE,n])}return zn(t,e),Xn(t)}(Bi);function zi(e){return void 0!==e.getLocale}var ji,Yi=new Map([["no","nb"],["iw","he"],["in","id"],["ji","yi"]]),Ki=function(){function e(){Kn(this,e)}return Xn(e,null,[{key:"getCanonicalLocaleString",value:function(t){return Array.isArray(t)?t.map(function(t){return e.getCanonicalLocale(e.forLocaleStringInternal(t)).toLocaleString()}):e.getCanonicalLocale(e.forLocaleStringInternal(t)).toLocaleString()}},{key:"getCanonicalLocale",value:function(t){return null==t&&(t=new Intl.Locale((new Intl.NumberFormat).resolvedOptions().locale)),(t=e.processLocale(t)).numberingSystem?t:t=new Intl.Locale(t,{numberingSystem:"latn"})}},{key:"processLocale",value:function(e){if(e.toLocaleString().startsWith("und"))return e;var t=Intl.NumberFormat.supportedLocalesOf(e.toLocaleString());if(0===t.length){var n=Yi.get(e.language);return n?new Intl.Locale(e.baseName.replace(e.language,n)):(console.log("Unsupported locale: ".concat(e.toLocaleString())),new Intl.Locale("und"))}return new Intl.Locale(t[0])}},{key:"forLocaleStringInternal",value:function(e){return e?new Intl.Locale(e.trim().replace(/_/g,"-")):void 0}}])}(),qi=Object.freeze({__proto__:null,LocaleUtil:Ki});function Xi(e){return"function"==typeof e}function Zi(e){return"function"==typeof e}function Qi(e,t,n,r,i,a,o,s,u){if(1===e.length&&br(e[0]))return[{type:ji.literal,value:e[0].value}];var c,l,d;zi(t)?(c=t,l=t.getLocale(),d=t.getTimeZone()):l=t,l=u||Ki.getCanonicalLocaleString(l);var h,f,v=[],p=wn(e);try{for(p.s();!(h=p.n()).done;){var m=h.value;if(br(m))v.push({type:ji.literal,value:m.value});else if(Mr(m))"number"==typeof a&&v.push({type:ji.literal,value:n.getNumberFormat(l).format(a)});else{var E=m.value;if(!i)throw new Gi(E,o);if(wr(m)){var g=m.children,_=m.value,y=i[_];if(s&&(y=function(e){return e}),!Xi(y))throw new Vi(_,"function",o);var C=y(Qi(g,t,n,r,i,a,o,s,l).map(function(e){return e.value}));Array.isArray(C)||(C=[C]),s?v.push({type:ji.object,value:s.createElement.apply(s,[_,{}].concat(Fn(C)))}):v.push.apply(v,Fn(C.map(function(e){return{type:"string"==typeof e?ji.literal:ji.object,value:e}})))}else{if(!i||!(E in i))throw new Gi(E,o);var R=i[E];if(Lr(m))R&&"string"!=typeof R&&"number"!=typeof R?Zi(R)&&(R=R(s,{},[])):R="string"==typeof R||"number"==typeof R?String(R):"",v.push({type:"string"==typeof R?ji.literal:ji.object,value:R});else if(Nr(m)){var T="string"==typeof m.style?r.date[m.style]:xr(m.style)?m.style.parsedOptions:{};void 0!==d&&(T.timeZone=d),v.push({type:ji.literal,value:n.getDateTimeFormat(l,T).format(R)})}else if(kr(m)){var S="string"==typeof m.style?r.time[m.style]:xr(m.style)?m.style.parsedOptions:r.time.medium;void 0!==d&&(S.timeZone=d),v.push({type:ji.literal,value:n.getDateTimeFormat(l,S).format(R)})}else if(Pr(m)){var I="string"==typeof m.style?r.number[m.style]:Fr(m.style)?m.style.parsedOptions:void 0;I&&I.scale&&(R*=I.scale||1),v.push({type:ji.literal,value:n.getNumberFormat(l,I).format(R)})}else if(Hr(m)){var A="string"==typeof m.style?r.price[m.style]:void 0,O=n.getPriceFormat(c||l,A).format(R,A);v.push({type:"string"==typeof O?ji.literal:ji.object,value:O})}else if(Ur(m)){var b=m.options[R]||m.options.other;if(!b)throw new Wi(m.value,R,Object.keys(m.options),o);v.push.apply(v,Fn(Qi(b.value,t,n,r,i,a,o,s,l)))}else if(Dr(m)){var L=m.options["=".concat(R)];if(!L){if(!Intl.PluralRules)throw new Bi('Intl.PluralRules is not available in this environment.\nTry polyfilling it using "@formatjs/intl-pluralrules"\n',Fi.MISSING_INTL_API,o);var P=n.getPluralRules(l,{type:m.pluralType}).select(R-(m.offset||0));L=m.options[P]||m.options.other}if(!L)throw new Wi(m.value,R,Object.keys(m.options),o);v.push.apply(v,Fn(Qi(L.value,t,n,r,i,R-(m.offset||0),o,s,l)))}}}}}catch(e){p.e(e)}finally{p.f()}return s?v:(f=v).length<2?f:f.reduce(function(e,t){var n=e[e.length-1];return n&&n.type===ji.literal&&t.type===ji.literal?n.value+=t.value:e.push(t),e},[])}!function(e){e[e.literal=0]="literal",e[e.object=1]="object"}(ji||(ji={}));var Ji=function(){return Xn(function e(){Kn(this,e)},[{key:"getObfuscatedMarketplaceId",value:function(){}},{key:"getDefaultLocale",value:function(){return Intl.DateTimeFormat().resolvedOptions().locale}},{key:"getDefaultCurrency",value:function(){}}])}(),$i=function(e){function t(){return Kn(this,t),Bn(this,t,arguments)}return zn(t,e),Xn(t)}(Ji),ea=function(){function e(){Kn(this,e)}return Xn(e,[{key:"getMarketplace",value:function(){return e.emptyMarketplace}}])}();ea.emptyMarketplace=new $i;var ta=function(){function e(){Kn(this,e)}return Xn(e,null,[{key:"setProvider",value:function(t){e.marketplaceProvider=t}},{key:"provider",value:function(){return e.marketplaceProvider||(e.marketplaceProvider=new ea),e.marketplaceProvider}}])}();ta.marketplaceProvider=void 0;var na={A2Q3Y263D00KWC:{name:"BR",locale:"pt-BR",currency:"BRL"},AZXD3QD5B39HD:{name:"BR_DEVO",locale:"pt-BR",currency:"BRL"},A2EUQ1WTGCTBG2:{name:"CA",locale:"en-CA",currency:"CAD"},A2WDZJZ5TCRMLH:{name:"CL",locale:"es-CL",currency:"CLP"},A2IDBVIE7EAGN4:{name:"CL_DEVO",locale:"es-CL",currency:"CLP"},A1ZXRLSQW2V54D:{name:"CO",locale:"es-CO",currency:"COP"},A1NOHO22DE3OHQ:{name:"CO_DEVO",locale:"es-CO",currency:"COP"},A1AM78C64UM0Y8:{name:"MX",locale:"es-MX",currency:"MXN"},A3P3J5A7D2ZVXI:{name:"MX_DEVO",locale:"es-MX",currency:"MXN"},ATVPDKIKX0DER:{name:"US",locale:"en-US",currency:"USD"},AGWSWK15IEJJ7:{name:"PYOP_US_PROD",locale:"en-US",currency:"USD"},A3BXB0YN3XH17H:{name:"PYOP_US_PROD_SANDBOX",locale:"en-US",currency:"USD"},A35A4JO734ER04:{name:"PYOP_US_DEVO",locale:"en-US",currency:"USD"},A341L3VCFKNMIY:{name:"PYOP_US_DEVO_SANDBOX",locale:"en-US",currency:"USD"},A2CE4MDCUAASDP:{name:"PYOP_CA_PROD",locale:"en-CA",currency:"CAD"},A2VJI655WT2I0B:{name:"PYOP_CA_PROD_SANDBOX",locale:"en-CA",currency:"CAD"},A1NWP2E4EKQP94:{name:"PYOP_CA_DEVO",locale:"en-CA",currency:"CAD"},ASBG27DKM7EX6:{name:"PYOP_CA_DEVO_SANDBOX",locale:"en-CA",currency:"CAD"},A2VIGQ35RCS4UG:{name:"AE",locale:"en-AE",currency:"AED"},A34GYYCZVDBSIK:{name:"AE_DEVO",locale:"en-AE",currency:"AED"},A1PA6795UKMFR9:{name:"DE",locale:"de-DE",currency:"EUR"},AMEN7PMS3EDWL:{name:"BE",locale:"fr-FR",currency:"EUR"},A1YFOMBPFBRY22:{name:"BE_DEVO",locale:"fr-FR",currency:"EUR"},ARBP9OOSHTCHU:{name:"EG",locale:"en-AE",currency:"EGP"},AUJPM9XGFJRC7:{name:"EG_DEVO",locale:"en-AE",currency:"EGP"},A1RKKUPIHCS9HS:{name:"ES",locale:"es-ES",currency:"EUR"},AJZF8LZ1EJVJN:{name:"ES_DEVO",locale:"es-ES",currency:"EUR"},A13V1IB3VIYZZH:{name:"FR",locale:"fr-FR",currency:"EUR"},A1F83G8C2ARO7P:{name:"GB",locale:"en-GB",currency:"GBP"},APJ6JRA9NG5V4:{name:"IT",locale:"it-IT",currency:"EUR"},A3HOBANJMCMD83:{name:"IT_DEVO",locale:"it-IT",currency:"EUR"},A28R8C7NBKEWEA:{name:"IE",locale:"en-IE",currency:"EUR"},AQGJ466SKA0F0:{name:"IE_DEVO",locale:"en-IE",currency:"EUR"},A21TJRUUN4KGV:{name:"IN",locale:"en-IN",currency:"INR"},A2XZLSVIQ0F4JT:{name:"IN_DEVO",locale:"en-IN",currency:"INR"},A3OCL2LJ6GDH9T:{name:"NG",locale:"en-NG",currency:"NGN"},A3PJZM0QIA8QDU:{name:"NG_DEVO",locale:"en-NG",currency:"NGN"},A1805IZSGTT6HS:{name:"NL",locale:"nl-NL",currency:"EUR"},A1M3WC0SJ3A38T:{name:"NL_DEVO",locale:"nl-NL",currency:"EUR"},A1C3SOZRARQ6R3:{name:"PL",locale:"pl-PL",currency:"PLN"},AKY4K4WKH21YQ:{name:"PL_DEVO",locale:"pl-PL",currency:"PLN"},A17E79C6D8DWNP:{name:"SA",locale:"en-AE",currency:"SAR"},A1MQPSGJ6U9Q54:{name:"SA_DEVO",locale:"en-AE",currency:"SAR"},A2NODRKZP88ZB9:{name:"SE",locale:"sv-SE",currency:"SEK"},AT614YYYNOC1S:{name:"SE_DEVO",locale:"sv-SE",currency:"SEK"},A33AVAJ2PDY3EV:{name:"TR",locale:"tr-TR",currency:"TRY"},A3CQBQD3RGPJR8:{name:"TR_DEVO",locale:"tr-TR",currency:"TRY"},AE08WJ6YKNBMC:{name:"ZA",locale:"en-ZA",currency:"ZAR"},A3TFQ1G9L8TQ5L:{name:"ZA_DEVO",locale:"en-ZA",currency:"ZAR"},AZAJMM36N6WQL:{name:"PYOP_UK_PROD",locale:"en-GB",currency:"GBP"},A3M3RRFO9XDT2G:{name:"PYOP_UK_PROD_SANDBOX",locale:"en-GB",currency:"GBP"},A2UWQKHEFGNQY3:{name:"PYOP_UK_DEVO",locale:"en-GB",currency:"GBP"},A2V84NPDZD3ZEH:{name:"PYOP_UK_DEVO_SANDBOX",locale:"en-GB",currency:"GBP"},A53RDEWN57UU5:{name:"PYOP_DE_PROD",locale:"de-DE",currency:"EUR"},A1G8446IYHA4MR:{name:"PYOP_DE_PROD_SANDBOX",locale:"de-DE",currency:"EUR"},A34RX6LWLXD2KA:{name:"PYOP_DE_DEVO",locale:"de-DE",currency:"EUR"},A225AO9WA6YYOF:{name:"PYOP_DE_DEVO_SANDBOX",locale:"de-DE",currency:"EUR"},A3FDG49KKM823Y:{name:"PYOP_IN_PROD",locale:"en-IN",currency:"INR"},A1IAUC0NN979H6:{name:"PYOP_IN_PROD_SANDBOX",locale:"en-IN",currency:"INR"},A18VPDB9UTK24D:{name:"PYOP_IN_DEVO",locale:"en-IN",currency:"INR"},A16Z2XWZJTFS70:{name:"PYOP_IN_DEVO_SANDBOX",locale:"en-IN",currency:"INR"},A39IBJ37TRP1C6:{name:"AU",locale:"en-AU",currency:"AUD"},A1RNPCQ4K8U27I:{name:"AU_DEVO",locale:"en-AU",currency:"AUD"},A1VC38T7YXB528:{name:"JP",locale:"ja-JP",currency:"JPY"},AD2EMQ3L3PG8S:{name:"RU",locale:"ru-RU",currency:"RUB"},A38NPJYVS5YHNH:{name:"RU_DEVO",locale:"ru-RU",currency:"RUB"},A19VAU5U5O7RUS:{name:"SG",locale:"en-SG",currency:"SGD"},A1DQ6JV7I20JSG:{name:"SG_DEVO",locale:"en-SG",currency:"SGD"},A75P1MG8VMU51:{name:"PYOP_JP_PROD",locale:"ja-JP",currency:"JPY"},A31YDYE76E6TCP:{name:"PYOP_JP_PROD_SANDBOX",locale:"ja-JP",currency:"JPY"},A2EFPHRCZ60KI3:{name:"PYOP_JP_DEVO",locale:"ja-JP",currency:"JPY"},A1U1OSY46WLA42:{name:"PYOP_JP_DEVO_SANDBOX",locale:"ja-JP",currency:"JPY"},AAHKV2X7AFYLW:{name:"CN",locale:"zh-CN",currency:"CNY"}},ra=function(e){function t(e,n,r){var i;if(Kn(this,t),i=Bn(this,t),e){i.obfuscatedMarketplaceId=e;var a=na[e];i.defaultLocale=n||(a?a.locale:function(e,t,n,r){var i=Vn(Gn(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof i?function(e){return i.apply(n,e)}:i}(t,"getDefaultLocale",i,3)([])),i.defaultCurrency=r||(a?a.currency:void 0)}else i.obfuscatedMarketplaceId=void 0,i.defaultLocale=void 0,i.defaultCurrency=void 0;return i}return zn(t,e),Xn(t,[{key:"getObfuscatedMarketplaceId",value:function(){return this.obfuscatedMarketplaceId}},{key:"getDefaultLocale",value:function(){return this.defaultLocale}},{key:"getDefaultCurrency",value:function(){return this.defaultCurrency}},{key:"toString",value:function(){return"Marketplace[obfuscatedMarketplaceId=".concat(this.getObfuscatedMarketplaceId(),",defaultLocale=").concat(this.getDefaultLocale(),",defaultCurrency=").concat(this.getDefaultCurrency(),"]")}}],[{key:"getObfuscatedMarketplaceIdMap",value:function(){for(var e=new Map,t=0,n=Object.keys(na);t<n.length;t++){var r=n[t];e.set(na[r].name,r)}return e}}])}(Ji),ia={},aa={};Object.defineProperty(aa,"__esModule",{value:!0}),aa.ConfigType=void 0;var oa=function(){return Xn(function e(t,n){Kn(this,e),this._name=t,this._parent=n},[{key:"parent",get:function(){return this._parent}},{key:"toString",value:function(){return this._name}}])}();aa.ConfigType=oa,oa.MARKETPLACEID_TO_CX_TUPLE=new oa("MARKETPLACEID_TO_CX_TUPLE"),oa.PRICE_FORMAT=new oa("PRICE_FORMAT"),oa.RETAIL_PRICE_FORMAT=new oa("RETAIL_PRICE_FORMAT",oa.PRICE_FORMAT),oa.POINTS_FORMAT=new oa("POINTS_FORMAT"),oa.CX_TUPLE_TO_I18N_DOMAIN=new oa("CX_TUPLE_TO_I18N_DOMAIN"),oa.CX_TUPLE_TO_DEFAULT_PREFERENCES=new oa("CX_TUPLE_TO_DEFAULT_PREFERENCES");var sa={};Object.defineProperty(sa,"__esModule",{value:!0}),sa.ConfigName=void 0;var ua=function(){return Xn(function e(t,n){Kn(this,e),this._name=t,this._returnType=n},[{key:"getReturnType",value:function(){return this._returnType}},{key:"toString",value:function(){return this._name}}])}();sa.ConfigName=ua;var ca={};Object.defineProperty(ca,"__esModule",{value:!0}),ca.QueryOutput=void 0;var la=function(){return Xn(function e(t,n){Kn(this,e),this._name=t,this._returnType=n},[{key:"getReturnType",value:function(){return this._returnType}},{key:"toString",value:function(){return this._name}}])}();ca.QueryOutput=la;var da={},ha={},fa={};Object.defineProperty(fa,"__esModule",{value:!0}),fa.isNullOrUndefined=void 0,fa.isNullOrUndefined=function(e){return null==e||null==e},Object.defineProperty(ha,"__esModule",{value:!0}),ha.ConfigurationData=void 0;var va=fa,pa=function(){return Xn(function e(t){Kn(this,e),this._configs=va.isNullOrUndefined(t)?new Map:t},[{key:"getStringValue",value:function(e){var t=this._configs.get(e);return va.isNullOrUndefined(t)?null:String(t)}},{key:"getNumberValue",value:function(e){var t=this._configs.get(e);if(va.isNullOrUndefined(t))return null;if(t=Number(t),Number.isNaN(t))throw new Error("The value of ".concat(e," cannot be converted to a number"));return t}},{key:"getBooleanValue",value:function(e){var t=this._configs.get(e);return va.isNullOrUndefined(t)?null:"true"===String(t).toLowerCase()}},{key:"getEnumValue",value:function(e,t){var n=this._configs.get(t);if(va.isNullOrUndefined(n))return null;var r=Object.keys(e).filter(function(t){return e[t]==n});return r.length>0?e[r[0]]:null}},{key:"isPrimitiveData",value:function(){return this._configs.size<=1}},{key:"getPrimitiveDataConfigName",value:function(){return 1==this._configs.size?this._configs.keys().next().value:null}},{key:"isEmpty",value:function(){if(0===this._configs.size)return!0;var e,t=wn(this._configs.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;if(!va.isNullOrUndefined(n))return!1}}catch(e){t.e(e)}finally{t.f()}return!0}},{key:"merge",value:function(e){var t,n=wn(e._configs.entries());try{for(n.s();!(t=n.n()).done;){var r=t.value;this._configs.set(r[0],r[1])}}catch(e){n.e(e)}finally{n.f()}return this}},{key:"toString",value:function(){var e,t="{",n=0,r=wn(this._configs.entries());try{for(r.s();!(e=r.n()).done;){var i=e.value;t+="".concat(i[0],":").concat(i[1]),++n!=this._configs.size&&(t+=",")}}catch(e){r.e(e)}finally{r.f()}return t+"}"}}])}();ha.ConfigurationData=pa,Object.defineProperty(da,"__esModule",{value:!0}),da.I18nConfiguration=void 0;var ma=ha,Ea=function(){return Xn(function e(t){Kn(this,e),this._configData=t,this._isPrimitiveDataResult=t.isPrimitiveData()},[{key:"configData",get:function(){return this._configData}},{key:"getStringValue",value:function(){return this.validatePrimitiveResult("getStringValue"),this._configData.getStringValue(this._configData.getPrimitiveDataConfigName())}},{key:"getNumberValue",value:function(){return this.validatePrimitiveResult("getNumberValue"),this._configData.getNumberValue(this._configData.getPrimitiveDataConfigName())}},{key:"getBooleanValue",value:function(){return this.validatePrimitiveResult("getBooleanValue"),this._configData.getBooleanValue(this._configData.getPrimitiveDataConfigName())}},{key:"getEnumValue",value:function(e){return this.validatePrimitiveResult("getEnumValue"),this._configData.getEnumValue(e,this._configData.getPrimitiveDataConfigName())}},{key:"isEmpty",value:function(){return this._configData.isEmpty()}},{key:"validatePrimitiveResult",value:function(e){if(!this._isPrimitiveDataResult)throw new Error("Method ".concat(e," cannot be called on a configuration of type object.\n                Call getConfigData().").concat(e,"(configName) instead."))}},{key:"toString",value:function(){return"I18nConfiguration: ".concat(this._configData)}}])}();da.I18nConfiguration=Ea,Ea.Builder=function(){return Xn(function e(){Kn(this,e),this._configs=new Map},[{key:"addConfiguration",value:function(e,t){return this._configs.set(e,t),this}},{key:"build",value:function(){return new Ea(new ma.ConfigurationData(this._configs))}}])}();var ga={};Object.defineProperty(ga,"__esModule",{value:!0}),ga.DataType=void 0;var _a=function(){return Xn(function e(t){Kn(this,e),this._isPrimitive=t},[{key:"isPrimitive",get:function(){return this._isPrimitive}}])}();ga.DataType=_a,_a.STRING=new _a(!0),_a.INT=new _a(!0),_a.BOOLEAN=new _a(!0),_a.CONFIGURATION_DATA=new _a(!1),_a.ENUM=new _a(!0);var ya={};Object.defineProperty(ya,"__esModule",{value:!0}),ya.I18nArgs=void 0;var Ca=function(){return Xn(function e(){Kn(this,e)},[{key:"toString",value:function(){var e,t="".concat(this.constructor.name,":{"),n=0,r=wn(this.getArgsMap().entries());try{for(r.s();!(e=r.n()).done;){var i=e.value;t+="".concat(i[0],":").concat(i[1]),++n!=this.getArgsMap().size&&(t+=",")}}catch(e){r.e(e)}finally{r.f()}return t+"}"}}])}();ya.I18nArgs=Ca;var Ra={};Object.defineProperty(Ra,"__esModule",{value:!0}),Ra.QueryResolver=void 0;var Ta=function(){return Xn(function e(){Kn(this,e),this._isInitialized=!1},[{key:"validate",value:function(e,t){var n=this.getTargetConfigType();if(e.getConfigType()!==n||t.getConfigType()!==n)throw new Error(this.getValidationErrorMessage())}},{key:"isInitialized",value:function(){return this._isInitialized}},{key:"setInitializedState",value:function(e){this._isInitialized=e}}])}();Ra.QueryResolver=Ta;var Sa={};Object.defineProperty(Sa,"__esModule",{value:!0}),Sa.I18nConfigurationProvider=void 0;var Ia=da,Aa=function(){return Xn(function e(){Kn(this,e)},[{key:"getConfiguration",value:function(e,t){var n;this.validate(e,t);try{n=this.resolveConfiguration(e,t)}catch(r){console.warn("Failed to resolve configuration query with name ".concat(e.toString()," and args ").concat(t.toString(),". Error: ").concat(r)),n=(new Ia.I18nConfiguration.Builder).build()}return n}},{key:"validate",value:function(e,t){if(e.getConfigType()!==t.getConfigType()&&(void 0===t.getConfigType().parent||e.getConfigType()!==t.getConfigType().parent))throw new Error("Input query args type need to match the config name type."+"Found ".concat(e.getConfigType()," for config name, but ").concat(t.getConfigType()," for config args."))}}])}();Sa.I18nConfigurationProvider=Aa;var Oa={};Object.defineProperty(Oa,"__esModule",{value:!0}),Oa.ConfigurationProviderManager=void 0;var ba=function(){function e(t){Kn(this,e),this._provider=t}return Xn(e,null,[{key:"register",value:function(t){if(null==t)throw new Error("Configuration provider cannot be undefined or null");void 0===this.instance?(this._instance=new e(t),console.log("Registered provider ".concat(t.constructor.name," for configuration resolution."))):console.warn("Provider ".concat(this.instance._provider.constructor.name," is already registered. ")+"Ignoring register request for ".concat(t.constructor.name))}},{key:"getProvider",value:function(){if(void 0!==this.instance)return this.instance._provider;console.warn("No provider has been registered yet. Returning undefined.")}},{key:"hasProvider",value:function(){return null!=this.instance}},{key:"instance",get:function(){return this._instance}},{key:"resetInstance",value:function(){this._instance=void 0}}])}();Oa.ConfigurationProviderManager=ba;var La={};Object.defineProperty(La,"__esModule",{value:!0}),La.MarketplaceIdToCxTuple=void 0;var Pa=aa,Na=ga,ka=function(e){function t(e,n){return Kn(this,t),Bn(this,t,[e,n])}return zn(t,e),Xn(t,[{key:"getConfigType",value:function(){return Pa.ConfigType.MARKETPLACEID_TO_CX_TUPLE}}])}(sa.ConfigName);La.MarketplaceIdToCxTuple=ka,ka.CX_ID=new ka("cx_id",Na.DataType.STRING),ka.CX_FAMILY=new ka("cx_family",Na.DataType.STRING);var Ua={};Object.defineProperty(Ua,"__esModule",{value:!0}),Ua.MarketplaceIdToCxTupleArgs=void 0;var Da=aa,Ma=function(e){function t(e){var n;return Kn(this,t),(n=Bn(this,t))._obfuscatedMarketplaceId=e,n}return zn(t,e),Xn(t,[{key:"obfuscatedMarketplaceId",get:function(){return this._obfuscatedMarketplaceId}},{key:"getConfigType",value:function(){return Da.ConfigType.MARKETPLACEID_TO_CX_TUPLE}},{key:"getArgsMap",value:function(){return new Map([["obfuscated_marketplace_id",this._obfuscatedMarketplaceId]])}}])}(ya.I18nArgs);Ua.MarketplaceIdToCxTupleArgs=Ma,Ma.Builder=function(){return Xn(function e(){Kn(this,e)},[{key:"withObfuscatedMarketplaceId",value:function(e){return this.obfuscatedMarketplaceId=e,this}},{key:"build",value:function(){return new Ma(this.obfuscatedMarketplaceId)}}])}();var wa={};Object.defineProperty(wa,"__esModule",{value:!0}),wa.MarketplaceIdToCxTupleResult=void 0;var Fa=ga,xa=function(e){function t(){return Kn(this,t),Bn(this,t,arguments)}return zn(t,e),Xn(t)}(ca.QueryOutput);wa.MarketplaceIdToCxTupleResult=xa,xa.CX_ID=new xa("cx_id",Fa.DataType.STRING),xa.CX_FAMILY=new xa("cx_family",Fa.DataType.STRING);var Ha={};Object.defineProperty(Ha,"__esModule",{value:!0}),Ha.PriceFormat=void 0;var Ba=ga,Wa=aa,Va=function(e){function t(e,n){return Kn(this,t),Bn(this,t,[e,n])}return zn(t,e),Xn(t,[{key:"getConfigType",value:function(){return Wa.ConfigType.PRICE_FORMAT}},{key:"getReturnType",value:function(){return this._returnType}}])}(sa.ConfigName);Ha.PriceFormat=Va,Va.CURRENCY_FORMAT=new Va("currency_format",Ba.DataType.CONFIGURATION_DATA),Va.SYMBOL_PREFIX=new Va("symbol_prefix",Ba.DataType.STRING),Va.CURRENCY_SYMBOL_POSITION=new Va("currency_symbol_position",Ba.DataType.ENUM),Va.TRAILING_ZERO_DISPLAY=new Va("trailing_zero_display",Ba.DataType.ENUM);var Ga={};Object.defineProperty(Ga,"__esModule",{value:!0}),Ga.PriceFormatArgs=void 0;var za=function(e){function t(e,n,r,i,a,o){var s;return Kn(this,t),(s=Bn(this,t))._locale=e,s._currency=n,s._cxFamily=r,s._cxId=i,s._cxProgram=a,s._priceFormatType=o,s}return zn(t,e),Xn(t,[{key:"locale",get:function(){return this._locale}},{key:"currency",get:function(){return this._currency}},{key:"cxFamily",get:function(){return this._cxFamily}},{key:"cxId",get:function(){return this._cxId}},{key:"cxProgram",get:function(){return this._cxProgram}},{key:"priceFormatType",get:function(){return this._priceFormatType}}])}(ya.I18nArgs);Ga.PriceFormatArgs=za;var ja={},Ya={};Object.defineProperty(Ya,"__esModule",{value:!0}),Ya.RetailPriceFormatArgs=void 0;var Ka=aa,qa=function(e){function t(e,n,r,i,a,o){return Kn(this,t),Bn(this,t,[e,n,r,i,a,o])}return zn(t,e),Xn(t,[{key:"getConfigType",value:function(){return Ka.ConfigType.RETAIL_PRICE_FORMAT}},{key:"getArgsMap",value:function(){return new Map([["locale",this._locale],["currency",this._currency],["cx_family",t.RETAIL_CX_FAMILY],["cx_id",this._cxId],["cx_program",this._cxProgram],["price_format_type",this._priceFormatType]])}}])}(Ga.PriceFormatArgs);Ya.RetailPriceFormatArgs=qa,qa.RETAIL_CX_FAMILY="retail",Object.defineProperty(ja,"__esModule",{value:!0}),ja.PriceFormatArgsBuilder=void 0;var Xa=Ya,Za=ia,Qa=function(){return Xn(function e(){Kn(this,e),this._cxProgram=e.EMPTY_CX_PROGRAM},[{key:"withLocale",value:function(e){return this._locale=e,this}},{key:"withCurrency",value:function(e){return this._currency=e,this}},{key:"withCxId",value:function(e){return this._cxId=e,this}},{key:"withCxProgram",value:function(e){return this._cxProgram=e,this}},{key:"withCxFamily",value:function(e){return this._cxFamily=e,this}},{key:"withPriceFormatType",value:function(e){return this._priceFormatType=e,this}},{key:"fromPriceFormatArgs",value:function(e){return this.withCurrency(e.currency).withLocale(e.locale).withCxFamily(e.cxFamily).withCxId(e.cxId).withCxProgram(e.cxProgram).withPriceFormatType(e.priceFormatType)}},{key:"build",value:function(){if(Za.isNullOrUndefined(this._cxFamily)||Xa.RetailPriceFormatArgs.RETAIL_CX_FAMILY===this._cxFamily)return new Xa.RetailPriceFormatArgs(this._locale,this._currency,this._cxFamily,this._cxId,this._cxProgram,this._priceFormatType);throw new Error("CX family ".concat(this._cxFamily," is currently not supported."))}}])}();ja.PriceFormatArgsBuilder=Qa,Qa.EMPTY_CX_PROGRAM="[]";var Ja={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.PriceFormatType=void 0,(t=e.PriceFormatType||(e.PriceFormatType={})).ISO="iso",t.PLURAL="plural",t.AMAZON_SYMBOL="amazonSymbol",t.COMPACT="compact",t.IN_SENTENCE="inSentence"}(Ja);var $a={};Object.defineProperty($a,"__esModule",{value:!0}),$a.PriceFormatResult=void 0;var eo=ga,to=function(e){function t(){return Kn(this,t),Bn(this,t,arguments)}return zn(t,e),Xn(t)}(ca.QueryOutput);$a.PriceFormatResult=to,to.SYMBOL=new to("symbol",eo.DataType.STRING),to.INSERT_SPACE_IN_PATTERN=new to("insert_space_in_pattern",eo.DataType.BOOLEAN),to.FORMAT_PATTERN=new to("format_pattern",eo.DataType.STRING),to.SYMBOL_PREFIX=new to("symbol_prefix",eo.DataType.STRING),to.CURRENCY_SYMBOL_POSITION=new to("currency_symbol_position",eo.DataType.ENUM),to.TRAILING_ZERO_DISPLAY=new to("trailing_zero_display",eo.DataType.ENUM);var no={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.TrailingZeroDisplay=void 0,(t=e.TrailingZeroDisplay||(e.TrailingZeroDisplay={})).AUTO="AUTO",t.HIDE_IF_WHOLE="HIDE_IF_WHOLE"}(no);var ro={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.CurrencySymbolPosition=void 0,(t=e.CurrencySymbolPosition||(e.CurrencySymbolPosition={})).DEFAULT="default",t.START="start",t.END="end"}(ro);var io={};Object.defineProperty(io,"__esModule",{value:!0}),io.PointsFormat=void 0;var ao=ga,oo=aa,so=function(e){function t(e,n){return Kn(this,t),Bn(this,t,[e,n])}return zn(t,e),Xn(t,[{key:"getConfigType",value:function(){return oo.ConfigType.POINTS_FORMAT}}])}(sa.ConfigName);io.PointsFormat=so,so.PATTERN=new so("pattern",ao.DataType.STRING);var uo={};Object.defineProperty(uo,"__esModule",{value:!0}),uo.PointsFormatArgs=void 0;var co=aa,lo=function(e){function t(e,n,r){var i;return Kn(this,t),(i=Bn(this,t))._locale=e,i._programName=n,i._style=r,i}return zn(t,e),Xn(t,[{key:"getConfigType",value:function(){return co.ConfigType.POINTS_FORMAT}},{key:"getArgsMap",value:function(){return new Map([["locale",this._locale],["program_name",this._programName],["style",this._style]])}},{key:"locale",get:function(){return this._locale}},{key:"programName",get:function(){return this._programName}},{key:"style",get:function(){return this._style}}])}(ya.I18nArgs);uo.PointsFormatArgs=lo,lo.Builder=function(){return Xn(function e(){Kn(this,e)},[{key:"withLocale",value:function(e){return this.locale=e,this}},{key:"withProgramName",value:function(e){return this.programName=e,this}},{key:"withStyle",value:function(e){return this.style=e,this}},{key:"build",value:function(){return new lo(this.locale,this.programName,this.style)}}])}();var ho={};Object.defineProperty(ho,"__esModule",{value:!0}),ho.PointsFormatResult=void 0;var fo=ga,vo=function(e){function t(){return Kn(this,t),Bn(this,t,arguments)}return zn(t,e),Xn(t)}(ca.QueryOutput);ho.PointsFormatResult=vo,vo.PATTERN=new vo("pattern",fo.DataType.STRING);var po={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.PointsFormatStyle=void 0,(t=e.PointsFormatStyle||(e.PointsFormatStyle={})).DEFAULT="default",t.IMPLICIT="implicit"}(po);var mo={};Object.defineProperty(mo,"__esModule",{value:!0}),mo.CXTupleToI18nDomain=void 0;var Eo=ga,go=aa,_o=function(e){function t(e,n){return Kn(this,t),Bn(this,t,[e,n])}return zn(t,e),Xn(t,[{key:"getConfigType",value:function(){return go.ConfigType.CX_TUPLE_TO_I18N_DOMAIN}}])}(sa.ConfigName);mo.CXTupleToI18nDomain=_o,_o.I18N_DOMAIN=new _o("i18n_domain",Eo.DataType.STRING);var yo,Co={};Object.defineProperty(Co,"__esModule",{value:!0}),Co.CXTupleToI18nDomainArgs=void 0;var Ro=aa,To=function(e){function t(e,n,r){var i;return Kn(this,t),(i=Bn(this,t))._cxFamily=e,i._cxId=n,i._cxProgram=r,i}return zn(t,e),Xn(t,[{key:"cxFamily",get:function(){return this._cxFamily}},{key:"cxId",get:function(){return this._cxId}},{key:"cxProgram",get:function(){return this._cxProgram}},{key:"getConfigType",value:function(){return Ro.ConfigType.CX_TUPLE_TO_I18N_DOMAIN}},{key:"getArgsMap",value:function(){return new Map([["cx_family",this._cxFamily],["cx_id",this._cxId],["cx_program",this._cxProgram]])}}])}(ya.I18nArgs);Co.CXTupleToI18nDomainArgs=To,To.Builder=((yo=function(){return Xn(function e(){Kn(this,e),this.cxProgram=To.Builder.EMPTY_CX_PROGRAM},[{key:"withCxFamily",value:function(e){return this.cxFamily=e,this}},{key:"withCxId",value:function(e){return this.cxId=e,this}},{key:"withCxProgram",value:function(e){return this.cxProgram=e,this}},{key:"build",value:function(){return new To(this.cxFamily,this.cxId,this.cxProgram)}}])}()).EMPTY_CX_PROGRAM="[]",yo);var So={};Object.defineProperty(So,"__esModule",{value:!0}),So.CXTupleToI18nDomainResult=void 0;var Io=ga,Ao=function(e){function t(){return Kn(this,t),Bn(this,t,arguments)}return zn(t,e),Xn(t)}(ca.QueryOutput);So.CXTupleToI18nDomainResult=Ao,Ao.I18N_DOMAIN=new Ao("i18n_domain",Io.DataType.STRING);var Oo={};Object.defineProperty(Oo,"__esModule",{value:!0}),Oo.CXTupleToDefaultPreferences=void 0;var bo=ga,Lo=aa,Po=function(e){function t(e,n){return Kn(this,t),Bn(this,t,[e,n])}return zn(t,e),Xn(t,[{key:"getConfigType",value:function(){return Lo.ConfigType.CX_TUPLE_TO_DEFAULT_PREFERENCES}}])}(sa.ConfigName);Oo.CXTupleToDefaultPreferences=Po,Po.DEFAULT_CURRENCY=new Po("default_currency",bo.DataType.STRING),Po.DEFAULT_LANGUAGE=new Po("default_language",bo.DataType.STRING);var No={};Object.defineProperty(No,"__esModule",{value:!0}),No.CXTupleToDefaultPreferencesArgs=void 0;var ko=aa,Uo=function(e){function t(e,n,r){var i;return Kn(this,t),(i=Bn(this,t))._cxFamily=e,i._cxId=n,i._cxProgram=r,i}return zn(t,e),Xn(t,[{key:"getConfigType",value:function(){return ko.ConfigType.CX_TUPLE_TO_DEFAULT_PREFERENCES}},{key:"getArgsMap",value:function(){return new Map([["cx_family",this._cxFamily],["cx_id",this._cxId],["cx_program",this._cxProgram]])}},{key:"cxFamily",get:function(){return this._cxFamily}},{key:"cxId",get:function(){return this._cxId}},{key:"cxProgram",get:function(){return this._cxProgram}}])}(ya.I18nArgs);No.CXTupleToDefaultPreferencesArgs=Uo,Uo.Builder=function(){return Xn(function e(){Kn(this,e)},[{key:"withCxFamily",value:function(e){return this.cxFamily=e,this}},{key:"withCxId",value:function(e){return this.cxId=e,this}},{key:"withCxProgram",value:function(e){return this.cxProgram=e,this}},{key:"build",value:function(){return new Uo(this.cxFamily,this.cxId,this.cxProgram)}}])}();var Do={};Object.defineProperty(Do,"__esModule",{value:!0}),Do.CXTupleToDefaultPreferencesResult=void 0;var Mo=ga,wo=function(e){function t(){return Kn(this,t),Bn(this,t,arguments)}return zn(t,e),Xn(t)}(ca.QueryOutput);Do.CXTupleToDefaultPreferencesResult=wo,wo.DEFAULT_CURRENCY=new wo("default_currency",Mo.DataType.STRING),wo.DEFAULT_LANGUAGE=new wo("default_language",Mo.DataType.STRING),function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=aa;Object.defineProperty(e,"ConfigType",{enumerable:!0,get:function(){return t.ConfigType}});var n=sa;Object.defineProperty(e,"ConfigName",{enumerable:!0,get:function(){return n.ConfigName}});var r=ca;Object.defineProperty(e,"QueryOutput",{enumerable:!0,get:function(){return r.QueryOutput}});var i=da;Object.defineProperty(e,"I18nConfiguration",{enumerable:!0,get:function(){return i.I18nConfiguration}});var a=ha;Object.defineProperty(e,"ConfigurationData",{enumerable:!0,get:function(){return a.ConfigurationData}});var o=ga;Object.defineProperty(e,"DataType",{enumerable:!0,get:function(){return o.DataType}});var s=ya;Object.defineProperty(e,"I18nArgs",{enumerable:!0,get:function(){return s.I18nArgs}});var u=Ra;Object.defineProperty(e,"QueryResolver",{enumerable:!0,get:function(){return u.QueryResolver}});var c=Sa;Object.defineProperty(e,"I18nConfigurationProvider",{enumerable:!0,get:function(){return c.I18nConfigurationProvider}});var l=Oa;Object.defineProperty(e,"ConfigurationProviderManager",{enumerable:!0,get:function(){return l.ConfigurationProviderManager}});var d=fa;Object.defineProperty(e,"isNullOrUndefined",{enumerable:!0,get:function(){return d.isNullOrUndefined}});var h=La;Object.defineProperty(e,"MarketplaceIdToCxTuple",{enumerable:!0,get:function(){return h.MarketplaceIdToCxTuple}});var f=Ua;Object.defineProperty(e,"MarketplaceIdToCxTupleArgs",{enumerable:!0,get:function(){return f.MarketplaceIdToCxTupleArgs}});var v=wa;Object.defineProperty(e,"MarketplaceIdToCxTupleResult",{enumerable:!0,get:function(){return v.MarketplaceIdToCxTupleResult}});var p=Ha;Object.defineProperty(e,"PriceFormat",{enumerable:!0,get:function(){return p.PriceFormat}});var m=Ga;Object.defineProperty(e,"PriceFormatArgs",{enumerable:!0,get:function(){return m.PriceFormatArgs}});var E=ja;Object.defineProperty(e,"PriceFormatArgsBuilder",{enumerable:!0,get:function(){return E.PriceFormatArgsBuilder}});var g=Ya;Object.defineProperty(e,"RetailPriceFormatArgs",{enumerable:!0,get:function(){return g.RetailPriceFormatArgs}});var _=Ja;Object.defineProperty(e,"PriceFormatType",{enumerable:!0,get:function(){return _.PriceFormatType}});var y=$a;Object.defineProperty(e,"PriceFormatResult",{enumerable:!0,get:function(){return y.PriceFormatResult}});var C=no;Object.defineProperty(e,"TrailingZeroDisplay",{enumerable:!0,get:function(){return C.TrailingZeroDisplay}});var R=ro;Object.defineProperty(e,"CurrencySymbolPosition",{enumerable:!0,get:function(){return R.CurrencySymbolPosition}});var T=io;Object.defineProperty(e,"PointsFormat",{enumerable:!0,get:function(){return T.PointsFormat}});var S=uo;Object.defineProperty(e,"PointsFormatArgs",{enumerable:!0,get:function(){return S.PointsFormatArgs}});var I=ho;Object.defineProperty(e,"PointsFormatResult",{enumerable:!0,get:function(){return I.PointsFormatResult}});var A=po;Object.defineProperty(e,"PointsFormatStyle",{enumerable:!0,get:function(){return A.PointsFormatStyle}});var O=mo;Object.defineProperty(e,"CXTupleToI18nDomain",{enumerable:!0,get:function(){return O.CXTupleToI18nDomain}});var b=Co;Object.defineProperty(e,"CXTupleToI18nDomainArgs",{enumerable:!0,get:function(){return b.CXTupleToI18nDomainArgs}});var L=So;Object.defineProperty(e,"CXTupleToI18nDomainResult",{enumerable:!0,get:function(){return L.CXTupleToI18nDomainResult}});var P=Oo;Object.defineProperty(e,"CXTupleToDefaultPreferences",{enumerable:!0,get:function(){return P.CXTupleToDefaultPreferences}});var N=No;Object.defineProperty(e,"CXTupleToDefaultPreferencesArgs",{enumerable:!0,get:function(){return N.CXTupleToDefaultPreferencesArgs}});var k=Do;Object.defineProperty(e,"CXTupleToDefaultPreferencesResult",{enumerable:!0,get:function(){return k.CXTupleToDefaultPreferencesResult}})}(ia);var Fo={},xo={},Ho={},Bo={},Wo={};Object.defineProperty(Wo,"__esModule",{value:!0});var Vo=function(){function e(){Kn(this,e)}return Xn(e,[{key:"getContent",value:function(){return e.CX_TUPLE_TO_DEFAULT_PREFERENCES_MAPPING}}])}();Wo.default=Vo,Vo.CX_TUPLE_TO_DEFAULT_PREFERENCES_MAPPING=new Map([["retail/amazon.ae|default_language","en-AE"],["retail/amazon.ae|default_currency","AED"],["retail/amazon.au|default_language","en-AU"],["retail/amazon.au|default_currency","AUD"],["retail/amazon.com.be|default_language","fr-BE"],["retail/amazon.com.be|default_currency","EUR"],["retail/amazon.com.br|default_language","pt-BR"],["retail/amazon.com.br|default_currency","BRL"],["retail/amazon.ca|default_language","en-CA"],["retail/amazon.ca|default_currency","CAD"],["retail/amazon.cl|default_language","es-CL"],["retail/amazon.cl|default_currency","CLP"],["retail/amazon.com.co|default_language","es-CO"],["retail/amazon.com.co|default_currency","COP"],["retail/amazon.cn|default_language","zh-CN"],["retail/amazon.cn|default_currency","CNY"],["retail/amazon.de|default_language","de-DE"],["retail/amazon.de|default_currency","EUR"],["retail/amazon.eg|default_language","ar-AE"],["retail/amazon.eg|default_currency","EGP"],["retail/amazon.es|default_language","es-ES"],["retail/amazon.es|default_currency","EUR"],["retail/amazon.fr|default_language","fr-FR"],["retail/amazon.fr|default_currency","EUR"],["retail/amazon.in|default_language","en-IN"],["retail/amazon.in|default_currency","INR"],["retail/amazon.it|default_language","it-IT"],["retail/amazon.it|default_currency","EUR"],["retail/amazon.co.jp|default_language","ja-JP"],["retail/amazon.co.jp|default_currency","JPY"],["retail/amazon.com.mx|default_language","es-MX"],["retail/amazon.com.mx|default_currency","MXN"],["retail/amazon.com.ng|default_language","en-NG"],["retail/amazon.com.ng|default_currency","NGN"],["retail/amazon.nl|default_language","nl-NL"],["retail/amazon.nl|default_currency","EUR"],["retail/amazon.pl|default_language","pl-PL"],["retail/amazon.pl|default_currency","PLN"],["retail/amazon.ru|default_language","ru-RU"],["retail/amazon.ru|default_currency","RUB"],["retail/amazon.sa|default_language","ar-AE"],["retail/amazon.sa|default_currency","SAR"],["retail/amazon.se|default_language","sv-SE"],["retail/amazon.se|default_currency","SEK"],["retail/amazon.sg|default_language","en-SG"],["retail/amazon.sg|default_currency","SGD"],["retail/amazon.com.tr|default_language","tr-TR"],["retail/amazon.com.tr|default_currency","TRY"],["retail/amazon.co.uk|default_language","en-GB"],["retail/amazon.co.uk|default_currency","GBP"],["retail/amazon.com|default_language","en-US"],["retail/amazon.com|default_currency","USD"],["retail/amazon.co.za|default_language","en-ZA"],["retail/amazon.co.za|default_currency","ZAR"],["pyop/apa.amazon.ca|default_language","en-CA"],["pyop/apa.amazon.ca|default_currency","CAD"],["pyop/apa.amazon.de|default_language","de-DE"],["pyop/apa.amazon.de|default_currency","EUR"],["pyop/apa.amazon.in|default_language","en-IN"],["pyop/apa.amazon.in|default_currency","INR"],["pyop/apa.amazon.co.jp|default_language","ja-JP"],["pyop/apa.amazon.co.jp|default_currency","JPY"],["pyop/apa.amazon.com|default_language","en-US"],["pyop/apa.amazon.com|default_currency","USD"],["pyop/apa.amazon.co.uk|default_language","en-GB"],["pyop/apa.amazon.co.uk|default_currency","GBP"]]);var Go={};Object.defineProperty(Go,"__esModule",{value:!0});var zo=function(e){function t(){var e;return Kn(this,t),(e=Bn(this,t)).initialize(),e}return zn(t,e),Xn(t,[{key:"initialize",value:function(){if(!this.isInitialized())try{this._resourceConfigRetriever=this.createMapResourceConfigRetriever(),this.setInitializedState(!0)}catch(e){console.error("Failed to initialize query resolver ".concat(this.constructor.name))}return this.isInitialized()}}])}(ia.QueryResolver);Go.default=zo,zo.MAP_ATTRIBUTE_KEY_SEPARATOR="|";var jo=mr&&mr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Bo,"__esModule",{value:!0});var Yo=ia,Ko=jo(Wo),qo=jo(Go),Xo=function(e){function t(){return Kn(this,t),Bn(this,t)}return zn(t,e),Xn(t,[{key:"resolve",value:function(e,t){return this.validate(e,t),this.doResolve(e,t)}},{key:"doResolve",value:function(e,t){var n=new Yo.I18nConfiguration.Builder;switch(e){case Yo.CXTupleToDefaultPreferences.DEFAULT_CURRENCY:var r=this.getResource(e,t);n.addConfiguration(Yo.CXTupleToDefaultPreferencesResult.DEFAULT_CURRENCY,r);break;case Yo.CXTupleToDefaultPreferences.DEFAULT_LANGUAGE:var i=this.getResource(e,t);n.addConfiguration(Yo.CXTupleToDefaultPreferencesResult.DEFAULT_LANGUAGE,i);break;default:throw new Error("Attribute name ".concat(e," is not defined for feature ").concat(e.getConfigType()))}return n.build()}},{key:"getResource",value:function(e,n){var r=n.cxFamily+t.CX_TUPLE_SEPARATOR+n.cxId;return r+=qo.default.MAP_ATTRIBUTE_KEY_SEPARATOR,r+=e,this._resourceConfigRetriever.getContent().get(r)}},{key:"createMapResourceConfigRetriever",value:function(){return new Ko.default}},{key:"getTargetConfigType",value:function(){return t.CONFIG_TYPE}},{key:"getValidationErrorMessage",value:function(){return"CXTuple to default preferences configs can only be resolved for configType ".concat(t.CONFIG_TYPE)}}])}(qo.default);Bo.default=Xo,Xo.CX_TUPLE_SEPARATOR="/",Xo.CONFIG_TYPE=Yo.ConfigType.CX_TUPLE_TO_DEFAULT_PREFERENCES;var Zo={},Qo={};Object.defineProperty(Qo,"__esModule",{value:!0});var Jo=function(){function e(){Kn(this,e)}return Xn(e,[{key:"getContent",value:function(){return e.CX_TUPLE_TO_I18N_DOMAIN_MAPPINGS}}])}();Qo.default=Jo,Jo.CX_TUPLE_TO_I18N_DOMAIN_MAPPINGS=new Map([["retail/amazon.ae|i18n_domain","retail-ae"],["retail/amazon.com.au|i18n_domain","retail-au"],["retail/amazon.com.be|i18n_domain","retail-be"],["retail/amazon.com.br|i18n_domain","retail-br"],["retail/amazon.ca|i18n_domain","retail-ca"],["retail/amazon.cl|i18n_domain","retail-cl"],["retail/amazon.com.co|i18n_domain","retail-co"],["retail/amazon.cn|i18n_domain","retail-cn"],["retail/amazon.de|i18n_domain","retail-de"],["retail/amazon.eg|i18n_domain","retail-eg"],["retail/amazon.es|i18n_domain","retail-es"],["retail/amazon.fr|i18n_domain","retail-fr"],["retail/amazon.in|i18n_domain","retail-in"],["retail/amazon.it|i18n_domain","retail-it"],["retail/amazon.co.jp|i18n_domain","retail-jp"],["retail/amazon.com.mx|i18n_domain","retail-mx"],["retail/amazon.com.ng|i18n_domain","retail-ng"],["retail/amazon.nl|i18n_domain","retail-nl"],["retail/amazon.pl|i18n_domain","retail-pl"],["retail/amazon.ru|i18n_domain","retail-ru"],["retail/amazon.sa|i18n_domain","retail-sa"],["retail/amazon.se|i18n_domain","retail-se"],["retail/amazon.sg|i18n_domain","retail-sg"],["retail/amazon.com.tr|i18n_domain","retail-tr"],["retail/amazon.co.uk|i18n_domain","retail-uk"],["retail/amazon.com|i18n_domain","retail-us"],["retail/amazon.co.za|i18n_domain","retail-za"]]);var $o=mr&&mr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Zo,"__esModule",{value:!0});var es=ia,ts=$o(Qo),ns=$o(Go),rs=function(e){function t(){return Kn(this,t),Bn(this,t)}return zn(t,e),Xn(t,[{key:"resolve",value:function(e,t){return this.validate(e,t),this.doResolve(e,t)}},{key:"doResolve",value:function(e,t){var n=new es.I18nConfiguration.Builder;if(e!==es.CXTupleToI18nDomain.I18N_DOMAIN)throw new Error("Attribute name ".concat(e," is not defined for feature ").concat(e.getConfigType()));var r=this.getResource(e,t);return n.addConfiguration(es.CXTupleToI18nDomainResult.I18N_DOMAIN,r),n.build()}},{key:"getResource",value:function(e,n){var r=n.cxFamily+t.CX_TUPLE_SEPARATOR+n.cxId;return r+=ns.default.MAP_ATTRIBUTE_KEY_SEPARATOR,r+=e,this._resourceConfigRetriever.getContent().get(r)}},{key:"createMapResourceConfigRetriever",value:function(){return new ts.default}},{key:"getTargetConfigType",value:function(){return t.CONFIG_TYPE}},{key:"getValidationErrorMessage",value:function(){return"CXTuple to I18nDomain configs can only be resolved for configType ".concat(t.CONFIG_TYPE)}}])}(ns.default);Zo.default=rs,rs.CX_TUPLE_SEPARATOR="/",rs.CONFIG_TYPE=es.ConfigType.CX_TUPLE_TO_I18N_DOMAIN;var is={},as={};Object.defineProperty(as,"__esModule",{value:!0});var os=function(){function e(){Kn(this,e)}return Xn(e,[{key:"getContent",value:function(){return e.MARKETPLACE_TO_CXTUPLE_MAPPINGS}}])}();as.default=os,os.MARKETPLACE_TO_CXTUPLE_MAPPINGS=new Map([["A2VIGQ35RCS4UG|cx_id","amazon.ae"],["A2VIGQ35RCS4UG|cx_family","retail"],["A34GYYCZVDBSIK|cx_id","amazon.ae"],["A34GYYCZVDBSIK|cx_family","retail"],["A39IBJ37TRP1C6|cx_id","amazon.com.au"],["A39IBJ37TRP1C6|cx_family","retail"],["A1RNPCQ4K8U27I|cx_id","amazon.com.au"],["A1RNPCQ4K8U27I|cx_family","retail"],["AMEN7PMS3EDWL|cx_id","amazon.com.be"],["AMEN7PMS3EDWL|cx_family","retail"],["A1YFOMBPFBRY22|cx_id","amazon.com.be"],["A1YFOMBPFBRY22|cx_family","retail"],["A2Q3Y263D00KWC|cx_id","amazon.com.br"],["A2Q3Y263D00KWC|cx_family","retail"],["AZXD3QD5B39HD|cx_id","amazon.com.br"],["AZXD3QD5B39HD|cx_family","retail"],["A2EUQ1WTGCTBG2|cx_id","amazon.ca"],["A2EUQ1WTGCTBG2|cx_family","retail"],["A2WDZJZ5TCRMLH|cx_id","amazon.cl"],["A2WDZJZ5TCRMLH|cx_family","retail"],["A2IDBVIE7EAGN4|cx_id","amazon.cl"],["A2IDBVIE7EAGN4|cx_family","retail"],["A1NOHO22DE3OHQ|cx_id","amazon.com.co"],["A1NOHO22DE3OHQ|cx_family","retail"],["AAHKV2X7AFYLW|cx_id","amazon.cn"],["AAHKV2X7AFYLW|cx_family","retail"],["A1PA6795UKMFR9|cx_id","amazon.de"],["A1PA6795UKMFR9|cx_family","retail"],["ARBP9OOSHTCHU|cx_id","amazon.eg"],["ARBP9OOSHTCHU|cx_family","retail"],["AUJPM9XGFJRC7|cx_id","amazon.eg"],["AUJPM9XGFJRC7|cx_family","retail"],["A1RKKUPIHCS9HS|cx_id","amazon.es"],["A1RKKUPIHCS9HS|cx_family","retail"],["AJZF8LZ1EJVJN|cx_id","amazon.es"],["AJZF8LZ1EJVJN|cx_family","retail"],["A13V1IB3VIYZZH|cx_id","amazon.fr"],["A13V1IB3VIYZZH|cx_family","retail"],["A21TJRUUN4KGV|cx_id","amazon.in"],["A21TJRUUN4KGV|cx_family","retail"],["A2XZLSVIQ0F4JT|cx_family","retail"],["A2XZLSVIQ0F4JT|cx_id","amazon.in"],["APJ6JRA9NG5V4|cx_id","amazon.it"],["APJ6JRA9NG5V4|cx_family","retail"],["A3HOBANJMCMD83|cx_id","amazon.it"],["A3HOBANJMCMD83|cx_family","retail"],["A1VC38T7YXB528|cx_id","amazon.co.jp"],["A1VC38T7YXB528|cx_family","retail"],["A1AM78C64UM0Y8|cx_id","amazon.com.mx"],["A1AM78C64UM0Y8|cx_family","retail"],["A3P3J5A7D2ZVXI|cx_id","amazon.com.mx"],["A3P3J5A7D2ZVXI|cx_family","retail"],["A3OCL2LJ6GDH9T|cx_id","amazon.com.ng"],["A3OCL2LJ6GDH9T|cx_family","retail"],["A3PJZM0QIA8QDU|cx_id","amazon.com.ng"],["A3PJZM0QIA8QDU|cx_family","retail"],["A1805IZSGTT6HS|cx_id","amazon.nl"],["A1805IZSGTT6HS|cx_family","retail"],["A1M3WC0SJ3A38T|cx_id","amazon.nl"],["A1M3WC0SJ3A38T|cx_family","retail"],["A1C3SOZRARQ6R3|cx_id","amazon.pl"],["A1C3SOZRARQ6R3|cx_family","retail"],["AKY4K4WKH21YQ|cx_id","amazon.pl"],["AKY4K4WKH21YQ|cx_family","retail"],["AD2EMQ3L3PG8S|cx_id","amazon.ru"],["AD2EMQ3L3PG8S|cx_family","retail"],["A38NPJYVS5YHNH|cx_id","amazon.ru"],["A38NPJYVS5YHNH|cx_family","retail"],["A17E79C6D8DWNP|cx_id","amazon.sa"],["A17E79C6D8DWNP|cx_family","retail"],["A1MQPSGJ6U9Q54|cx_id","amazon.sa"],["A1MQPSGJ6U9Q54|cx_family","retail"],["A2NODRKZP88ZB9|cx_id","amazon.se"],["A2NODRKZP88ZB9|cx_family","retail"],["AT614YYYNOC1S|cx_id","amazon.se"],["AT614YYYNOC1S|cx_family","retail"],["A19VAU5U5O7RUS|cx_id","amazon.sg"],["A19VAU5U5O7RUS|cx_family","retail"],["A1DQ6JV7I20JSG|cx_id","amazon.sg"],["A1DQ6JV7I20JSG|cx_family","retail"],["A33AVAJ2PDY3EV|cx_id","amazon.com.tr"],["A33AVAJ2PDY3EV|cx_family","retail"],["A3CQBQD3RGPJR8|cx_id","amazon.com.tr"],["A3CQBQD3RGPJR8|cx_family","retail"],["A1F83G8C2ARO7P|cx_id","amazon.co.uk"],["A1F83G8C2ARO7P|cx_family","retail"],["ATVPDKIKX0DER|cx_id","amazon.com"],["ATVPDKIKX0DER|cx_family","retail"],["AE08WJ6YKNBMC|cx_id","amazon.co.za"],["AE08WJ6YKNBMC|cx_family","retail"],["A3TFQ1G9L8TQ5L|cx_id","amazon.co.za"],["A3TFQ1G9L8TQ5L|cx_family","retail"],["A2CE4MDCUAASDP|cx_id","apa.amazon.ca"],["A2CE4MDCUAASDP|cx_family","pyop"],["A2VJI655WT2I0B|cx_id","apa.amazon.ca"],["A2VJI655WT2I0B|cx_family","pyop"],["A1NWP2E4EKQP94|cx_id","apa.amazon.ca"],["A1NWP2E4EKQP94|cx_family","pyop"],["ASBG27DKM7EX6|cx_id","apa.amazon.ca"],["ASBG27DKM7EX6|cx_family","pyop"],["A53RDEWN57UU5|cx_id","apa.amazon.de"],["A53RDEWN57UU5|cx_family","pyop"],["A1G8446IYHA4MR|cx_id","apa.amazon.de"],["A1G8446IYHA4MR|cx_family","pyop"],["A34RX6LWLXD2KA|cx_id","apa.amazon.de"],["A34RX6LWLXD2KA|cx_family","pyop"],["A225AO9WA6YYOF|cx_id","apa.amazon.de"],["A225AO9WA6YYOF|cx_family","pyop"],["A3FDG49KKM823Y|cx_id","apa.amazon.in"],["A3FDG49KKM823Y|cx_family","pyop"],["A1IAUC0NN979H6|cx_id","apa.amazon.in"],["A1IAUC0NN979H6|cx_family","pyop"],["A18VPDB9UTK24D|cx_id","apa.amazon.in"],["A18VPDB9UTK24D|cx_family","pyop"],["A16Z2XWZJTFS70|cx_id","apa.amazon.in"],["A16Z2XWZJTFS70|cx_family","pyop"],["A75P1MG8VMU51|cx_id","apa.amazon.co.jp"],["A75P1MG8VMU51|cx_family","pyop"],["A31YDYE76E6TCP|cx_id","apa.amazon.co.jp"],["A31YDYE76E6TCP|cx_family","pyop"],["A2EFPHRCZ60KI3|cx_id","apa.amazon.co.jp"],["A2EFPHRCZ60KI3|cx_family","pyop"],["A1U1OSY46WLA42|cx_id","apa.amazon.co.jp"],["A1U1OSY46WLA42|cx_family","pyop"],["AGWSWK15IEJJ7|cx_id","apa.amazon.com"],["AGWSWK15IEJJ7|cx_family","pyop"],["A3BXB0YN3XH17H|cx_id","apa.amazon.com"],["A3BXB0YN3XH17H|cx_family","pyop"],["A35A4JO734ER04|cx_id","apa.amazon.com"],["A35A4JO734ER04|cx_family","pyop"],["A341L3VCFKNMIY|cx_id","apa.amazon.com"],["A341L3VCFKNMIY|cx_family","pyop"],["AZAJMM36N6WQL|cx_id","apa.amazon.co.uk"],["AZAJMM36N6WQL|cx_family","pyop"],["A3M3RRFO9XDT2G|cx_id","apa.amazon.co.uk"],["A3M3RRFO9XDT2G|cx_family","pyop"],["A2UWQKHEFGNQY3|cx_id","apa.amazon.co.uk"],["A2UWQKHEFGNQY3|cx_family","pyop"],["A2V84NPDZD3ZEH|cx_id","apa.amazon.co.uk"],["A2V84NPDZD3ZEH|cx_family","pyop"]]);var ss=mr&&mr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(is,"__esModule",{value:!0});var us=ia,cs=ss(as),ls=ss(Go),ds=function(e){function t(){return Kn(this,t),Bn(this,t)}return zn(t,e),Xn(t,[{key:"resolve",value:function(e,t){return this.validate(e,t),this.doResolve(e,t)}},{key:"doResolve",value:function(e,t){var n=new us.I18nConfiguration.Builder;switch(e){case us.MarketplaceIdToCxTuple.CX_ID:var r=this.getResource(e,t);n.addConfiguration(us.MarketplaceIdToCxTupleResult.CX_ID,r);break;case us.MarketplaceIdToCxTuple.CX_FAMILY:var i=this.getResource(e,t);n.addConfiguration(us.MarketplaceIdToCxTupleResult.CX_FAMILY,i);break;default:throw new Error("Attribute name ".concat(e," is not defined for feature ").concat(e.getConfigType()))}return n.build()}},{key:"getResource",value:function(e,t){var n=t.obfuscatedMarketplaceId;return n+=ls.default.MAP_ATTRIBUTE_KEY_SEPARATOR,n+=e,this._resourceConfigRetriever.getContent().get(n)}},{key:"createMapResourceConfigRetriever",value:function(){return new cs.default}},{key:"getTargetConfigType",value:function(){return t.CONFIG_TYPE}},{key:"getValidationErrorMessage",value:function(){return"Marketplace to CXTuple configs can only be resolved for configType ".concat(t.CONFIG_TYPE)}}])}(ls.default);is.default=ds,ds.CONFIG_TYPE=us.ConfigType.MARKETPLACEID_TO_CX_TUPLE;var hs={},fs={},vs={},ps={};Object.defineProperty(ps,"__esModule",{value:!0}),ps.DEFAULT_PRICE_FORMAT_OVERRIDES=void 0;var ms=ia,Es={cop:ms.TrailingZeroDisplay.HIDE_IF_WHOLE,ngn:ms.TrailingZeroDisplay.HIDE_IF_WHOLE};ps.DEFAULT_PRICE_FORMAT_OVERRIDES={symbolPosition:{},customSymbolData:{"sek_amazon.se":{customSymbol:"kr",insertSpaceInPattern:!1},"pln_amazon.pl":{customSymbol:"zł",insertSpaceInPattern:!1},sgd:{customSymbol:"S$",insertSpaceInPattern:!1},"aed_amazon.ae":{customSymbol:"AED",insertSpaceInPattern:!0},"sar_amazon.sa":{customSymbol:"SAR",insertSpaceInPattern:!0},"egp_amazon.eg":{customSymbol:"EGP",insertSpaceInPattern:!0},"try_amazon.com.tr":{customSymbol:"TL",insertSpaceInPattern:!0}},trailingZeroDisplayOverrides:Es};var gs={};Object.defineProperty(gs,"__esModule",{value:!0}),gs.AR_PRICE_FORMAT_OVERRIDES=void 0;var _s={symbol_position:ia.CurrencySymbolPosition.END};gs.AR_PRICE_FORMAT_OVERRIDES={symbolPosition:_s,customSymbolData:{"aed_amazon.ae":{customSymbol:"درهم",insertSpaceInPattern:!0},"egp_amazon.eg":{customSymbol:"جنيه",insertSpaceInPattern:!0},"sar_amazon.sa":{customSymbol:"ريال",insertSpaceInPattern:!0},"usd_amazon.com":{customSymbol:"؜US$",insertSpaceInPattern:!1}},symbolPrefix:"؜"};var ys={};Object.defineProperty(ys,"__esModule",{value:!0}),ys.BN_PRICE_FORMAT_OVERRIDES=void 0;var Cs={symbol_position:ia.CurrencySymbolPosition.START};ys.BN_PRICE_FORMAT_OVERRIDES={symbolPosition:Cs,customSymbolData:{}};var Rs={};Object.defineProperty(Rs,"__esModule",{value:!0}),Rs.DA_PRICE_FORMAT_OVERRIDES=void 0,Rs.DA_PRICE_FORMAT_OVERRIDES={symbolPosition:{},customSymbolData:{"sek_amazon.se":{customSymbol:"Skr",insertSpaceInPattern:!1}}};var Ts={};Object.defineProperty(Ts,"__esModule",{value:!0}),Ts.ET_PRICE_FORMAT_OVERRIDES=void 0,Ts.ET_PRICE_FORMAT_OVERRIDES={symbolPosition:{},customSymbolData:{"sek_amazon.se":{customSymbol:"Skr",insertSpaceInPattern:!1}}};var Ss={};Object.defineProperty(Ss,"__esModule",{value:!0}),Ss.EN_XD_PRICE_FORMAT_OVERRIDES=void 0,Ss.EN_XD_PRICE_FORMAT_OVERRIDES={symbolPosition:{},customSymbolData:{}};var Is={};Object.defineProperty(Is,"__esModule",{value:!0}),Is.EN_PHNX_XD_UNIFON_PRICE_FORMAT_OVERRIDES=void 0,Is.EN_PHNX_XD_UNIFON_PRICE_FORMAT_OVERRIDES={symbolPosition:{},customSymbolData:{}};var As={};Object.defineProperty(As,"__esModule",{value:!0}),As.ES_PRICE_FORMAT_OVERRIDES=void 0,As.ES_PRICE_FORMAT_OVERRIDES={symbolPosition:{},customSymbolData:{"usd_amazon.com_compact":{customSymbol:"$",insertSpaceInPattern:!1},"usd_amazon.com":{customSymbol:"US$",insertSpaceInPattern:!1}}};var Os={};Object.defineProperty(Os,"__esModule",{value:!0}),Os.FR_CA_PRICE_FORMAT_OVERRIDES=void 0,Os.FR_CA_PRICE_FORMAT_OVERRIDES={symbolPosition:{},customSymbolData:{"cad_amazon.ca":{customSymbol:"$",insertSpaceInPattern:!1}}};var bs={};Object.defineProperty(bs,"__esModule",{value:!0}),bs.FR_XD_PRICE_FORMAT_OVERRIDES=void 0;var Ls={symbol_position:ia.CurrencySymbolPosition.END};bs.FR_XD_PRICE_FORMAT_OVERRIDES={symbolPosition:Ls,customSymbolData:{}};var Ps={};Object.defineProperty(Ps,"__esModule",{value:!0}),Ps.FR_XD_UNIFON_PRICE_FORMAT_OVERRIDES=void 0,Ps.FR_XD_UNIFON_PRICE_FORMAT_OVERRIDES={symbolPosition:{},customSymbolData:{}};var Ns={};Object.defineProperty(Ns,"__esModule",{value:!0}),Ns.FR_PHNX_XD_UNIFON_PRICE_FORMAT_OVERRIDES=void 0;var ks={symbol_position:ia.CurrencySymbolPosition.START};Ns.FR_PHNX_XD_UNIFON_PRICE_FORMAT_OVERRIDES={symbolPosition:ks,customSymbolData:{}};var Us={};Object.defineProperty(Us,"__esModule",{value:!0}),Us.HE_PRICE_FORMAT_OVERRIDES=void 0,Us.HE_PRICE_FORMAT_OVERRIDES={symbolPosition:{},customSymbolData:{},symbolPrefix:"‏"};var Ds={};Object.defineProperty(Ds,"__esModule",{value:!0}),Ds.IS_PRICE_FORMAT_OVERRIDES=void 0,Ds.IS_PRICE_FORMAT_OVERRIDES={symbolPosition:{},customSymbolData:{"sek_amazon.se":{customSymbol:"Skr",insertSpaceInPattern:!1}}};var Ms={};Object.defineProperty(Ms,"__esModule",{value:!0}),Ms.JA_PRICE_FORMAT_OVERRIDES=void 0;var ws={jpy_insentence:ia.CurrencySymbolPosition.END};Ms.JA_PRICE_FORMAT_OVERRIDES={symbolPosition:ws,customSymbolData:{jpy_insentence:{customSymbol:"円",insertSpaceInPattern:!1},"jpy_amazon.co.jp_compact":{customSymbol:"¥",insertSpaceInPattern:!1}}};var Fs={};Object.defineProperty(Fs,"__esModule",{value:!0}),Fs.NB_PRICE_FORMAT_OVERRIDES=void 0,Fs.NB_PRICE_FORMAT_OVERRIDES={symbolPosition:{},customSymbolData:{"sek_amazon.se":{customSymbol:"Skr",insertSpaceInPattern:!1}}};var xs={};Object.defineProperty(xs,"__esModule",{value:!0}),xs.NN_PRICE_FORMAT_OVERRIDES=void 0,xs.NN_PRICE_FORMAT_OVERRIDES={symbolPosition:{},customSymbolData:{"sek_amazon.se":{customSymbol:"Skr",insertSpaceInPattern:!1}}};var Hs={};Object.defineProperty(Hs,"__esModule",{value:!0}),Hs.NO_PRICE_FORMAT_OVERRIDES=void 0,Hs.NO_PRICE_FORMAT_OVERRIDES={symbolPosition:{},customSymbolData:{"sek_amazon.se":{customSymbol:"Skr",insertSpaceInPattern:!1}}};var Bs={};Object.defineProperty(Bs,"__esModule",{value:!0}),Bs.TR_PRICE_FORMAT_OVERRIDES=void 0;var Ws={symbol_position:ia.CurrencySymbolPosition.END};Bs.TR_PRICE_FORMAT_OVERRIDES={symbolPosition:Ws,customSymbolData:{}};var Vs={};Object.defineProperty(Vs,"__esModule",{value:!0}),Vs.ZH_PRICE_FORMAT_OVERRIDES=void 0;var Gs=ia,zs={jpy_insentence:Gs.CurrencySymbolPosition.END,cny_insentence:Gs.CurrencySymbolPosition.END};Vs.ZH_PRICE_FORMAT_OVERRIDES={symbolPosition:zs,customSymbolData:{cny_insentence:{customSymbol:"元",insertSpaceInPattern:!1},jpy_insentence:{customSymbol:"日元",insertSpaceInPattern:!1}}};var js={};Object.defineProperty(js,"__esModule",{value:!0}),js.HI_XD_PRICE_FORMAT_OVERRIDES=void 0;var Ys=ia,Ks={"inr_amazon.in_insentence":Ys.TrailingZeroDisplay.HIDE_IF_WHOLE,"inr_amazon.in_amazonsymbol":Ys.TrailingZeroDisplay.HIDE_IF_WHOLE};js.HI_XD_PRICE_FORMAT_OVERRIDES={symbolPosition:{},customSymbolData:{},trailingZeroDisplayOverrides:Ks};var qs=Er(qi);Object.defineProperty(vs,"__esModule",{value:!0}),vs.CustomSymbolOverrides=void 0;var Xs=ps,Zs=gs,Qs=ys,Js=Rs,$s=Ts,eu=Ss,tu=Is,nu=As,ru=Os,iu=bs,au=Ps,ou=Ns,su=Us,uu=Ds,cu=Ms,lu=Fs,du=xs,hu=Hs,fu=Bs,vu=Vs,pu=js,mu=ia,Eu=qs,gu="default",_u="_",yu=new RegExp("-","g"),Cu=kn({ar:Zs.AR_PRICE_FORMAT_OVERRIDES,bn:Qs.BN_PRICE_FORMAT_OVERRIDES,da:Js.DA_PRICE_FORMAT_OVERRIDES,et:$s.ET_PRICE_FORMAT_OVERRIDES,es:nu.ES_PRICE_FORMAT_OVERRIDES,fr_ca:ru.FR_CA_PRICE_FORMAT_OVERRIDES,he:su.HE_PRICE_FORMAT_OVERRIDES,is:uu.IS_PRICE_FORMAT_OVERRIDES,ja:cu.JA_PRICE_FORMAT_OVERRIDES,nb:lu.NB_PRICE_FORMAT_OVERRIDES,nn:du.NN_PRICE_FORMAT_OVERRIDES,no:hu.NO_PRICE_FORMAT_OVERRIDES,tr:fu.TR_PRICE_FORMAT_OVERRIDES,zh:vu.ZH_PRICE_FORMAT_OVERRIDES,en_xd:eu.EN_XD_PRICE_FORMAT_OVERRIDES,en_phnx_xd_unifon:tu.EN_PHNX_XD_UNIFON_PRICE_FORMAT_OVERRIDES,fr_xd:iu.FR_XD_PRICE_FORMAT_OVERRIDES,fr_xd_unifon:au.FR_XD_UNIFON_PRICE_FORMAT_OVERRIDES,fr_phnx_xd_unifon:ou.FR_PHNX_XD_UNIFON_PRICE_FORMAT_OVERRIDES,hi_xd:pu.HI_XD_PRICE_FORMAT_OVERRIDES},gu,Xs.DEFAULT_PRICE_FORMAT_OVERRIDES),Ru=function(){return Xn(function e(t){Kn(this,e),this.overrides=[],this.intlLocale=Eu.LocaleUtil.getCanonicalLocale(new Intl.Locale(t));for(var n=[],r=this.intlLocale.baseName,i=(r=r.replace(yu,_u)).lastIndexOf(_u);i>0;)n.push(r.toLocaleLowerCase("und")),i=(r=r.substring(0,i)).lastIndexOf(_u);if(this.intlLocale.script)for(i=(r=(r=new Intl.Locale(this.intlLocale.baseName.replace("-"+this.intlLocale.script,"")).baseName).replace(yu,_u)).lastIndexOf(_u);i>0;)n.push(r.toLocaleLowerCase("und")),i=(r=r.substring(0,i)).lastIndexOf(_u);n.push(r.toLocaleLowerCase("und"));for(var a=0,o=n;a<o.length;a++){var s=o[a],u=Cu[s];u&&this.overrides.push(u)}this.overrides.push(Cu[gu])},[{key:"getCustomSymbolData",value:function(e){var t,n=this.getResourceFallbackKeys(e),r=wn(this.overrides);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=this.getResourceValue(i.customSymbolData,n);if(a)return a}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"getResourceValue",value:function(e,t){var n,r=wn(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(this.containsKey(i,e))return e[i]}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"getResourceFallbackKeys",value:function(e){var t=[];if(!e.currencyCode)return[];var n=e.typeName;n&&(n=n.toLowerCase());var r=e.currencyCode.toLowerCase(),i=e.cxId;return i&&(i=i.toLowerCase(),t.push(Tu(r,i,n),Tu(r,i))),t.push(Tu(r,n),Tu(r)),t}},{key:"getSymbolPrefix",value:function(){var e,t=wn(this.overrides);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(this.containsKey("symbolPrefix",n))return n.symbolPrefix}}catch(e){t.e(e)}finally{t.f()}return null}},{key:"getSymbolPositionOverride",value:function(e){var t=[];e&&t.push.apply(t,Fn(this.getResourceFallbackKeys(e))),t.push("symbol_position");var n,r=wn(this.overrides);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=this.getResourceValue(i.symbolPosition,t);if(a)return a}}catch(e){r.e(e)}finally{r.f()}return mu.CurrencySymbolPosition.DEFAULT}},{key:"getTrailingZeroDisplay",value:function(e){var t,n=this.getResourceFallbackKeys(e),r=wn(this.overrides);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.trailingZeroDisplayOverrides){var a=this.getResourceValue(i.trailingZeroDisplayOverrides,n);if(a)return a}}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"containsKey",value:function(e,t){return!!t&&t.hasOwnProperty(e)}}])}();function Tu(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!t||0===t.length)throw new Error("The key field(s) must not be null or empty");return t.join(_u)}vs.CustomSymbolOverrides=Ru,Object.defineProperty(fs,"__esModule",{value:!0});var Su=vs,Iu=function(){return Xn(function e(t){Kn(this,e),this._locale=t},[{key:"getContent",value:function(){return new Su.CustomSymbolOverrides(this._locale)}}])}();fs.default=Iu;var Au={};Object.defineProperty(Au,"__esModule",{value:!0});var Ou=function(e){function t(e){var n;return Kn(this,t),(n=Bn(this,t))._locale=e,n.initialize(),n}return zn(t,e),Xn(t,[{key:"initialize",value:function(){if(!this.isInitialized())try{this._resourceConfigRetriever=this.createResourceConfigRetriever(),this.setInitializedState(!0)}catch(e){console.error("Failed to initialize query resolver ".concat(this.constructor.name))}return this.isInitialized()}}])}(ia.QueryResolver);Au.default=Ou;var bu=mr&&mr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(hs,"__esModule",{value:!0});var Lu=ia,Pu=bu(fs),Nu=function(e){function t(){return Kn(this,t),Bn(this,t,arguments)}return zn(t,e),Xn(t,[{key:"resolve",value:function(e,t){return this.validate(e,t),this.doResolve(e,t)}},{key:"doResolve",value:function(e,t){var n=new Lu.I18nConfiguration.Builder,r=this._resourceConfigRetriever.getContent(),i={currencyCode:t.currency,typeName:t.priceFormatType,cxId:t.cxId};switch(e){case Lu.PriceFormat.CURRENCY_FORMAT:var a=r.getCustomSymbolData(i);(0,Lu.isNullOrUndefined)(a)||(n.addConfiguration(Lu.PriceFormatResult.SYMBOL,a.customSymbol),n.addConfiguration(Lu.PriceFormatResult.INSERT_SPACE_IN_PATTERN,a.insertSpaceInPattern),n.addConfiguration(Lu.PriceFormatResult.FORMAT_PATTERN,a.formatPattern));break;case Lu.PriceFormat.CURRENCY_SYMBOL_POSITION:n.addConfiguration(Lu.PriceFormatResult.CURRENCY_SYMBOL_POSITION,r.getSymbolPositionOverride(i)||Lu.CurrencySymbolPosition.DEFAULT);break;case Lu.PriceFormat.SYMBOL_PREFIX:n.addConfiguration(Lu.PriceFormatResult.SYMBOL_PREFIX,r.getSymbolPrefix());break;case Lu.PriceFormat.TRAILING_ZERO_DISPLAY:n.addConfiguration(Lu.PriceFormatResult.TRAILING_ZERO_DISPLAY,r.getTrailingZeroDisplay(i)||Lu.TrailingZeroDisplay.AUTO);break;default:throw new Error("Attribute name ".concat(e," is not defined for feature ").concat(e.getConfigType()))}return n.build()}},{key:"validate",value:function(e,n){if(e.getConfigType()!==this.getTargetConfigType()||n.getConfigType()!==t.SPECIFIC_CONFIG_TYPE)throw new Error(this.getValidationErrorMessage())}},{key:"createResourceConfigRetriever",value:function(){return new Pu.default(this._locale)}},{key:"getTargetConfigType",value:function(){return t.CONFIG_TYPE}},{key:"getValidationErrorMessage",value:function(){return"Retail Price Format configs can only be resolved for"+"configType ".concat(t.CONFIG_TYPE," and args type ").concat(t.SPECIFIC_CONFIG_TYPE)}}],[{key:"create",value:function(e){if(e instanceof Lu.PriceFormatArgs){var n=e.locale;return new t((0,Lu.isNullOrUndefined)(n)?"und":n)}throw new Error("Cannot create PriceFormatResourceBundleQueryResolver using args of type ".concat(Yn(e),".")+"Use RetailPriceFormatArgs to query Price Format data.")}}])}(bu(Au).default);hs.default=Nu,Nu.CONFIG_TYPE=Lu.ConfigType.PRICE_FORMAT,Nu.SPECIFIC_CONFIG_TYPE=Lu.ConfigType.RETAIL_PRICE_FORMAT;var ku=mr&&mr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ho,"__esModule",{value:!0});var Uu=ia,Du=ku(Bo),Mu=ku(Zo),wu=ku(is),Fu=ku(hs),xu=function(){return Xn(function e(){Kn(this,e)},null,[{key:"getResolver",value:function(e){var t;switch(e.getConfigType()){case Uu.ConfigType.RETAIL_PRICE_FORMAT:t=Fu.default.create(e);break;case Uu.ConfigType.MARKETPLACEID_TO_CX_TUPLE:t=new wu.default;break;case Uu.ConfigType.CX_TUPLE_TO_I18N_DOMAIN:t=new Mu.default;break;case Uu.ConfigType.CX_TUPLE_TO_DEFAULT_PREFERENCES:t=new Du.default;break;default:throw new Error("No resolver has been registered for config type ".concat(e.getConfigType()))}return t}}])}();Ho.default=xu;var Hu=mr&&mr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(xo,"__esModule",{value:!0});var Bu=ia,Wu=Hu(Ho),Vu=function(e){function t(){return Kn(this,t),Bn(this,t,arguments)}return zn(t,e),Xn(t,[{key:"resolveConfiguration",value:function(e,t){return Wu.default.getResolver(t).resolve(e,t)}}])}(Bu.I18nConfigurationProvider);xo.default=Vu;var Gu=mr&&mr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Fo,"__esModule",{value:!0});var zu=Fo.ResourceBundleI18nConfigurationProvider=void 0,ju=Gu(xo);zu=Fo.ResourceBundleI18nConfigurationProvider=ju.default;var Yu,Ku=function(){return Xn(function e(t){Kn(this,e),this._configProvider=t},[{key:"resolve",value:function(e){if(ia.isNullOrUndefined(e)||ia.isNullOrUndefined(e.getObfuscatedMarketplaceId()))return hr.UNKNOWN;var t=(new ia.MarketplaceIdToCxTupleArgs.Builder).withObfuscatedMarketplaceId(e.getObfuscatedMarketplaceId()).build(),n=this._configProvider.getConfiguration(ia.MarketplaceIdToCxTuple.CX_FAMILY,t).getStringValue(),r=this._configProvider.getConfiguration(ia.MarketplaceIdToCxTuple.CX_ID,t).getStringValue();return ia.isNullOrUndefined(n)||ia.isNullOrUndefined(r)?hr.UNKNOWN:hr.of(n,r)}}])}(),qu=function(){return Xn(function e(t){Kn(this,e),this._configProvider=t},[{key:"resolveDefaultCurrency",value:function(e){var t=(new ia.CXTupleToDefaultPreferencesArgs.Builder).withCxFamily(e.cxFamily).withCxId(e.cxFamily).build();return this._configProvider.getConfiguration(ia.CXTupleToDefaultPreferences.DEFAULT_CURRENCY,t).getStringValue()||""}},{key:"resolveDefaultLanguage",value:function(e){var t=(new ia.CXTupleToDefaultPreferencesArgs.Builder).withCxFamily(e.cxFamily).withCxId(e.cxFamily).build();return this._configProvider.getConfiguration(ia.CXTupleToDefaultPreferences.DEFAULT_LANGUAGE,t).getStringValue()||""}}])}();function Xu(e,t){if(null==e)return null;if(t.has(e))return t.get(e);throw new Error("Failed to convert to config enum with ".concat(e))}function Zu(e,t){if(null==e)return null;var n,r=wn(t.entries());try{for(r.s();!(n=r.n()).done;){var i=Mn(n.value,2),a=i[0];if(i[1]==e)return a}}catch(e){r.e(e)}finally{r.f()}throw new Error("Failed to convert from config enum with ".concat(e))}function Qu(e,t){e.includes(t)&&e.splice(e.indexOf(t),1)}var Ju="currency",$u="literal",ec="minusSign",tc="fraction",nc="decimal",rc="integer",ic=new RegExp("[‎‏‪-‮⁦-⁩؜]+"),ac="undefined"!=typeof process&&process.env.I18N_PRICE_FORMAT_NUMBER_FORMAT_CACHE_SIZE?parseInt(process.env.I18N_PRICE_FORMAT_NUMBER_FORMAT_CACHE_SIZE,10):1e3,oc=new Set(["retail"]),sc=new Map([["end",ia.CurrencySymbolPosition.END],["start",ia.CurrencySymbolPosition.START],["default",ia.CurrencySymbolPosition.DEFAULT]]),uc=new Map([["HIDE_IF_WHOLE",ia.TrailingZeroDisplay.HIDE_IF_WHOLE],["AUTO",ia.TrailingZeroDisplay.AUTO]]),cc=new Map([["inSentence",ia.PriceFormatType.IN_SENTENCE],["amazonSymbol",ia.PriceFormatType.AMAZON_SYMBOL],["iso",ia.PriceFormatType.ISO],["compact",ia.PriceFormatType.COMPACT],["plural",ia.PriceFormatType.PLURAL]]),lc=function(){return Xn(function e(t,n,r,i,a){Kn(this,e),this.numberFormatCache=new _r({maxSize:ac}),this.type=n,this.trailingZeroDisplay=a,this.localizationContext=i,this.configurationProvider=this.resolveConfigProvider();var o=new Ku(this.configurationProvider),s=new qu(this.configurationProvider);this.cxTuple=this.localizationContext.getAttribute(nr.CX_TUPLE_KEY)||o.resolve(r),this.locale=Ki.getCanonicalLocaleString(this.resolveLocale(t,this.cxTuple,r,s)),this.marketplaceDefaultCurrencyCode=this.resolveDefaultCurrency(this.cxTuple,r,s);var u=(new ia.PriceFormatArgsBuilder).withLocale(this.locale).withPriceFormatType(Xu(n,cc)).build(),c=this.getConfigurationDataWithArgs(u,[ia.PriceFormat.SYMBOL_PREFIX,ia.PriceFormat.CURRENCY_SYMBOL_POSITION]);this.symbolPosition=this.getCurrencySymbolPositionFromConfig(c),this.symbolPrefix=c.getStringValue(ia.PriceFormatResult.SYMBOL_PREFIX)||""},[{key:"format",value:function(e){return dc(this.getNumberFormatParts(e))}},{key:"formatToParts",value:function(e){var t=this.getNumberFormatParts(e),n=function(e,t){return _c(e,tc)&&"compact"!==t?Ec(e)?gc(e)?3:4:gc(e)?0:1:Ec(e)?5:2}(t,this.type),r=hc(t,rc),i=hc(t,Ju),a=hc(t,nc),o=hc(t,tc);if(!r||!i)throw new Error("Currency symbol or integer value are not present");var s={fieldOrder:n,integerValue:r,currencySymbol:i,decimalSeparator:a,fractionalValue:o};return{amount:e.amount,currency:e.currency,displayString:dc(t),displayFields:s}}},{key:"getConfigurationData",value:function(e,t){if(ia.isNullOrUndefined(e))throw new Error("The currency code must not be null or undefined");var n=new ia.ConfigurationData;if(this.checkCachedConfig(e,t,n),0==t.length)return n;var r=this.buildQueryArgs(e),i=this.getConfigurationDataWithArgs(r,t);return this.cacheConfig(e,t,i),i.merge(n),i}},{key:"resolveSymbolPositionOverride",value:function(e){var t;if(e)t=this.getConfigurationData(e,[ia.PriceFormat.CURRENCY_SYMBOL_POSITION]);else{var n=(new ia.PriceFormatArgsBuilder).withLocale(this.locale).withPriceFormatType(Xu(this.type,cc)).build();t=this.getConfigurationDataWithArgs(n,[ia.PriceFormat.CURRENCY_SYMBOL_POSITION])}return this.getCurrencySymbolPositionFromConfig(t)}},{key:"resolveTrailingZeroDisplay",value:function(e){return void 0!==this.trailingZeroDisplay?this.trailingZeroDisplay:Zu(this.getConfigurationData(e,[ia.PriceFormat.TRAILING_ZERO_DISPLAY]).getEnumValue(ia.TrailingZeroDisplay,ia.PriceFormatResult.TRAILING_ZERO_DISPLAY),uc)||"AUTO"}},{key:"resolveConfigProvider",value:function(){return ia.ConfigurationProviderManager.hasProvider()||ia.ConfigurationProviderManager.register(new zu),ia.ConfigurationProviderManager.getProvider()}},{key:"resolveLocale",value:function(e,t,n,r){if(!ia.isNullOrUndefined(e))return""!==e?e:(console.warn("An empty locale string was passed in; this will be interpreted as the Root locale. This is generally an I18n anti-pattern. Consider passing in a valid BCP 47 language tag."),"und");var i=r.resolveDefaultLanguage(t);return""!==i?i:n.getDefaultLocale()||"und"}},{key:"resolveDefaultCurrency",value:function(e,t,n){var r=n.resolveDefaultCurrency(e);return""!==r?r:t.getDefaultCurrency()}},{key:"getConfigurationDataWithArgs",value:function(e,t){var n=new ia.ConfigurationData;if(ia.isNullOrUndefined(e))return console.log("Return empty configuration data with args undefined."),n;var r,i=wn(t);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=this.configurationProvider.getConfiguration(a,e);n.merge(o.configData)}}catch(e){i.e(e)}finally{i.f()}return n}},{key:"checkCachedConfig",value:function(e,t,n){if(this.currencyFormatCache&&this.currencyFormatCache.key===e&&(Qu(t,ia.PriceFormat.CURRENCY_FORMAT),n.merge(this.currencyFormatCache.value)),this.trailingZeroDisplay||this.trailingZeroDisplayCache&&this.trailingZeroDisplayCache.key===e){Qu(t,ia.PriceFormat.TRAILING_ZERO_DISPLAY);var r=this.trailingZeroDisplay?Xu(this.trailingZeroDisplay,uc):this.trailingZeroDisplayCache.value,i=(new ia.I18nConfiguration.Builder).addConfiguration(ia.PriceFormatResult.TRAILING_ZERO_DISPLAY,r).build();n.merge(i.configData)}if(this.symbolPositionCache&&this.symbolPositionCache.key===e){Qu(t,ia.PriceFormat.CURRENCY_SYMBOL_POSITION);var a=(new ia.I18nConfiguration.Builder).addConfiguration(ia.PriceFormatResult.CURRENCY_SYMBOL_POSITION,this.symbolPositionCache.value).build().configData;n.merge(a)}if(this.symbolPrefixCache&&this.symbolPrefixCache.key===e){Qu(t,ia.PriceFormat.SYMBOL_PREFIX);var o=(new ia.I18nConfiguration.Builder).addConfiguration(ia.PriceFormatResult.SYMBOL_PREFIX,this.symbolPrefixCache.value).build().configData;n.merge(o)}}},{key:"cacheConfig",value:function(e,t,n){t.includes(ia.PriceFormat.CURRENCY_FORMAT)&&(this.currencyFormatCache={key:e,value:n}),t.includes(ia.PriceFormat.CURRENCY_SYMBOL_POSITION)&&(this.symbolPositionCache={key:e,value:n.getEnumValue(ia.CurrencySymbolPosition,ia.PriceFormatResult.CURRENCY_SYMBOL_POSITION)}),t.includes(ia.PriceFormat.TRAILING_ZERO_DISPLAY)&&(this.trailingZeroDisplayCache={key:e,value:n.getEnumValue(ia.TrailingZeroDisplay,ia.PriceFormatResult.TRAILING_ZERO_DISPLAY)}),t.includes(ia.PriceFormat.SYMBOL_PREFIX)&&(this.symbolPrefixCache={key:e,value:n.getStringValue(ia.PriceFormatResult.SYMBOL_PREFIX)})}},{key:"getCurrencySymbolPositionFromConfig",value:function(e){return Zu(e.getEnumValue(ia.CurrencySymbolPosition,ia.PriceFormatResult.CURRENCY_SYMBOL_POSITION),sc)||"default"}},{key:"buildQueryArgs",value:function(e){return oc.has(this.cxTuple.cxFamily)?(new ia.PriceFormatArgsBuilder).withCurrency(e).withCxFamily(this.cxTuple.cxFamily).withCxId(this.cxTuple.cxId).withLocale(this.locale).withPriceFormatType(Xu(this.type,cc)).build():hr.UNKNOWN.cxFamily===this.cxTuple.cxFamily?(new ia.PriceFormatArgsBuilder).withCurrency(e).withLocale(this.locale).withPriceFormatType(Xu(this.type,cc)).build():void 0}},{key:"getFormat",value:function(e){var t,n=!1,r=!1,i="default",a=this.getConfigurationData(e.currencyCode,[ia.PriceFormat.CURRENCY_FORMAT,ia.PriceFormat.SYMBOL_PREFIX,ia.PriceFormat.CURRENCY_SYMBOL_POSITION]);if(function(e){switch(e){case"iso":case"plural":return!1;default:return!0}}(this.type)){var o=a.getStringValue(ia.PriceFormatResult.SYMBOL);this.marketplaceDefaultCurrencyCode&&this.marketplaceDefaultCurrencyCode!==e.currencyCode&&!o?(n=!0,t=this.symbolPrefix+e.currencyCode,r=!0):o&&(t=o,n=!0,r=a.getBooleanValue(ia.PriceFormatResult.INSERT_SPACE_IN_PATTERN)||!1)}return"iso"!==this.type&&(i="default"!==this.symbolPosition?this.symbolPosition:this.resolveSymbolPositionOverride(e.currencyCode)),{numberFormat:this.getNumberFormatFromCacheOrCreate(this.locale,e,this.type),currencySymbol:t,insertSpaceInPattern:r,symbolOverrideApplied:n,symbolPosition:i}}},{key:"getNumberFormatParts",value:function(e){var t=e.currency,n=this.getFormat(t),r=function(e,t){var n=Math.pow(10,t||0),r=Number((e*n).toFixed(5));return r%.5!=0?e:Math.floor(r)%2==0?Math.floor(r)/n:Math.round(r)/n}(e.amount,n.numberFormat.resolvedOptions().minimumFractionDigits);if("number"!=typeof r||Number.isNaN(r))throw new Error("Amount is not a number");var i,a,o,s=function(e,t){return"compact"===t?e<0?Math.ceil(e)||0:Math.floor(e):e}(r,this.type),u=n.numberFormat.formatToParts(s);if("compact"===this.type?u=function(e){var t;mc(e)&&(e[t=Ec(e)?Cc(e,$u,!0):Cc(e,$u,!1)].type===$u&&" "===e[t].value&&e.splice(t,1));return e}(u):n.insertSpaceInPattern&&(o={type:$u,value:" "},mc(i=u)||(Ec(i)?(a=Cc(i,Ju,!0),i.splice(a,0,o)):(a=Cc(i,Ju,!1),i.splice(a+1,0,o))),u=i),"default"!==n.symbolPosition&&(u=function(e,t,n){if("end"!==n||Ec(t)){if("start"===n&&Ec(t)){var r=0;t[r].type===$u&&r++,t[r].type===ec&&r++,t=yc(t=fc(e,t,n,r,!0),Cc(t,Ju,!0),r)}}else t=yc(t=fc(e,t,n,t.length-1,!1),Cc(t,Ju,!1),t.length-1);return t}(this.type,u,n.symbolPosition)),!u)throw new Error("Intl.NumberFormat formatToParts returned empty");return"HIDE_IF_WHOLE"===this.resolveTrailingZeroDisplay(t.currencyCode)&&(u=this.hideTrailingZeroIfInteger(e,n,u)),u.map(function(e){var t=e.type,r=e.value;return t===Ju?(n.symbolOverrideApplied&&n.currencySymbol&&(r=n.currencySymbol),{type:t,value:r}):{type:t,value:r}})}},{key:"hideTrailingZeroIfInteger",value:function(e,t,n){return e.amount.toFixed(t.numberFormat.resolvedOptions().minimumFractionDigits)%1!=0?n:n.filter(function(e){return e.type!==nc&&e.type!==tc})}},{key:"getNumberFormatFromCacheOrCreate",value:function(e,t,n){var r=this.serializeNumberFormatCacheKey(e,t,n),i=this.numberFormatCache.get(r);return void 0===i&&(i=new Intl.NumberFormat(this.locale,function(e,t){return Object.assign({currency:e.currencyCode},function(e){return Object.assign({style:"currency",currencyDisplay:vc(e),useGrouping:pc(e)},function(e){return"compact"===e?{maximumFractionDigits:0,minimumFractionDigits:0}:{}}(e))}(t))}(t,n)),this.numberFormatCache.set(r,i)),i}},{key:"serializeNumberFormatCacheKey",value:function(e,t,n){return"".concat(e,"-").concat(t.currencyCode,"-").concat(n)}}],[{key:"getInstance",value:function(e){return(new this.Builder).withLocale(e).withType("amazonSymbol").build()}},{key:"getInstanceByType",value:function(e,t){return(new this.Builder).withLocale(e).withType(t).build()}},{key:"getInstanceByMarketplaceId",value:function(e,t){return(new this.Builder).withLocale(e).withType("amazonSymbol").withMarketplace(new ra(t)).build()}},{key:"getInstanceByMarketplace",value:function(e,t){return(new this.Builder).withLocale(e).withType("amazonSymbol").withMarketplace(t).build()}},{key:"getInstanceByTypeAndMarketplaceId",value:function(e,t,n){return(new this.Builder).withLocale(e).withType(t).withMarketplace(new ra(n)).build()}},{key:"getInstanceByTypeAndMarketplace",value:function(e,t,n){return(new this.Builder).withLocale(e).withType(t).withMarketplace(n).build()}}])}();function dc(e){return e.map(function(e){return e.value}).reduce(function(e,t){return e+t})}function hc(e,t){var n,r="",i=wn(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(t!==rc||a.type!==rc&&"group"!==a.type){if(a.type===t)return a.value}else r+=a.value}}catch(e){i.e(e)}finally{i.f()}return r||void 0}function fc(e,t,n,r,i){if(mc(t)){var a=Cc(t,$u,i);"end"===n&&(t[a].value=t[a].value.replace(ic,"")),t=yc(t,a,r),"compact"===e&&t.splice(r,1)}return t}function vc(e){switch(e){case"iso":return"code";case"plural":return"name";default:return"symbol"}}function pc(e){return"compact"!==e}function mc(e){var t=1;return Ec(e)?(e[(t=e.length)-1].type===$u&&t--,t-=2):(e[t-1].type===$u&&t++,e[t-1].type===ec&&t++),e[t].type===$u}function Ec(e){var t=e.length-1;return e[t].type===$u&&t--,e[t].type===Ju}function gc(e){return _c(e,nc)}function _c(e,t){if(!e)throw new Error("Format Parts must not be emtpy");var n,r=wn(e);try{for(r.s();!(n=r.n()).done;)if(n.value.type===t)return!0}catch(e){r.e(e)}finally{r.f()}return!1}function yc(e,t,n){if(n===t)return e;for(var r=e[t],i=n<t?-1:1,a=t;a!==n;a+=i)e[a]=e[a+i];return e[n]=r,e}function Cc(e,t,n){var r,i,a;for(n?(r=e.length-1,i=0,a=-1):(r=0,i=e.length-1,a=1);r!==i;)if(e[r].type!==t)r+=a;else{if(t!==$u||0!==r&&r!==e.length-1)return r;r+=a}return e[r].type===t?r:-1}function Rc(e){switch(e){case"compact":return"compact";case"in_sentence":return"inSentence";case"iso":return"iso";case"plural":return"plural";default:return"amazonSymbol"}}lc.Builder=((Yu=function(){return Xn(function e(){Kn(this,e)},[{key:"withLocale",value:function(e){return this.locale=e,this}},{key:"withType",value:function(e){return this.type=e,this}},{key:"withMarketplace",value:function(e){return this.marketplace=e,this}},{key:"withMarketplaceId",value:function(e){return this.marketplace=new ra(e),this}},{key:"withTrailingZeroDisplay",value:function(e){return this.trailingZeroDisplay=e,this}},{key:"withLocalizationContext",value:function(e){this.locale=e.getLocale(),this.localizationContext=e;var t=e.asAttributesMap().get(or);return t instanceof Ji&&(this.marketplace=t),this}},{key:"build",value:function(){var e=this.marketplace||ta.provider().getMarketplace(),t=this.localizationContext||lc.Builder.DEFAULT_LC;return new lc(this.locale,this.type||"amazonSymbol",e,t,this.trailingZeroDisplay)}}])}()).DEFAULT_LC=(new ir).build(),Yu);var Tc=function(){return Xn(function e(t,n){Kn(this,e),t||(t=(new Intl.NumberFormat).resolvedOptions().locale);var r,i,a=n&&n.style?Rc(n.style):Rc("default"),o=new lc.Builder;if(zi(t)){r=t.getLocale(),i=t.asAttributesMap().get(or);var s=t;o.withLocalizationContext(s).withMarketplace(i)}else r=Array.isArray(t)?0===t.length?(new Intl.NumberFormat).resolvedOptions().locale:t[0]:t,o.withLocale(r);this.priceFormat=o.withType(a).build()},[{key:"format",value:function(e){return this.priceFormat.format(e)}}])}();function Sc(e){return{create:function(){return{has:function(t){return t in e},get:function(t){return e[t]},set:function(t,n){e[t]=n}}}}}var Ic=function(){function e(t){var n,r,i=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.defaultLocale,o=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;if(Kn(this,e),this.formatterCache={number:{},dateTime:{},pluralRules:{},price:{}},this.format=function(e){var t=i.formatToParts(e);if(1===t.length)return t[0].value;var n=t.reduce(function(e,t){return e.length&&t.type===ji.literal&&"string"==typeof e[e.length-1]?e[e.length-1]+=t.value:e.push(t.value),e},[]);return n.length<=1?n[0]||"":n},this.formatToParts=function(e){return Qi(i.ast,i.localesOrLocalizationContext,i.formatters,i.formats,e,void 0,i.message,void 0,i.resolvedLocales)},this.formatToVdomParts=function(e,t){return function(e,t,n,r,i,a,o,s,u){return Qi(e,t,n,r,a,void 0,s,i,u).map(function(e){return e.value})}(i.ast,i.localesOrLocalizationContext,i.formatters,i.formats,e,t,0,i.message,i.resolvedLocales)},this.resolvedOptions=function(){return{locale:i.resolvedLocale.toLocaleString()}},this.getAst=function(){return i.ast},this.localesOrLocalizationContext=a,this.resolvedLocales=e.resolveLocale(zi(a)?a.getLocale():a),Array.isArray(this.resolvedLocales)?this.resolvedLocale=new Intl.Locale(this.resolvedLocales[0]):this.resolvedLocale=new Intl.Locale(this.resolvedLocales),"string"==typeof t){if(this.message=t,!e.__parse)throw new TypeError("IntlMessageFormat.__parse must be set to process `message` of type `string`");this.ast=e.__parse(t,{ignoreTag:void 0!==s?s.ignoreTag:void 0,locale:this.resolvedLocale})}else this.ast=t;if(!Array.isArray(this.ast))throw new TypeError("A message must be provided as a String or AST.");this.formats=(n=e.formats,(r=o)?Object.keys(n).reduce(function(e,t){var i,a;return e[t]=(i=n[t],(a=r[t])?Object.assign(Object.assign(Object.assign({},i||{}),a||{}),Object.keys(i).reduce(function(e,t){return e[t]=Object.assign(Object.assign({},i[t]),a[t]||{}),e},{})):i),e},Object.assign({},n)):n),this.formatters=s&&s.formatters||function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{number:{},dateTime:{},pluralRules:{},price:{}};return{getNumberFormat:Pi(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Nn(Intl.NumberFormat,t)},{cache:Sc(e.number),strategy:Hi.variadic}),getDateTimeFormat:Pi(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Nn(Intl.DateTimeFormat,t)},{cache:Sc(e.dateTime),strategy:Hi.variadic}),getPluralRules:Pi(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Nn(Intl.PluralRules,t)},{cache:Sc(e.pluralRules),strategy:Hi.variadic}),getPriceFormat:Pi(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Nn(Tc,t)},{cache:Sc(e.price),strategy:Hi.variadic})}}(this.formatterCache)}return Xn(e,null,[{key:"defaultLocale",get:function(){return e.memoizedDefaultLocale||(e.memoizedDefaultLocale=(new Intl.NumberFormat).resolvedOptions().locale),e.memoizedDefaultLocale}}])}();Ic.memoizedDefaultLocale=null,Ic.resolveLocale=function(e){return Ki.getCanonicalLocaleString(e)},Ic.__parse=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=Object.assign({shouldParseSkeletons:!0,requiresOtherClause:!0},t);var n=new Si(e,t).parse();if(n.err){var r=SyntaxError(Tr[n.err.kind]);throw r.location=n.err.location,r.originalMessage=n.err.message,r}return t&&t.captureLocation||Li(n.val),n.val},Ic.formats={number:{integer:{maximumFractionDigits:0},currency:{style:"currency"},percent:{style:"percent"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}},price:{default:{style:"default"},aui:{style:"aui"},iso:{style:"iso"},plural:{style:"plural"},amazon_symbol:{style:"amazon_symbol"},compact:{style:"compact"},in_sentence:{style:"in_sentence"}}};var Ac,Oc,bc,Lc=Ic,Pc=function(){return Xn(function e(t,n,r){Kn(this,e),this.message=t,this.context=n,this.options=r},[{key:"format",value:function(e){return void 0===this.formatter&&(this.formatter=new Lc(this.message,this.context)),this.formatter.format(e)}}])}(),Nc=function(){return Xn(function e(t,n,r){Kn(this,e),this.messages=t,this.baseName=n,this.context=r},[{key:"getMessage",value:function(e){var t=this.messages.get(e);if(void 0===t)throw new Error("Resource does not exist: bundle=".concat(this.baseName,", key=").concat(e,", context=").concat(this.context));return t}},{key:"formatMessage",value:function(e,t){var n=this.getMessage(e);return new Pc(n,this.context).format(t)}}])}(),kc=Object.freeze({runtimeResourceFormat:"JsonFileHierarchy",fallbackMechanismAttributes:[["i18nDomain"]]}),Uc={exports:{}};Oc=mr,bc=function(){var e=function(){},t="undefined",n=("undefined"==typeof window?"undefined":Yn(window))!==t&&Yn(window.navigator)!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function i(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(t,n){for(var i=0;i<r.length;i++){var a=r[i];this[a]=i<t?e:this.methodFactory(a,t,n)}this.log=this.debug}function s(e,n,r){return function(){("undefined"==typeof console?"undefined":Yn(console))!==t&&(o.call(this,n,r),this[e].apply(this,arguments))}}function u(r,o,u){return function(r){return"debug"===r&&(r="log"),("undefined"==typeof console?"undefined":Yn(console))!==t&&("trace"===r&&n?a:void 0!==console[r]?i(console,r):void 0!==console.log?i(console,"log"):e)}(r)||s.apply(this,arguments)}function c(e,n,i){var a,s=this;n=null==n?"WARN":n;var c="loglevel";function l(){var e;if(("undefined"==typeof window?"undefined":Yn(window))!==t&&c){try{e=window.localStorage[c]}catch(e){}if(Yn(e)===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(c)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===s.levels[e]&&(e=void 0),e}}"string"==typeof e?c+=":"+e:"symbol"===Yn(e)&&(c=void 0),s.name=e,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=i||u,s.getLevel=function(){return a},s.setLevel=function(n,i){if("string"==typeof n&&void 0!==s.levels[n.toUpperCase()]&&(n=s.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(a=n,!1!==i&&function(e){var n=(r[e]||"silent").toUpperCase();if(("undefined"==typeof window?"undefined":Yn(window))!==t&&c){try{return void(window.localStorage[c]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"="+n+";"}catch(e){}}}(n),o.call(s,n,e),("undefined"==typeof console?"undefined":Yn(console))===t&&n<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(e){n=e,l()||s.setLevel(e,!1)},s.resetLevel=function(){s.setLevel(n,!1),function(){if(("undefined"==typeof window?"undefined":Yn(window))!==t&&c){try{return void window.localStorage.removeItem(c)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},s.enableAll=function(e){s.setLevel(s.levels.TRACE,e)},s.disableAll=function(e){s.setLevel(s.levels.SILENT,e)};var d=l();null==d&&(d=n),s.setLevel(d,!1)}var l=new c,d={};l.getLogger=function(e){if("symbol"!==Yn(e)&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new c(e,l.getLevel(),l.methodFactory)),t};var h=("undefined"==typeof window?"undefined":Yn(window))!==t?window.log:void 0;return l.noConflict=function(){return("undefined"==typeof window?"undefined":Yn(window))!==t&&window.log===l&&(window.log=h),l},l.getLoggers=function(){return d},l.default=l,l},(Ac=Uc).exports?Ac.exports=bc():Oc.log=bc();var Dc=Uc.exports.getLogger("arb-js"),Mc={trace:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.output("trace",t)},debug:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.output("debug",t)},info:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.output("info",t)},warn:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.output("warn",t)},error:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.output("error",t)},isDebugEnabled:function(){return Dc.getLevel()<=Dc.levels.DEBUG},isInfoEnabled:function(){return Dc.getLevel()<=Dc.levels.INFO},output:function(e,t){t[0]="[".concat("arb-js","] ").concat(t[0]),Dc[e].apply(Dc,Fn(t))}},wc=Mc,Fc={},xc=function(){return Xn(function e(t){Kn(this,e),this.RETRY_LIMIT=1,this.loaded={},this.options=Object.assign(Object.assign({},Fc),t)},[{key:"readManifest",value:function(e){return kc}},{key:"readResource",value:(e=Ln(Un().m(function e(t){var n,r,i,a;return Un().w(function(e){for(;;)switch(e.p=e.n){case 0:n=0;case 1:if(!(n<=this.RETRY_LIMIT)){e.n=9;break}if(r=void 0,e.p=2,void 0!==(r=this.options.resolveBundleUrl(this.options,t))){e.n=3;break}return wc.error("No resource endpoint found. Fallback item: ",t),e.a(2);case 3:return void 0===this.loaded[r]?(wc.info("Fetching ".concat(r," for fallback item: "),t),this.loaded[r]=this.options.resolveResourcePack(r)):wc.info("Request already fetched for fallback item: ",t),e.n=4,this.loaded[r];case 4:if(null!=(i=e.v)){e.n=5;break}return wc.error("Loading resource has failed. Fallback item: ",t),e.a(2);case 5:return e.a(2,i);case 6:if(e.p=6,a=e.v,!(n<this.RETRY_LIMIT&&a.retry&&r)){e.n=7;break}return wc.info("Retrying request for ".concat(r,". Fallback item: "),t),this.loaded[r]=void 0,e.a(3,8);case 7:return wc.error("Failed to load resource. Error: ".concat(a.message,". Fallback item: "),t),e.a(3,9);case 8:n++,e.n=1;break;case 9:return e.a(2,void 0)}},e,this,[[2,6]])})),function(t){return e.apply(this,arguments)})}]);var e}(),Hc=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Kn(this,t),(n=Bn(this,t,[e])).retry=r,n.retry=r,n}return zn(t,e),Xn(t)}(Pn(Error));function Bc(e,t){return Wc.apply(this,arguments)}function Wc(){return(Wc=Ln(Un().m(function e(t,n){var r,i;return Un().w(function(e){for(;;)switch(e.n){case 0:if("undefined"==typeof performance){e.n=2;break}return r=performance.now(),e.n=1,n();case 1:i=performance.now(),wc.info("".concat(t,": ").concat(i-r," ms")),e.n=4;break;case 2:return console.time(t),e.n=3,n();case 3:console.timeEnd(t);case 4:return e.a(2)}},e)}))).apply(this,arguments)}var Vc=function(){return Xn(function e(t,n){Kn(this,e),this.resourceReader=t,this.fallbackHandler=n,this.resourcesCache=new Cr(this.resourceReader.readResource.bind(this.resourceReader),{maxSize:e.RESOURCE_CACHE_SIZE,keyFn:Ar.cacheKey})},[{key:"load",value:(e=Ln(Un().m(function e(t,n){var r,i,a,o,s,u,c,l,d,h,f,v,p,m,E,g=this;return Un().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=new Map,i=this.resourceReader.readManifest(t)){e.n=1;break}throw new Error("Manifest can not be null!");case 1:return a=this.fallbackHandler.getFallbackChains(t,i.fallbackMechanismAttributes,n),wc.info('Requesting resource packs for "'.concat(t,'" bundle. Localization context: %0'),n),e.n=2,Bc('Resource pack requests for "'.concat(t,'" bundle'),Ln(Un().m(function e(){var t,n,r,i;return Un().w(function(e){for(;;)switch(e.n){case 0:t=[],n=wn(a);try{for(n.s();!(r=n.n()).done;)i=r.value,t.push(g.resourcesCache.get(i))}catch(e){n.e(e)}finally{n.f()}return e.n=1,Promise.all(t);case 1:return e.a(2)}},e)})));case 2:o=0,s=wn(a),e.p=3,s.s();case 4:if((u=s.n()).done){e.n=8;break}return c=u.value,o++,e.n=5,this.resourcesCache.get(c);case 5:if(void 0!==(l=e.v)&&void 0!==l[c.locale]&&void 0!==l[c.locale][c.bundle]){e.n=6;break}return wc.debug("No bundled resources were found for %0",c),e.a(3,7);case 6:for(d=l[c.locale][c.bundle],h=0,f=Object.entries(d);h<f.length;h++)v=Mn(f[h],2),p=v[0],m=v[1],r.has(p)||r.set(p,this.findMessage(m,c));case 7:e.n=4;break;case 8:e.n=10;break;case 9:e.p=9,E=e.v,s.e(E);case 10:return e.p=10,s.f(),e.f(10);case 11:return 0===o&&wc.error("The generated locale fallback chain was empty.This is bad as no context messages could be populated in MessageBundle."),e.a(2,new Nc(r,t,n))}},e,this,[[3,9,10,11]])})),function(t,n){return e.apply(this,arguments)})},{key:"findMessage",value:function(e,t){var n=Yn(e);if("string"===n)return e;if("object"===n){var r=this.findMatchingVariant(e,t);return r?r.value:e.value}throw new Error("Unsupported resource pack value type")}},{key:"findMatchingVariant",value:function(e,t){for(var n=e.overrides,r=n.length-1;r>=0;r--){for(var i=n[r],a=!0,o=0,s=Object.entries(i.localizationContext);o<s.length;o++){var u=Mn(s[o],2),c=u[0],l=u[1];if(t.variants&&(!t.variants.has(c)||t.variants.get(c)!==l)){a=!1;break}}if(a)return i}}}]);var e}();Vc.RESOURCE_CACHE_SIZE=512;var Gc=function(){return Xn(function e(t,n){Kn(this,e),this.localizationContextProvider=t,this.asyncResourceReader=n;var r=new Or;this.bundleLoader=new Vc(n,r),this.bundleCache=new Cr(this.generateMessageBundle.bind(this),{maxSize:e.MESSAGE_BUNDLE_CACHE_SIZE,keyFn:Rr.generateCacheKey})},[{key:"generateMessageBundle",value:(t=Ln(Un().m(function e(t){return Un().w(function(e){for(;;)if(0===e.n)return e.a(2,this.bundleLoader.load(t.bundle,t.context))},e,this)})),function(e){return t.apply(this,arguments)})},{key:"getBundle",value:(e=Ln(Un().m(function e(t,n){var r,i,a;return Un().w(function(e){for(;;)switch(e.n){case 0:return r=n||this.localizationContextProvider.getLocalizationContext(),i=new Rr(t,r),e.n=1,this.bundleCache.get(i);case 1:return a=e.v,e.a(2,a)}},e,this)})),function(t,n){return e.apply(this,arguments)})}]);var e,t}();function zc(e,t){var n=e&&e.endpointMap&&e.endpointMap[t.locale];return n&&n[t.bundle]}Gc.MESSAGE_BUNDLE_CACHE_SIZE=512;var jc={endpointMap:{ar:{strings:"translation-ar.json"},"ar-AE":{strings:"translation-ar.json"},bn:{strings:"translation-bn.json"},"bn-IN":{strings:"translation-bn.json"},cs:{strings:"translation-cs.json"},"cs-CZ":{strings:"translation-cs.json"},da:{strings:"translation-da.json"},"da-DK":{strings:"translation-da.json"},de:{strings:"translation-de.json"},"de-DE":{strings:"translation-de.json"},en:{strings:"translation-en.json"},"en-CA":{strings:"translation-en.json"},"en-GB":{strings:"translation-en.json"},"en-IN":{strings:"translation-en.json"},"en-US":{strings:"translation-en.json"},es:{strings:"translation-es.json"},"es-ES":{strings:"translation-es.json"},"es-US":{strings:"translation-es.json"},fr:{strings:"translation-fr.json"},"fr-CA":{strings:"translation-fr.json"},"fr-FR":{strings:"translation-fr.json"},he:{strings:"translation-he.json"},"he-IL":{strings:"translation-he.json"},hi:{strings:"translation-hi.json"},"hi-IN":{strings:"translation-hi.json"},it:{strings:"translation-it.json"},"it-IT":{strings:"translation-it.json"},ja:{strings:"translation-ja.json"},"ja-JP":{strings:"translation-ja.json"},kn:{strings:"translation-kn.json"},"kn-IN":{strings:"translation-kn.json"},ko:{strings:"translation-ko.json"},"ko-KR":{strings:"translation-ko.json"},ml:{strings:"translation-ml.json"},"ml-IN":{strings:"translation-ml.json"},mr:{strings:"translation-mr.json"},"mr-IN":{strings:"translation-mr.json"},nl:{strings:"translation-nl.json"},"nl-NL":{strings:"translation-nl.json"},pl:{strings:"translation-pl.json"},"pl-PL":{strings:"translation-pl.json"},pt:{strings:"translation-pt.json"},"pt-BR":{strings:"translation-pt.json"},"pt-PT":{strings:"translation-pt.json"},ta:{strings:"translation-ta.json"},"ta-IN":{strings:"translation-ta.json"},te:{strings:"translation-te.json"},"te-IN":{strings:"translation-te.json"},tr:{strings:"translation-tr.json"},"tr-TR":{strings:"translation-tr.json"},und:{strings:"translation.json"},zh:{strings:"translation-zh.json"},"zh-CN":{strings:"translation-zh.json"},"zh-TW":{strings:"translation-zh.json"}}},Yc=new Map([["translations/translation.json",r(254)],["translations/translation-ar.json",r(3278)],["translations/translation-de.json",r(214)],["translations/translation-en.json",r(8494)],["translations/translation-es.json",r(1045)],["translations/translation-he.json",r(602)],["translations/translation-ko.json",r(3743)],["translations/translation-pt.json",r(2061)],["translations/translation-zh.json",r(3847)],["translations/translation-fr.json",r(8925)],["translations/translation-it.json",r(7992)],["translations/translation-ja.json",r(2300)]]);function Kc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"strings";return function(e){var t={};e.resolveBundleUrl?t.resolveBundleUrl=function(t,n){return e.resolveBundleUrl(zc(e.arbManifest,n),n.locale,n.bundle)}:t.resolveBundleUrl=function(t,n){var r,i=null!==(r=e.urlPrefix)&&void 0!==r?r:"";return"/"!==i[0]&&(i="/"+i),i&&"/"!==i[i.length-1]&&(i+="/"),i+zc(e.arbManifest,n)},e.resolveResourcePack&&(t.resolveResourcePack=e.resolveResourcePack);var n=function(e){return new xc(Object.assign({resolveResourcePack:function(e){return Ln(Un().m(function t(){var n,r,i,a,o;return Un().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,fetch(e);case 1:if(n=t.v,r=n.ok,i=n.status,a=n.statusText,r){t.n=2;break}throw o=i>=500&&i<600,wc.error("Failed to fetch ".concat(e,": %O"),{status:i,statusText:a}),new Hc("Failed to fetch ".concat(e),o);case 2:return t.a(2,n.json())}},t)}))()}},e))}(t);return new Gc(new ar(e.localizationContextProvider),n)}({arbManifest:jc,localizationContextProvider:function(){return(new ir).withLocale(e).withDefaultLocale("en-US").build()},resolveBundleUrl:function(e){return e?"translations/".concat(e):void 0},resolveResourcePack:function(e){return e?Promise.resolve(Yc.get(e)):Promise.reject(new Error("Asset could not be retrieved"))}}).getBundle(t)}var qc=function(){return c(function e(){l(this,e),n(this,"currentModalInstance",null)},[{key:"createModal",value:function(e){var t=this,n=null;return new Promise(function(r){try{window.P.when("A","a-modal").execute(function(i,a){var o=i.$(e.trigger),s={name:e.name,header:e.header,width:e.width,closeButton:e.closeButton,position:e.position,dataStrategy:e.dataStrategy,popoverLabel:e.popoverLabel,inlineContent:e.content};if((n=a.get(o))?n.update(s):n=a.create(o,s),!n)return S.logErrorWithLevel(R.ERROR,"Failed to create the modal"),void r(!1);t.currentModalInstance=n,r(!0)})}catch(e){S.logErrorWithLevelWithException(R.ERROR,e instanceof Error?e:new Error(String(e)),"Error in modal creation"),r(!1)}})}},{key:"showModal",value:function(){var e=this;return new Promise(function(t){try{if(!e.currentModalInstance)return S.logErrorWithLevel(R.ERROR,"No modal instance available to show. Call createModal first."),void t(!1);var n=e.currentModalInstance.show();if(!n)return S.logErrorWithLevel(R.ERROR,"Failed to show the modal"),void t(!1);t(n)}catch(e){S.logErrorWithLevelWithException(R.ERROR,e instanceof Error?e:new Error(String(e)),"Error showing modal"),t(!1)}})}},{key:"hideModal",value:function(){if(this.currentModalInstance)try{this.currentModalInstance.hide()}catch(t){var e=t instanceof Error?t:new Error(String(t));S.logErrorWithLevelWithException(R.ERROR,e,"Failed to hide the modal")}}},{key:"getCurrentModalInstance",value:function(){return this.currentModalInstance}}])}(),Xc=c(function e(){var t=this;l(this,e),n(this,"handleShopDirectAction",function(){var n=a(s().mark(function n(r,i){var a,o,u,c,l,d,h,f,v,m,E,g,_,y,C,T,I,A,O,b,L,P,N,k;return s().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(o=r.payload){n.next=1;break}return S.addCount(p.RUFUS_SHOP_DIRECT_MISSING_PAYLOAD,1),S.logErrorWithLevel(R.ERROR,"Missing payload in shop direct action"),n.abrupt("return");case 1:if(r.url){n.next=2;break}return S.addCount(p.RUFUS_SHOP_DIRECT_MISSING_URL,1),S.logErrorWithLevel(R.ERROR,"Missing url in shop direct action payload"),n.abrupt("return");case 2:if(o.merchantName||(S.addCount(p.RUFUS_SHOP_DIRECT_MISSING_MERCHANT,1),S.logErrorWithLevel(R.ERROR,"Missing merchant name in shop direct action payload")),u=null===(a=r.payload)||void 0===a?void 0:a.merchantName,c=r.url,l=An.extractAsinFromActionId(o.continueToSiteButtonActionId||"",e.CONTINUE_TO_SITE_PREFIX),d=e.MODAL_NAME+l,h=document.getElementById("zumaDesktopModalTemplate")){n.next=3;break}return S.addCount(p.RUFUS_SHOP_DIRECT_MISSING_TEMPLATE,1),S.logErrorWithLevel(R.ERROR,"Missing template for shop direct modal content"),n.abrupt("return");case 3:return(f=h.getElementsByClassName("rufus-zuma-subtitle")[0])&&(f.innerHTML.includes("{website}")&&(f.innerHTML=f.innerHTML.replace("{website}",'<span class="a-text-bold rufus-zuma-domain-name"></span>')),(v=f.getElementsByClassName("rufus-zuma-domain-name")[0])&&(v.innerHTML=u||c)),(m=h.getElementsByClassName("rufus-zuma-button-link")[0])&&(m.setAttribute("href",c),g=m.parentElement,_={url:c,modalName:d,continueToSiteButtonActionId:null===(E=r.payload)||void 0===E?void 0:E.continueToSiteButtonActionId},g&&g.getAttribute("data-action")&&(g.setAttribute("data-rufus-oam-open-external-link",JSON.stringify(_)),t.setCsaTags(g,"rufus-dsk-oam-modal-cta",null===(y=r.payload)||void 0===y?void 0:y.continueToSiteButtonActionId))),(C=h.getElementsByClassName("rufus-zuma-learn-more-link")[0])&&(T="/b?node=204815148011&amp;ref=sr_z_ibs",C.setAttribute("href",T),I=C.parentElement,A={url:T,actionId:r.actionId},I&&I.getAttribute("data-action")&&I.setAttribute("data-rufus-oam-faq-link",JSON.stringify(A))),(O=h.getElementsByClassName("rufus-zuma-modal")[0])&&t.setCsaTags(O,"rufus-dsk-oam-modal",r.actionId),b=h?h.innerHTML:"",L="You're leaving Amazon",n.prev=4,n.next=5,Kc(document.documentElement.lang);case 5:P=n.sent,L=P.getMessage("oam_modal_header"),n.next=7;break;case 6:n.prev=6,N=n.catch(4),S.addCount(p.RUFUS_SHOP_DIRECT_TRANSLATION_ERROR,1),S.logErrorWithLevelWithException(R.ERROR,N,"Failed to load oam header message, using default string");case 7:return n.prev=7,n.next=8,t.modalFactory.createModal({header:L,width:"375px",closeButton:!0,position:"center",dataStrategy:"inline",popoverLabel:"OAM Modal",name:d,content:b,trigger:i});case 8:if(!n.sent){n.next=10;break}return n.next=9,t.modalFactory.showModal();case 9:n.sent?(Jt("OAM_INTERSTITIAL_OPENED"),S.addCount(p.RUFUS_SHOP_DIRECT_MODAL_OPENED,1),t.logModalClose(d)):(S.addCount(p.RUFUS_SHOP_DIRECT_FAILED_TO_SHOW_MODAL,1),S.logErrorWithLevel(R.ERROR,"Failed to show modal for shop direct action")),n.next=11;break;case 10:S.addCount(p.RUFUS_SHOP_DIRECT_FAILED_TO_CREATE_MODAL,1),S.logErrorWithLevel(R.ERROR,"Failed to create modal for shop direct action");case 11:n.next=13;break;case 12:n.prev=12,k=n.catch(7),S.addCount(p.RUFUS_SHOP_DIRECT_EXCEPTION_WITH_MODAL,1),S.logErrorWithLevelWithException(R.ERROR,k,"Failed to create or show modal for shop direct action");case 13:case"end":return n.stop()}},n,null,[[4,6],[7,12]])}));return function(e,t){return n.apply(this,arguments)}}()),n(this,"logModalClose",function(e){window.P.when("A","a-modal").execute(function(t){t.on("a:popover:afterHide:"+e,function(){Jt("OAM_INTERSTITIAL_CLOSED"),S.addCount(p.RUFUS_SHOP_DIRECT_MODAL_CLOSED,1)})})}),n(this,"setCsaTags",function(e,t,n){e.setAttribute(m.TYPE_ID,"widget"),e.setAttribute(m.CONTENT_ID,t),e.setAttribute(m.SLOT_ID,t+"-"+(null!=n?n:"unknown")),e.setAttribute(m.REQUEST_ID,jt.getInstance().nileRequestId)}),this.modalFactory=new qc});function Zc(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Zc=function(){return!!e})()}n(Xc,"MODAL_NAME","ZumaOamModal"),n(Xc,"CONTINUE_TO_SITE_PREFIX","action_continue_to_site_");var Qc=function(e){function t(e,r,i){var a;return l(this,t),a=function(e,t,n){return t=h(t),d(e,Zc()?Reflect.construct(t,[],h(e).constructor):t.apply(e,n))}(this,t),n(a,"handleAction",function(e){return new Promise(function(t){var n="action"in e,r=n?e.action:e,i=r.actionType;switch(i){case nn.INVOKE_NILE_BACKEND_API.toString():a.handleInvokeNileBackendApi(e),t(!0);break;case nn.ADD_TO_CART.toString():var o,s=null===(o=r.payload)||void 0===o?void 0:o.asin;if(!s||"string"!=typeof s){t(!1);break}var u=yn(a.panelContainer.getPanelViewContext().pageType),c=mn.getAtcEndpointByDomain(window.location.hostname);(function(e,t,n,r){return new Promise(function(i,a){var o,s;e.$.ajax({url:r,type:"POST",headers:{"Content-Type":'application/vnd.com.amazon.api+json; type="cart.add-items.request/v1"',"Accept-Language":"en-US","x-api-csrf-token":(s=document.querySelector('meta[name="aapi-csrf-token"]'),s&&s.getAttribute("content")||""),Accept:'application/vnd.com.amazon.api+json; type="cart.add-items/v1"',"x-amzn-encrypted-slate-token":(o=document.querySelector('meta[name="encrypted-slate-token"]'),o&&o.getAttribute("content")||"")},data:JSON.stringify({items:[{asin:t}]}),xhrFields:{withCredentials:!0},success:function(e){var t,r=null===(t=e.entity)||void 0===t||null===(t=t.count)||void 0===t||null===(t=t.entity)||void 0===t?void 0:t.items;Sn(r,n),Tn.triggerAtcToast(),i(e)},error:function(e,t,n){a(new Error("Add to cart failed: ".concat(t," - ").concat(n)))}})})})(a.A,s,u,"".concat(c,"?ref_=rhwa_atc")).then(function(){S.addCount(p.RUFUS_ATC_AJAX_SUCCESS,1),t(!0)}).catch(function(e){S.addCount(p.RUFUS_ATC_AJAX_FAILURE,1),S.logErrorWithLevelWithException(R.ERROR,e,"AddItems AJAX call failed"),t(!1)});break;case nn.OPEN_URL.toString():Jt(r.actionType,r.actionId);var l=n?e.clickEventName:void 0;S.addCount(p.RUFUS_OPEN_URL_CLICK_PREFIX+l,1),a.handleOpenUrlAction(r),a.containsCSAIParam(r.actionAdditionalProps)&&(a.dispatch("applyAnimationAndStateUpdateWithDefault","minimized"),S.addCount(p.RUFUS_CSAI_OPENED,1)),t(!0);break;case nn.SHOP_DIRECT.toString():Jt(r.actionType,r.actionId),S.addCount(p.RUFUS_SHOP_DIRECT_CLICK,1);var d=n?e.triggerElement:void 0;a.shopDirectActionHandler.handleShopDirectAction(r,d).then(function(){t(!0)}).catch(function(e){S.addCount(p.RUFUS_SHOP_DIRECT_HANDLER_ERROR,1),S.logErrorWithLevelWithException(R.ERROR,e,"Failed to handle shop direct action"),t(!1)});break;case nn.BUY_FOR_ME.toString():Jt(r.actionType,r.actionId),S.addCount(p.RUFUS_BUY_FOR_ME_CLICK,1),a.buyForMeActionHandler.handleBuyForMeAction(r).then(function(){t(!0)}).catch(function(e){S.addCount(p.RUFUS_BUY_FOR_ME_HANDLER_ERROR,1),S.logErrorWithLevelWithException(R.ERROR,e,"Failed to handle buy for me action"),t(!1)});break;case nn.INVOKE_HISTORY_API.toString():var h,f=null==r||null===(h=r.payload)||void 0===h?void 0:h.threadId;null!=f?(a.dispatch("handleInvokeHistoryAPI",f),t(!0)):(S.addCount(p.RUFUS_THREAD_ID_UNDEFINED,1),t(!1));break;case nn.DISMISS.toString():t(!0);break;default:S.logErrorWithLevel(R.ERROR,"New ActionType: ".concat(i)),t(!1)}})}),n(a,"getOpenUrlTarget",function(e){var t,n={targetType:tn.SELF};return null!==(t=null==e?void 0:e.openURLTarget)&&void 0!==t?t:n}),n(a,"isValidPopupTarget",function(e){return e.newWindowHeightPixels>0&&e.newWindowWidthPixels>0&&e.newWindowScreenPosition>-1}),n(a,"handleOpenUrlAction",function(e){var t=a.getOpenUrlTarget(e.payload);switch(t.targetType){case tn.POPUP:var n="width=".concat(t.newWindowWidthPixels,", height=").concat(t.newWindowHeightPixels,", left=").concat(t.newWindowScreenPosition);if(!a.isValidPopupTarget(t)){S.logErrorWithLevel(R.ERROR,"Invalid Popup Target ".concat(n)),window.open(e.url,"_self");break}window.open(e.url,t.targetType.toString(),n);break;case tn.SELF:default:window.open(e.url,"_self")}}),n(a,"handleInvokeNileBackendApi",function(e){var t,n,r,i,o,s,u="action"in e,c=u?e.action:e,l=u?null!==(t=e.query)&&void 0!==t?t:null===(n=c.payload)||void 0===n?void 0:n.query:null===(r=c.payload)||void 0===r?void 0:r.query;null!=l&&(a.streamingClient.startStream({actionType:rn.SEARCH,inputQuery:l,qis:null===(i=c.payload)||void 0===i?void 0:i.qis,reftag:mn.extractNileReftagFromUrl(c.url)}),Jt(c.actionType,c.actionId),S.addCount(p.RUFUS_RQ_CLICK,1),(null===(o=c.payload)||void 0===o?void 0:o.qis)===sn.NILE_DEALS_RELATED_QUESTION&&S.addCount(p.RUFUS_DEALS_RQ_CLICK,1),(null===(s=c.payload)||void 0===s?void 0:s.qis)===sn.NILE_NDSWDCS_RELATED_QUESTION&&S.addCount(p.RUFUS_WDCS_RQ_CLICK,1))}),n(a,"containsCSAIParam",function(e){return"true"==(null==e?void 0:e.isCSAI)||"true"==(null==e?void 0:e.get("isCSAI"))}),a.A=e,a.streamingClient=r,a.panelContainer=i,a.shopDirectActionHandler=new Xc,a.buyForMeActionHandler=new On,a}return v(t,e),c(t)}(In),Jc=function(){return c(function e(t){var r=this;l(this,e),n(this,"cleanupScheduled",!1),n(this,"handleOnPanelAnimationStart",function(){var e=r.panelContainer.getPanelViewContext(),t=yn(null==e?void 0:e.pageType);t!==gn.DETAIL_PAGE&&t!==gn.GATEWAY||(r.interval&&window.clearInterval(r.interval),r.interval=window.setInterval(function(){r.panelContainer.getA().trigger("resize",window,{width:1,height:1})},10))}),n(this,"handleOnPanelAnimationEnd",function(){r.panelContainer.triggerLayoutRecalculation(),r.interval&&!r.cleanupScheduled&&(r.cleanupScheduled=!0,window.setTimeout(function(){r.cleanup(),r.cleanupScheduled=!1},500))}),this.panelContainer=t,this.panelContainer.on("onPanelAnimationStart",this.handleOnPanelAnimationStart),this.panelContainer.on("onPanelAnimationEnd",this.handleOnPanelAnimationEnd)},[{key:"cleanup",value:function(){this.interval&&(window.clearInterval(this.interval),this.interval=void 0)}}])}();function $c(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return($c=function(){return!!e})()}var el=function(e){return e.AUTHENTICATED="authenticated",e.UNAUTHENTICATED="unauthenticated",e.UNKNOWN="unknown",e}({}),tl=function(e){function t(){var e;return l(this,t),e=function(e,t,n){return t=h(t),d(e,$c()?Reflect.construct(t,[],h(e).constructor):t.apply(e,n))}(this,t),n(e,"lastAuthStatus",el.UNKNOWN),n(e,"handleStorageEvent",function(t){"csa-tabbed-browsing"==t.key&&e.checkAuthStatus()}),n(e,"handleVisibilityChange",function(){e.checkAuthStatus()}),e.attachEventListeners(),e}return v(t,e),c(t,[{key:"checkAuthStatus",value:function(){var e=this.isValidAuthSession()?el.AUTHENTICATED:el.UNAUTHENTICATED;if(e!==this.lastAuthStatus){if(this.dispatch("authStatusChanged",e),e!==el.AUTHENTICATED)return S.addCount(p.RUFUS_SIGN_OUT,1),el.UNAUTHENTICATED;this.lastAuthStatus=e}return e}},{key:"isValidAuthSession",value:function(){var e,t,n,r=wt("authCookieName");return!(""===(e=null!=r&&r.trim()?r:"x-main",t=e.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),n=document.cookie.match("(^|;)\\s*"+t+"\\s*=\\s*([^;]+)"),n?n.pop():"")&&!mn.isDevoDomain())}},{key:"attachEventListeners",value:function(){window.addEventListener("storage",this.handleStorageEvent),document.addEventListener("visibilitychange",this.handleVisibilityChange)}}],[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}])}(In),nl="THREAD_STATE_IN_HISTORY_THREAD",rl="THREAD_STATE_UNKNOWN";const il=e=>{let t;const n=new Set,r=(e,r)=>{const i="function"==typeof e?e(t):e;if(!Object.is(i,t)){const e=t;t=(null!=r?r:"object"!=typeof i||null===i)?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,a={setState:r,getState:i,getInitialState:()=>o,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{"production"!=={NODE_ENV:"production"}.MODE&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},o=t=e(r,i,a);return a};var al=r(8090);const{useDebugValue:ol}=Cn,{useSyncExternalStoreWithSelector:sl}=al;let ul=!1;const cl=e=>e,ll=e=>{"production"!=={NODE_ENV:"production"}.MODE&&"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t="function"==typeof e?(e=>e?il(e):il)(e):e,n=(e,n)=>function(e,t=cl,n){"production"!=={NODE_ENV:"production"}.MODE&&n&&!ul&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),ul=!0);const r=sl(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return ol(r),r}(t,e,n);return Object.assign(n,t),n};var dl=function(){function e(){l(this,e),this.weblabTreatmentsMap=this.getWeblabTreatmentsMap()}return c(e,[{key:"parseWeblabTreatmentsMap",value:function(e){var t=this,n={};if(!e)return n;try{e.slice(1,-1).split(",").forEach(function(e){var r=xt(e.trim().split("="),2),i=r[0],a=r[1];n[i.trim()]=t.isTreatmentNull(a.trim())?void 0:a.trim()}),S.addCount(p.RUFUS_CLIENT_WEBLAB_TREATMENTS_PARSED,1)}catch(t){S.logErrorWithLevelWithException(R.ERROR,t,"Could not parse the weblab treatments, weblabTreatments: ".concat(e))}return n}},{key:"isTreatmentNull",value:function(e){return"null"===e||"undefined"===e}},{key:"getWeblabTreatmentsMap",value:function(){var e=wt("clientWeblabTreatmentMap");return this.parseWeblabTreatmentsMap(e)}},{key:"getWeblabTreatment",value:function(e){var t;return null===(t=this.weblabTreatmentsMap)||void 0===t?void 0:t[e]}},{key:"getWeblabTreatments",value:function(e){var t=this;return e.map(function(e){var n;return null===(n=t.weblabTreatmentsMap)||void 0===n?void 0:n[e]})}},{key:"isWeblabTreatmentEnabledAndRecordTrigger",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"T1",n=this.getWeblabTreatment(e);return n&&S.recordTrigger(e,n),n===t}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}(),hl=function(e){var t;return window.P&&P.now(e).execute(function(e){t=e}),t};function fl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function vl(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fl(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fl(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function pl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ml(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pl(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pl(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function El(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function gl(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?El(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):El(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var _l=null,yl=function(){return _l||(_l=(e?ll(e):ll)(function(e,t){return gl(gl(gl({},function(e){return{chatHistoryTurns:[],hasMoreThreads:!0,isLoadingMoreThreads:!1,chatHistoryErrorMessage:null,prependChatHistoryTurn:function(t){return e(function(e){return{chatHistoryTurns:[t].concat(O(e.chatHistoryTurns))}})},prependChatHistoryTurns:function(t){return e(function(e){return{chatHistoryTurns:[].concat(O(t),O(e.chatHistoryTurns))}})},addChatHistoryTurn:function(t){return e(function(e){return{chatHistoryTurns:[].concat(O(e.chatHistoryTurns),[t])}})},addChatHistoryTurns:function(t){return e(function(e){return{chatHistoryTurns:[].concat(O(e.chatHistoryTurns),O(t))}})},clearChatHistoryConversation:function(){return e({chatHistoryTurns:[],hasMoreThreads:!0,isLoadingMoreThreads:!1,chatHistoryErrorMessage:null})},setChatHistoryTurns:function(t){return e({chatHistoryTurns:t})},setHasMoreThreads:function(t){return e({hasMoreThreads:t})},setIsLoadingMoreThreads:function(t){return e({isLoadingMoreThreads:t})},setChatHistoryErrorMessage:function(t){return e({chatHistoryErrorMessage:t})}}}(e)),hl(kt)?function(e,t){return{interactions:[],turns:void 0,hasMoreTurns:!0,isLoadingMoreTurns:!1,conversationErrorMessage:null,getAllTurns:function(){return t().interactions.flatMap(function(e){return e.turns})},getInteractions:function(){return O(t().interactions)},getLastInteraction:function(){var e=t().interactions;return e.length>0?ml({},e[e.length-1]):void 0},getInteractionByIndex:function(e){var n=t().interactions;if(!(e<0||e>=n.length))return ml({},n[e])},findInterruptedConversationGroupId:function(e){for(var n=t().interactions.flatMap(function(e){return e.turns}),r=n.length-1;r>=0;r--){var i=n[r];if(i.groupId&&!i.groupId.startsWith(e))return i.groupId}},prependTurn:function(t){e(function(e){var n=O(e.interactions);if(0===n.length)n.push({turns:[t]});else{var r=n[n.length-1].turns;n[n.length-1]={turns:[t].concat(O(r))}}return{interactions:n}})},prependHistoryTurns:function(t){e(function(e){return{interactions:[{turns:O(t)}].concat(O(e.interactions))}})},addTurn:function(t){e(function(e){var n=O(e.interactions);if(0===n.length)n.push({turns:[t]});else{var r=n[n.length-1].turns,i=1===r.length&&r[0].type===b.HTML_LOADER;n[n.length-1]=i?{turns:[t]}:{turns:[].concat(O(r),[t])}}return{interactions:n}})},addTurns:function(t){e(function(e){var n=O(e.interactions);if(0===n.length)n.push({turns:O(t)});else{var r=n[n.length-1].turns,i=1===r.length&&r[0].type===b.HTML_LOADER;n[n.length-1]=i?{turns:O(t)}:{turns:[].concat(O(r),O(t))}}return{interactions:n}})},setTurns:function(t){e(function(e){var n=O(e.interactions);return 0===n.length?n.push({turns:t}):n[n.length-1]={turns:t},{interactions:n}})},removeTurnsByGroupId:function(t){e(function(e){var n=O(e.interactions);return 0===n.length?e:{interactions:n.map(function(e){return{turns:e.turns.filter(function(e){return e.groupId!==t})}})}})},replaceTurnsByGroupId:function(t,n){e(function(e){var r=O(e.interactions);if(0===r.length)return r.push({turns:O(n)}),{interactions:r};var i=r[r.length-1].turns,a=i.findIndex(function(e){return e.groupId===t});if(-1===a)r[r.length-1]={turns:[].concat(O(i),O(n))};else{var o=i.filter(function(e,n){return e.groupId!==t||n===a});o.splice.apply(o,[a,1].concat(O(n))),r[r.length-1]={turns:o}}return{interactions:r}})},updateTurnContent:function(t,n){e(function(e){var r=O(e.interactions);if(0===r.length)return e;var i=r[r.length-1].turns,a=i.map(function(e){return e.groupId===t?ml(ml({},e),{},{content:n}):e});return a.some(function(e,t){return e!==i[t]})?(r[r.length-1]={turns:a},{interactions:r}):e})},replaceTurnByGroupId:function(t,n){e(function(e){var r=O(e.interactions);if(0===r.length)return e;var i=r[r.length-1].turns.map(function(e){return e.groupId===t?n:e});return r[r.length-1]={turns:i},{interactions:r}})},clearConversation:function(){e(function(){return{interactions:[],hasMoreTurns:!0,isLoadingMoreTurns:!1,conversationErrorMessage:null}})},startNewInteraction:function(){e(function(e){var t=function(e){var t=document.getElementById(N);if(!t)return null;t.classList.contains("aok-hidden")||t.classList.add("aok-hidden");var n=t.cloneNode(!0);n.classList.remove("aok-hidden");var r=n.querySelector("#".concat(k));return r&&(r.id="".concat(k,"-").concat(e)),{id:"loader-".concat(Date.now()),type:b.HTML_LOADER,content:n.outerHTML,groupId:"loader-turn",isCached:!1}}(e.interactions.length);return t?{interactions:[].concat(O(e.interactions),[{turns:[t]}])}:{interactions:[].concat(O(e.interactions),[{turns:[]}])}})},setInteractions:function(t){e(function(){return{interactions:O(t)}})},setHasMoreTurns:function(t){return e({hasMoreTurns:t})},setIsLoadingMoreTurns:function(t){return e({isLoadingMoreTurns:t})},resetTurnPagination:function(){return e({hasMoreTurns:!0,isLoadingMoreTurns:!1})},setConversationErrorMessage:function(t){return e({conversationErrorMessage:t})}}}(e,t):function(e,t){return{turns:[],hasMoreTurns:!0,isLoadingMoreTurns:!1,conversationErrorMessage:null,getAllTurns:function(){return t().turns},prependTurn:function(t){return e(function(e){return{turns:[t].concat(O(e.getAllTurns()))}})},prependHistoryTurns:function(t){return e(function(e){return{turns:[].concat(O(t),O(e.getAllTurns()))}})},addTurn:function(t){return e(function(e){return{turns:[].concat(O(e.getAllTurns()),[vl(vl({},t),{},{timestamp:Date.now()})])}})},addTurns:function(t){return e(function(e){return{turns:[].concat(O(e.getAllTurns()),O(t.map(function(e){return vl(vl({},e),{},{timestamp:Date.now()})})))}})},clearConversation:function(){return e({turns:[],hasMoreTurns:!0,isLoadingMoreTurns:!1,conversationErrorMessage:null})},setTurns:function(t){return e({turns:t})},removeTurnsByGroupId:function(t){return e(function(e){return{turns:e.getAllTurns().filter(function(e){return e.groupId!==t})}})},replaceTurnsByGroupId:function(t,n){return e(function(e){var r=e.getAllTurns().findIndex(function(e){return e.groupId===t});if(-1===r)return{turns:[].concat(O(e.getAllTurns()),O(n))};var i=e.getAllTurns().filter(function(e,n){return e.groupId!==t||n===r});return i.splice.apply(i,[r,1].concat(O(n))),{turns:i}})},findInterruptedConversationGroupId:function(e){for(var n=t().turns,r=n.length-1;r>=0;r--){var i=n[r];if(i.groupId&&!i.groupId.startsWith(e))return i.groupId}},updateTurnContent:function(t,n){return e(function(e){var r=!1,i=e.getAllTurns().map(function(e){return e.groupId===t?(r=!0,vl(vl({},e),{},{content:n})):e});return r?{turns:i}:e})},replaceTurnByGroupId:function(t,n){return e(function(e){return{turns:e.getAllTurns().map(function(e){return e.groupId===t?n:e})}})},setHasMoreTurns:function(t){return e({hasMoreTurns:t})},setIsLoadingMoreTurns:function(t){return e({isLoadingMoreTurns:t})},resetTurnPagination:function(){return e({hasMoreTurns:!0,isLoadingMoreTurns:!1})},setConversationErrorMessage:function(t){return e({conversationErrorMessage:t})}}}(e,t)),function(e,t){return{threadId:null,threadState:rl,getThreadId:function(){return t().threadId},getThreadState:function(){return t().threadState},getThreadContext:function(){var e=t();return{threadId:e.threadId,threadState:e.threadState}},setThreadId:function(t){e({threadId:t})},setThreadState:function(t){e({threadState:t})},setThreadContext:function(t,n){e({threadId:t,threadState:n})},resetThreadContext:function(){e({threadId:null,threadState:rl})}}}(e,t))})),_l;var e},Cl="rufus",Rl={tabId:{key:"".concat(Cl,":tabId")},panel:{key:"".concat(Cl,":panel"),json:!0},"panel:dockedState":{key:"".concat(Cl,":panel:dockedState"),json:!1},impressionsContextMap:{key:"".concat(Cl,":impression-context-map"),json:!0},previousPageUrl:{key:"".concat(Cl,":previous-page-url")},flowCards:{key:"".concat(Cl,":flow-cards"),json:!0},reactState:{key:"".concat(Cl,":reactState"),json:!0},reactStyles:{key:"".concat(Cl,":reactStyles"),json:!1},historyThreadContextCache:{key:"".concat(Cl,":historyThreadContextCache"),json:!0}},Tl="panel",Sl="panel:dockedState",Il="tabId",Al="impressionsContextMap",Ol="previousPageUrl",bl="flowCards",Ll="reactState",Pl="historyThreadContextCache";function Nl(e){return e in ft}function kl(e){if(!e.type||!Nl(e.type))return!0;if(!e.content)return!1;if("string"==typeof e.content){var t,n=document.createElement("div");n.innerHTML=e.content;var r=null===(t=n.textContent)||void 0===t?void 0:t.trim();return void 0!==r&&r.length>0}return!0}function Ul(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Dl(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ul(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ul(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var Ml="RufusCacheManager",wl=function(){return c(function e(t,r){var i=this;l(this,e),n(this,"markCustomerSeenFTUX",function(){i.impressionsContextMap[i.uniqueId]||(i.impressionsContextMap[i.uniqueId]=!0,i.write(Al,i.impressionsContextMap,localStorage))}),n(this,"markCustomerSeenMovablePanelTooltip",function(){var e="".concat(i.uniqueId,"_").concat(an.MOVABLE_PANEL_TOOLTIP_SEEN_STATUS);i.impressionsContextMap[e]||(i.impressionsContextMap[e]=!0,i.write(Al,i.impressionsContextMap,localStorage))}),n(this,"toggleAutoMinimize",function(e){i.panel&&(i.panel.state.autoMinimize=e,i.setPanel(i.panel,Tl))}),n(this,"setPreviousPageUrl",function(){i.previousPageUrl=mn.getCurrentPageUrl(),i.write(Ol,i.previousPageUrl)}),n(this,"isStreamingRequestInProgress",function(){var e;return!1===(null===(e=i.getPanelState())||void 0===e||null===(e=e.requestContext)||void 0===e?void 0:e.requestCompleted)}),n(this,"updateLastCacheInvalidatedTimestamp",function(){i.panel&&(i.panel.metadata.lastCacheInvalidatedTimestamp=Date.now(),i.setPanel(i.panel,Tl))}),n(this,"setRequestMetadata",function(e){i.panel&&(i.panel.state.requestMetadata=e,i.setPanel(i.panel,Tl))}),n(this,"getRequestMetadata",function(){var e;return null===(e=i.panel)||void 0===e?void 0:e.state.requestMetadata}),this.uniqueId=t,this.isCacheEnabled=r,this.tabId=this.readTabId(),this.defaultPanel=this.buildDefaultPanel(),this.impressionsContextMap=this.readImpressionsContextMap(),this.previousPageUrl=this.readPreviousPageUrl(),this.historyThreadContextCache=this.readHistoryThreadContextCache()},[{key:"initialize",value:function(){this.panel=this.readPanel(Tl),this.reactStatePanel=this.readPanel(Ll),this.setPreviousPageUrl()}},{key:"getTabId",value:function(){return this.tabId||S.logErrorWithLevel(R.ERROR,"".concat(Ml," - Error retrieving tabId")),this.tabId}},{key:"getPanel",value:function(){return this.panel||S.logErrorWithLevel(R.ERROR,"".concat(Ml," - Error retrieving panel")),this.panel}},{key:"getReactStatePanel",value:function(){return this.reactStatePanel||S.logErrorWithLevel(R.ERROR,"".concat(Ml," - Error retrieving react state panel")),this.reactStatePanel}},{key:"setPanel",value:function(e,t){return this.panel=e,this.panel.metadata.creationTimestamp=Date.now(),this.panel.metadata.flowClosureId=hn(),this.write(t,this.panel),this.panel}},{key:"setPanelContent",value:(d=a(s().mark(function e(t){return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.panel&&this.isCacheEnabled){e.next=1;break}return e.abrupt("return");case 1:this.panel.content=this.flowCardProxy(t).innerHTML,this.setPanel(this.panel,Tl);case 2:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"setReactStatePanelInteractionContent",value:(u=a(s().mark(function e(t){var n;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.reactStatePanel&&this.isCacheEnabled){e.next=1;break}return e.abrupt("return");case 1:n=t.map(function(e){return e.turns.map(function(e){return e.isCached=!0,e}),e}).filter(function(e){return!(!e.turns||0===e.turns.length)&&e.turns.some(kl)}).slice(-5),this.reactStatePanel.content=JSON.stringify(n),this.reactStatePanel.metadata.creationTimestamp=Date.now(),this.write(Ll,this.reactStatePanel);case 2:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"setReactStatePanelContent",value:(o=a(s().mark(function e(t){var n;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.reactStatePanel&&this.isCacheEnabled){e.next=1;break}return e.abrupt("return");case 1:(n=this.limitTurnGroups(t,5)).forEach(function(e){return e.isCached=!0}),this.reactStatePanel.content=JSON.stringify(n),this.reactStatePanel.metadata.creationTimestamp=Date.now(),this.write(Ll,this.reactStatePanel);case 2:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"getReactStatePanelContent",value:function(){try{var e,t=null===(e=this.reactStatePanel)||void 0===e?void 0:e.content;return t?JSON.parse(t):[]}catch(e){return S.logErrorWithLevel(R.ERROR,"".concat(Ml," - Error parsing react state content")),[]}}},{key:"restoreReactStateFromCache",value:function(){S.widgetBodyBegin(g.RUFUS_PAPYRUS_CACHE_LOAD_LATENCY);var e=this.getReactStatePanelContent(),t=yl().getState();if(e.length>0)if(e[0]&&"turns"in e[0])if("setInteractions"in t)t.setInteractions(e);else{var n=e.flatMap(function(e){return e.turns});t.setTurns(n)}else t.setTurns(e);else yl().getState().clearConversation();return S.widgetBodyEnd(g.RUFUS_PAPYRUS_CACHE_LOAD_LATENCY),e}},{key:"setPanelState",value:(i=a(s().mark(function e(t){return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.panel){e.next=1;break}return e.abrupt("return");case 1:this.panel.state=Dl({},t),this.setPanel(this.panel,Tl);case 2:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"getPanelState",value:function(){var e;return null===(e=this.panel)||void 0===e?void 0:e.state}},{key:"setPanelRequestCompleted",value:(r=a(s().mark(function e(t){var n;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.panel){e.next=1;break}return e.abrupt("return");case 1:!this.panel.state||!this.panel.state.requestContext||null!==(n=this.panel.state.requestContext)&&void 0!==n&&n.requestCompleted||(this.panel.state.requestContext.requestCompleted=t),this.setPanel(this.panel,Tl);case 2:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"setPanelRequestContext",value:(t=a(s().mark(function e(t){return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.panel){e.next=1;break}return e.abrupt("return");case 1:this.panel.state.requestContext=t,this.setPanel(this.panel,Tl);case 2:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"hasCustomerSeenFTUX",value:function(){var e;return null!==(e=this.impressionsContextMap[this.uniqueId])&&void 0!==e&&e}},{key:"hasCustomerSeenMovablePanelTooltip",value:function(){var e,t="".concat(this.uniqueId,"_").concat(an.MOVABLE_PANEL_TOOLTIP_SEEN_STATUS);return null!==(e=this.impressionsContextMap[t])&&void 0!==e&&e}},{key:"shouldInvalidatePanelCache",value:function(){return(this.isFlowCardPresentInPanelAndFlowClosureIdMismatch()||!this.isPanelCacheLastInvalidatedTimestampWithinTTL(this.getPanel()))&&!this.isStreamingRequestInProgress()}},{key:"getHistoricalThreadId",value:function(){var e,t,n,r;if((null===(e=this.historyThreadContextCache)||void 0===e||null===(e=e.historyThreadContext)||void 0===e?void 0:e.threadState)===nl&&null!=(null===(t=this.historyThreadContextCache)||void 0===t||null===(t=t.historyThreadContext)||void 0===t?void 0:t.threadId))return null!==(n=null===(r=this.historyThreadContextCache)||void 0===r||null===(r=r.historyThreadContext)||void 0===r?void 0:r.threadId)&&void 0!==n?n:void 0}},{key:"getHistoryThreadContextCache",value:function(){return this.historyThreadContextCache}},{key:"setHistoryThreadContextCache",value:function(){var e=this.getHistoryThreadContextCache();if(null!=e){var t=yl().getState().getThreadContext(),n=t.threadId,r=t.threadState;e.historyThreadContext.threadId=n||void 0,e.historyThreadContext.threadState=r,e.metadata.creationTimestamp=Date.now(),this.write(Pl,e)}}},{key:"restoreThreadContext",value:function(){var e,t=this.getHistoryThreadContextCache();null!=t&&t.historyThreadContext.threadId&&yl().getState().setThreadContext(t.historyThreadContext.threadId,null!==(e=t.historyThreadContext.threadState)&&void 0!==e?e:rl)}},{key:"getPreviousPageUrl",value:function(){return this.previousPageUrl}},{key:"setFlowCards",value:function(e,t){if(e&&t){var r=this.read(bl);this.write(bl,Dl(Dl({},r),{},{sections:Dl(Dl({},null==r?void 0:r.sections),{},n({},e,t.innerHTML))}))}}},{key:"getFlowCard",value:function(e){var t;if(e){var n=this.read(bl);return null==n||null===(t=n.sections)||void 0===t?void 0:t[e]}}},{key:"limitTurnGroups",value:function(e,t){var n=[];if(e.forEach(function(e,t){e.type===b.HTML_CONTENT_TURN_START&&n.push(t)}),n.length<=t)return e;var r=n[n.length-t];return e.slice(r)}},{key:"read",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sessionStorage,n=null,r=Rl[e],i=r.key,a=r.json;try{var o=t.getItem(i);o&&(n=a?JSON.parse(o):o)}catch(e){S.logErrorWithLevelWithException(R.ERROR,e,"".concat(Ml," - Error reading from ").concat(i," ").concat(e instanceof Error?"(".concat(e.message,")"):"")),n=null}return n}},{key:"write",value:function(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:sessionStorage,a=Rl[t],o=a.key,s=a.json;if("object"===e(n)&&!s)return S.logErrorWithLevel(R.ERROR,"".concat(Ml," - Trying to serialize a non-json object ").concat(o)),!1;var u=null===(r=this.getPanelState())||void 0===r?void 0:r.viewState;if(u&&"panel"==t){this.write(Sl,u);var c="expanded"===u?"closed":u;this.write(Sl,c,localStorage)}try{return i.setItem(o,"object"===e(n)?JSON.stringify(n):n),!0}catch(e){return S.logErrorWithLevelWithException(R.ERROR,e,"".concat(Ml," - Error writing from ").concat(o," ").concat(e instanceof Error?"(".concat(e.message,")"):"")),!1}}},{key:"readTabId",value:function(){var e=this.read(Il);return e||(e=Ft(),this.write(Il,e),S.addCount(p.RUFUS_TAB_ID_GENERATED,1)),e}},{key:"readPanel",value:function(e){var t=this.read(e);return this.validatePanel(t)||(t=this.clonePanel(this.defaultPanel),this.write(e,t)),this.isCacheEnabled||(t.content=""),this.validatePanelContent(t)||(t.content="",t.metadata.creationTimestamp=Date.now()),t}},{key:"readImpressionsContextMap",value:function(){var e=this.read(Al,localStorage);return null!=e?e:n({},this.uniqueId,!1)}},{key:"readPreviousPageUrl",value:function(){var e=this.read(Ol);return e||(e=mn.getCurrentPageUrl(),this.write(Ol,e)),e}},{key:"buildDefaultPanel",value:function(){return{content:"",metadata:{creationTimestamp:Date.now(),uniqueId:this.uniqueId,lastCacheInvalidatedTimestamp:Date.now(),flowClosureId:hn()},state:{height:300,width:320,left:0,bottom:0,viewState:"closed"}}}},{key:"validatePanel",value:function(e){return!(!e||!e.metadata||e.metadata.uniqueId!==this.uniqueId)}},{key:"validatePanelContent",value:function(e){return e.content.length<2e6}},{key:"clonePanel",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"isPanelCacheLastInvalidatedTimestampWithinTTL",value:function(e){return void 0===e||Math.abs(e.metadata.lastCacheInvalidatedTimestamp-Date.now())<864e5}},{key:"isFlowCardPresentInPanelAndFlowClosureIdMismatch",value:function(){var e,t=hn();return this.read(bl)&&void 0!==t&&t!==(null===(e=this.panel)||void 0===e?void 0:e.metadata.flowClosureId)}},{key:"flowCardProxy",value:function(e){var t=e.cloneNode(!0),n=t.querySelectorAll('[data-section-class="'.concat(dt,'"]')),r=this.read(bl);return n.forEach(function(e){var t,n;e.innerHTML=null!==(t=null==r||null===(n=r.sections)||void 0===n?void 0:n[e.id])&&void 0!==t?t:e.innerHTML}),t}},{key:"readHistoryThreadContextCache",value:function(){var e=this.read(Pl);return e&&this.isHistoryThreadContextCacheValid(e)||(e={historyThreadContext:{threadId:void 0,threadState:rl},metadata:{creationTimestamp:Date.now()}},this.write(Pl,e)),e}},{key:"isHistoryThreadContextCacheValid",value:function(e){return Math.abs(Date.now()-e.metadata.creationTimestamp)<6e5}},{key:"cacheRNWStyles",value:function(){var e=document.getElementById("react-native-stylesheet");if(null!=e&&e.sheet)try{var t=Array.from(e.sheet.cssRules).map(function(e){return e.cssText.replace(/\s+/g," ").trim()}).join("");this.write("reactStyles",t)}catch(e){S.logErrorWithLevel(R.ERROR,"Failed to cache RNW styles: "+e)}}}]);var t,r,i,o,u,d}(),Fl=c(function e(){l(this,e)});function xl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Hl(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xl(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xl(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}n(Fl,"CONTENT_TYPE","Content-Type"),n(Fl,"ANTI_CSRF_TOKEN","anti-csrftoken-a2z"),n(Fl,"FLOW_CLOSURE_ID","x-amzn-flow-closure-id"),n(Fl,"IS_PAPYRUS","x-amz-is-papyrus");var Bl=function(){return c(function e(t,n){l(this,e),this.A=t,this.tabId=n},[{key:"post",value:function(e,t){return this.A.post(e,Hl(Hl({},t),{},{headers:this.buildPostHeaders()}))}},{key:"get",value:function(e,t){return this.A.get(e,Hl({},t))}},{key:"abortCurrentRequest",value:function(){this.currentRequest&&(this.currentRequest.abort(),this.currentRequest=void 0)}},{key:"isLoading",value:function(){return!!this.currentRequest}},{key:"buildPostHeaders",value:function(){return n({},Fl.ANTI_CSRF_TOKEN,dn())}}])}(),Wl=function(e){return e.THREAD="THREAD",e.TURN="TURN",e.DEFAULT="DEFAULT",e}({}),Vl="TEST_1056934",Gl="RUFUS_DESKTOP_LINK_REPLACEMENT_1164286",zl="RUFUS_NAVONLY_INGRESS_1200814",jl="RUFUS_COMMON_ASSETS_MIGRATION_CL_1189218",Yl="RUFUS_ORTELIUS_COMPLETE_DIALUP_1259431",Kl="RUFUS_DESKTOP_RQ_PILL_RESIZE_EXPERIMENT_1146390",ql="RUFUS_DESKTOP_SELECTED_TEXT_CONTEXT_1360217",Xl="rufus-selected-text-pill",Zl="rufus-selected-text-pill-show",Ql="rufus-selected-text-pill-hide",Jl="aok-hidden",$l=function(){function e(){var t=this;l(this,e),n(this,"pillElement",null),n(this,"containerElement",null),n(this,"selectedTextContextManager",null),n(this,"isInitialized",!1),n(this,"handleContextUpdate",function(e){e.newContext?t.showPill(e.newContext):t.hidePill()}),n(this,"handleDismissClick",function(e){e.preventDefault(),e.stopPropagation(),t.selectedTextContextManager&&t.selectedTextContextManager.clearSelectedTextContext()}),this.selectedTextContextManager=sd.getInstance()}return c(e,[{key:"initialize",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".rufus-textarea-wrapper";if(!this.isInitialized&&(this.containerElement=document.querySelector(t),this.containerElement||(this.containerElement=document.querySelector(".rufus-text-area-container")),this.containerElement&&(this.createPillElement(),this.attachContextListener(),this.isInitialized=!0,null!==(e=this.selectedTextContextManager)&&void 0!==e&&e.hasSelectedTextContext()))){var n=this.selectedTextContextManager.getSelectedTextContext();n&&this.showPill(n)}}},{key:"cleanup",value:function(){this.removePillElement(),this.isInitialized=!1}},{key:"createPillElement",value:function(){var e;this.removePillElement();var t=document.createElement("div");t.id=Xl,t.className="".concat("rufus-selected-text-pill"," ").concat(Jl),t.setAttribute("role","status"),t.setAttribute("aria-live","polite");var n=document.createElement("div");n.className="rufus-selected-text-pill-content";var r=document.createElement("span");r.className="rufus-selected-text-pill-icon",r.innerHTML="↳",r.setAttribute("aria-hidden","true");var i=document.createElement("span");i.className="rufus-selected-text-pill-text single-line-truncate";var a,o=document.createElement("button");o.className="rufus-selected-text-pill-dismiss",o.setAttribute("type","button"),o.setAttribute("aria-label","Remove selected text context"),o.innerHTML="×",o.addEventListener("click",this.handleDismissClick),n.appendChild(r),n.appendChild(i),t.appendChild(n),t.appendChild(o),null!==(e=this.containerElement)&&void 0!==e&&e.firstChild?this.containerElement.insertBefore(t,this.containerElement.firstChild):null===(a=this.containerElement)||void 0===a||a.appendChild(t),this.pillElement=t}},{key:"removePillElement",value:function(){if(this.pillElement){var e=this.pillElement.querySelector(".rufus-selected-text-pill-dismiss");e&&e.removeEventListener("click",this.handleDismissClick),this.pillElement.remove(),this.pillElement=null}var t=document.getElementById(Xl);t&&t.remove()}},{key:"attachContextListener",value:function(){this.selectedTextContextManager&&this.selectedTextContextManager.on("contextUpdated",this.handleContextUpdate)}},{key:"showPill",value:function(e){var t;if(this.pillElement){var n=this.pillElement.querySelector(".rufus-selected-text-pill-text");n&&(n.textContent=e.displayText,n.setAttribute("title",e.selectedText)),this.pillElement.setAttribute("aria-label","Selected text context: ".concat(e.displayText)),null===(t=this.containerElement)||void 0===t||t.classList.add("has-selected-text-context"),this.pillElement.classList.remove(Jl,Ql),this.pillElement.classList.add(Zl)}}},{key:"hidePill",value:function(){var e=this;this.pillElement&&(this.pillElement.classList.remove(Zl),this.pillElement.classList.add(Ql),this.pillElement.addEventListener("animationend",function(){var t;e.pillElement&&(e.pillElement.classList.add(Jl),e.pillElement.classList.remove(Ql)),null===(t=e.containerElement)||void 0===t||t.classList.remove("has-selected-text-context")},{once:!0}))}},{key:"refreshOnBfCacheNavigation",value:function(){this.isInitialized=!1,this.pillElement=null,this.initialize()}}],[{key:"getInstance",value:function(){return e.isFeatureEnabled()?(e.instance||(e.instance=new e),e.instance):null}},{key:"isFeatureEnabled",value:function(){return"T1"===dl.getInstance().getWeblabTreatment(ql)}},{key:"resetInstance",value:function(){e.instance&&e.instance.cleanup(),e.instance=null}}])}();function ed(e,t){var n=td(e),r=td(t);return'<div class="rufus-selected-text-context-pill" title="'.concat(r,'">\n        <span class="rufus-selected-text-context-icon" aria-hidden="true">↳</span>\n        <span class="rufus-selected-text-context-text single-line-truncate">').concat(n,"</span>\n    </div>")}function td(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function nd(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(nd=function(){return!!e})()}n($l,"instance",null);var rd="[SELECTED_TEXT_CONTEXT_START]",id="[SELECTED_TEXT_CONTEXT_END]",ad="[USER_QUERY_START]",od="[USER_QUERY_END]",sd=function(e){function t(){var e;return l(this,t),e=function(e,t,n){return t=h(t),d(e,nd()?Reflect.construct(t,[],h(e).constructor):t.apply(e,n))}(this,t),n(e,"selectedTextContext",null),e}return v(t,e),c(t,[{key:"getSelectedTextContext",value:function(){return this.selectedTextContext}},{key:"setSelectedTextContext",value:function(e){var t=this.selectedTextContext;if(null===e||""===e.trim())this.selectedTextContext=null;else{var n=e.trim();this.selectedTextContext={selectedText:n,displayText:this.truncateText(n,50),timestamp:Date.now()}}this.dispatch("contextUpdated",{previousContext:t,newContext:this.selectedTextContext})}},{key:"clearSelectedTextContext",value:function(){this.setSelectedTextContext(null)}},{key:"hasSelectedTextContext",value:function(){return null!==this.selectedTextContext}},{key:"createCustomPrompt",value:function(e){if(!this.selectedTextContext)return e;S.addCount(p.QUERY_SENT_WITH_SELECTED_TEXT_CONTEXT,1),Jt(_.QUERY_SENT_WITH_SELECTED_TEXT_CONTEXT);var t=rd,n=id,r=ad,i=od,a=405-e.length,o=this.selectedTextContext.selectedText;return a<=0?e:(o.length>a&&(o=a>3?o.substring(0,a-3)+"...":o.substring(0,a)),"".concat(t,"\n").concat(o,"\n").concat(n,"\n").concat(r,"\n").concat(e,"\n").concat(i))}},{key:"truncateText",value:function(e,t){return e.length<=t?e:e.substring(0,t-3)+"..."}}],[{key:"getInstance",value:function(){return t.isFeatureEnabled()?(t.instance||(t.instance=new t),t.instance):null}},{key:"isFeatureEnabled",value:function(){return"T1"===dl.getInstance().getWeblabTreatment(ql)}},{key:"parsePromptWithContext",value:function(e){var t=rd,n=id,r=ad,i=od;if(!e.includes(t)||!e.includes(n))return null;try{var a=e.indexOf(t)+29,o=e.indexOf(n),s=e.substring(a,o).trim(),u="";if(e.includes(r)&&e.includes(i)){var c=e.indexOf(r)+18,l=e.indexOf(i);u=e.substring(c,l).trim()}else u=e.substring(o+27).trim();return{selectedText:s,userQuery:u}}catch(e){return null}}},{key:"createDisplayText",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return t.prototype.truncateText(e,n)}},{key:"resetInstance",value:function(){t.instance=null}},{key:"transformCustomerTextElement",value:function(e){var n=e.querySelector(".rufus-customer-text-wrap");if(!n)return e.outerHTML;var r=n.textContent||"",i=t.parsePromptWithContext(r);if(!i)return e.outerHTML;n.textContent=i.userQuery;var a=ed(t.createDisplayText(i.selectedText),i.selectedText),o=e.querySelector(".rufus-customer-text");if(o){o.classList.add("rufus-customer-text-with-context");var s=o.querySelector(".rufus-speech-bubble");s&&s.insertAdjacentHTML("beforebegin",a)}return e.outerHTML}}])}(In);function ud(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function cd(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ud(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ud(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}n(sd,"instance",null);var ld=function(){return c(function e(){l(this,e)},null,[{key:"process",value:function(e,t){var n=this,r=[];return e.sections.forEach(function(e){var t,i=null===(t=e.target)||void 0===t?void 0:t.groupId;if("HTML"===e.content.format){var a=n.processHTMLSection(e.content.data,i);r.push.apply(r,O(a))}else{var o=[e.content.data],s=n.processJSONSection(o,i);r.push.apply(r,O(s))}}),S.widgetBodyEnd(t,!1),r}},{key:"retrieveInterruptedConversation",value:function(e,t,n){var r=null==n?void 0:n.conversationHistoryRequestIds;if(r){var i=r.lastIndexOf(t);if(-1!==i){var a=this.groupTurnsByCustomerMarker(e);if(a[i])return a[i]}}return[]}},{key:"groupTurnsByCustomerMarker",value:function(e){return e.reduce(function(e,t){return t.type===b.HTML_CONTENT_TURN_START?e.push([t]):e.length>0&&e[e.length-1].push(t),e},[])}},{key:"filterCustomerTextTurns",value:function(e){return e.filter(function(e){return e.type!==b.HTML_CONTENT_TURN_START})}},{key:"processHTMLSection",value:function(e,t){var n=this,r=(new DOMParser).parseFromString(e,"text/html");return Array.from(r.body.children).map(function(e){return n.createTurnFromHTMLElement(e,t)})}},{key:"createTurnFromHTMLElement",value:function(e,t){var n=e.getAttribute(Ue)===ut,r=n?sd.transformCustomerTextElement(e):e.outerHTML,i={type:n?b.HTML_CONTENT_TURN_START:b.HTML_CONTENT,id:this.generateTurnId(),content:r,timestamp:Date.now()};return t&&(i.groupId=t),i}},{key:"processJSONSection",value:function(e,t){return t?e.map(function(e){return cd(cd({},e),{},{groupId:e.groupId||t})}):e}},{key:"generateTurnId",value:function(){var e=new Uint32Array(1);return crypto.getRandomValues(e),"history-turn-".concat(Date.now(),"-").concat(e[0])}}])}();function dd(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(dd=function(){return!!e})()}var hd=function(e){function t(e,r){var i,a;return l(this,t),a=function(e,t,n){return t=h(t),d(e,dd()?Reflect.construct(t,n||[],h(e).constructor):t.apply(e,n))}(this,t,[e,r]),n(a,"isPapyrusMixedRenderingEnabled",!1),a.isPapyrusMixedRenderingEnabled=null!==(i=hl(Pt))&&void 0!==i&&i,a.url=a.isPapyrusMixedRenderingEnabled?t.HISTORY_ENDPOINT+"&programId=".concat("NILE_CLASSIC:desktop-cl"):t.HISTORY_ENDPOINT,a}return v(t,e),c(t,[{key:"fetchHistory",value:(r=a(s().mark(function e(t){var n,r,i,a,o,u=this,c=arguments;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:"",i=c.length>3?c[3]:void 0,a="RUFUS_INVOKE_".concat(r=c.length>2?c[2]:void 0,"_HISTORY_API"),r||(a="RUFUS_INVOKE_DEFAULT_HISTORY_API"),S.addCount(a,1),o=n?g.RUFUS_INTERRUPTION_RECOVERY_LATENCY:g.RUFUS_HISTORY_LATENCY,S.widgetBodyBegin(o),e.abrupt("return",new Promise(function(e,a){u.abortCurrentRequest(),u.currentRequest=u.post(u.url,{method:"POST",params:n?u.buildInterruptionRecoveryRequest(n):u.buildRequest(t,r,i),paramsFormat:"json",contentType:"application/json",success:function(t){return u.isPapyrusMixedRenderingEnabled?u.onFetchPapyrusHistory(t,e,o,n):u.onFetchHistorySuccess(t,e,o,n)},error:function(e,t){return u.onFetchHistoryError(e,t,a,o)}})}));case 1:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)})},{key:"hasMoreHistory",value:function(){var e,t;return null===(e=null===(t=this.lastResponseMetadata)||void 0===t?void 0:t.hasAdditionalHistory)||void 0===e||e}},{key:"hasMoreThreads",value:function(){var e,t;return null===(e=null===(t=this.lastResponseMetadata)||void 0===t?void 0:t.hasAdditionalThreads)||void 0===e||e}},{key:"resetPagination",value:function(){this.lastResponseMetadata=void 0}},{key:"isFirstTimeLoadHistory",value:function(){var e;return!(null!==(e=this.lastResponseMetadata)&&void 0!==e&&e.lastFetchedTurnId)}},{key:"buildRequest",value:function(e,t,n){var r,i,a,o;switch(t){case Wl.THREAD:a={historyType:t,maxThreads:20},null!==(r=this.lastResponseMetadata)&&void 0!==r&&r.lastFetchedThreadId&&(a.lastFetchedThreadId=this.lastResponseMetadata.lastFetchedThreadId);break;case Wl.TURN:a={historyType:t,threadId:n,maxTurns:5};break;default:a={tabId:this.tabId,maxTurns:e+5,historyOrder:"ASC",historySource:"CONVERSATION_LAYER",historyType:t}}return null!==(i=this.lastResponseMetadata)&&void 0!==i&&i.lastFetchedTurnId&&t!=Wl.THREAD&&(a.lastFetchedTurnId=null===(o=this.lastResponseMetadata)||void 0===o?void 0:o.lastFetchedTurnId),a}},{key:"buildInterruptionRecoveryRequest",value:function(e){return{tabId:this.tabId,maxTurns:2,historyOrder:"ASC",historySource:"CONVERSATION_LAYER",interruptedConversationRecoveryContext:{interruptedConversationRequestId:e,isInterruptedConversationRecoveryRequest:!0}}}},{key:"retrieveRecoveredInterruptedConversation",value:function(e,t){var n,r=null===(n=this.lastResponseMetadata)||void 0===n?void 0:n.conversationHistoryRequestIds;if(r){var i=r.lastIndexOf(t);if(-1!==i){var a=function(e,t){var n=(new DOMParser).parseFromString(e,"text/html"),r=Array.from(n.getElementsByClassName(F));return t<r.length&&t>=0?r[t].outerHTML:null}(e,i);if(a)return a}}return""}},{key:"onFetchHistorySuccess",value:function(e,t,n,r){var i;this.lastResponseMetadata=null!==(i=e.metadata)&&void 0!==i?i:e.responseMetadata,this.currentRequest=void 0;var a=function(e){var t=(new DOMParser).parseFromString(e,"text/html"),n=document.createDocumentFragment(),r=Array.from(t.getElementsByClassName("rufus-customer-text")),i=t.getElementById("rufus-welcome-message-box-container");if(i&&i.parentElement){var a=t.createElement("div");a.className=F,a.appendChild(i.parentElement.cloneNode(!0)),n.appendChild(a)}r.forEach(function(e){var r=t.createElement("div");r.className=F;var i=e.parentElement;i&&r.appendChild(i.cloneNode(!0));for(var a=i?i.nextElementSibling:null;a&&!a.querySelector(".rufus-customer-text");)r.appendChild(a.cloneNode(!0)),a=a.nextElementSibling;n.appendChild(r)});var o=t.createElement("div");return o.appendChild(n),o.innerHTML}(e.renderedHistoryContent);t(r?this.retrieveRecoveredInterruptedConversation(a,r):a),S.widgetBodyEnd(n,!1)}},{key:"onFetchPapyrusHistory",value:function(e,t,n,r){var i;this.lastResponseMetadata=null!==(i=e.metadata)&&void 0!==i?i:e.responseMetadata,this.currentRequest=void 0;var a=ld.process(e,n);t(r?ld.retrieveInterruptedConversation(a,r,this.lastResponseMetadata):a)}},{key:"onFetchHistoryError",value:function(e,t,n,r){this.currentRequest=void 0,n(t),S.logErrorWithLevel(R.ERROR,"Error fetching history. Status Code: ".concat(e.status,", Status text: ").concat(t)),S.widgetBodyEnd(r,!0)}}]);var r}(Bl);n(hd,"HISTORY_ENDPOINT",he+"history?ref=".concat(Pe.HISTORY));var fd=function(e){return e[e.INSUFFICIENT_BROWSER_CAPABILITIES=10]="INSUFFICIENT_BROWSER_CAPABILITIES",e[e.UNDEFINED_EVENT_SOURCE=20]="UNDEFINED_EVENT_SOURCE",e[e.SSE_HANDLER_ERROR=30]="SSE_HANDLER_ERROR",e[e.TIMEOUT=40]="TIMEOUT",e[e.OFFLINE=50]="OFFLINE",e[e.HANDLE_CONTEXT_CHUNK_ERROR=60]="HANDLE_CONTEXT_CHUNK_ERROR",e[e.HANDLE_CONVERSATION_METADATA_CHUNK_ERROR=70]="HANDLE_CONVERSATION_METADATA_CHUNK_ERROR",e}({}),vd=c(function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";l(this,e),n(this,"missingElements",[]),n(this,"getElementOrRecordMissing",function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=document.getElementById(e);if(!r&&(t.missingElements.push(e),n)){var i=t.sourceComponentName?"[".concat(t.sourceComponentName,"] "):"";S.logErrorWithLevel(R.ERROR,"".concat(i,"Rufus element ID was not found: ").concat(e))}return r}),n(this,"getMissingElements",function(){return t.missingElements}),n(this,"logMissingElementsAndThrowError",function(){if(t.missingElements.length>0){var e=t.sourceComponentName?"[".concat(t.sourceComponentName,"] "):"",n="".concat(e,"Rufus element IDs were not found: ").concat(t.missingElements.join(", "));throw S.logErrorWithLevel(R.ERROR,n),new Error(n)}}),this.sourceComponentName=r}),pd=function(){function e(){l(this,e);var t=new vd("ErrorRenderer").getElementOrRecordMissing(M,!0),n=document.getElementById(Et);if(n)this.errorContainer=n;else{var r=document.createElement("div");r.classList.add("rufus-error-container"),r.id=Et,null==t||t.insertAdjacentElement("afterend",r),this.errorContainer=r}}return c(e,null,[{key:"initialize",value:function(){e.instance=new e}},{key:"renderError",value:function(t){this.logCount(t.errorCode),e.resetErrorContainer(),e.hideLoader(),e.populateErrorContainerInner(t.errorCode,t.errorMessage,t.retryCallback),e.getInstance().currentErrorCode=t.errorCode}},{key:"removeError",value:function(t){e.getInstance().currentErrorCode===t&&e.resetErrorContainer()}},{key:"getInstance",value:function(){return e.instance||(e.initialize(),S.logErrorWithLevel(R.ERROR,"ErrorRenderer should be initialized at the top level before calling renderError")),e.instance}},{key:"logCount",value:function(e){var t=p.RENDERED_ERROR_CODE_PREFIX+e;S.addCount(t,1)}},{key:"resetErrorContainer",value:function(){e.getInstance().errorContainer.innerHTML="",e.getInstance().currentErrorCode=void 0}},{key:"hideLoader",value:function(){var e=document.getElementById(N);null==e||e.classList.add("aok-hidden")}},{key:"populateErrorContainerInner",value:function(t,n,r){var i=e.getInstance(),a=document.createElement("div");a.classList.add("rufus-error-container-inner",x),t&&a.setAttribute("data-error-code",t.toString()),e.renderErrorMessage(a,n),r&&e.renderRetryButton(a,r),i.errorContainer.appendChild(a)}},{key:"renderErrorMessage",value:(t=a(s().mark(function e(t,n){var r,i,a,o;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=document.createElement("div"),e.prev=1,n!==mt&&void 0!==n){e.next=3;break}return i=n===mt?mt:"default_error_message",e.next=2,Kc(document.documentElement.lang);case 2:a=e.sent,r.innerHTML=a.getMessage(i),e.next=4;break;case 3:r.innerHTML=n;case 4:e.next=6;break;case 5:e.prev=5,o=e.catch(1),S.logErrorWithLevel(R.ERROR,"Failed to load translation bundle",o instanceof Error?o.message:String(o)),r.innerHTML="Something went wrong. Please try again later.";case 6:return e.prev=6,r.classList.add("rufus-error-text"),t.appendChild(r),e.finish(6);case 7:case"end":return e.stop()}},e,null,[[1,5,6,7]])})),function(e,n){return t.apply(this,arguments)})},{key:"renderRetryButton",value:function(e,t){var n=document.createElement("span");n.classList.add("rufus-retry-button-container","a-button","a-button-toggle","system-pill");var r=document.createElement("span");r.classList.add("a-button-inner");var i=document.createElement("button");i.classList.add("rufus-retry-button","a-button-text","a-text-center"),i.type="button";var a=document.createElement("span");a.classList.add("a-color-link"),a.textContent="Retry",i.appendChild(a),r.appendChild(i),n.appendChild(r),e.appendChild(n),i.addEventListener("click",function(){t()})}},{key:"destroy",value:function(){e.instance=void 0}}]);var t}(),md=c(function e(){l(this,e),n(this,"firstInferenceChunkProcessed",!1),n(this,"activeChunk",{}),n(this,"patchMap",{})}),Ed=c(function e(){l(this,e),n(this,"renderingTimestamps",[]),n(this,"networkTimestamps",[]),n(this,"backendTimestamps",[])}),gd=function(e){return e.NEW_STREAM="NEW_STREAM",e.SSE_ERROR="SSE_ERROR",e.TIMEOUT="TIMEOUT",e.PAGE_NAVIGATION="PAGE_NAVIGATION",e.UNKNOWN="UNKNOWN",e}({}),_d=c(function e(t){l(this,e),n(this,"activeChunkPatchIds",[]),n(this,"chunkFirstReceivedMap",new Map),n(this,"latencyData",new md),this.tabId=t});function yd(e){return function(e){if(Array.isArray(e))return e}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Rd(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Cd(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Rd(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Rd(e,t){if(e){if("string"==typeof e)return Td(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Td(e,t):void 0}}function Td(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Sd,Id=function(e,t){if(!(this instanceof Id))return new Id(e,t);this.INITIALIZING=-1,this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this.url=e,t=t||{},this.headers=t.headers||{},this.payload=void 0!==t.payload?t.payload:"",this.method=t.method||this.payload&&"POST"||"GET",this.withCredentials=!!t.withCredentials,this.debug=!!t.debug,this.FIELD_SEPARATOR=":",this.listeners={},this.xhr=null,this.readyState=this.INITIALIZING,this.progress=0,this.chunk="",this.lastEventId="",this.addEventListener=function(e,t){void 0===this.listeners[e]&&(this.listeners[e]=[]),-1===this.listeners[e].indexOf(t)&&this.listeners[e].push(t)},this.removeEventListener=function(e,t){if(void 0!==this.listeners[e]){var n=[];this.listeners[e].forEach(function(e){e!==t&&n.push(e)}),0===n.length?delete this.listeners[e]:this.listeners[e]=n}},this.dispatchEvent=function(e){if(!e)return!0;this.debug&&console.debug(e),e.source=this;var t="on"+e.type;return(!this.hasOwnProperty(t)||(this[t].call(this,e),!e.defaultPrevented))&&(!this.listeners[e.type]||this.listeners[e.type].every(function(t){return t(e),!e.defaultPrevented}))},this._markClosed=function(){this.xhr=null,this._setReadyState(this.CLOSED)},this._setReadyState=function(e){var t=new CustomEvent("readystatechange");t.readyState=e,this.readyState=e,this.dispatchEvent(t)},this._onStreamFailure=function(e){var t=new CustomEvent("error");t.responseCode=e.currentTarget.status,t.data=e.currentTarget.response,this.dispatchEvent(t),this._markClosed()},this._onStreamAbort=function(){this.dispatchEvent(new CustomEvent("abort")),this._markClosed()},this._onStreamProgress=function(e){if(this.xhr)if(200===this.xhr.status){var t=this.xhr.responseText.substring(this.progress);this.progress+=t.length;var n=(this.chunk+t).split(/(\r\n\r\n|\r\r|\n\n)/g),r=n.pop();n.forEach(function(e){e.trim().length>0&&this.dispatchEvent(this._parseEventChunk(e))}.bind(this)),this.chunk=r}else this._onStreamFailure(e)},this._onStreamLoaded=function(e){this._onStreamProgress(e),this.dispatchEvent(this._parseEventChunk(this.chunk)),this.chunk="",this._markClosed()},this._preProcessChunk=function(e){var t,n=[],r=!1,i=Cd(e.split(/\n|\r\n|\r/));try{for(i.s();!(t=i.n()).done;){var a=t.value,o=a.trim();o.startsWith("data:")?(r=!0,n.push(a)):o.startsWith("event:")||o.startsWith("id:")||""===o?(r=!1,n.push(a)):r?n.push("data: ".concat(o)):n.push(a)}}catch(e){i.e(e)}finally{i.f()}return n.join("\n")},this._parseEventChunk=function(e){if(!e||0===e.length)return null;this.debug&&console.debug(e),e=this._preProcessChunk(e);var t={id:null,retry:null,data:null,event:null};e.split(/\n|\r\n|\r/).forEach(function(e){var n,r,i=e.indexOf(this.FIELD_SEPARATOR);if(i>0){var a=" "===e[i+1]?2:1;n=e.substring(0,i),r=e.substring(i+a)}else{if(!(i<0))return;n=e,r=""}n in t&&("data"===n&&null!==t[n]?t.data+="\n"+r:t[n]=r)}.bind(this)),null!==t.id&&(this.lastEventId=t.id);var n=new CustomEvent(t.event||"message");return n.id=t.id,n.data=t.data||"",n.lastEventId=this.lastEventId,n},this._onReadyStateChange=function(){if(this.xhr&&this.xhr.readyState===XMLHttpRequest.HEADERS_RECEIVED){var e,t={},n=Cd(this.xhr.getAllResponseHeaders().trim().split("\r\n"));try{for(n.s();!(e=n.n()).done;){var r=yd(e.value.split(":")),i=r[0],a=Td(r).slice(1).join(":").trim();t[i.trim().toLowerCase()]=t[i.trim().toLowerCase()]||[],t[i.trim().toLowerCase()].push(a)}}catch(e){n.e(e)}finally{n.f()}var o=new CustomEvent("open");o.responseCode=this.xhr.status,o.headers=t,this.dispatchEvent(o),this._setReadyState(this.OPEN)}},this.stream=function(){if(!this.xhr){for(var e in this._setReadyState(this.CONNECTING),this.xhr=new XMLHttpRequest,this.xhr.addEventListener("progress",this._onStreamProgress.bind(this)),this.xhr.addEventListener("load",this._onStreamLoaded.bind(this)),this.xhr.addEventListener("readystatechange",this._onReadyStateChange.bind(this)),this.xhr.addEventListener("error",this._onStreamFailure.bind(this)),this.xhr.addEventListener("abort",this._onStreamAbort.bind(this)),this.xhr.open(this.method,this.url),this.headers)this.xhr.setRequestHeader(e,this.headers[e]);this.lastEventId.length>0&&this.xhr.setRequestHeader("Last-Event-ID",this.lastEventId),this.xhr.withCredentials=this.withCredentials,this.xhr.send(this.payload)}},this.close=function(){this.readyState!==this.CLOSED&&this.xhr.abort()},(void 0===t.start||t.start)&&this.stream()};function Ad(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Od(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ad(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ad(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function bd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ld(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?bd(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bd(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}"undefined"!=typeof exports&&(exports.SSE=Id);var Pd=c(function e(){l(this,e)});Sd=Pd,n(Pd,"timeouts",new Map),n(Pd,"startTimeout",function(e,t,n){if(Sd.validateTimeoutId(e)){Sd.clear(e);var r=Sd.createTimeoutInfo(t,n);Sd.setTimeoutWithCallback(e,r)}}),n(Pd,"extendTimeout",function(e,t){var n=Sd.timeouts.get(e);if(!n)return!1;void 0!==n.id&&clearTimeout(n.id);var r=Sd.calculateExtendedDuration(n,t).newDuration,i=Sd.updateTimeoutInfo(n,r);return void 0===n.pausedAt?Sd.setTimeoutWithCallback(e,i):Sd.timeouts.set(e,i),!0}),n(Pd,"pauseTimeout",function(e){var t=Sd.timeouts.get(e);if(!t||void 0!==t.pausedAt)return!1;Sd.clearExistingTimeout(t);var n=Sd.createPausedTimeoutInfo(t);return Sd.timeouts.set(e,n),!0}),n(Pd,"resumeTimeout",function(e){var t=Sd.timeouts.get(e);if(!t||void 0===t.pausedAt)return!1;var n=Sd.createResumedTimeoutInfo(t);return Sd.setTimeoutWithCallback(e,n),!0}),n(Pd,"clear",function(e){var t=Sd.timeouts.get(e);return!!t&&(Sd.clearExistingTimeout(t),Sd.timeouts.delete(e),!0)}),n(Pd,"clearTimeouts",function(e){e.forEach(function(e){Sd.clear(e)})}),n(Pd,"hasTimeout",function(e){return Sd.timeouts.has(e)}),n(Pd,"validateTimeoutId",function(e){return!!e||(S.logErrorWithLevel(R.ERROR,"Empty timeout id. Timeout id must be a non-empty string."),!1)}),n(Pd,"createTimeoutInfo",function(e,t){return{id:void 0,callback:e,startTime:Date.now(),duration:t,pausedAt:void 0}}),n(Pd,"setTimeoutWithCallback",function(e,t){var n=setTimeout(function(){Sd.timeouts.delete(e),t.callback()},t.duration);Sd.timeouts.set(e,Ld(Ld({},t),{},{id:n}))}),n(Pd,"calculateExtendedDuration",function(e,t){var n,r,i=Date.now();return void 0!==e.pausedAt?(n=e.pausedAt-e.startTime,r=e.duration-n+t):(n=i-e.startTime,r=Math.max(0,e.duration-n)+t),{elapsedTime:n,newDuration:r}}),n(Pd,"updateTimeoutInfo",function(e,t){return Ld(Ld({},e),{},{id:void 0,startTime:Date.now(),duration:t})}),n(Pd,"createPausedTimeoutInfo",function(e){var t=Date.now(),n=t-e.startTime,r=Math.max(0,e.duration-n);return Ld(Ld({},e),{},{id:void 0,duration:r,pausedAt:t})}),n(Pd,"createResumedTimeoutInfo",function(e){return Ld(Ld({},e),{},{id:void 0,startTime:Date.now(),pausedAt:void 0})}),n(Pd,"clearExistingTimeout",function(e){void 0!==e.id&&clearTimeout(e.id)});var Nd=function(){function e(){var t=this;l(this,e),n(this,"loggers",new Map),n(this,"initialize",function(e,n){t.loggers.set(e.configName,new kd(e,n))}),n(this,"getLogger",function(e){return t.loggers.get(e)})}return c(e,null,[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}(),kd=c(function e(t,r){var i=this;l(this,e),n(this,"setMarker",function(e){var t=i.markers.findIndex(function(t){return t.name===e});-1!==t?i.markers[t].timestamp=Date.now():S.logErrorWithLevel(R.WARN,'Marker "'.concat(e,'" not found in configuration.'))}),n(this,"skipMarker",function(e){var t=i.markers.findIndex(function(t){return t.name===e});-1!==t?i.markers[t].timestamp=null:S.logErrorWithLevel(R.WARN,'Marker "'.concat(e,'" not found in configuration.'))}),n(this,"markerProcessed",function(e){var t=i.markers.findIndex(function(t){return t.name===e});return-1!==t&&void 0!==i.markers[t].timestamp}),n(this,"emitMetrics",function(){if(i.allMarkersProcessed()){var e=i.calculateLatencyMetrics();i.emitCSMLatencyMetrics(e)}}),n(this,"allMarkersProcessed",function(){return i.markers.every(function(e){return void 0!==e.timestamp})}),n(this,"calculateLatencyMetrics",function(){return i.markers.map(function(e){var t=i.config.markers.findIndex(function(t){return t.name===e.name});return{timestamp:e.timestamp,csmLatencyEvent:i.config.markers[t].csmLatencyEvent,biMetricName:i.config.markers[t].biMetricName}})}),n(this,"emitCSMLatencyMetrics",function(e){var t=i.config.configName;S.widgetBodyBegin(t,i.startTime),e.map(function(e){e.timestamp&&S.logCsmFeatureLatency(e.csmLatencyEvent,t,e.timestamp)}),S.widgetBodyEnd(t)}),this.startTime=null!=r?r:Date.now(),this.config=t,this.markers=t.markers.map(function(e){return{name:e.name,timestamp:void 0}})}),Ud={configName:"RUFUS_USER_PERCEIVED_LATENCY",markers:[{name:"initialized",biMetricName:"RUFUS_INITIALIZE_UPL",csmLatencyEvent:T.ClickToATF},{name:"initial_streaming_first_chunk_received",biMetricName:"RUFUS_INITIAL_STREAMING_FIRST_CHUNK_UPL",csmLatencyEvent:T.ClickToCF}]},Dd={configName:"RUFUS_USER_PERCEIVED_LATENCY_BF_CACHE",markers:[{name:"initialized",biMetricName:"RUFUS_INITIALIZE_BF_CACHE_UPL",csmLatencyEvent:T.ClickToATF},{name:"initial_streaming_first_chunk_received",biMetricName:"RUFUS_INITIAL_STREAMING_FIRST_CHUNK_BF_CACHE_UPL",csmLatencyEvent:T.ClickToCF}]},Md=function(e){return e.CLOSE="close",e.INTERNAL_ERROR="internal_error",e.SOFTLANDING_ERROR="softlanding_error",e.UNSUPPORTED_QUERY_ERROR="unsupported_query_error",e.CONTEXT="context",e.AFFORDANCE="affordance",e.MESSAGE="message",e.INTERIM="interim",e.INFERENCE="inference",e.CURATED_ANSWER="curated_answer",e.FEEDBACK="feedback",e.UNKNOWN="unknown",e.REMOVE="remove",e.ACTION="action",e.CONVERSATION_METADATA="conversation_metadata",e}({});function wd(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(wd=function(){return!!e})()}var Fd=function(e){return e.OPEN="open",e.STREAMING="streaming",e.CLOSED="closed",e.ERROR="error",e}({}),xd=function(e){function t(e,r,i,a,o){var s;return l(this,t),s=function(e,t,n){return t=h(t),d(e,wd()?Reflect.construct(t,[],h(e).constructor):t.apply(e,n))}(this,t),n(s,"startInitialStreamingCall",function(e){var t=yn(e.pageType),n=e.qis,r=e.metadata;s.startStream({actionType:s.getInitialStreamingActionType(t,n),isInitialStream:!0,qis:n,externalQuery:s.getInitialStreamingExternalQuery(e.keyword,n),metadata:r,reftag:mn.extractNileReftagFromUrl(mn.getCurrentPageUrl())})}),n(s,"papyrusStreamingEventHandler",function(e){s.handleStreamingEvent(e,"papyrus")}),n(s,"genericStreamingEventHandler",function(e){s.handleStreamingEvent(e,"generic")}),n(s,"streamOpenHandler",function(){s.setStreamingStatus({streamingStatus:Fd.OPEN}),s.streamingLogger.openStreamingRequest()}),n(s,"streamCloseEventHandler",function(){s.setStreamingStatus({streamingStatus:Fd.CLOSED}),Pd.clearTimeouts(t.streamingTimeoutIds),s.eventSource&&s.streamingLogger.closeStreamingRequest()}),n(s,"streamErrorHandler",function(e){if(s.setStreamingStatus({streamingStatus:Fd.ERROR}),Pd.clearTimeouts(t.streamingTimeoutIds),navigator.onLine){var n=s.getResponseCode(e);s.streamingLogger.handleStreamError(gd.SSE_ERROR,n),pd.renderError({errorCode:fd.SSE_HANDLER_ERROR})}}),n(s,"streamTimeoutHandler",function(){s.setStreamingStatus({streamingStatus:Fd.ERROR}),Pd.clearTimeouts(t.streamingTimeoutIds),s.abortCurrentStream(gd.TIMEOUT),pd.renderError({errorCode:fd.TIMEOUT})}),s.A=e,s.contextManager=r,s.tabId=i,s.streamingLogger=a,s.streamingStatus={streamingStatus:void 0,actionType:void 0,inputQuery:void 0,asinId:void 0,isInitialStream:void 0,requestContext:void 0,metadata:void 0},s.isBfcacheNavigation=!1,s.shouldUseRufusCommonModule=dl.getInstance().isWeblabTreatmentEnabledAndRecordTrigger(Yl)||dl.getInstance().isWeblabTreatmentEnabledAndRecordTrigger(jl),s.animationTransitionHandler=o,s.isTopAnchoringEnabled=hl(kt)||!1,s}return v(t,e),c(t,[{key:"startStream",value:(r=a(s().mark(function e(t){var n,r,i,a,o,u,c,l,d,h,f,v,p,m;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.actionType,i=t.inputQuery,a=t.asinId,o=t.isInitialStream,u=t.qis,c=t.externalQuery,l=t.metadata,d=t.reftag,this.abortCurrentStream(gd.NEW_STREAM),this.streamingLogger.startStreamingRequest(r),h=this.contextManager.buildContext(r,i,a,o,u,c,l,this.shouldUseRufusCommonModule),f=null===(n=h.bottomSheetContext)||void 0===n?void 0:n.bottomSheetEmpty,r!==rn.SWIPE_UP||!1!==f){e.next=1;break}return null===(v=Nd.getInstance().getLogger(Ud.configName))||void 0===v||v.skipMarker("initial_streaming_first_chunk_received"),this.dispatch("invalidatePanelCache",!1),e.abrupt("return");case 1:if(!this.isTopAnchoringEnabled||!this.animationTransitionHandler){e.next=5;break}return e.prev=2,e.next=3,this.animationTransitionHandler.executeTransition();case 3:e.next=5;break;case 4:e.prev=4,m=e.catch(2),S.logErrorWithLevelWithException(R.ERROR,m,"Animation transition failed, continuing with streaming");case 5:this.dispatch("saveRequestMetadataToPanelCache",{actionType:r,inputQuery:i,asinId:a,isInitialStream:o,qis:u,externalQuery:c,metadata:l,reftag:d}),o&&this.isBfcacheNavigation&&Jt(_.BACK_NAVIGATION),p=this.getUrl(d,o),this.setStreamingStatus({streamingStatus:Fd.STREAMING,actionType:r,requestContext:h,inputQuery:null!=i?i:void 0,asinId:null!=a?a:void 0,isInitialStream:!0===o,metadata:null!=l?l:void 0}),Pd.startTimeout(gt,this.streamTimeoutHandler,4e4),this.initEventSource(p,h,o);case 6:case"end":return e.stop()}},e,this,[[2,4]])})),function(e){return r.apply(this,arguments)})},{key:"getStreamingStatus",value:function(){return this.streamingStatus}},{key:"abortCurrentStream",value:function(e){this.eventSource&&(this.streamingStatus.streamingStatus!==Fd.CLOSED&&this.streamingLogger.handleRequestInterrupted(e),this.eventSource.close(),this.eventSource=void 0)}},{key:"setIsBfcacheNavigation",value:function(e){this.isBfcacheNavigation=e}},{key:"getIsRufusStayBehaviorRequired",value:function(){return this.contextManager.getIsRufusStayBehaviorRequired()}},{key:"initEventSource",value:function(e,t,r){this.eventSource=function(e,t,r){var i=hn(),a=hl(bt)||hl(Lt);return new Id(e,{payload:JSON.stringify(t),method:"POST",headers:Od(Od(n(n({},Fl.CONTENT_TYPE,"application/json"),Fl.ANTI_CSRF_TOKEN,dn()),void 0!==i&&n({},Fl.FLOW_CLOSURE_ID,i)),!0===a&&r&&n({},Fl.IS_PAPYRUS,"true"))})}(e,t,r),this.eventSource.onopen=this.streamOpenHandler;for(var i=hl(bt)||hl(Lt),a=wt(Ae),o=!a||"ATVPDKIKX0DER"===a,s=0,u=Object.values(Md);s<u.length;s++){var c=u[s];!0===i&&o&&c===Md.MESSAGE&&r?this.eventSource.addEventListener(c,this.papyrusStreamingEventHandler):this.eventSource.addEventListener(c,this.getEventHandler(c))}this.eventSource.onerror=this.streamErrorHandler}},{key:"getEventHandler",value:function(e){return e===Md.CLOSE?this.streamCloseEventHandler:this.genericStreamingEventHandler}},{key:"setStreamingStatus",value:function(e){var t=e.streamingStatus,n=void 0===t?this.streamingStatus.streamingStatus:t,r=e.actionType,i=void 0===r?this.streamingStatus.actionType:r,a=e.inputQuery,o=void 0===a?this.streamingStatus.inputQuery:a,s=e.asinId,u=void 0===s?this.streamingStatus.asinId:s,c=e.isInitialStream,l=void 0===c?this.streamingStatus.isInitialStream:c,d=e.requestContext,h={streamingStatus:n,actionType:i,inputQuery:o,asinId:u,isInitialStream:l,requestContext:void 0===d?this.streamingStatus.requestContext:d};this.dispatch("onStreamingStatusChange",h),this.streamingStatus=h}},{key:"handleStreamingEvent",value:function(e,n){if(!this.eventSource)return S.logErrorWithLevel(R.ERROR,"SSE stream event received with undefined event source: ".concat(e.type)),void pd.renderError({errorCode:fd.UNDEFINED_EVENT_SOURCE});this.shouldUseRufusCommonModule?this.streamingLogger.setChunkReceived(e,this.streamingStatus,!0):this.streamingLogger.setChunkReceived(e,this.streamingStatus),Pd.clearTimeouts(t.streamingTimeoutIds),Pd.startTimeout(_t,this.streamTimeoutHandler,4e4);var r={event:e,streamingStatusDetails:this.streamingStatus,streamingEventType:e.type};this.streamingLogger.setStreamingEvent(r),"papyrus"===n?this.dispatch("onEventReceivedForPapyrusFlow",r):this.shouldUseRufusCommonModule?this.dispatch("onEventReceivedV2",r):this.dispatch("onEventReceived",r),Object.values(Md).includes(e.type)||S.logErrorWithLevel(R.ERROR,"Unsupported event type ".concat(e.type," received"))}},{key:"getResponseCode",value:function(e){try{var t=JSON.stringify(e);return JSON.parse(t).responseCode}catch(e){return console.error("".concat("StreamingClient"," - Error parsing SSEvent ").concat(e instanceof Error?"(".concat(e.message,")"):"")),"unknown"}}},{key:"getUrl",value:function(e,t){var n=this.A.$(location).attr("href"),r=new URL(n),i=r.searchParams.get("auditEnabled");if(r.search="?tabId=".concat(this.tabId),"true"===i&&r.searchParams.append("auditEnabled","true"),r.hash="",r.pathname=he+"streaming",e&&r.searchParams.append("ref",e),this.shouldUseRufusCommonModule){var a=hl(bt),o=hl(Lt),s=t&&a||o?"NILE_CLASSIC:desktop-cl":"NILE_CLASSIC";r.searchParams.append("programId",s)}return r.toString()}},{key:"shouldShowDeepLinkFallbackCX",value:function(e){return!(e!==un.NILE_INGRESS_LINK||"T1"!==dl.getInstance().getWeblabTreatment("RUFUS_DESKTOP_DEEP_LINK_FALLBACK_1106261"))}},{key:"getInitialStreamingExternalQuery",value:function(e,t){return this.shouldShowDeepLinkFallbackCX(t)?void 0:e}},{key:"getInitialStreamingActionType",value:function(e,t){if(Object.values(un).includes(t))return this.shouldShowDeepLinkFallbackCX(t)?rn.SWIPE_UP:rn.SEARCH;switch(e){case gn.SEARCH_RESULTS:var n=mn.extractQueryFromUrl(mn.getCurrentPageUrl()),r=this.contextManager.getSearchBarQuery();return n||r?rn.SEARCH:rn.SWIPE_UP;case gn.DETAIL_PAGE:return rn.ASIN_CLICK;default:return rn.SWIPE_UP}}}]);var r}(In);function Hd(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Hd=function(){return!!e})()}n(xd,"streamingTimeoutIds",[gt,_t]);var Bd=function(e){function t(e){var n;return l(this,t),n=function(e,t,n){return t=h(t),d(e,Hd()?Reflect.construct(t,[],h(e).constructor):t.apply(e,n))}(this,t),n.A=e,n.initialize(),n}return v(t,e),c(t,[{key:"initialize",value:function(){this.registerOnClickedAction(this.A)}},{key:"registerOnClickedAction",value:function(e){var n=this;e.declarative("rufus-action","click",function(e){var r=e.$target;if(void 0!==e.data.action){var i=t.eventDataToActionData(e.data,r);n.onAction(i)}else void 0!==e.data.actionType&&n.onAction(t.eventDataToAction(e.data,r))})}},{key:"onAction",value:function(e){this.dispatch("onAction",e)}}],[{key:"eventDataToActionData",value:function(e,t){return new en(e.action,null==e?void 0:e.query,null==e?void 0:e.sectionId,null==e?void 0:e.clickEventName,t)}},{key:"eventDataToAction",value:function(e,t){return new en(e,void 0,void 0,void 0,t)}}])}(In);var Wd=function(){return c(function e(){l(this,e)},null,[{key:"isWDCSSection",value:function(e,t){return e===ct&&t===sn.NILE_NDSWDCS_RELATED_QUESTION}}])}();n(Wd,"removeDataMixClaimedAttribute",function(e){var t,n=e.querySelector("#cr-product-insights-cards");null==n||null===(t=n.parentElement)||void 0===t||t.removeAttribute("data-mix-claimed")});var Vd,Gd=["fade-in","rufus-fade-in","rufus-web-fade-in","rufus-query-fade-in"],zd=function(e){for(var t=function(){var t=r[n];e.querySelectorAll("."+t).forEach(function(e){e.classList.remove(t)})},n=0,r=Gd;n<r.length;n++)t()},jd=function(e){var t;(t=e.classList).remove.apply(t,Gd),zd(e)},Yd=function(e){e.forEach(function(e){var t;(t=e.classList).remove.apply(t,Gd)})},Kd="_SL",qd="data-a-modal",Xd="m.media-amazon.com",Zd=function(e){S.widgetBodyBegin(g.UPDATE_CL_IMAGE_URL_TO_LOW_RES);var t=e.querySelectorAll('[id^="rufus-panel-image-carousel-card-"]');t.length<=0||(t.forEach(function(e){var t=e.querySelector('[id^="conversation-layer-image"]'),n=e.parentElement;Qd(t,n)}),S.widgetBodyEnd(g.UPDATE_CL_IMAGE_URL_TO_LOW_RES))},Qd=function(e,t){var n=t.getAttribute(qd);if(null!=n){var r,i,a,o=null===(r=JSON.parse(n))||void 0===r?void 0:r.imageUrl,s=null!==(i=null===(a=JSON.parse(n))||void 0===a?void 0:a.actionId)&&void 0!==i?i:"";if(null!=o){var u=$d(o),c=e.src;e.onload=function(){S.widgetBodyEnd(g.RUFUS_LOW_RESOLUTION_IMAGE_LOADED_LATENCY,!1),S.widgetBodyBegin(g.RUFUS_LOW_RESOLUTION_IMAGE_RENDERED_LATENCY),e.decode().then(function(){S.widgetBodyEnd(g.RUFUS_LOW_RESOLUTION_IMAGE_RENDERED_LATENCY,!1),S.addCount(p.RUFUS_MULTIMODAL_IMAGE_SHOWN,1)})},e.src=u,S.widgetBodyBegin(g.RUFUS_LOW_RESOLUTION_IMAGE_LOADED_LATENCY),e.onclick=function(){Jt(_.OPEN_MEDIA,s),S.addCount(p.RUFUS_MULTIMODAL_IMAGE_CLICKED,1)},e.onerror=function(e){Jd("LOW","RENDER",e.toString())},t.setAttribute(qd,n.toString().replace(c,u))}else S.logErrorWithLevel(R.ERROR,"High resolution image is empty.")}else S.logErrorWithLevel(R.ERROR,"DataModel for MultiModal is null.")},Jd=function(e,t,n){S.logErrorWithLevel(R.ERROR,"".concat(e.toLowerCase()," resolution image could not be ").concat(t.toLowerCase(),"ed due to error: ").concat(n)),S.addCount("ERROR_ON_".concat(t,"ING_").concat(e,"_RES_IMAGE"),1),S.widgetBodyEnd("RUFUS_".concat(e,"_RESOLUTION_IMAGE_").concat(t,"ED_LATENCY"),!0)},$d=function(e){if(!e.includes(Xd))return e;var t=window.devicePixelRatio,n=eh(t),r=Math.ceil(oe*window.devicePixelRatio*n),i=e.split("."),a=i[i.length-1];return e.replace(a,"".concat(Kd).concat(r.toString(),"_.").concat(a))},eh=function(e){return e<=1?1:.6},th=function(){function e(){l(this,e)}return c(e,null,[{key:"handleLinkWrapperLeftClick",value:function(t,n){var r=e.getAnchorElement(n),i=t(n),a=n,o=a.ctrlKey,s=a.metaKey;o||s?e.handleModifierKeyLeftClick(i):e.handleStandardLeftClick(n,i,null==r?void 0:r.href)}},{key:"handleModifierKeyLeftClick",value:function(e){e&&S.addCount(p.RUFUS_HYPERLINK_CLICK_PREFIX+"OPENED_IN_NEW_TAB_"+e,1)}},{key:"handleStandardLeftClick",value:function(e,t,n){e.preventDefault(),t&&S.addCount(p.RUFUS_HYPERLINK_CLICK_PREFIX+"OPENED_IN_CURRENT_TAB_"+t,1),n&&window.location.assign(n)}},{key:"handleLinkWrapperAuxClick",value:function(e,t){var n=e(t);n&&S.addCount(p.RUFUS_HYPERLINK_CLICK_PREFIX+"OPENED_IN_NEW_TAB_"+n,1)}},{key:"handleLinkWrapperOpenContextMenu",value:function(e,t){var n=e(t);n&&S.addCount(p.RUFUS_HYPERLINK_CLICK_PREFIX+"OPENED_CONTEXT_MENU_"+n,1)}},{key:"getAnchorElement",value:function(e){return e.currentTarget instanceof HTMLAnchorElement?e.currentTarget:void 0}}])}();function nh(e,t){var n=e.querySelectorAll("img"),r=0,i=function(){r===n.length&&(t(),n.forEach(function(e){e.removeEventListener("load",a),e.removeEventListener("error",a)}))},a=function(){r++,i()};n.forEach(function(e){e.complete?r++:(e.addEventListener("load",a),e.addEventListener("error",a))}),i()}Vd=th,n(th,"LINK_WRAPPER_CLASS_NAME","rufus-link-wrapper"),n(th,"ASIN_FACEOUT_LINK_SELECTOR",".rufus-asin-faceout-wrapper a"),n(th,"ASIN_FACEOUT_DATA_SECTION_CLASS","AsinFaceoutList"),n(th,"addListeners",function(e){"T1"==Vd.triggerWeblabAndGetTreatment()&&e&&(Vd.addListenersToLinkWrappers(e),Vd.addListenersToAsinFaceoutLinks(e))}),n(th,"addListenersToLinkWrappers",function(e){var t=e.getElementsByClassName(Vd.LINK_WRAPPER_CLASS_NAME);Array.from(t).forEach(function(e){return Vd.addLinkEventListeners(e,Vd.getRegularLinkEventName)})}),n(th,"addListenersToAsinFaceoutLinks",function(e){var t=e.querySelectorAll(Vd.ASIN_FACEOUT_LINK_SELECTOR);Array.from(t).forEach(function(e){return Vd.addLinkEventListeners(e,Vd.getAsinFaceoutEventName)})}),n(th,"getRegularLinkEventName",function(e){var t;return null===(t=Vd.getAnchorElement(e))||void 0===t?void 0:t.getAttribute("data-click-event-name")}),n(th,"getAsinFaceoutEventName",function(){return Vd.ASIN_FACEOUT_DATA_SECTION_CLASS}),n(th,"addLinkEventListeners",function(e,t){e.addEventListener("click",Vd.handleLinkWrapperLeftClick.bind(null,t)),e.addEventListener("contextmenu",Vd.handleLinkWrapperOpenContextMenu.bind(null,t)),e.addEventListener("auxclick",Vd.handleLinkWrapperAuxClick.bind(null,t))}),n(th,"triggerWeblabAndGetTreatment",function(){var e=dl.getInstance().getWeblabTreatment(Gl);if(e)return S.recordTrigger(Gl,e),e});var rh=function(){return c(function e(){l(this,e)},null,[{key:"parseEventData",value:function(e){try{return JSON.parse(e.data)}catch(e){return S.logErrorWithLevelWithException(R.ERROR,e,"Rufus - Error parsing event data: ".concat(e instanceof Error?"(".concat(e.message,")"):"")),null}}}])}();function ih(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var ah=["type","src","charset","class"],oh=function(e){return ah.includes(e)||e.startsWith("data-")},sh=function(e){var t=e.getAttribute("type");return!t||"text/javascript"===t||"application/javascript"===t},uh=function(e){var t=document.getElementById(L);t&&Array.from(e.querySelectorAll("script")).map(function(e){var t=document.createElement("script");return e.getAttributeNames().filter(oh).forEach(function(n){var r=e.getAttribute(n);t.setAttribute(n,r)}),t.text=e.text,t}).forEach(function(e){try{t.appendChild(e)}catch(e){S.logErrorWithLevelWithException(R.ERROR,e,"Failed to load additional script for execution")}})};function ch(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ch=function(){return!!e})()}var lh=function(e){function t(e){var n;return l(this,t),n=function(e,t,n){return t=h(t),d(e,ch()?Reflect.construct(t,[],h(e).constructor):t.apply(e,n))}(this,t),n.conversationList=e,n}return v(t,e),c(t,[{key:"getInterruptionRecoveryContainer",value:function(){return document.getElementById(yt)}},{key:"getInterruptionRecoveryButton",value:function(){return document.getElementById("rufus-interrupted-stream-recovery-button-container")}},{key:"getInterruptionRecoverySpinner",value:function(){return document.getElementById("rufus-interrupted-stream-recovery-spinner-container")}},{key:"checkInterruptionRecoveryButtonVisibility",value:function(){var e=this.getInterruptionRecoveryButton();return!!e&&!e.classList.contains("aok-hidden")}},{key:"toggleInterruptionRecoveryButtonVisibility",value:function(e){var t;e&&(S.addCount(p.INTERRUPTION_RECOVERY_BUTTON_SHOWN,1),Jt(_.INTERRUPTION_RECOVERY_BUTTON_SHOWN)),null===(t=this.getInterruptionRecoveryButton())||void 0===t||t.classList.toggle("aok-hidden",!e)}},{key:"toggleInterruptionRecoverySpinnerVisibility",value:function(e){var t;null===(t=this.getInterruptionRecoverySpinner())||void 0===t||t.classList.toggle("aok-hidden",!e)}},{key:"addInterruptionRecoveryButtonEventListener",value:function(e){var t=this,n=this.getInterruptionRecoveryButton();n&&(this.buttonClickHandler&&n.removeEventListener("click",this.buttonClickHandler),this.buttonClickHandler=function(){return t.handleInterruptionRecoveryButtonClick(e)},n.addEventListener("click",this.buttonClickHandler))}},{key:"handleInterruptionRecoveryButtonClick",value:function(e){S.addCount(p.INTERRUPTION_RECOVERY_BUTTON_CLICK,1),Jt(_.INTERRUPTION_RECOVERY_BUTTON_CLICK),this.toggleInterruptionRecoveryButtonVisibility(!1),this.toggleInterruptionRecoverySpinnerVisibility(!0),this.dispatch("onInterruptionRecoveryButtonClick",e)}},{key:"finalizeInterruptionRecoverySetup",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t(),r){var i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;n.getInterruptionRecoveryButton()?(n.addInterruptionRecoveryButtonEventListener(e),n.toggleInterruptionRecoveryButtonVisibility(!0)):t<10&&setTimeout(function(){return i(t+1)},50)};setTimeout(function(){return i()},0)}else{this.addInterruptionRecoveryButtonEventListener(e),this.toggleInterruptionRecoveryButtonVisibility(!0);var a=this.getInterruptionRecoveryContainer();a&&a.classList.remove("aok-hidden")}}},{key:"moveInterruptionRecoveryToInnerContainer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n){var r=this.createInterruptionRecoveryTurn();if(!r)return;this.containerHtmlContent=r.content;var i=this.getInterruptionRecoveryContainer();i&&i.parentElement&&i.parentElement.removeChild(i),yl().getState().addTurn(r)}else this.conversationList.getContainerInner().append(this.getInterruptionRecoveryContainer());this.finalizeInterruptionRecoverySetup(e,t,n)}},{key:"moveInterruptionRecoveryContainerToConversation",value:function(e,t){var n=this.conversationList.getActiveConversationContainer(),r=n.children.length;r>0&&(n.children[r-1].appendChild(this.getInterruptionRecoveryContainer()),this.finalizeInterruptionRecoverySetup(e,t,!1))}},{key:"moveInterruptionRecoveryContainerOutOfConversation",value:function(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this.removeInterruptionRecoveryFromReactState(),this.restoreInterruptionRecoveryContainerToMainContainer();else{var e=this.conversationList.getMainContainer();this.toggleInterruptionRecoveryButtonVisibility(!1),this.toggleInterruptionRecoverySpinnerVisibility(!1),this.getInterruptionRecoveryContainer().classList.add("aok-hidden"),e.appendChild(this.getInterruptionRecoveryContainer())}}},{key:"dismissInterruptionRecoverySpinnerAndShowButton",value:function(){this.toggleInterruptionRecoverySpinnerVisibility(!1),this.toggleInterruptionRecoveryButtonVisibility(!0),this.getInterruptionRecoveryContainer().classList.remove("aok-hidden")}},{key:"createInterruptionRecoveryTurn",value:function(){var e=this.getInterruptionRecoveryContainer();if(!e)return S.logErrorWithLevel(R.ERROR,"Interruption recovery container not found"),null;var t=e.cloneNode(!0);return t.classList.remove("aok-hidden"),{type:b.HTML_CONTENT_INTERRUPTION_RECOVERY,id:yt,groupId:yt,content:t.outerHTML,rufusUI:!1,timestamp:Date.now()}}},{key:"removeInterruptionRecoveryFromReactState",value:function(){yl().getState().removeTurnsByGroupId(yt)}},{key:"restoreInterruptionRecoveryContainerToMainContainer",value:function(){var e=this.conversationList.getMainContainer();if(this.containerHtmlContent){var t=document.createElement("div");t.innerHTML=this.containerHtmlContent;var n=t.firstElementChild;n&&(n.classList.add("aok-hidden"),e.appendChild(n)),this.containerHtmlContent=void 0}}}])}(In),dh=function(){function e(){l(this,e)}return c(e,null,[{key:"hasTurnBeforeCustomerText",value:function(e){for(var t=yl().getState().getAllTurns(),n=t.findIndex(function(e){return e.type===b.HTML_CONTENT_TURN_START}),r=-1===n?t.length:n,i=0;i<r;i++)if(e(t[i]))return!0;return!1}},{key:"hasPapyrusFtuxOrRux",value:function(){return this.hasTurnBeforeCustomerText(function(t){return e.hasPapyrusRux(t)||e.hasPapyrusFtux(t)})}},{key:"hasPapyrusRux",value:function(e){var t;return(null===(t=e.groupId)||void 0===t?void 0:t.startsWith(tt))||e.id.startsWith(tt)}},{key:"hasPapyrusFtux",value:function(e){var t;return(null===(t=e.groupId)||void 0===t?void 0:t.startsWith(nt))||e.id.startsWith(nt)}},{key:"getCustomerTurnsCount",value:function(){return yl().getState().getAllTurns().filter(function(e){return e.type===b.HTML_CONTENT_TURN_START}).length}}])}(),hh=function(){return c(function e(){l(this,e)},[{key:"handlePrependHistory",value:function(e,t){if(t){var n=this.deduplicateHistoryTurns(e);yl().getState().prependHistoryTurns(n)}else yl().getState().prependHistoryTurns(e)}},{key:"deduplicateHistoryTurns",value:function(e){var t=dh.getCustomerTurnsCount();if(0===t)return e;for(var n=0,r=e.length,i=e.length-1;i>=0;i--)if(e[i].type===b.HTML_CONTENT_TURN_START&&++n===t){r=i;break}return e.slice(0,r)}}])}();function fh(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function vh(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fh(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fh(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function ph(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ph=function(){return!!e})()}var mh=function(e){return e.VisibleWithAvatar="visibileWithAvatar",e.VisibleWithoutAvatar="visibleWithoutAvatar",e.HiddenBeforeComplete="hiddenBeforeComplete",e.Hidden="hidden",e}({}),Eh=function(e){return e.AppendInner="appendInner",e.AppendActive="appendActive",e.PrependHistory="prependHistory",e.ReplaceActive="replaceActive",e.ReplaceHistory="replaceHistory",e.InsertIntoLastActiveTurn="insertIntoLastActiveTurn",e.RemoveLastActiveTurn="removeLastActiveTurn",e.ReplaceInterruptedConversation="replaceInterruptedConversation",e.ReplaceInterruptedConversationPapyrus="replaceInterruptedConversationPapyrus",e}({}),gh=function(e){function t(e,r,i){var a,o,s,u;return l(this,t),u=function(e,t,n){return t=h(t),d(e,ph()?Reflect.construct(t,[],h(e).constructor):t.apply(e,n))}(this,t),n(u,"isTopLoading",!1),n(u,"currentGeneratingMessage","Rufus is currently generating a response"),n(u,"completedGeneratingMessage","Rufus has completed generating a response"),n(u,"SECTIONS_WITH_SCRIPTS",[ct,lt]),n(u,"fixUnsupportedSymbols",function(e){return Ce.forEach(function(t,n){e=e.replace(new RegExp(n,"g"),t)}),e}),n(u,"isSpinnerShowing",function(){return null!=u.elements.spinnerContainer&&!u.elements.spinnerContainer.classList.contains("aok-hidden")}),n(u,"removeActiveConversationTurnsFromHistory",function(e){for(var t=u.getNumberOfConversationTurns(),n=0;n<t&&e.lastChild;n++)e.removeChild(e.lastChild)}),n(u,"getSectionGroupIdsFromSection",function(e){var t=e.querySelectorAll(Ne);return Array.from(t).map(function(e){return e.id})}),n(u,"selectSectionWithId",function(e,t){return e.querySelector("#".concat(t))}),n(u,"replaceStreamingElement",function(e,t){var n=parseInt(e.getAttribute(ke)||""),r=parseInt(t.getAttribute(ke)||"");return!isNaN(n)&&!isNaN(r)&&n<r?(u.animationUtil.prepareSectionForReplaceAnimation(e,t),e.style.height="".concat(e.getBoundingClientRect().height,"px"),e.innerHTML=t.innerHTML,e.style.removeProperty("height"),e.setAttribute(ke,String(r)),e):void 0}),n(u,"appendElementToContainer",function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;u.animationUtil.prepareSectionForAppendAnimation(e),void 0===u.elements.currentStreamContainer&&u.createNewStreamContainer(t,rn.UNKNOWN);var i=e.getAttribute(Ue)||void 0,a=n&&n===Md.MESSAGE;if("TextSubsections"!==i||r!==sn.NILE_NDSWDCS_RELATED_QUESTION){if(Wd.isWDCSSection(i,r)||i===lt){var o=e.cloneNode(!0),s=o.id;!function(e){Yd([e]),e.classList.remove(rt)}(o),function(e,t){var n,r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ih(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ih(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(e.querySelectorAll("script"));try{for(r.s();!(n=r.n()).done;){var i=n.value;sh(i)&&(i.text="//".concat(t,"\n").concat(i.text))}}catch(e){r.e(e)}finally{r.f()}}(o,s),u.sectionIdToScriptSectionsMap[s]=o,uh(o)}if(u.shouldAddRemoveSectionClass(t,r,a,i)&&e.classList.add(x),"Carousel"===i&&Zd(e),"PriceHistoryChart"===i&&u.appendSvgChartToContainer(e),i===dt){var c=e.cloneNode(!0);u.cacheManager.setFlowCards(e.id,e),uh(c)}var l;return t&&n===Md.AFFORDANCE&&(null===(l=u.elements.currentStreamContainer)||void 0===l||l.classList.remove(B)),u.elements.currentStreamContainer.appendChild(e),u.handleHidingLoaderAvatar(n,i),u.updateCache(),e}}),n(u,"handleLoadMoreHistoryButtonClick",function(){S.addCount(p.LOAD_HISTORY_BUTTON_CLICK,1),Jt(_.LOAD_HISTORY),u.dispatch("onLoadMoreHistoryButtonClick",void 0)}),n(u,"replaceContentInContainer",function(e,t){u.elements.container.style.removeProperty("scroll-behavior");var n=document.createElement("div");n.innerHTML=e,nh(n,function(){t===Eh.ReplaceActive?(u.elements.activeConversationContainer.innerHTML="".concat(n.innerHTML),th.addListeners(u.elements.activeConversationContainer)):t===Eh.ReplaceHistory&&(u.elements.historyContainer.innerHTML="".concat(n.innerHTML),th.addListeners(u.elements.historyContainer)),u.elements.container.scrollTop=u.elements.container.scrollHeight,u.elements.container.style.scrollBehavior="smooth",u.dispatch("completeReplacingContentInContainer",void 0)})}),n(u,"updateCache",function(){u.cacheManager.setPanelContent(u.getPanelContentSnapshot())}),u.missingElementsRecorder=new vd("ConversationList"),u.sectionIdToScriptSectionsMap={},u.elements=u.readHtmlElementsFromDom(),u.animationUtil=e,u.streamingLifecycleEventLogger=r,u.cacheManager=i,u.asinFaceoutState={expectAsinFaceoutChunkNext:!1},u.isMixedRenderingEnabled=null!==(a=hl(Pt))&&void 0!==a&&a,u.isTopContentAnchoringEnabled=null!==(o=hl(kt))&&void 0!==o&&o,u.interruptionRecoveryHandler=new lh(u),u.papyrusHistoryHandler=new hh,u.interruptionRecoveryHandler.on("onInterruptionRecoveryButtonClick",function(e){u.dispatch("onInterruptionRecoveryButtonClick",e)}),u.isPapyrusCachingEnabled=null!==(s=hl(Nt))&&void 0!==s&&s,u.loadTranslations(),u.SECTIONS_WITH_SCRIPTS.forEach(function(e){var t=u.elements.container.querySelectorAll("[".concat(Ue,'="').concat(e,'"]'));Array.from(t).forEach(function(e){var t=e.cloneNode(!0),n=t.id;u.sectionIdToScriptSectionsMap[n]=t,uh(t)})}),u.updateCache(),u.elements.container.style.scrollBehavior="smooth",u.attachEventListeners(),u}return v(t,e),c(t,[{key:"getInterruptionRecoveryHandler",value:function(){return this.interruptionRecoveryHandler}},{key:"getContainerInner",value:function(){return this.elements.containerInner}},{key:"getActiveConversationContainer",value:function(){return this.elements.activeConversationContainer}},{key:"getMainContainer",value:function(){return this.elements.mainContainer}},{key:"refreshOnBfCacheNavigation",value:function(){Object.assign(this.elements,this.readHtmlElementsFromDom()),this.attachEventListeners(),this.loadTranslations(),this.cacheManager.restoreThreadContext()}},{key:"loadTranslations",value:function(){var e=this;Kc(document.documentElement.lang).then(function(t){e.currentGeneratingMessage=t.getMessage("currently_generating_a_response"),e.completedGeneratingMessage=t.getMessage("completed_generating_a_response")}).catch(function(e){S.logErrorWithLevelWithException(R.ERROR,e,"Failed to load accessibility translations for Rufus generation status messages")})}},{key:"readHtmlElementsFromDom",value:function(){var e={container:this.missingElementsRecorder.getElementOrRecordMissing(L),mainContainer:this.missingElementsRecorder.getElementOrRecordMissing("rufus-container-main-view"),containerInner:this.missingElementsRecorder.getElementOrRecordMissing("rufus-conversation-container-inner"),activeConversationContainer:this.missingElementsRecorder.getElementOrRecordMissing(M),historyContainer:this.missingElementsRecorder.getElementOrRecordMissing(w),rufusFlyoutDiv:this.missingElementsRecorder.getElementOrRecordMissing(q),overflowMenu:this.missingElementsRecorder.getElementOrRecordMissing(Re),loadMoreHistoryButton:document.getElementById("rufus-load-more-history-button"),beginningOfHistoryContainer:document.getElementById("rufus-history-beginning-container"),loader:document.getElementById(N),loaderAvatar:document.getElementById(k),rufusPanelContent:document.getElementById(K),spinnerContainer:document.getElementById(W),papyrusReactContainer:document.getElementById($e)};return this.missingElementsRecorder.logMissingElementsAndThrowError(),e}},{key:"attachEventListeners",value:function(){var e;null===(e=this.elements.loadMoreHistoryButton)||void 0===e||e.addEventListener("click",this.handleLoadMoreHistoryButtonClick),th.addListeners(this.elements.activeConversationContainer),function(){var e=document.getElementById(q),t=document.getElementById($);if(e&&t){var n=function(e,t){e.preventDefault(),t.focus()};e.addEventListener("keydown",function(r){if("Escape"!==r.key){if("Tab"===r.key){var i=Array.from(e.querySelectorAll("button:not(.aok-hidden):not([disabled]), textarea, a[href]")).filter(function(e){return null!==e.offsetParent});if(0!==i.length){var a=i[0],o=i[i.length-1];r.shiftKey&&document.activeElement===a?n(r,o):r.shiftKey||document.activeElement!==o||n(r,a)}}}else t.click()})}}()}},{key:"modifyPapyrusContent",value:function(e,t,n){if(void 0!==t){switch(e){case Eh.PrependHistory:this.handlePrependPapyrusHistory(t,!!n);break;case Eh.ReplaceHistory:case Eh.ReplaceActive:yl().getState().setTurns(t),this.dispatch("completeReplacingContentInContainer",void 0);break;case Eh.ReplaceInterruptedConversationPapyrus:this.handleReplaceInterruptedConversationPapyrus(t)}this.updatePapyrusReactStateAndHTMLCache()}}},{key:"modifyContent",value:function(e,t,n){if(this.validateContentForOperation(e,t)){switch(e){case Eh.AppendInner:void 0!==t&&this.handleAppendInner(t);break;case Eh.PrependHistory:this.handlePrependHistory(t,!!n);break;case Eh.AppendActive:this.handleAppendActive(t);break;case Eh.ReplaceHistory:case Eh.ReplaceActive:this.replaceContentInContainer(t,e);break;case Eh.InsertIntoLastActiveTurn:this.handleInsertIntoLastActiveTurn(t);break;case Eh.RemoveLastActiveTurn:var r;null===(r=this.elements.activeConversationContainer.lastElementChild)||void 0===r||r.remove();break;case Eh.ReplaceInterruptedConversation:this.handleReplaceInterruptedConversation(t)}this.updateCache()}}},{key:"moveInterruptionRecoveryContainerToConversation",value:function(e){var t=this,n=function(){return t.dispatch("lastActiveTurnContentUpdated",void 0)};this.isMixedRenderingEnabled?this.interruptionRecoveryHandler.moveInterruptionRecoveryToInnerContainer(e,n,this.isTopContentAnchoringEnabled):this.interruptionRecoveryHandler.moveInterruptionRecoveryContainerToConversation(e,n)}},{key:"toggleLoadMoreHistoryButtonElementVisibility",value:function(e){var t,n;e&&(S.addCount(p.RUFUS_HISTORY_BUTTON_SHOWN,1),this.isMixedRenderingEnabled||null===(n=this.getPapyrusFtux())||void 0===n||n.remove()),null===(t=this.elements.loadMoreHistoryButton)||void 0===t||null===(t=t.parentElement)||void 0===t||t.classList.toggle("aok-hidden",!e)}},{key:"toggleBeginningOfHistoryElementVisibility",value:function(e){var t;e&&S.addCount(p.RUFUS_BEGINNING_HISTORY_SHOWN,1),null===(t=this.elements.beginningOfHistoryContainer)||void 0===t||t.classList.toggle("aok-hidden",!e)}},{key:"isFtuxOrRuxOnScreen",value:function(){var e=Array.from(this.elements.activeConversationContainer.getElementsByClassName(F)),t=Array.from(this.elements.historyContainer.getElementsByClassName(F));return e.length>0&&(e[0].classList.contains(H)||e[0].classList.contains(st))&&0===t.length}},{key:"getActiveConversationContainerContent",value:function(){return this.elements.activeConversationContainer.innerHTML}},{key:"getPapyrusFtux",value:function(){var e;return null!==(e=this.elements)&&void 0!==e&&e.papyrusReactContainer?this.elements.papyrusReactContainer.querySelector('[data-csa-c-group-id^="'.concat(nt,'"]')):null}},{key:"getHistoryContainerContent",value:function(){return this.elements.historyContainer.innerHTML}},{key:"createNewStreamContainer",value:function(e,t){this.handleInitialStream(!!e);var n=this.createAndAppendContainer(!!e);t&&(t===rn.SEARCH||t===rn.ASIN_CLICK)&&e&&n.classList.add(B),this.elements.container.focus()}},{key:"removeTemporarySections",value:function(){var e;((e=this.elements.container)?Array.from(e.getElementsByClassName(x)):[]).forEach(function(e){var t;null===(t=e.parentElement)||void 0===t||t.removeChild(e),yl().getState().removeTurnsByGroupId(e.id)}),this.updatePapyrusReactStateAndHTMLCache()}},{key:"getRemovableSectionsFromLatestActiveTurn",value:function(){var e,t;return Array.from(null!==(e=null===(t=this.elements.activeConversationContainer.lastElementChild)||void 0===t?void 0:t.getElementsByClassName(x))&&void 0!==e?e:[])}},{key:"startTopLoading",value:function(){this.isTopLoading||(this.elements.container.insertBefore(this.elements.spinnerContainer,this.elements.container.firstChild),this.toggleLoadMoreHistorySpinnerElementVisibility(!0),this.isTopLoading=!0)}},{key:"endTopLoading",value:function(){this.isTopLoading&&(this.toggleLoadMoreHistorySpinnerElementVisibility(!1),this.isTopLoading=!1)}},{key:"toggleLoaderAndUpdateAnnouncer",value:function(e){var t=document.getElementById("rufus-status-announcer");if(this.isTopContentAnchoringEnabled)switch(this.elements.loader.classList.add("aok-hidden"),this.elements.loaderAvatar.classList.add("rufus-visibility-hidden"),e){case mh.VisibleWithAvatar:case mh.VisibleWithoutAvatar:t&&(t.textContent=this.currentGeneratingMessage);break;case mh.Hidden:t&&(t.textContent=this.completedGeneratingMessage);break;case mh.HiddenBeforeComplete:t&&t.textContent!==this.currentGeneratingMessage&&(t.textContent=this.currentGeneratingMessage)}else switch(e){case mh.VisibleWithAvatar:this.elements.loader.classList.remove("aok-hidden"),this.elements.loaderAvatar.classList.remove("rufus-visibility-hidden"),t&&(t.textContent=this.currentGeneratingMessage);break;case mh.VisibleWithoutAvatar:this.elements.loader.classList.remove("aok-hidden"),this.elements.loaderAvatar.classList.add("rufus-visibility-hidden"),t&&t.textContent!==this.currentGeneratingMessage&&(t.textContent=this.currentGeneratingMessage);break;case mh.HiddenBeforeComplete:this.elements.loader.classList.add("aok-hidden"),this.elements.loaderAvatar.classList.add("rufus-visibility-hidden"),t&&t.textContent!==this.currentGeneratingMessage&&(t.textContent=this.currentGeneratingMessage);break;case mh.Hidden:this.elements.loader.classList.add("aok-hidden"),this.elements.loaderAvatar.classList.add("rufus-visibility-hidden"),t&&(t.textContent=this.completedGeneratingMessage)}}},{key:"updateHtmlSections",value:function(e){var t=this,n=e.event,r=e.streamingStatusDetails,i=e.streamingEventType;if(n.data&&""!==n.data){var a=this.prepareNewHtmlContent(n.data);th.addListeners(a),this.refreshTruncation();var o=this.getSectionGroupIdsFromSection(a);if(0!==o.length){var s=o.length-1;o.forEach(function(e,o){t.processSection(a,e,o,s,r,n,i)})}else this.handleNoSectionGroups(n.data)}}},{key:"updateHtmlSectionsV2",value:function(e){var t=this,n=e.event,r=e.streamingStatusDetails,i=e.streamingEventType,a=e.chunkTypeToLatencyDataMap;if(n.data&&""!==n.data){var o=this.asinFaceoutState,s=o.expectAsinFaceoutChunkNext,u=o.faceoutAction;if(s&&u)this.handleASINFaceoutUpdate(n,r,i);else{var c=rh.parseEventData(n),l=null==c?void 0:c.sections,d=null==l?void 0:l.map(function(e){return e.target.groupId}).filter(function(e){return!!e}),h=d?d.length-1:void 0;this.refreshTruncation(),null==l||l.forEach(function(e,o){if(e.target.type!==lt||s){var u=e.target.groupId;if(u){var c=t.prepareNewHtmlContent(e.content.data);th.addListeners(c),t.processSectionV2(c,u,o,h,r,n,e.action,i,a)}else t.handleNoSectionGroups(e.content.data)}else t.asinFaceoutState={expectAsinFaceoutChunkNext:!0,faceoutAction:e.action}})}}}},{key:"removeHtml",value:function(e,t){var n=this;"Section"===e&&(this.animationUtil.enqueueAnimation(function(){S.addCount(p.SECTION_REMOVED,1),Jt(_.REMOVE_SECTION),n.removeSection(t),n.streamingLifecycleEventLogger.recordPatchRenderEnd(Date.now());var e=document.getElementById("section_groupId_"+t);return n.isInterimLoadingMessage(e)&&e?e:void 0}),this.animationUtil.enqueueAnimation(function(){S.addCount(p.BULLET_POINT_VERTICAL_COLLAPSE,1),Jt(_.BULLET_POINT_VERTICAL_COLLAPSE);var e=document.getElementById("section_groupId_"+t);return n.handleBulletPointAnimation(e)}))}},{key:"removeSection",value:function(e){if(e){var t,n=document.getElementById("section_groupId_"+e),r=this.shouldHandleAvatarOnRemovedSection(n);this.isInterimLoadingMessage(n)?this.animateRemovalOfInterimLoadingMessage(n):null==n||null===(t=n.parentElement)||void 0===t||t.removeChild(n),r&&this.handleRemovedSectionHadAvatar()}}},{key:"animateRemovalOfInterimLoadingMessage",value:function(e){var t=this;if(e){var n=e.getElementsByClassName("rufus-text-wrap"),r=setTimeout(function(){var n;null===(n=e.parentElement)||void 0===n||n.removeChild(e),t.handleRemovedSectionHadAvatar()},500);if(1===n.length)this.handleTextWrapAnimation(e,n.length,r);else for(var i=0;i<n.length;i++){var a=n[i];this.handleTextWrapAnimation(a,n.length,r)}}}},{key:"handleTextWrapAnimation",value:function(e,t,n){var r=this,i=function(a){a.target===e&&(e.removeEventListener("animationend",i),1===t&&setTimeout(function(){r.removeElementAndHandleAvatar(e)},100),clearTimeout(n))};if(t>1){var a=e.getBoundingClientRect().height;e.style.minHeight="".concat(a,"px")}setTimeout(function(){e.removeEventListener("animationend",i),clearTimeout(n)},500),e.addEventListener("animationend",i),e.classList.add("rufus-loading-message-fade-out")}},{key:"handleBulletPointAnimation",value:function(e){var t=this;if(e){var n=setTimeout(function(){var n;null===(n=e.parentElement)||void 0===n||n.removeChild(e),t.handleRemovedSectionHadAvatar()},600),r=e.getElementsByClassName("ellipse-pulse");if(r.length>1){for(var i=r.length-1,a=r[i],o=function(){var e=r[s];setTimeout(function(){e.style.opacity="0",e.style.transition="opacity 10ms ease"},150*(i-s))},s=r.length-2;s>=0;s--)o();var u=r[0].getBoundingClientRect().top,c=a.getBoundingClientRect().top,l=function(r){r.target===a&&(a.removeEventListener("animationend",l),setTimeout(function(){t.removeElementAndHandleAvatar(e),clearTimeout(n)},100))};return a.addEventListener("animationend",l),a.classList.add("ellipse-vertical-collapse"),a.style.setProperty("--y-position","-".concat(c-u,"px")),a.style.setProperty("--animation-duration","".concat(150*i,"ms")),a}}}},{key:"removeElementAndHandleAvatar",value:function(e){var t;null===(t=e.parentElement)||void 0===t||t.removeChild(e),this.handleRemovedSectionHadAvatar()}},{key:"isInterimLoadingMessage",value:function(e){return null!=(null==e?void 0:e.querySelector(".rufus-loading-message-template"))}},{key:"shouldHandleAvatarOnRemovedSection",value:function(e){return null!=(null==e?void 0:e.querySelector(".rufus-avatar-img"))&&!this.isInterimLoadingMessage(e)}},{key:"handleRemovedSectionHadAvatar",value:function(){this.toggleLoaderAndUpdateAnnouncer(mh.VisibleWithAvatar)}},{key:"refreshTruncation",value:function(){P.when("a-truncate").execute(function(e){e.refreshAutoTruncate()})}},{key:"appendOverlayToSnapshot",value:function(e){var t=this.elements.rufusFlyoutDiv.cloneNode(!0).querySelector("#".concat(te));null!=t&&(yl().getState().clearChatHistoryConversation(),t.classList.add("aok-hidden"),t.classList.remove("overlay-slide-in"),e.appendChild(t))}},{key:"clearPapyrusReactContentFromPanelSnapshot",value:function(e){var t=e.querySelector("#".concat($e));if(t){var n=t.querySelector("#".concat(et));if(n){var r=n.querySelector('[data-csa-c-group-id^="'.concat(nt,'"]'));if(r){var i=r.querySelector("#animatedComponent");i&&i.removeAttribute("style"),t.prepend(r)}n.innerHTML=""}}}},{key:"clearExcessPapyrusReactContentFromPanelSnapshot",value:function(e){var t=e.querySelector("#".concat($e));if(t){var n=t.querySelector("#".concat(et));n&&(n.querySelectorAll(".rufus-html-turn-contextual-pills").forEach(function(e){return e.remove()}),this.isTopContentAnchoringEnabled?(n.querySelectorAll(".".concat(Dt,", .").concat(Mt)).forEach(function(e){Array.from(e.children).some(function(e){var t,n=null===(t=e.textContent)||void 0===t?void 0:t.trim();return n&&n.length>0})||e.remove()}),function(e){var t=e.querySelectorAll(".".concat(Dt,", .").concat(Mt));if(!(t.length<=5))for(var n=t[t.length-5],r=0,i=Array.from(e.children);r<i.length;r++){var a=i[r];if(a===n)break;a.remove()}}(n),function(e){if(!(e.querySelectorAll(".".concat(Mt)).length>0)){var t=e.querySelectorAll(".".concat(Dt));0!==t.length&&t[t.length-1].classList.replace(Dt,Mt)}}(n)):this.limitHtmlTurnGroups(n,5))}}},{key:"getPanelContentSnapshot",value:function(){var e=this,t=this.elements.rufusPanelContent.cloneNode(!0);t.querySelector("#".concat(te))||this.appendOverlayToSnapshot(t);var n=t.querySelector("#".concat(N));this.isPapyrusCachingEnabled?(this.cacheManager.cacheRNWStyles(),this.clearExcessPapyrusReactContentFromPanelSnapshot(t)):this.clearPapyrusReactContentFromPanelSnapshot(t);var r=t.querySelector("#".concat(W)),i=t.querySelector("#".concat(M)),a=t.querySelector("#".concat(w)),o=t.querySelector("#".concat(L)),s=t.querySelector("#".concat(D)),u=t.querySelector("#".concat(Te)),c=t.querySelector(".".concat(Ct)),l=t.querySelector(".".concat(St));o.style.removeProperty("scroll-behavior"),this.handleAsinFilterPillSnapshot(c,l),this.purgeExcessConversations(i,a);var d=Array.from(a.children);i.prepend.apply(i,d);var h=function(t){var n=o.querySelector("#".concat(t));if(n){var r=e.sectionIdToScriptSectionsMap[t],i=r.getAttribute(Ue)||void 0,a=i===lt?n.cloneNode(!0):r;document.querySelectorAll("body > script").forEach(function(e){e.text&&e.text.includes("//".concat(t))&&a.appendChild(e)}),i===ct&&Wd.removeDataMixClaimedAttribute(a),n.replaceWith(a)}};for(var f in this.sectionIdToScriptSectionsMap)h(f);return n&&n.classList.add("aok-hidden"),r&&r.classList.add("aok-hidden"),s&&(s.style.display="none"),u&&(u.innerHTML=this.elements.overflowMenu.innerHTML),jd(t),t}},{key:"updateInnerContainerHeight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.elements.containerInner.getBoundingClientRect().height,n=this.elements.rufusFlyoutDiv.style.getPropertyValue("--expanded-container-height"),r=n?parseInt(n)-96:0;(e||(t>r||""===this.elements.historyContainer.innerHTML.trim())&&t!==r)&&(this.elements.containerInner.style.height="".concat(r,"px"))}},{key:"toggleLoadMoreHistorySpinnerElementVisibility",value:function(e){var t;null===(t=this.elements.spinnerContainer)||void 0===t||t.classList.toggle("aok-hidden",!e)}},{key:"getNumberOfConversationTurns",value:function(){if(!this.areContainersValid())return 0;var e=this.getTurnsFromContainers(),t=e.activeTurns,n=e.historyTurns,r=t.length>0&&t[0].classList.contains(H)&&0===n.length;return 1===t.length&&(0===n.length||1===n.length&&n[0].classList.contains(H))||r?0:this.calculateTotalTurns(t,n)}},{key:"markLastTurnAnimationComplete",value:function(){var e;null===(e=this.elements.activeConversationContainer.lastElementChild)||void 0===e||e.classList.add(it)}},{key:"isLastTurnAnimationComplete",value:function(){var e;return(null===(e=this.elements.activeConversationContainer.lastElementChild)||void 0===e?void 0:e.classList.contains(it))||!1}},{key:"isLastTurnContentEmpty",value:function(){var e;return""===(null===(e=this.elements.activeConversationContainer.lastElementChild)||void 0===e?void 0:e.innerHTML)}},{key:"isFtuxPresent",value:function(){var e=document.querySelector(Ne);return(null==e?void 0:e.getAttribute(Ue))===st}},{key:"isAffordancePresentInContainer",value:function(){var e,t=(null===(e=this.elements.activeConversationContainer.lastElementChild)||void 0===e?void 0:e.children)||[];return Array.from(t).some(function(e){return e.getAttribute(Ue)===ut})}},{key:"isCustomerTextPresent",value:function(){return yl().getState().getAllTurns().some(function(e){return e.type===b.HTML_CONTENT_TURN_START})}},{key:"limitHtmlTurnGroups",value:function(e,t){var n=e.querySelectorAll(".rufus-html-turn-start");if(!(n.length<=t))for(var r=n[n.length-t],i=0,a=Array.from(e.children);i<a.length;i++){var o=a[i];if(o===r)break;o.remove()}}},{key:"purgeExcessConversations",value:function(e,t){var n;ln(e),ln(t),n=e,Array.from(n.children).forEach(function(e){var t;e.classList.contains(B)&&null!==(t=e.lastElementChild)&&void 0!==t&&t.classList.contains(x)&&n.removeChild(e)}),cn(e,5),cn(t,5-e.children.length),e.children.length+t.children.length>=5&&!this.isMixedRenderingEnabled&&this.clearPapyrusReactCache()}},{key:"clearPapyrusReactCache",value:function(){this.isTopContentAnchoringEnabled&&"getInteractions"in yl().getState()?this.cacheManager.setReactStatePanelInteractionContent([]):this.cacheManager.setReactStatePanelContent([])}},{key:"clearPapyrusReactCXAndCache",value:function(){yl().getState().clearConversation(),this.clearPapyrusReactCache()}},{key:"processTurnForCache",value:function(e){if(e.type&&Nl(e.type)&&"string"==typeof e.content){var t=(n=e.content,(new DOMParser).parseFromString(n,"text/html").body.firstElementChild);if(t)return jd(t),vh(vh({},e),{},{content:t.outerHTML})}var n;return e}},{key:"updatePapyrusReactStateAndHTMLCache",value:function(){var e=this,t=yl().getState();if(this.isTopContentAnchoringEnabled&&"getInteractions"in t){var n=t.getInteractions().map(function(t){return vh(vh({},t),{},{turns:t.turns.filter(function(e){return!e.type||!(e.type===b.HTML_CONTENT_CONTEXTUAL_PILLS||e.type===b.HTML_CONTENT_INTERRUPTION_RECOVERY)}).map(function(t){return e.processTurnForCache(t)})})});return this.cacheManager.setReactStatePanelInteractionContent(n),void this.updateCache()}var r=yl().getState().getAllTurns().filter(function(e){return!e.type||!(e.type===b.HTML_CONTENT_CONTEXTUAL_PILLS||e.type===b.HTML_CONTENT_INTERRUPTION_RECOVERY)});this.cacheManager.setReactStatePanelContent(r),this.updateCache()}},{key:"moveActiveConversationTurnsToHistory",value:function(){var e=this;Array.from(this.elements.activeConversationContainer.children).forEach(function(t){return e.elements.historyContainer.append(t)}),this.elements.activeConversationContainer.innerHTML="",this.dispatch("completeMovingActiveConversationTurnsToHistory",void 0)}},{key:"handleHidingLoaderAvatar",value:function(e,t){var n=e!==Md.AFFORDANCE,r="LoadingMessageTemplate"!==t;!this.elements.loaderAvatar.classList.contains("rufus-visibility-hidden")&&n&&this.toggleLoaderAndUpdateAnnouncer(r?mh.VisibleWithoutAvatar:mh.HiddenBeforeComplete)}},{key:"appendSvgChartToContainer",value:function(e){var t=e.getElementsByClassName("rufus-pricing-chart-container");if(0!==t.length){var n;if(this.isMixedRenderingEnabled&&null!==(n=hl("rufus-pricing-chart-observer-registered"))&&void 0!==n&&n)return;P.now("pricing-chart-client").execute(function(e){void 0!==e?Array.from(t).forEach(function(t){var n=t.dataset.pricingChartJson,r=t.dataset.pricingWindowsEnabled;if(n&&r){var i;if("true"===r){var a=t.dataset.pricingDefaultWindowIndex;i=e.rebuildData(Number(a),JSON.parse(n))}else i=JSON.parse(n);var o=e.renderChart(i);o||S.addCount(p.RUFUS_PRICING_RENDERING_ERROR,1),t.innerHTML=o}else S.addCount(p.RUFUS_PRICING_INVALID_DATA,1)}):S.addCount(p.RUFUS_PRICING_CLIENT_NOT_LOADED,1)})}}},{key:"areContainersValid",value:function(){return this.elements.activeConversationContainer?!!this.elements.historyContainer||(S.addCount(p.RUFUS_HISTORY_CONTAINER_IN_HISTORY_NULL,1),!1):(S.addCount(p.RUFUS_ACTIVE_CONVERSATION_CONTAINER_IN_HISTORY_NULL,1),!1)}},{key:"getTurnsFromContainers",value:function(){return{activeTurns:Array.from(this.elements.activeConversationContainer.getElementsByClassName(F)),historyTurns:Array.from(this.elements.historyContainer.getElementsByClassName(F))}}},{key:"calculateTotalTurns",value:function(e,t){var n=0;return e.forEach(function(e){var t=e.classList.contains(H);""!==e.innerHTML.trim()&&(e.hasChildNodes()||t)||e.remove(),n+=t?0:1}),t.forEach(function(e){n++,""!==e.innerHTML.trim()&&e.hasChildNodes()||e.remove()}),n}},{key:"handleInitialStream",value:function(e){e&&(this.removeFTUXIfNoInteraction(),this.moveActiveConversationTurnsToHistory())}},{key:"removeFTUXIfNoInteraction",value:function(){var e,t=this.elements.activeConversationContainer.lastElementChild;this.shouldDedupeFTUX(t)&&(null==t||null===(e=t.parentElement)||void 0===e||e.removeChild(t))}},{key:"shouldDedupeFTUX",value:function(e){var t,n;if(null==e||!e.classList.contains(H))return!1;var r=null==e||null===(t=e.firstElementChild)||void 0===t?void 0:t.getAttribute(Ue),i=null==e||null===(n=e.children)||void 0===n||null===(n=n[1])||void 0===n?void 0:n.getAttribute(Ue);return r===st&&i!==ut}},{key:"createAndAppendContainer",value:function(e){var t=document.createElement("div");return t.classList.add(F),e&&t.classList.add(H),this.elements.activeConversationContainer.append(t),this.elements.currentStreamContainer=t,t}},{key:"prepareNewHtmlContent",value:function(e){var t=document.createElement("div");return t.innerHTML=this.fixUnsupportedSymbols(e),t}},{key:"handleNoSectionGroups",value:function(e){this.modifyContent(Eh.AppendActive,e),S.addCount(p.RUFUS_SECTION_WITHOUT_GROUP_SECTION_ID,1)}},{key:"processSection",value:function(e,t,n,r,i,a,o){var s=this;this.animationUtil.enqueueAnimation(function(){var u=s.getSectionGroupIdsFromSection(s.elements.activeConversationContainer).includes(t)?s.updateExistingSection(e,t):s.addNewSection(e,t,i,o);return s.streamingLifecycleEventLogger.recordSectionRenderEnd(a,i,n,n===r),u})}},{key:"processSectionV2",value:function(e,t,n,r,i,a,o,s,u){var c=this;this.animationUtil.enqueueAnimation(function(){var l;"ADD"===o?l=c.addNewSection(e,t,i,s):"REPLACE"===o&&(l=c.updateExistingSection(e,t));var d=c.streamingLifecycleEventLogger.recordSectionRenderEnd(a,i,n,n===r);return dl.getInstance().isWeblabTreatmentEnabledAndRecordTrigger("RUFUS_LATENCY_METRICS_DISPLAY_1295028")&&null!=d&&d.eachSectionLatencyData&&d.requestStartTime&&c.animationUtil.enqueueAnimation(function(){var e=d.eachSectionLatencyData,n=d.requestStartTime,r=d.generationModelMetadata;if(n){var a="";a+="\n                                <tr>\n                                    <td>Model Agent Name</td>\n                                    <td>".concat(null==r?void 0:r.agentName,"</td>\n                                </tr>\n                            "),null==u||u.forEach(function(e,t){a+="\n                                <tr>\n                                    <td>First <b>".concat(t,"</b></td>\n                                    <td>").concat(e-n," ms</td>                    \n                                </tr>\n                            ")}),null==e||e.forEach(function(e,t){a+="\n                                <tr>\n                                    <td>Section number: <b>".concat(t,"</b> &<br/> type: <b>").concat(e.sectionType,"</b></td>\n                                    <td>\n                                        <div><b>Rendering Complete:</b> ").concat(e.renderingTimestamps[0]-n," ms</div>\n                                    </td>                    \n                                </tr>\n                            ")});var o="".concat(t,"metrics"),s='\n                            <table id="'.concat(o,'">\n                                ').concat(a,"\n                            </table>\n                        "),l=document.createElement("div");return l.innerHTML=c.fixUnsupportedSymbols(s),c.addNewSection(l,o,i)}}),l})}},{key:"updateExistingSection",value:function(e,t){var n=this.selectSectionWithId(this.elements.activeConversationContainer,t),r=this.selectSectionWithId(e,t);return n&&r?this.replaceStreamingElement(n,r):void 0}},{key:"addNewSection",value:function(e,t,n,r){var i,a=e.querySelector("#".concat(t));return a?this.appendElementToContainer(a,n.isInitialStream,r,null===(i=n.requestContext)||void 0===i||null===(i=i.queryContext)||void 0===i?void 0:i.qis):void 0}},{key:"validateContentForOperation",value:function(e,t){var n=[Eh.AppendActive,Eh.PrependHistory,Eh.InsertIntoLastActiveTurn,Eh.AppendInner];return!(!t&&n.includes(e))}},{key:"handlePrependPapyrusHistory",value:function(e,t){var n=this;this.elements.container.style.removeProperty("scroll-behavior");var r=this.elements.container.scrollHeight;this.papyrusHistoryHandler.handlePrependHistory(e,t),requestAnimationFrame(function(){n.updateScrollAfterPrepend(r)})}},{key:"handlePrependHistory",value:function(e,t){var n=this;this.elements.container.style.removeProperty("scroll-behavior");var r=this.elements.container.scrollHeight,i=this.createTempDiv(e);t&&this.removeActiveConversationTurnsFromHistory(i),Zd(i),this.appendSvgChartToContainer(i),nh(i,function(){n.prependContentAndUpdateScroll(i,r)})}},{key:"prependContentAndUpdateScroll",value:function(e,t){var n;uh(e),(n=this.elements.historyContainer).prepend.apply(n,O(e.children)),th.addListeners(this.elements.historyContainer),this.updateScrollAfterPrepend(t)}},{key:"updateScrollAfterPrepend",value:function(e){this.endTopLoading();var t=this.elements.container.scrollHeight-e;this.elements.container.scrollTop=this.elements.container.scrollTop+t,this.elements.container.style.scrollBehavior="smooth"}},{key:"createTempDiv",value:function(e){var t=document.createElement("div");return t.innerHTML=e,t}},{key:"handleReplaceInterruptedConversation",value:function(e){var t=this.interruptionRecoveryHandler.getInterruptionRecoveryContainer().parentElement;if(null!=t&&t.classList.contains(F)){this.interruptionRecoveryHandler.moveInterruptionRecoveryContainerOutOfConversation(this.isTopContentAnchoringEnabled);var n=this.createTempDiv(e);Zd(n),this.appendSvgChartToContainer(n),t.outerHTML=n.innerHTML,th.addListeners(this.elements.activeConversationContainer)}}},{key:"handleReplaceInterruptedConversationPapyrus",value:function(e){var t=this,n=yl().getState().findInterruptedConversationGroupId(ht);if(!n)return S.logErrorWithLevel(R.ERROR,"ConversationList - Failed to find interrupted conversation groupId for recovery"),void this.interruptionRecoveryHandler.moveInterruptionRecoveryContainerOutOfConversation(this.isTopContentAnchoringEnabled);yl().getState().replaceTurnsByGroupId(n,e),this.isTopContentAnchoringEnabled?setTimeout(function(){t.interruptionRecoveryHandler.moveInterruptionRecoveryContainerOutOfConversation(t.isTopContentAnchoringEnabled)},0):this.interruptionRecoveryHandler.moveInterruptionRecoveryContainerOutOfConversation(this.isTopContentAnchoringEnabled)}},{key:"handleAppendInner",value:function(e){var t,n=this.createTempDiv(e);(t=this.elements.containerInner).append.apply(t,O(n.children))}},{key:"handleAppendActive",value:function(e){var t,n=this.createTempDiv(e);(t=this.elements.activeConversationContainer).append.apply(t,O(n.children)),th.addListeners(this.elements.activeConversationContainer)}},{key:"handleInsertIntoLastActiveTurn",value:function(e){if(this.elements.activeConversationContainer.children.length>0){var t,n=this.createTempDiv(e);null===(t=this.elements.activeConversationContainer.lastElementChild)||void 0===t||t.append.apply(t,O(n.children)),th.addListeners(this.elements.activeConversationContainer.lastElementChild),this.dispatch("lastActiveTurnContentUpdated",void 0)}}},{key:"handleASINFaceoutUpdate",value:function(e,t,n){var r=this,i=this.prepareNewHtmlContent(e.data);th.addListeners(i),this.refreshTruncation();var a=this.getSectionGroupIdsFromSection(i);if(0!==a.length){var o=a.length-1;a.forEach(function(a,s){r.processSectionV2(i,a,s,o,t,e,r.asinFaceoutState.faceoutAction,n)}),this.asinFaceoutState={expectAsinFaceoutChunkNext:!1,faceoutAction:void 0}}else this.handleNoSectionGroups(e.data)}},{key:"handleAsinFilterPillSnapshot",value:function(e,t){if(e&&t){e.classList.remove("rufus-asin-filter-pill-show","rufus-asin-filter-pill-hide"),e.classList.add("aok-hidden"),e.removeAttribute("aria-label");var n=e.querySelector("#rufus-asin-filter-pill-content"),r=e.querySelector("#rufus-asin-filter-pill-preview-image"),i=e.querySelector(".rufus-asin-filter-pill-title");n&&(n.href=""),r&&(r.src=""),i&&(i.textContent=""),t.classList.remove("rufus-asin-filter-shade-show","rufus-asin-filter-shade-hide")}}},{key:"shouldAddRemoveSectionClass",value:function(e,t,n,r){return(e||t===sn.NILE_ASIN_INGRESS)&&!0===n&&r!==st}}])}(In),_h=function(){return c(function e(t){l(this,e),this.A=t,this.registerEventHandlers()},[{key:"registerEventHandlers",value:function(){var e=this;this.A.declarative("expandable-pills-toggle-action","click",function(t){return e.handleToggleClick(t)}),document.addEventListener("click",function(e){var t=e.target.closest(".rufus-expandable-pills-item");if(t){var n=t.getAttribute("data-pill-variant"),r=t.getAttribute("data-pill-url");"sourceButton"===n&&r&&S.addCount(p.EXPANDABLE_PILLS_WEB_SEARCH_PILL_CLICK,1)}})}},{key:"handleToggleClick",value:function(e){var t,n=e.$target.get(0).closest(".rufus-expandable-pills-toggle");if(n){var r=n.closest(".rufus-expandable-pills"),i=null==r?void 0:r.querySelector(".rufus-expandable-pills-content"),a=n.querySelector(".rufus-expandable-pills-chevron");if(r&&i&&a){var o=!("true"===r.getAttribute("data-expanded"));r.setAttribute("data-expanded",o.toString()),n.setAttribute("aria-expanded",o.toString()),o?(i.classList.remove("collapsed"),i.classList.add("expanded"),a.classList.add("expanded")):(i.classList.remove("expanded"),i.classList.add("collapsed"),a.classList.remove("expanded"));var s=(null===(t=r.querySelector(".rufus-expandable-pills-label"))||void 0===t?void 0:t.textContent)||"";n.setAttribute("aria-label","".concat(o?"Collapse":"Expand"," ").concat(s)),S.addCount(p.EXPANDABLE_PILLS_TOGGLE_CLICK,1)}}}}])}(),yh=function(){return c(function e(){l(this,e)},null,[{key:"buildPayload",value:function(e,t,n,r,i,a,o,s,u,c){return{feedbackType:t,conversationId:n+r,turnRequestId:i,gmtTime:a,detailFeedback:o,freeformFeedback:s,mainFeedback:u,turnSessionId:c,pageContext:this.buildFeedbackPageContext(e)}}},{key:"buildFeedbackPageContext",value:function(e){var t,n,r=e.getPanelViewContext(),i=mn.getCurrentPageUrl(),a=yn(r.pageType),o=null===(t=(n=mn.metadataParsers)[a])||void 0===t?void 0:t.call(n,i);return{pageType:a,targetPageType:a,originPageType:a,targetUrl:mn.getCurrentPageUrl(),originUrl:i,targetPageMetadata:o,pageMetadata:o,originPageMetadata:o}}}])}();function Ch(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Rh(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Rh=function(){return!!e})()}var Th=function(e){function t(e,n,r){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return l(this,t),i=function(e,t,n){return t=h(t),d(e,Rh()?Reflect.construct(t,[],h(e).constructor):t.apply(e,n))}(this,t),i.A=e,i.contextManager=n,i.panelContainer=r,i.checkedIndices=a,i.numberOfCheckBoxChecked=o,i.registerEventHandlers(),i.shouldUseRufusCommonModule=dl.getInstance().isWeblabTreatmentEnabledAndRecordTrigger(Yl)||dl.getInstance().isWeblabTreatmentEnabledAndRecordTrigger(jl),i}return v(t,e),c(t,[{key:"registerEventHandlers",value:function(){var e=this;this.A.declarative(Xe,"mouseenter",function(){return e.handleThumbsUpMouseEnter()}),this.A.declarative(Xe,"mouseleave",function(){return e.handleThumbsUpMouseLeave()}),this.A.declarative(Xe,"click",function(){return e.handleThumbsUpMouseClick(e.A,e.contextManager)}),this.A.declarative(Ze,"mouseenter",function(){return e.handleThumbsDownMouseEnter()}),this.A.declarative(Ze,"mouseleave",function(){return e.handleThumbsDownMouseLeave()}),this.A.declarative(Ze,"click",function(){return e.handleThumbsDownMouseClick()}),this.A.declarative("rufus-feedback-checkbox-actions","change",function(t){return e.handleCheckboxChange(t)}),this.A.declarative("rufus-dismiss-button-actions","click",function(){return e.handleDismissButtonClick(e.A,e.contextManager)}),this.A.declarative("rufus-submit-feedback-button-actions","click",function(){return e.handleSubmitButtonClick(e.A,e.contextManager)})}},{key:"handleThumbsUpMouseEnter",value:function(){var e=this.getVotingConfig(),t=e.thumbsUpArea,n=e.isThumbsDownClicked,r=e.isThumbsUpClicked;n||r||this.updateThumbImage(t,"https://m.media-amazon.com/images/G/01/Rufus_Desktop/thumbs_up_hover-0c724742-dd32-471c-b488-94227df26330._CB559205155_._SY200_.png")}},{key:"handleThumbsUpMouseLeave",value:function(){var e=this.getVotingConfig(),t=e.thumbsUpArea,n=e.isThumbsDownClicked,r=e.isThumbsUpClicked;n||r||this.updateThumbImage(t,"https://m.media-amazon.com/images/G/01/Rufus_Desktop/thumbs_up-c1ca7881-13d4-4958-8b4c-f97108f6e11d.png")}},{key:"handleThumbsUpMouseClick",value:function(e,n){var r=this.getVotingConfig(),i=r.thumbsUpArea,a=r.thumbsDownArea,o=r.isThumbsUpClicked;if(!r.isThumbsDownClicked&&!o){var s=document.getElementById(je),u=document.getElementById("rufus-thumbs-up-feedback-sent-text");this.updateThumbImage(i,j),this.hideElement(a),this.hideElement(s),this.showElement(u),this.dispatch("onFeedbackSubmitted",void 0),this.sendFeedback(Qe,"THUMBS_UP",t.EMPTY_FEEDBACK.detailFeedback,t.EMPTY_FEEDBACK.freeFormFeedback,e,t.FEEDBACK_SUCCESS_CALLBACK,t.FEEDBACK_FAILURE_CALLBACK,n),Jt(_.MAIN_FEEDBACK_REQUEST,y.THUMBS_UP),S.addCount(p.RUFUS_THUMBSUP_CLICKED,1)}}},{key:"handleThumbsDownMouseEnter",value:function(){var e=this.getVotingConfig(),t=e.thumbsDownArea;e.isThumbsDownClicked||this.updateThumbImage(t,"https://m.media-amazon.com/images/G/01/Rufus_Desktop/thumbs_down_hover-43572115-0a37-4aa3-ad4b-6e031a588612._CB559205155_._SY200_.png")}},{key:"handleThumbsDownMouseLeave",value:function(){var e=this.getVotingConfig(),t=e.thumbsDownArea;e.isThumbsDownClicked||this.updateThumbImage(t,"https://m.media-amazon.com/images/G/01/Rufus_Desktop/thumbs_down-fd26b2f9-143b-468e-9e99-c020f17a6aa0._CB559205155_._SY200_.png")}},{key:"handleThumbsDownMouseClick",value:function(){var e=this.getVotingConfig(),t=e.thumbsDownArea;if(!e.isThumbsDownClicked){var n=document.getElementById(Ye);this.updateThumbImage(t,Y),this.showElement(n),this.scrollIntoViewElementWithId(Ye),Jt(_.MAIN_FEEDBACK_REQUEST,y.THUMBS_DOWN),S.addCount(p.RUFUS_THUMBSDOWN_CLICKED,1)}}},{key:"handleCheckboxChange",value:function(e){var t=e.$target.get(0).name,n=this.getIndexFromCheckboxId(t),r=e.$target.get(0).checked,i=document.getElementById("rufus-text-area-".concat(n)),a=document.getElementById(Ye),o=null==a?void 0:a.querySelector('input[name="rufus-checkbox-'.concat(n,'"]'));r?this.checkedIndices.add(n):this.checkedIndices.delete(n),this.toggleTextAreaDisplay(i),this.toggleSubmitButton(o)}},{key:"handleDismissButtonClick",value:function(e,n){this.showThumbsDownFeedbackSentText(),this.sendFeedback(Qe,Je,t.EMPTY_FEEDBACK.detailFeedback,t.EMPTY_FEEDBACK.freeFormFeedback,e,t.FEEDBACK_SUCCESS_CALLBACK,t.FEEDBACK_FAILURE_CALLBACK,n)}},{key:"handleSubmitButtonClick",value:function(e,n){var r=this.extractFeedbackData(),i=r.detailFeedback,a=r.freeFormFeedback;this.checkedIndices.size>0&&S.addCount(p.RUFUS_FEEDBACK_OPTION_SUBMITTED,1),this.checkedIndices=new Set,this.showThumbsDownFeedbackSentText(),this.sendFeedback("DETAIL_FEEDBACK",Je,i,a,e,function(){S.widgetBodyEnd(g.RUFUS_FEEDBACK_LATENCY,!1),S.addCount(p.RUFUS_FEEDBACK_TEXT_SUBMITTED,1)},t.FEEDBACK_FAILURE_CALLBACK,n),Jt(_.DETAIL_FEEDBACK_REQUEST,y.THUMBS_DOWN)}},{key:"getVotingConfig",value:function(){var e=document.getElementById("rufus-thumbs-down"),t=document.getElementById(ze);return{thumbsUpArea:t,thumbsDownArea:e,isThumbsDownClicked:e&&e.src===Y,isThumbsUpClicked:t&&t.src===j}}},{key:"updateThumbImage",value:function(e,t){e&&(e.src=t)}},{key:"hideElement",value:function(e){null==e||e.classList.add("aok-hidden")}},{key:"showElement",value:function(e){null==e||e.classList.remove("aok-hidden")}},{key:"scrollIntoViewElementWithId",value:function(e){this.dispatch("onThumbsDownClick",e)}},{key:"toggleSubmitButton",value:function(e){e&&e.checked?(0===this.numberOfCheckBoxChecked&&this.enableSubmitButton(),this.numberOfCheckBoxChecked+=1):(1===this.numberOfCheckBoxChecked&&this.disableSubmitButton(),this.numberOfCheckBoxChecked-=1)}},{key:"enableSubmitButton",value:function(){var e=document.getElementById(Ke),t=document.getElementById(qe);e.classList.remove("a-button-disabled"),t.removeAttribute("disabled")}},{key:"disableSubmitButton",value:function(){var e=document.getElementById(Ke),t=document.getElementById(qe);e.classList.add("a-button-disabled"),t.setAttribute("disabled","disabled")}},{key:"getIndexFromCheckboxId",value:function(e){return e.split("-").pop()||""}},{key:"toggleTextAreaDisplay",value:function(e){e&&e.classList.toggle("aok-hidden")}},{key:"extractFeedbackData",value:function(){var e,t=[],n="",r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ch(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ch(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(this.checkedIndices);try{for(r.s();!(e=r.n()).done;){var i=e.value,a=document.getElementsByName("rufus-checkbox-".concat(i)),o=null!=a?a[0]:null;o&&""!=o.value.trim()&&t.push(o.value);var s=document.getElementById("rufus-text-area-inner-".concat(i));s&&(n+=s.value)}}catch(e){r.e(e)}finally{r.f()}return{detailFeedback:t,freeFormFeedback:n}}},{key:"showThumbsDownFeedbackSentText",value:function(){var e,t=document.getElementById(Ye),n=document.getElementById(ze),r=document.getElementById(je),i=document.getElementById("rufus-thumbs-down-feedback-sent-text");this.numberOfCheckBoxChecked=0,t.remove(),null===(e=n.parentElement)||void 0===e||e.remove(),this.hideElement(r),this.showElement(i),this.dispatch("onFeedbackSubmitted",void 0)}},{key:"sendFeedback",value:function(e,t,r,i,a,o,s,u){S.widgetBodyBegin(g.RUFUS_FEEDBACK_LATENCY);var c=Xt(),l=c.uxSessionId,d=c.nileRequestId,h=c.sessionId,f=c.marketplaceId,v=(new Date).toISOString(),p={method:"POST",params:this.shouldUseRufusCommonModule?yh.buildPayload(this.panelContainer,e,l,f,d,v,r,i,t,h):{feedbackType:e,conversationId:l+f,turnRequestId:d,gmtTime:v,detailFeedback:r,freeformFeedback:i,mainFeedback:t,turnSessionId:h,pageContext:u.buildFeedbackPageContext()},paramsFormat:"json",contentType:"application/json",success:o,error:s,headers:n({},Fl.ANTI_CSRF_TOKEN,dn())};a.post("".concat(he,"feedback?tabId=").concat(l,"&ref=").concat(Pe.FEEDBACK),p)}}])}(In);n(Th,"EMPTY_FEEDBACK",{detailFeedback:[],freeFormFeedback:""}),n(Th,"FEEDBACK_SUCCESS_CALLBACK",function(){S.widgetBodyEnd(g.RUFUS_FEEDBACK_LATENCY,!1)}),n(Th,"FEEDBACK_FAILURE_CALLBACK",function(){S.widgetBodyEnd(g.RUFUS_FEEDBACK_LATENCY,!0)});var Sh=function(e){return e.HANDLE_EXPAND="rufus-cl-handle-expand",e.HANDLE_STREAM="rufus-cl-handle-stream",e}({}),Ih=["heroBanner","rufusMarketing"],Ah={heroBanner:{actions:[{name:"HolidayShopRedirect",type:"stream",context:{qis:un.NILE_INGRESS_LINK}},{name:"GetStartedRedirect",type:"stream",context:{qis:un.NILE_INGRESS_LINK}}]},rufusMarketing:{actions:[{name:"DealsRedirect",type:"stream",context:{qis:un.NILE_INGRESS_LINK}},{name:"GiftingRedirect",type:"stream",context:{qis:un.NILE_INGRESS_LINK}},{name:"CategoryRedirect",type:"stream",context:{qis:un.NILE_INGRESS_LINK}}]}},Oh=function(e){var t=new URL(e).searchParams,n=t.get("rufus-action"),r=t.get("rufus-client");if(n||r){var i=function(e,t){if(e&&t&&(n=t,Ih.includes(n)))return function(e,t){return Ah[e].actions.find(function(e){return e.name===t})}(t,e);var n}(n,r);if(i)return{action:n,client:r,query:t.get("rufus-query"),actionConfig:i};var a="rufus-action: ".concat(n," is not defined as an available action for rufus-client: \n     ").concat(r," in the CL_EXTERNAL_CLIENT_CONFIGS");S.logErrorWithLevel(R.ERROR,a)}},bh=function(){var e=Oh(window.location.href),t=null==e?void 0:e.actionConfig;return!(!e||"stream"!==(null==t?void 0:t.type))&&function(e){var t,n=null==e?void 0:e.actionConfig,r=e.client+"_"+e.action,i={query:null!==(t=e.query)&&void 0!==t?t:"",qis:null==n?void 0:n.context.qis,metricName:r};P.when(Sh.HANDLE_STREAM).execute(function(e){e(i)})}(e)},Lh=window.location.hostname,Ph=Lh===we?"Rufus/b?node=121214013011&ref_=nl_cl_dsk_faq":"",Nh=(mn.getUrlByDomain(Lh,Ph),mn.getUrlByDomain(Lh,Ph),mn.getUrlByDomain(Lh,Ph),{OPEN_CHAT_HISTORY:{actions:[{action:"CHAT_HISTORY",payload:void 0}]},OPEN_NEW_CHAT:{actions:[{action:"NEW_CHAT",payload:void 0}]},OPEN_FAQ:{actions:[{action:"GET_STARTED",payload:void 0}]}});function kh(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(kh=function(){return!!e})()}var Uh=function(e){function t(){var e;l(this,t),e=function(e,t,n){return t=h(t),d(e,kh()?Reflect.construct(t,[],h(e).constructor):t.apply(e,n))}(this,t),n(e,"startPositionY",0),n(e,"eventsBound",!1),n(e,"handleAutoMinimizeToggleSwitchStateChange",function(e){P.when("a-switch").execute(function(t){var n=document.getElementById(Se);n?t.getSwitch(n).isOn(e):S.logErrorWithLevel(R.ERROR,"Errors happened when auto-minimize toggle switch state changing, toggle switch was not found")})}),n(e,"initializeAutoMinimizeToggleSwitchEvents",function(){var t=document.getElementById(Se);t?(t.addEventListener("click",function(){S.addCount(p.RUFUS_PANEL_OVERFLOW_MENU_AUTO_MINIMIZE,1),P.when("a-switch").execute(function(e){e.getSwitch(t).isOn()?Jt(_.RUFUS_PANEL_OVERFLOW_MENU,y.AUTO_MINIMIZE_ENABLE):Jt(_.RUFUS_PANEL_OVERFLOW_MENU,y.AUTO_MINIMIZE_DISABLE)})}),P.when("A").execute(function(t){t.on("a:switch:rufus-overflow-menu-auto-minimize-toggle:on",function(){e.dispatch("onAutoMinimizeClick",!0)}),t.on("a:switch:rufus-overflow-menu-auto-minimize-toggle:off",function(){e.dispatch("onAutoMinimizeClick",!1)})})):S.logErrorWithLevel(R.ERROR,"Errors happened when auto-minimize toggle switch initialized, toggle switch was not found")}),n(e,"onOptionClicked",function(t){t.forEach(function(t){switch(t.action){case"CHAT_HISTORY":e.setElementState(e.overflowMenuContainer,"closed"),Jt(_.RUFUS_PANEL_OVERFLOW_MENU,y.CHAT_HISTORY),Jt(_.RUFUS_PANEL_OVERFLOW_MENU,y.OVERFLOW_MENU_CLOSE),S.addCount(p.RUFUS_PANEL_OVERFLOW_MENU_CHAT_HISTORY,1),e.dispatch("onChatHistoryClicked",void 0);break;case"NEW_CHAT":e.setElementState(e.overflowMenuContainer,"closed"),Jt(_.RUFUS_PANEL_OVERFLOW_MENU,y.NEW_CHAT),Jt(_.RUFUS_PANEL_OVERFLOW_MENU,y.OVERFLOW_MENU_CLOSE),S.addCount(p.RUFUS_PANEL_OVERFLOW_MENU_NEW_CHAT,1),e.dispatch("onNewChatClicked",void 0);break;case"GET_STARTED":e.setElementState(e.overflowMenuContainer,"closed"),Jt(_.RUFUS_PANEL_OVERFLOW_MENU,y.GET_STARTED),Jt(_.RUFUS_PANEL_OVERFLOW_MENU,y.OVERFLOW_MENU_CLOSE),S.addCount(p.RUFUS_PANEL_OVERFLOW_MENU_GET_STARTED,1),e.dispatch("onGetStartedClicked",void 0);break;default:S.logErrorWithLevel(R.ERROR,"Unsupported action:"+t.action)}})}),n(e,"overflowButtonClicked",function(t){t.preventDefault();var n="closed"===e.overflowMenuContainer.getAttribute("data-state")?"open":"closed";e.setElementState(e.overflowMenuContainer,n),e.dispatch("onOverflowMenuStateChange",n),Jt(_.RUFUS_PANEL_OVERFLOW_MENU,"closed"===n?y.OVERFLOW_MENU_CLOSE:y.OVERFLOW_MENU_OPEN),e.handleOverflowMenuOutsideClicked(),t.stopPropagation()}),n(e,"setElementState",function(e,t){e.setAttribute("data-state",t)}),n(e,"mousedown",function(t){t.target!==e.overflowButton&&(t.target===e.overflowMenuContainer||e.overflowMenuContainer.contains(t.target)||(e.setElementState(e.overflowMenuContainer,"closed"),e.dispatch("onOverflowMenuStateChange","closed")))}),n(e,"handleOverflowMenuOutsideClicked",function(){"open"===e.overflowMenuContainer.getAttribute("data-state")?document.body.addEventListener("mousedown",e.mousedown):document.body.removeEventListener("mousedown",e.mousedown)}),n(e,"handleMouseenter",function(t){t.preventDefault(),e.startPositionY=t.clientY,e.setElementState(e.overflowMenuContainer,"open"),document.addEventListener("mousemove",e.handleMousemove),Jt(_.RUFUS_PANEL_OVERFLOW_MENU,y.OVERFLOW_MENU_OPEN)}),n(e,"handleMousemove",function(t){var n=t.clientY-e.startPositionY;"open"===e.overflowMenuContainer.getAttribute("data-state")&&n<-5&&(e.setElementState(e.overflowMenuContainer,"closed"),document.removeEventListener("mousemove",e.handleMousemove))});var r=new vd;e.overflowButton=r.getElementOrRecordMissing("rufus-panel-header-overflow-button"),e.overflowChervon=r.getElementOrRecordMissing("rufus-panel-header-overflow"),e.overflowMenuContainer=r.getElementOrRecordMissing(Re),e.overflowMenuInnerOptions=r.getElementOrRecordMissing(Te);var i=r.getMissingElements();if(i.length>0){var a="[OverflowMenu] Errors happened when overflow menu initialized, Rufus element IDs were not found: "+i.join(", ");return S.logErrorWithLevel(R.ERROR,a),d(e)}return e.initialize(),e}return v(t,e),c(t,[{key:"renderOverflowMenu",value:function(){this.overflowMenuContainer.innerHTML=this.overflowMenuInnerOptions.innerHTML,this.overflowMenuInnerOptions.innerHTML="",this.bindOptionActions(),Array.from(this.overflowMenuContainer.querySelectorAll(".overflow-menu-option-container-webapp")).filter(function(e){return"none"!==getComputedStyle(e).display}).forEach(function(e,t){e.setAttribute("data-animation-index",String(t))})}},{key:"initialize",value:function(){this.renderOverflowMenu(),this.overflowButton.addEventListener("click",this.overflowButtonClicked),this.overflowChervon.addEventListener("mouseenter",this.handleMouseenter),this.initializeAutoMinimizeToggleSwitchEvents()}},{key:"bindOptionActions",value:function(){if(!this.eventsBound){this.eventsBound=!0;var e=document.getElementById("rufus-overflow-menu-option-container-chat-history");e&&(e.addEventListener("click",function(e){e.stopPropagation()}),e.addEventListener("click",this.onOptionClicked.bind(this,Nh.OPEN_CHAT_HISTORY.actions)));var t=document.getElementById("rufus-overflow-menu-option-container-new-chat");t&&(t.addEventListener("click",function(e){e.stopPropagation()}),t.addEventListener("click",this.onOptionClicked.bind(this,Nh.OPEN_NEW_CHAT.actions)));var n=document.getElementById("rufus-overflow-menu-option-container-faq");n?(n.addEventListener("click",function(e){e.stopPropagation()}),n.addEventListener("click",this.onOptionClicked.bind(this,Nh.OPEN_FAQ.actions))):S.logErrorWithLevel(R.ERROR,"Errors happened when bind option actions, overflow menu faq option container not found")}}}])}(In);function Dh(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Dh=function(){return!!e})()}var Mh=function(e){function t(){var e;return l(this,t),e=function(e,t,n){return t=h(t),d(e,Dh()?Reflect.construct(t,[],h(e).constructor):t.apply(e,n))}(this,t),n(e,"handleScroll",function(){var t=document.getElementById(ne);t&&t.scrollHeight-t.scrollTop-t.clientHeight<100&&e.dispatch("onScrollNearBottom",void 0)}),e.registerEventHandlers(),e}return v(t,e),c(t,[{key:"registerEventHandlers",value:function(){var e=this,t=document.getElementById("rufus-chat-history-header-goBack-button");t&&t.addEventListener("click",function(){return e.handleGoBackButtonClicked()});var n=document.getElementById("rufus-panel-header-new-chat");n&&n.addEventListener("click",function(){return e.handleNewChatButtonClicked()});var r=document.getElementById(ne);r&&r.addEventListener("scroll",this.handleScroll)}},{key:"handleGoBackButtonClicked",value:function(){S.addCount(p.RUFUS_HISTORY_OVERLAY_GO_BACK,1),Jt(_.RUFUS_THREAD_HISTORY_OVERLAY,y.OVERLAY_CLOSE),this.dispatch("onGoBackClicked",void 0)}},{key:"handleNewChatButtonClicked",value:function(){S.addCount(p.RUFUS_HISTORY_OVERLAY_NEW_CHAT,1),Jt(_.RUFUS_THREAD_HISTORY_OVERLAY,y.NEW_CHAT),this.dispatch("onNewChatClicked",void 0)}}])}(In);function wh(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(wh=function(){return!!e})()}var Fh=function(e){function t(){var e;return l(this,t),e=function(e,t,n){return t=h(t),d(e,wh()?Reflect.construct(t,[],h(e).constructor):t.apply(e,n))}(this,t),e.currentSearchFilterContext=null,e}return v(t,e),c(t,[{key:"setSearchFilterContext",value:function(e){var t;(null===(t=this.currentSearchFilterContext)||void 0===t?void 0:t.asinId)!==(null==e?void 0:e.asinId)&&(this.currentSearchFilterContext&&S.addCount(p.RASIN_CONVERSATION_REFINEMENT_SWAPPED,1),this.currentSearchFilterContext=e,this.dispatch("contextUpdated",this.currentSearchFilterContext),null===e?(Jt(_.CONVERSATION_REFINEMENT_CLEARED,y.ASIN_REFINEMENT),S.addCount(p.RASIN_CONVERSATION_REFINEMENT_CLEARED,1)):(Jt(_.CONVERSATION_REFINEMENT_SET,y.ASIN_REFINEMENT),S.addCount(p.RASIN_CONVERSATION_REFINEMENT_SET,1)))}},{key:"getSearchFilterContext",value:function(){return this.currentSearchFilterContext}}],[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}])}(In);function xh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Hh=function(){return c(function e(t){var r=this;l(this,e),n(this,"autoUndockingSize",e.AUTO_UNDOCK_SIZE),n(this,"handleElementChange",function(t,n){var i,a=!0,o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return xh(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xh(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(t);try{for(o.s();!(i=o.n()).done;){var s,u=i.value;a&&"attributes"===u.type&&"style"===u.attributeName&&u.target instanceof Element&&null!==(s=u.target.getAttribute("style"))&&void 0!==s&&s.includes("right")&&(r.autoUndockingSize=e.AUTO_UNDOCK_SIZE_WITH_EWC,r.shouldAutoUndock(r.panelContainer.isPanelDocked())&&r.panelContainer.undockPanel("AUTO"),n.disconnect(),a=!1)}}catch(e){o.e(e)}finally{o.f()}}),n(this,"getAutoUndockingSize",function(){return r.autoUndockingSize}),n(this,"shouldAutoUndock",function(e){return r.isSmallScreen()&&e}),this.panelContainer=t;var i=document.getElementById("nav-flyout-ewc");if(i){var a=i.style.right.length>0;this.autoUndockingSize=a?e.AUTO_UNDOCK_SIZE_WITH_EWC:e.AUTO_UNDOCK_SIZE,a||new MutationObserver(this.handleElementChange).observe(i,{attributes:!0,subtree:!1})}window.isB2B&&(this.autoUndockingSize=e.AB_AUTO_UNDOCK_SIZE)},[{key:"isSmallScreen",value:function(){return window.innerWidth<this.getAutoUndockingSize()}}])}();n(Hh,"AUTO_UNDOCK_SIZE_WITH_EWC",1432),n(Hh,"AUTO_UNDOCK_SIZE",1332),n(Hh,"AB_AUTO_UNDOCK_SIZE",1409);var Bh=null,Wh=function(e){if(null!==Bh)return Bh;var t=e.dockedPanelAdjustableWidthTreatment||"C";return Bh="T1"===t},Vh=function(){return null!=Bh&&Bh},Gh=function(e){var t=e.dockedSidePanelTreatment||"C";return"T1"===t?"docked-left":"T2"===t?"docked-right":"none"},zh=function(e){return"docked-left"===e||"docked-right"===e},jh=function(e){return"expanded"===e||zh(e)},Yh=function(e){document.body.offsetHeight,window.dispatchEvent(new CustomEvent("resize",{detail:{rufusAction:!0,dockedPanelResize:!0}})),e.trigger("resize",window,{width:1,height:1})},Kh="rufus:dockedPanelWidth",qh="rufus-docked-adjustable",Xh="rufus-docked-resize-handle-left",Zh="rufus-docked-resize-handle-right",Qh="resizing",Jh=function(){return c(function e(t,r){l(this,e),n(this,"rufusFlyoutDiv",null),n(this,"resizeHandle",null),n(this,"isResizing",!1),n(this,"startX",0),n(this,"startWidth",0),n(this,"currentWidth",0),n(this,"boundMouseMove",null),n(this,"boundMouseUp",null),n(this,"boundDisableTextSelection",null),this.dockingSide=t,this.auiInstance=r,this.rufusFlyoutDiv=document.getElementById(q),this.rufusFlyoutDiv?(this.currentWidth=this.getStoredWidth()||G,this.isAdjustableEnabled()&&(this.createResizeHandle(),this.bindEvents(),this.applyWidth(this.currentWidth))):S.logErrorWithLevel(R.ERROR,"DockedPanelResizeHandler: Could not find rufus flyout div")},[{key:"isAdjustableEnabled",value:function(){return Vh()&&document.body.classList.contains(qh)}},{key:"createResizeHandle",value:function(){if(this.rufusFlyoutDiv){var e=document.getElementById(z);e?this.resizeHandle=e:(this.resizeHandle=document.createElement("div"),this.resizeHandle.id=z,this.resizeHandle.className="rufus-docked-resize-handle",this.resizeHandle.setAttribute("role","separator"),this.resizeHandle.setAttribute("aria-orientation","vertical"),this.resizeHandle.setAttribute("aria-label","Resize panel"),this.resizeHandle.setAttribute("aria-valuenow",String(this.currentWidth)),this.resizeHandle.setAttribute("aria-valuemin",String(G)),this.resizeHandle.setAttribute("aria-valuemax",String(600)),this.applyResizeHandleStyles(),this.rufusFlyoutDiv.insertBefore(this.resizeHandle,this.rufusFlyoutDiv.firstChild))}}},{key:"applyResizeHandleStyles",value:function(){this.resizeHandle&&(this.resizeHandle.classList.remove(Xh,Zh),"docked-right"===this.dockingSide?this.resizeHandle.classList.add(Xh):this.resizeHandle.classList.add(Zh))}},{key:"bindEvents",value:function(){this.resizeHandle&&(this.resizeHandle.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.boundMouseMove=this.handleMouseMove.bind(this),this.boundMouseUp=this.handleMouseUp.bind(this),this.boundDisableTextSelection=function(e){return e.preventDefault()})}},{key:"handleMouseDown",value:function(e){var t;0===e.button&&this.isAdjustableEnabled()&&(e.preventDefault(),this.isResizing=!0,this.startX=e.clientX,this.startWidth=(null===(t=this.rufusFlyoutDiv)||void 0===t?void 0:t.offsetWidth)||G,this.boundMouseMove&&document.addEventListener("mousemove",this.boundMouseMove),this.boundMouseUp&&document.addEventListener("mouseup",this.boundMouseUp),this.boundDisableTextSelection&&document.addEventListener("selectstart",this.boundDisableTextSelection),this.rufusFlyoutDiv&&(this.rufusFlyoutDiv.style.transition="none"),this.resizeHandle&&this.resizeHandle.classList.add(Qh),S.addCount(p.RUFUS_PANEL_RESIZE_START,1))}},{key:"handleMouseMove",value:function(e){if(this.isResizing&&this.rufusFlyoutDiv&&this.isAdjustableEnabled()){var t;t="docked-right"===this.dockingSide?this.startX-e.clientX:e.clientX-this.startX;var n=this.startWidth+t;n=Math.max(G,Math.min(600,n)),this.currentWidth=n,this.applyWidth(n)}}},{key:"handleMouseUp",value:function(){this.isResizing&&(this.isResizing=!1,this.boundMouseMove&&document.removeEventListener("mousemove",this.boundMouseMove),this.boundMouseUp&&document.removeEventListener("mouseup",this.boundMouseUp),this.boundDisableTextSelection&&document.removeEventListener("selectstart",this.boundDisableTextSelection),this.rufusFlyoutDiv&&(this.rufusFlyoutDiv.style.transition=""),this.resizeHandle&&this.resizeHandle.classList.remove(Qh),this.storeWidth(this.currentWidth),this.resizeHandle&&this.resizeHandle.setAttribute("aria-valuenow",String(this.currentWidth)),S.addCount(p.RUFUS_PANEL_RESIZE_END,1),S.addCount("".concat(p.RUFUS_DOCKED_PANEL_WIDTH,"_").concat(this.currentWidth),1))}},{key:"applyWidth",value:function(e){if(this.rufusFlyoutDiv){this.rufusFlyoutDiv.style.width="".concat(e,"px"),document.body.style.setProperty("--rufus-docked-panel-width","".concat(e,"px"));var t=e+12;document.body.style.setProperty("--total-rufus-panel-full-width","".concat(t,"px")),document.body.style.setProperty("--total-rufus-panel-half-width","".concat(t/2,"px")),Yh(this.auiInstance)}}},{key:"storeWidth",value:function(e){try{sessionStorage.setItem(Kh,String(e))}catch(e){S.logErrorWithLevel(R.WARN,"DockedPanelResizeHandler: Could not store width preference: ".concat(e))}}},{key:"getStoredWidth",value:function(){try{var e=sessionStorage.getItem(Kh);if(e){var t=parseInt(e,10);if(!isNaN(t)&&t>=G&&t<=600)return t}}catch(e){}return null}},{key:"getCurrentWidth",value:function(){return this.currentWidth}},{key:"resetToDefault",value:function(){this.currentWidth=G,this.applyWidth(G);try{sessionStorage.removeItem(Kh)}catch(e){}}},{key:"show",value:function(){this.resizeHandle&&this.isAdjustableEnabled()&&(this.resizeHandle.style.display="")}},{key:"hide",value:function(){this.resizeHandle&&(this.resizeHandle.style.display="none")}},{key:"updateDockingSide",value:function(e){this.dockingSide=e,this.isAdjustableEnabled()&&this.applyResizeHandleStyles()}},{key:"enable",value:function(){Vh()&&(document.body.classList.contains(qh)||document.body.classList.add(qh),!this.resizeHandle&&this.rufusFlyoutDiv?(this.createResizeHandle(),this.bindEvents(),this.applyWidth(this.currentWidth)):this.resizeHandle&&(this.resizeHandle.style.display=""))}},{key:"disable",value:function(){document.body.classList.remove(qh),this.resizeHandle&&(this.resizeHandle.style.display="none"),this.resetToDefault()}},{key:"isEnabled",value:function(){return this.isAdjustableEnabled()}},{key:"destroy",value:function(){this.boundMouseMove&&document.removeEventListener("mousemove",this.boundMouseMove),this.boundMouseUp&&document.removeEventListener("mouseup",this.boundMouseUp),this.boundDisableTextSelection&&document.removeEventListener("selectstart",this.boundDisableTextSelection),this.resizeHandle&&this.resizeHandle.parentNode&&this.resizeHandle.parentNode.removeChild(this.resizeHandle),this.resizeHandle=null,this.rufusFlyoutDiv=null}}])}();function $h(e){return e.offsetTop}function ef(e,t){return e>t?"increase":e<t?"decrease":"unchanged"}var tf=function(e){return e.RESIZE_HEIGHT="height",e.RESIZE_WIDTH="width",e.RESIZE_WIDTH_FROM_LEFT="widthFromLeft",e.RESIZE_HEIGHT_FROM_BOTTOM="heightFromBottom",e}({}),nf=function(){return c(function e(){l(this,e)},null,[{key:"validateZoneDetectionInput",value:function(e,t){return e&&t?!(t.width<=0||t.height<=0)||(S.logErrorWithLevel(R.ERROR,"Invalid rect dimensions in detectResizeZone: width=".concat(t.width,", height=").concat(t.height)),!1):(S.logErrorWithLevel(R.ERROR,"Invalid parameters in detectResizeZone: missing event or rect"),!1)}},{key:"calculateZoneBounds",value:function(e,t){var n=e.clientX-t.left,r=e.clientY-t.top;return{isNearLeft:n<=8,isNearRight:n>=t.width-8,isNearTop:r<=8,isNearBottom:r>=t.height-8}}},{key:"determineZoneFromBounds",value:function(e){var t=e.isNearLeft,n=e.isNearRight,r=e.isNearTop,i=e.isNearBottom;return t&&r?"top-left":n&&r?"top-right":t&&i?"bottom-left":n&&i?"bottom-right":r?"top":i?"bottom":t?"left":n?"right":"none"}},{key:"detectZone",value:function(e,t){if(!this.validateZoneDetectionInput(e,t))return"none";var n=this.calculateZoneBounds(e,t);return this.determineZoneFromBounds(n)}},{key:"getActionsForZone",value:function(e){var t=this.ZONE_CONFIGURATIONS[e];return t?t.actions:[]}},{key:"updateCursorForZone",value:function(e,t,n,r){if(e&&n&&r&&"expanded"===t)try{var i=n.getBoundingClientRect(),a=this.detectZone(e,i),o=this.ZONE_CONFIGURATIONS[a],s=o?o.cursor:"default";r.style.pointerEvents="none"!==a?"auto":"none",r.style.cursor=s}catch(e){S.logErrorWithLevelWithException(R.ERROR,e,"Unexpected error in updateCursorForZone: ".concat(e instanceof Error?e.message:"Unknown error")),r.style.pointerEvents="none",r.style.cursor=""}else r&&(r.style.pointerEvents="none",r.style.cursor="")}}])}();n(nf,"ZONE_CONFIGURATIONS",{"top-left":{cursor:le,actions:[tf.RESIZE_HEIGHT,tf.RESIZE_WIDTH_FROM_LEFT]},"top-right":{cursor:ce,actions:[tf.RESIZE_HEIGHT,tf.RESIZE_WIDTH]},"bottom-left":{cursor:ce,actions:[tf.RESIZE_HEIGHT_FROM_BOTTOM,tf.RESIZE_WIDTH_FROM_LEFT]},"bottom-right":{cursor:le,actions:[tf.RESIZE_HEIGHT_FROM_BOTTOM,tf.RESIZE_WIDTH]},top:{cursor:ue,actions:[tf.RESIZE_HEIGHT]},bottom:{cursor:ue,actions:[tf.RESIZE_HEIGHT_FROM_BOTTOM]},left:{cursor:se,actions:[tf.RESIZE_WIDTH_FROM_LEFT]},right:{cursor:se,actions:[tf.RESIZE_WIDTH]},none:{cursor:"default",actions:[]}});var rf=function(){return c(function e(t){var r=this;l(this,e),n(this,"timer",null),n(this,"element",null),n(this,"closeButton",null),n(this,"handleCloseClick",function(e){e.preventDefault(),e.stopPropagation(),r.hide()}),this.cacheManager=t},[{key:"showIfNeeded",value:function(e){var t=this;if(!this.cacheManager.hasCustomerSeenMovablePanelTooltip()){if("minimized"===e)return;if(this.element=document.querySelector(".rufus-panel-tooltip"),!this.element)return void S.logErrorWithLevel(R.ERROR,"Movable panel tooltip element not found in DOM");this.closeButton=this.element.querySelector(".rufus-panel-tooltip-close"),this.closeButton&&this.attachCloseButtonListeners(),this.timer=window.setTimeout(function(){t.hide()},3e4),this.element.style.display="flex",requestAnimationFrame(function(){t.element&&(t.element.style.opacity="1")})}}},{key:"hideIfMinimized",value:function(e){"minimized"===e&&this.hide()}},{key:"hide",value:function(){var e=this;this.element&&(this.element.style.opacity="0",setTimeout(function(){e.element&&(e.element.style.display="none")},200)),this.timer&&(clearTimeout(this.timer),this.timer=null),this.cacheManager.markCustomerSeenMovablePanelTooltip()}},{key:"attachCloseButtonListeners",value:function(){this.element&&(this.closeButton=this.element.querySelector(".rufus-panel-tooltip-close"),this.closeButton&&(this.closeButton.removeEventListener("click",this.handleCloseClick),this.closeButton.addEventListener("click",this.handleCloseClick)))}}])}();function af(){var e=document.getElementById(q),t=document.querySelector(".rufus-pill"),n=document.getElementById("rufus-conversation-container");if(e&&t&&n){var r=parseFloat(window.getComputedStyle(e).getPropertyValue("--expanded-container-width")),i=window.getComputedStyle(t),a=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),o=window.getComputedStyle(n);return r-a-(parseFloat(o.paddingLeft)+parseFloat(o.paddingRight))}}function of(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(of=function(){return!!e})()}var sf="RufusPanelContainer",uf=function(e){function t(e,r){var i,a,o,s,u,c,f;l(this,t),a=function(e,t,n){return t=h(t),d(e,of()?Reflect.construct(t,[],h(e).constructor):t.apply(e,n))}(this,t),n(a,"rufusPanelHeaderContentRow",null),n(a,"rufusPanelOverlayHeaderContentRow",null),n(a,"rufusPanelResizeHandleTop",null),n(a,"rufusPanelResizeHandleRight",null),n(a,"rufusPanelResizeHandleTopRight",null),n(a,"rufusPanelResizeHandleUnified",null),n(a,"rufusPanelResizeHandleOverlayContainerUnified",null),n(a,"overflowMenuContainer",null),n(a,"startPositionY",0),n(a,"startPositionX",0),n(a,"startPositionBottom",0),n(a,"startPositionLeft",0),n(a,"newHeight",0),n(a,"newWidth",0),n(a,"newBottom",0),n(a,"newLeft",0),n(a,"showAnimationRunning",!1),n(a,"closeAnimationRunning",!1),n(a,"panelInFocus",!1),n(a,"closeRufusPanelLabel",""),n(a,"openRufusPanelLabel",""),n(a,"undockRufusPanelLabel",""),n(a,"dockRufusPanelLabel",""),n(a,"isMovableCLEnabled",!1),n(a,"isRepositioning",!1),n(a,"isResizing",!1),n(a,"startResizeWidth",0),n(a,"startResizeHeight",0),n(a,"dockingSide","none"),n(a,"unifiedResizeHandler",null),n(a,"isConversationHistoryEnabled",!1),n(a,"dockedPanelResizeHandler",null),n(a,"isPanelClosed",function(){return"closed"===a.currentState}),n(a,"isPanelOpened",function(){return jh(a.currentState)}),n(a,"isPanelDocked",function(){return zh(a.currentState)}),n(a,"isDockingEnabled",function(){return"docked-left"===a.dockingSide||"docked-right"===a.dockingSide}),n(a,"updateUndockButtonVisibility",function(){a.rufusPanelUndockButton&&a.isDockingEnabled()&&(a.dockingManager.isSmallScreen()?a.rufusPanelUndockButton.style.display="none":a.rufusPanelUndockButton.style.display="")}),n(a,"setUndockButtonIconForTreatment",function(e){if(a.rufusPanelUndockButton&&a.isDockingEnabled())if("expanded"===e){var t="docked-left"===a.dockingSide?"url('data:image/svg+xml;charset=utf8,%3Csvg%20width%3D%2215%22%20height%3D%2214%22%20viewBox%3D%220%200%2015%2014%22%20fill%3D%22none%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cpath%20d%3D%22M4.53012%2010.5672L4.53012%2010.6412C4.53012%2011.7458%205.42555%2012.6412%206.53012%2012.6412L9.08708%2012.6412%22%20stroke%3D%22%23565959%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M8.78328%2012.6412L11.3402%2012.6412C12.4448%2012.6412%2013.3402%2011.7458%2013.3402%2010.6412L13.3402%208.19678%22%20stroke%3D%22%23565959%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M13.3402%208.4931L13.3402%206.04865C13.3402%204.94408%2012.4448%204.04865%2011.3402%204.04865L10.3782%204.04865%22%20stroke%3D%22%23565959%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M0.75%205.00316L0.75%207.56012C0.75%208.66469%201.64543%209.56012%202.75%209.56012L5.19445%209.56012%22%20stroke%3D%22%23565959%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M5.19443%209.56012L7.63889%209.56012C8.74345%209.56012%209.63889%208.66469%209.63889%207.56012L9.63889%205.00316%22%20stroke%3D%22%23565959%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M5.19445%200.75H2.75C1.64543%200.75%200.75%201.64543%200.75%202.75V5.30696%22%20stroke%3D%22%23565959%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M9.63889%205.30696L9.63889%202.75C9.63889%201.64543%208.74346%200.75%207.63889%200.75L5.19443%200.75%22%20stroke%3D%22%23565959%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M3.29893%203.30185L7.47142%207.52393%22%20stroke%3D%22%23565959%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M6.03329%202.85727L2.84341%202.85727L2.84341%205.96838%22%20stroke%3D%22%23565959%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22/%3E%3C/svg%3E')":"url('data:image/svg+xml;charset=utf8,%3Csvg%20width%3D%2214%22%20height%3D%2214%22%20viewBox%3D%220%200%2014%2014%22%20fill%3D%22none%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cpath%20d%3D%22M2.82408%203.93988H2.75C1.64543%203.93988%200.75%204.83531%200.75%205.93988V8.49684%22%20stroke%3D%22%23565959%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M0.75%208.19304L0.75%2010.75C0.75%2011.8546%201.64543%2012.75%202.75%2012.75L5.19445%2012.75%22%20stroke%3D%22%23565959%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M4.89814%2012.75L7.34259%2012.75C8.44716%2012.75%209.34259%2011.8546%209.34259%2010.75L9.34259%209.78797%22%20stroke%3D%22%23565959%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M3.86111%205.00316L3.86111%207.56012C3.86111%208.66469%204.75654%209.56012%205.86111%209.56012L8.30557%209.56012%22%20stroke%3D%22%23565959%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M8.30555%209.56012L10.75%209.56012C11.8546%209.56012%2012.75%208.66469%2012.75%207.56012L12.75%205.00316%22%20stroke%3D%22%23565959%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M8.30557%200.75H5.86111C4.75655%200.75%203.86111%201.64543%203.86111%202.75V5.30696%22%20stroke%3D%22%23565959%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M12.75%205.30696L12.75%202.75C12.75%201.64543%2011.8546%200.75%2010.75%200.75L8.30555%200.75%22%20stroke%3D%22%23565959%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M10.1573%203.33211L5.9352%207.50459%22%20stroke%3D%22%23565959%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M10.6019%206.06646L10.6019%202.87659L7.49075%202.87659%22%20stroke%3D%22%23565959%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22/%3E%3C/svg%3E')";a.rufusPanelUndockButton.style.background="".concat(t," no-repeat center transparent")}else a.rufusPanelUndockButton.style.backgroundImage=""}),n(a,"applyAnimationAndStateUpdateWithDefault",function(e){var t;if(e){var n=null===(t=a.getPanelContainerState())||void 0===t?void 0:t.viewState;n&&a.applyAnimationAndStateUpdate(n,e)}}),n(a,"readFromCache",function(e){var t=Rl[e].key;try{var n=sessionStorage.getItem(t);return n?JSON.parse(n):null}catch(e){return S.logErrorWithLevelWithException(R.ERROR,e,"".concat(sf," - Error reading from ").concat(t," ").concat(e instanceof Error?"(".concat(e.message,")"):"")),null}}),n(a,"updateReactContent",function(){var e=a.readFromCache(Ll);if(null!=e&&e.content){var t=JSON.parse(e.content);if(null!=t&&t.length>0){var n=yl().getState();if(t[0]&&"turns"in t[0])if("setInteractions"in n)n.setInteractions(t);else{var r=t.flatMap(function(e){return e.turns});n.setTurns(r)}else n.setTurns(t)}}}),n(a,"updateStateAndContent",function(){var e=a.readFromCache(Tl);if(e){if(e.content){var t=document.getElementById(et);if(a.rufusPanelContent.innerHTML=e.content,t){var n=document.getElementById(et);n&&n.replaceWith(t)}}e.state&&a.updatePanelStateOnNavigationBack(e.state)}(hl(bt)||hl(Lt))&&a.updateReactContent()}),n(a,"updatePanelStateOnNavigationBack",function(e){a.dispatch("onPanelContainerStateChange",e),a.updatePanelViewStateOnNavigationBack(e),a.resizePanelOnNavigationBack(e)}),n(a,"handleNavigateFromTeaserCX",function(e){S.addCount(p.RUFUS_RECOVERY_TEASER_CX_CLICK,1);var t=a.getPanelContainerState().viewState;if("closed"===t||"minimized"===t){var n=a.getPanelViewContext();n.keyword=e,n.qis=un.NILE_TEASER_CX_RECOVERY,a.setPanelViewContext(n);var r=a.isDockingEnabled()&&!a.dockingManager.isSmallScreen()?a.dockingSide:"expanded";a.applyAnimationAndStateUpdate(t,r),S.addCount(p.RUFUS_RECOVERY_TEASER_CX_OPEN_PANEL,1)}}),n(a,"applyAnimationAndStateUpdate",function(e,t,n,r){e===t||a.closeAnimationRunning||(a.A.trigger("rufus-panel-state-change",e,t),a.resetRufusFlyoutDivClassName(),a.applyPanelAnimation(e,t)&&(a.isDockingEnabled()&&a.handleBodyPadding(t),a.handlePanelStateUpdate(e,t,n,r)))}),n(a,"handleBodyPadding",function(e){var t="docked-left"===e||"docked-right"===e?"rufus-docked-opening-transition":"rufus-docked-closing-transition";if(document.body.style.transition="",document.body.classList.add(t),"closed"===e||"expanded"===e){var n=document.body.classList.contains("rufus-docked-left")||document.body.classList.contains("rufus-docked-right");document.body.classList.remove("rufus-docked-left","rufus-docked-right"),document.body.style.paddingLeft="",document.body.style.paddingRight="",document.body.style.paddingTop="",document.body.style.removeProperty("--total-rufus-panel-full-width"),document.body.style.removeProperty("--total-rufus-panel-half-width"),n&&a.dockedPanelResizeHandler&&a.dockedPanelResizeHandler.disable(),n&&a.triggerLayoutRecalculation()}else if(zh(e)){document.body.classList.add("rufus-".concat(e));var r=null!==document.querySelector(".nav-ewc-persistent-hover #nav-flyout-ewc")?100:0;"docked-left"===e?(document.body.style.paddingLeft="".concat(V,"px"),r+=12):"docked-right"===e&&(document.body.style.paddingLeft="".concat(12,"px"),r+=V),document.body.style.paddingRight="".concat(r,"px"),document.body.style.paddingTop="".concat(12,"px"),a.rufusFlyoutDiv.style.setProperty("--expanded-container-width",V+"px"),document.body.style.setProperty("--total-rufus-panel-full-width","".concat(332,"px")),document.body.style.setProperty("--total-rufus-panel-half-width","".concat(166,"px")),a.triggerLayoutRecalculation(),a.dockedPanelResizeHandler||a.initializeDockedPanelResizeHandler(),a.dockedPanelResizeHandler&&a.dockedPanelResizeHandler.enable()}}),n(a,"triggerLayoutRecalculation",function(){Yh(a.A)}),n(a,"isShowAnimationRunning",function(){return a.showAnimationRunning}),n(a,"setPanelViewContext",function(e){a.rufusPanelViewContext.value=JSON.stringify(e)}),n(a,"updatePanelState",function(e,t){var n=a.currentState,r=n?"".concat(n,"_to_").concat(e):e;Jt(t?_.PANEL_RESIZE_RUFUS:_.PANEL_RESIZE,r),a.currentState=e,a.rufusFlyoutDiv.setAttribute("data-state",e),a.rufusButton.setAttribute("data-state",e);var i=jh(e)?a.closeRufusPanelLabel:a.openRufusPanelLabel;if(a.rufusButton.setAttribute("aria-label",i),a.rufusPanelUndockButton&&a.isDockingEnabled()){var o=zh(e)?a.undockRufusPanelLabel:a.dockRufusPanelLabel;a.rufusPanelUndockButton.setAttribute("aria-label",o)}a.setCursorForHeaderContentRow(e,a.rufusPanelHeaderContentRow),a.setCursorForHeaderContentRow(e,a.rufusPanelOverlayHeaderContentRow),a.setUndockButtonIconForTreatment(e),a.panelInFocus=a.isPanelOpened(),a.logPanelFocusMetrics(),S.addCount(p.RUFUS_PANEL_STATE_PREFIX+a.currentState.toUpperCase(),1),a.isMovableCLEnabled&&a.tooltipManager.hideIfMinimized(e),a.onPanelContainerStateChange(),jh(e)&&!a.isDockingEnabled()&&a.updateRQPillsWidth(af())}),n(a,"calculateExpandedLeftPosition",function(){var e=0;if("docked-right"===a.currentState){var t=a.rufusFlyoutDiv.offsetWidth||V;e=(document.documentElement.clientWidth||window.innerWidth)-t-24,e=Math.max(0,e)}return e}),n(a,"animateChatHistoryContainer",function(){a.rufusFlyoutDiv.style.overflow="hidden",a.handleDuplicateChatHistory();var e=document.getElementById(te);e&&(a.rufusFlyoutDiv.appendChild(e),e.classList.remove("aok-hidden"),requestAnimationFrame(function(){a.rufusFlyoutDiv.classList.add("history-open"),e.classList.add("overlay-slide-in")}),a.rufusFlyoutDiv.style.overflow="hidden")}),n(a,"closeChatHistoryContainer",function(){var e=document.getElementById(te);e&&!e.classList.contains("aok-hidden")&&(e.addEventListener("transitionend",function(t){"left"===t.propertyName&&(e.classList.add("aok-hidden"),a.rufusFlyoutDiv.style.overflow="")},{once:!0}),a.rufusFlyoutDiv.classList.remove("history-open"),e.classList.remove("overlay-slide-in"))}),n(a,"changePanelDockedState",function(){var e="CLICK";if(a.isDockingEnabled()&&a.isPanelOpened()){var t=zh(a.currentState)?"expanded":a.dockingSide;if(a.preserveBottomScrollPosition(),zh(a.currentState)&&"expanded"===t)a.undockPanel(e);else{a.applyAnimationAndStateUpdate(a.currentState,t);var n="".concat(p.RUFUS_PANEL_STATE_PREFIX).concat(e,"_DOCK");S.addCount(n,1),Jt(n)}}}),n(a,"bindActions",function(){if(a.navbar&&a.rufusButton&&a.rufusFlyoutDiv&&a.rufusPanelMinimizeButton&&a.rufusPanelCloseButton&&a.rufusPanelHeader&&a.rufusPanelViewContext){if(a.rufusButton.addEventListener("click",a.handleIngressClick),a.rufusPanelHeader.addEventListener("click",a.handlePanelHeaderClick),a.rufusPanelMinimizeButton.addEventListener("click",a.handlePanelMinimizeClick),a.rufusPanelCloseButton.addEventListener("click",a.handlePanelCloseClick),a.rufusPanelUndockButton&&a.rufusPanelUndockButton.addEventListener("click",a.changePanelDockedState),a.isMovableCLEnabled){if(!a.rufusPanelResizeHandleUnified)return void S.logErrorWithLevel(R.ERROR,"Error binding resize actions in PanelContainer, resize div in Rufus card is missing");if(!a.rufusPanelHeaderContentRow)return void S.logErrorWithLevel(R.ERROR,"Error binding resize actions in PanelContainer, header content div in Rufus card is missing");var e,t,n;a.rufusPanelResizeHandleUnified.addEventListener("mousedown",a.mousedownHandler),a.isConversationHistoryEnabled&&(null===(e=a.rufusPanelResizeHandleOverlayContainerUnified)||void 0===e||e.addEventListener("mousedown",a.mousedownHandler)),a.rufusFlyoutDiv.addEventListener("mousemove",function(e){a.rufusPanelResizeHandleUnified&&"expanded"===a.currentState&&nf.updateCursorForZone(e,a.currentState,a.rufusFlyoutDiv,a.rufusPanelResizeHandleUnified),a.rufusPanelResizeHandleOverlayContainerUnified&&"expanded"===a.currentState&&nf.updateCursorForZone(e,a.currentState,a.rufusFlyoutDiv,a.rufusPanelResizeHandleOverlayContainerUnified)}),a.rufusPanelResizeHandleUnified.addEventListener("mouseleave",function(){a.rufusPanelResizeHandleUnified&&(a.rufusPanelResizeHandleUnified.style.cursor="",a.rufusPanelResizeHandleUnified.style.pointerEvents="none")}),a.isConversationHistoryEnabled&&(null===(t=a.rufusPanelResizeHandleOverlayContainerUnified)||void 0===t||t.addEventListener("mouseleave",function(){a.rufusPanelResizeHandleOverlayContainerUnified&&(a.rufusPanelResizeHandleOverlayContainerUnified.style.cursor="",a.rufusPanelResizeHandleOverlayContainerUnified.style.pointerEvents="none")})),a.rufusPanelHeaderContentRow.addEventListener("mousedown",a.mousedownHandler),a.isConversationHistoryEnabled&&(null===(n=a.rufusPanelOverlayHeaderContentRow)||void 0===n||n.addEventListener("mousedown",a.mousedownHandler))}else{if(!(a.rufusPanelResizeHandleTop&&a.rufusPanelResizeHandleRight&&a.rufusPanelResizeHandleTopRight&&a.rufusPanelGrabber))return void S.logErrorWithLevel(R.ERROR,"Error binding resize actions in PanelContainer, resize div in Rufus card is missing");a.rufusPanelResizeHandleTop.addEventListener("mousedown",a.mousedownHandler),a.rufusPanelResizeHandleRight.addEventListener("mousedown",a.mousedownHandler),a.rufusPanelResizeHandleTopRight.addEventListener("mousedown",a.mousedownHandler),a.rufusPanelGrabber.addEventListener("mousedown",a.mousedownHandler)}a.rufusFlyoutDiv.addEventListener("dragstart",a.dragstart),window.addEventListener("resize",function(e){a.rufusFlyoutDiv.classList.add("rufus-no-transition"),a.updateUndockButtonVisibility();var t=e;t.detail&&!0===t.detail.rufusAction||!a.dockingManager.shouldAutoUndock(a.isPanelDocked())?a.isMovableCLEnabled?a.handleMovableCLWindowResize():a.handleLegacyWindowResize():a.undockPanel("AUTO")}),a.isMovableCLEnabled&&window.addEventListener("scroll",function(){if(!(window.scrollY<0)){var e=a.rufusFlyoutDiv.style.getPropertyValue("--expanded-container-height"),t=e?parseInt(e):a.rufusFlyoutDiv.offsetHeight,n=Math.max(0,a.navbarmain.getBoundingClientRect().bottom,a.navbelt.getBoundingClientRect().bottom),r=window.innerHeight-n-U,i=t;t>r&&(i=Math.max(r,ae),a.newHeight=i,a.rufusFlyoutDiv.style.setProperty("--expanded-container-height",a.newHeight+"px"));var o=window.innerHeight-n-i-U;a.newBottom=Math.min(a.newBottom,o),a.newBottom<0&&(a.newBottom=o),a.rufusFlyoutDiv.style.setProperty("--expanded-container-bottom",a.newBottom+"px")}}),window.addEventListener("click",function(e){var t=document.querySelector("#nav-rufus-content .rufus-container"),n=e.target;t&&t.contains(e.target)?a.panelInFocus||(a.panelInFocus=!0,a.logPanelFocusMetrics()):a.panelInFocus&&![J,$,Q,Z,X].includes(n.id)&&(a.panelInFocus=!1,a.logPanelFocusMetrics())}),window.P&&P.when("navbarJSLoaded").execute(function(){window.$Nav&&window.$Nav.getNow("cover")&&(window.$Nav.getNow("cover").isVisible()?a.hideRufusPanel():a.showRufusPanel(),window.$Nav.getNow("cover").onShow(function(){return a.hideRufusPanel()}),window.$Nav.getNow("cover").onHide(function(){return a.showRufusPanel()}))})}else S.logErrorWithLevel(R.ERROR,"Error binding actions in PanelContainer, some div in Rufus card is missing")}),n(a,"hideRufusPanel",function(){a.rufusFlyoutDiv.style.zIndex=String(Number(window.getComputedStyle(a.navbar).zIndex)-3)}),n(a,"showRufusPanel",function(){a.rufusFlyoutDiv.style.zIndex=""}),n(a,"resizePanelOnNavigationBack",function(e){var t,n;a.newHeight=e.height,a.newWidth=e.width,a.newBottom=null!==(t=e.bottom)&&void 0!==t?t:0,a.newLeft=null!==(n=e.left)&&void 0!==n?n:0,a.rufusFlyoutDiv.style.setProperty("--expanded-container-height",a.newHeight+"px"),a.rufusFlyoutDiv.style.setProperty("--expanded-container-width",a.newWidth+"px"),a.rufusFlyoutDiv.style.setProperty("--expanded-container-bottom",a.newBottom+"px"),a.rufusFlyoutDiv.style.setProperty("--expanded-container-left",a.newLeft+"px")}),n(a,"updatePanelViewStateOnNavigationBack",function(e){var t=e.autoMinimize&&"closed"!=e.viewState?"minimized":e.viewState;a.applyAnimationAndStateUpdate(a.currentState,t);var n=e.autoMinimize;a.dispatch("onAutoMinimizeToggleSwitchStateChange",n)}),n(a,"resetRufusFlyoutDivClassName",function(){a.rufusFlyoutDiv.className="rufus-panel-container"}),n(a,"handlePanelStateUpdate",function(e,t,n,r){a.dispatch("onPanelAnimationStart",t),"closed"===t?(a.closeAnimationRunning=!0,a.addAnimationEndListener(e,t,function(){return a.onHideAnimationEnd(t,n,r)}),a.emitPanelStateEvents(a.getPanelContainerState())):(a.showAnimationRunning=!0,a.addAnimationEndListener(e,t,function(){a.onShowAnimationEnd(t)}),a.updatePanelState(t,n))}),n(a,"addAnimationEndListener",function(e,t,n){var r="closed";if(a.isDockingEnabled()&&e!==r&&t!==r){var i=function(e){ot.includes(e.animationName)&&(a.rufusFlyoutDiv.removeEventListener("animationend",i),n())};a.rufusFlyoutDiv.addEventListener("animationend",i)}else a.rufusFlyoutDiv.addEventListener("animationend",n,{once:!0})}),n(a,"onHideAnimationEnd",function(e,t,n){var r,i;a.isDockingEnabled()&&document.body.classList.remove("rufus-docked-opening-transition","rufus-docked-closing-transition"),a.updatePanelState(e,t),null!==(null===(r=Fh.getInstance())||void 0===r?void 0:r.getSearchFilterContext())&&(null===(i=Fh.getInstance())||void 0===i||i.setSearchFilterContext(null)),a.closeAnimationRunning=!1,null!=n&&n||a.updateTruncateState(e),a.dispatch("onPanelAnimationEnd",e)}),n(a,"onShowAnimationEnd",function(e){a.isDockingEnabled()&&document.body.classList.remove("rufus-docked-opening-transition","rufus-docked-closing-transition"),a.showAnimationRunning=!1,a.dispatch("onPanelAnimationEnd",e),jh(e)&&(a.updateScrollButtonVisibility(),a.isDockingEnabled()&&setTimeout(function(){a.debouncedUpdateRQPillsWidth()},150))}),n(a,"openPanel",function(){a.isPanelOpened()||a.handleIngressClick()}),n(a,"handleIngressClick",function(){var e;e=a.isDockingEnabled()?"closed"===a.currentState?a.dockingManager.isSmallScreen()?"expanded":a.dockingSide:"closed":"expanded"!==a.currentState?"expanded":"closed",a.applyAnimationAndStateUpdate(a.currentState,e)}),n(a,"handlePanelCloseClick",function(e){switch(a.applyAnimationAndStateUpdate(a.currentState,"closed",void 0,void 0),a.rufusButton.focus(),a.getPanelContainerState().viewState){case"expanded":S.addCount(p.RUFUS_CLOSE_CLICK_FROM_EXPANDED,1),Jt(_.PANEL_CLOSE_CLICK);break;case"minimized":S.addCount(p.RUFUS_CLOSE_CLICK_FROM_MINIMIZED,1),Jt(_.PANEL_CLOSE_CLICK)}e.stopPropagation()}),n(a,"handlePanelHeaderClick",function(){"minimized"===a.currentState&&(a.applyAnimationAndStateUpdate(a.currentState,"expanded"),Jt(_.PANEL_EXPAND_CLICK))}),n(a,"handlePanelMinimizeClick",function(e){var t="minimized"===a.currentState,n=t?"expanded":"minimized";Jt(t?_.PANEL_EXPAND_CLICK:_.PANEL_MINIMIZE_CLICK),a.applyAnimationAndStateUpdate(a.currentState,n,!1,!0),e.stopPropagation()}),n(a,"disableTextSelection",function(e){e.preventDefault()}),n(a,"mousedownHandler",function(e){if(0===e.button&&a.isPanelOpened()){var t=e.target;a.startPositionY=e.clientY,a.startPositionX=e.clientX,"BUTTON"!==t.tagName&&(a.isMovableCLEnabled?a.handleMovableCLMousedown(e,t):a.handleLegacyMousedown(t))}}),n(a,"handleLegacyMousedown",function(e){document.addEventListener("selectstart",a.disableTextSelection),e===a.rufusPanelResizeHandleTopRight?(document.addEventListener("mousemove",a.mousemoveHeight),document.addEventListener("mousemove",a.mousemoveWidth),document.addEventListener("mouseup",a.mouseupHandler),e.style.cursor=ce):e===a.rufusPanelResizeHandleTop||e===a.rufusPanelGrabber?(document.addEventListener("mousemove",a.mousemoveHeight),document.addEventListener("mouseup",a.mouseupHandler),e.style.cursor=ue):e===a.rufusPanelResizeHandleRight&&(document.addEventListener("mousemove",a.mousemoveWidth),document.addEventListener("mouseup",a.mouseupHandler),e.style.cursor=se)}),n(a,"handleMovableCLMousedown",function(e,t){var n=a.getCurrentPanelPosition();if(a.startPositionBottom=a.newBottom=n.bottom,a.startPositionLeft=a.newLeft=n.left,t===a.rufusPanelResizeHandleUnified)a.handleMovableCLResizeMousedown(e);else if(a.isConversationHistoryEnabled&&t===a.rufusPanelResizeHandleOverlayContainerUnified)a.handleMovableCLResizeMousedown(e);else if(a.isElementValidTarget(a.rufusPanelHeaderContentRow,t)||a.isElementValidTarget(a.rufusPanelOverlayHeaderContentRow,t)){if(a.overflowMenuContainer&&a.overflowMenuContainer.contains(t)||"expanded"!==a.currentState)return;a.handleMovableCLRepositionMousedown(t)}}),n(a,"handleMovableCLResizeMousedown",function(e){var t=a.rufusFlyoutDiv.getBoundingClientRect(),n=nf.detectZone(e,t);a.setupResizeForZone(n)&&(document.addEventListener("selectstart",a.disableTextSelection),a.isResizing=!0,a.startResizeWidth=a.rufusFlyoutDiv.clientWidth,a.startResizeHeight=a.rufusFlyoutDiv.clientHeight,S.widgetBodyBegin(g.RUFUS_PANEL_RESIZE_LATENCY))}),n(a,"handleMovableCLRepositionMousedown",function(e){document.addEventListener("selectstart",a.disableTextSelection),a.isRepositioning=!0,document.addEventListener("mousemove",a.mousemovePosition),document.addEventListener("mouseup",a.mouseupHandler),e.style.cursor=de,a.rufusFlyoutDiv.classList.add(at),S.widgetBodyBegin(g.RUFUS_PANEL_DRAG_LATENCY)}),n(a,"mousemovePosition",function(e){a.tooltipManager.hide(),a.rufusFlyoutDiv.style.transition="none";var t=e.clientY-a.startPositionY,n=e.clientX-a.startPositionX;a.newBottom=a.startPositionBottom-t,a.newLeft=a.startPositionLeft+n;var r=(document.documentElement.clientWidth||window.innerWidth)-a.rufusFlyoutDiv.offsetWidth-24,i=Math.max(0,a.navbarmain.getBoundingClientRect().bottom,a.navbelt.getBoundingClientRect().bottom),o=window.innerHeight-i-a.rufusFlyoutDiv.offsetHeight-U,s=window.innerHeight-i-U,u=a.rufusFlyoutDiv.offsetHeight<=s;a.newBottom=Math.min(a.newBottom,o),a.newLeft=Math.max(0,Math.min(a.newLeft,r)),u&&(a.newBottom=Math.max(0,a.newBottom)),a.rufusFlyoutDiv.style.setProperty("--expanded-container-bottom",a.newBottom+"px"),a.rufusFlyoutDiv.style.setProperty("--expanded-container-left",a.newLeft+"px")}),n(a,"mousemoveHeight",function(e){a.rufusFlyoutDiv.style.transition="none";var t=e.clientY-a.startPositionY;a.rufusFlyoutDiv.offsetTop+t<=(a.isMovableCLEnabled?Math.max(0,a.navbarmain.getBoundingClientRect().bottom,a.navbelt.getBoundingClientRect().bottom)+12:a.navbar.offsetTop+a.navbar.offsetHeight+12)||(a.newHeight=a.rufusFlyoutDiv.clientHeight-t,a.newHeight=Math.max(a.newHeight,ae),a.rufusFlyoutDiv.style.setProperty("--expanded-container-height",a.newHeight+"px"),a.newHeight==ae&&e.clientY>a.startPositionY||(a.startPositionY=e.clientY))}),n(a,"mousemoveHeightFromBottom",function(e){a.rufusFlyoutDiv.style.transition="none";var t=e.clientY-a.startPositionY,n=a.rufusFlyoutDiv.clientHeight;if(a.newHeight=n+t,a.newHeight=Math.max(a.newHeight,ae),!(a.newHeight==ae&&e.clientY<a.startPositionY)){var r=a.newHeight-n,i=a.newBottom-r;if(i<0){var o=n+a.newBottom;a.newHeight=Math.max(o,ae),a.newBottom=0}else a.newBottom=i;a.rufusFlyoutDiv.style.setProperty("--expanded-container-height",a.newHeight+"px"),a.rufusFlyoutDiv.style.setProperty("--expanded-container-bottom",a.newBottom+"px"),a.startPositionY=e.clientY}}),n(a,"mousemoveWidth",function(e){a.rufusFlyoutDiv.style.transition="none";var t=a.startPositionX-e.clientX;a.newWidth=a.rufusFlyoutDiv.clientWidth-t,a.newWidth=Math.max(a.newWidth,290),a.newWidth=Math.min(a.newWidth,oe);var n=a.newWidth>=oe&&e.clientX>a.startPositionX,r=a.newWidth<=290&&e.clientX<a.startPositionX;if(a.isMovableCLEnabled){var i=(document.documentElement.clientWidth||window.innerWidth)-a.newLeft-24;a.newWidth=Math.min(a.newWidth,i)}a.rufusFlyoutDiv.style.setProperty("--expanded-container-width",a.newWidth+"px"),n||r||(a.startPositionX=e.clientX,a.debouncedUpdateRQPillsWidth())}),n(a,"mousemoveWidthFromLeft",function(e){a.rufusFlyoutDiv.style.transition="none";var t=e.clientX-a.startPositionX,n=a.newLeft+a.rufusFlyoutDiv.clientWidth;a.newLeft=a.newLeft+t,a.newLeft=Math.max(0,a.newLeft),a.newWidth=n-a.newLeft;var r=a.newWidth;a.newWidth=Math.max(a.newWidth,290),a.newWidth=Math.min(a.newWidth,oe),a.newWidth!==r&&(a.newLeft=n-a.newWidth),a.rufusFlyoutDiv.style.setProperty("--expanded-container-width",a.newWidth+"px"),a.rufusFlyoutDiv.style.setProperty("--expanded-container-left",a.newLeft+"px"),a.startPositionX=e.clientX,a.debouncedUpdateRQPillsWidth()}),n(a,"mouseupHandler",function(){a.rufusFlyoutDiv.style.transition=a.rufusPanelTransition,a.isMovableCLEnabled?(a.rufusFlyoutDiv.classList.remove(at),a.trackMovableCLMetrics(),a.isRepositioning&&S.widgetBodyEnd(g.RUFUS_PANEL_DRAG_LATENCY),a.isResizing&&S.widgetBodyEnd(g.RUFUS_PANEL_RESIZE_LATENCY),a.isRepositioning=!1,a.isResizing=!1):(a.rufusPanelResizeHandleTopRight.style.cursor=ce,a.rufusPanelResizeHandleTop.style.cursor=ue,a.rufusPanelResizeHandleRight.style.cursor=se),a.onPanelContainerStateChange(),a.updateScrollButtonVisibility(),document.removeEventListener("mouseup",a.mouseupHandler),document.removeEventListener("selectstart",a.disableTextSelection),a.isMovableCLEnabled?(document.removeEventListener("mousemove",a.mousemovePosition),a.unifiedResizeHandler&&(document.removeEventListener("mousemove",a.unifiedResizeHandler),a.unifiedResizeHandler=null)):(document.removeEventListener("mousemove",a.mousemoveHeight),document.removeEventListener("mousemove",a.mousemoveWidth))}),n(a,"dragstart",function(){a.mouseupHandler()}),n(a,"onPanelContainerStateChange",function(){var e=a.getPanelContainerState();a.dispatch("onPanelContainerStateChange",e),a.emitPanelStateEvents(e)}),n(a,"emitPanelStateEvents",function(e){var t=e.viewState;"expanded"===t?document.dispatchEvent(new CustomEvent("rufus:panel:open")):"closed"!==t&&"minimized"!==t||document.dispatchEvent(new CustomEvent("rufus:panel:closed"))}),n(a,"updateScrollButtonVisibility",function(){a.dispatch("updateScrollButtonVisibility",void 0)}),n(a,"mapBottomSheetSizeToPanelState",function(e){var t=a.getPanelContainerState().viewState;return"expanded"!==e?t:"expanded"===e&&a.isDockingEnabled()?"expanded"===a.currentState||a.dockingManager.isSmallScreen()?"expanded":a.dockingSide:e}),n(a,"updateRQPillsWidth",function(e){document.querySelectorAll("button.rufus-pill key, button.rufus-web-pill key").forEach(function(t){return fn(t,e)})}),n(a,"debouncedUpdateRQPillsWidth",(o=a.updateRQPillsWidth,s=a,u=null,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];clearTimeout(u),u=setTimeout(function(){o.apply(s,t)},100)})),a.A=e,a.tooltipManager=new rf(r),a.dockingManager=new Hh(a),a.navbar=document.getElementById("navbar"),a.navbarmain=document.getElementById("nav-main"),a.navbelt=document.getElementById("nav-belt"),a.rufusFlyoutDiv=document.getElementById(q),a.isMovableCLEnabled=null!==document.getElementById(ee),a.dockingSide=(c=Ut,window.P&&P.now(c).execute(function(e){f=e}),f),a.isConversationHistoryEnabled=null!==document.getElementById(ie)&&null!==document.getElementById(re),a.rufusPanelContent=document.getElementById(K),a.rufusButton=document.getElementById(X),a.rufusPanelMinimizeButton=document.getElementById(J),a.rufusPanelCloseButton=document.getElementById($),a.rufusPanelUndockButton=document.getElementById("rufus-panel-header-dock-undock-button"),a.rufusPanelHeader=document.getElementsByClassName("rufus-panel-header-container")[0],a.rufusPanelGrabber=document.getElementById("rufus-panel-header-grabber-row"),a.rufusPanelViewContext=document.getElementById("rufus-view-context"),a.isMovableCLEnabled||(a.rufusPanelResizeHandleTop=document.getElementById("rufus-panel-resize-handle-top"),a.rufusPanelResizeHandleRight=document.getElementById("rufus-panel-resize-handle-right"),a.rufusPanelResizeHandleTopRight=document.getElementById("rufus-panel-resize-handle-top-right")),a.currentState=null===(i=a.rufusFlyoutDiv)||void 0===i?void 0:i.getAttribute("data-state"),a.isDockingEnabled()&&a.setUndockButtonIconForTreatment(a.currentState);var v=a.rufusFlyoutDiv.style.getPropertyValue("--expanded-container-height"),m=a.rufusFlyoutDiv.style.getPropertyValue("--expanded-container-width");if(a.newHeight=v?parseInt(v):0,a.newWidth=m?parseInt(m):0,a.isMovableCLEnabled){a.rufusPanelHeaderContentRow=document.getElementById("rufus-panel-header-content-row"),a.rufusPanelResizeHandleUnified=document.getElementById(ee),a.overflowMenuContainer=document.getElementById(Re),a.rufusPanelHeaderContentRow&&"expanded"===a.currentState&&(a.rufusPanelHeaderContentRow.style.cursor=de),a.isConversationHistoryEnabled&&(a.rufusPanelOverlayHeaderContentRow=document.getElementById(ie),a.rufusPanelResizeHandleOverlayContainerUnified=document.getElementById(re),a.rufusPanelOverlayHeaderContentRow&&"expanded"===a.currentState&&(a.rufusPanelOverlayHeaderContentRow.style.cursor=de)),a.overflowMenuContainer&&(a.overflowMenuContainer.style.cursor="default");var E=a.getCurrentPanelPosition();a.newBottom=E.bottom,a.newLeft=E.left,a.tooltipManager.showIfNeeded(a.currentState)}a.rufusPanelTransition=a.rufusFlyoutDiv.style.transition,a.panelInFocus=a.currentState&&a.isPanelOpened(),a.panelInFocus&&a.logPanelFocusMetrics(),a.bindActions();var C=a.getPanelViewContext().panelStateOnIngressClick;return C&&(jh(C)?Jt(_.RUFUS_OPEN,y.RUFUS_ICON_TAP):"closed"===C&&Jt(_.RUFUS_CLOSE,y.RUFUS_ICON_TAP)),S.addCount(p.RUFUS_PANEL_CONTAINER_INSTANTIATED,1),a.updateUndockButtonVisibility(),a.initializeAccessibilityLabels(),a.isDockingEnabled()&&zh(a.currentState)&&a.initializeDockedPanelResizeHandler(),a}return v(t,e),c(t,[{key:"initializeDockedPanelResizeHandler",value:function(){if(!this.dockedPanelResizeHandler){var e=this.dockingSide;this.dockedPanelResizeHandler=function(e,t){return new Jh(e,t)}(e,this.A)}}},{key:"getA",value:function(){return this.A}},{key:"getPanelContainerState",value:function(){return{height:this.newHeight,width:this.newWidth,bottom:this.newBottom,left:this.newLeft,viewState:this.currentState}}},{key:"getPanelViewContext",value:function(){var e;try{e=JSON.parse(this.rufusPanelViewContext.value)}catch(e){console.error("".concat(sf," - Error parsing viewContext ").concat(this.rufusPanelViewContext.value," ").concat(e instanceof Error?"(".concat(e.message,")"):""))}return{pageType:e.pageType,keyword:e.keyword?e.keyword:"",asin:e.asin?e.asin:"",qis:e.qis?e.qis:"",metadata:e.metadata?e.metadata:"",panelStateOnIngressClick:e.panelStateOnIngressClick?e.panelStateOnIngressClick:""}}},{key:"handlePanelContainerViewStateUpdateWithCXZen",value:function(e){var t=this.mapBottomSheetSizeToPanelState(e);this.applyAnimationAndStateUpdate(this.getPanelContainerState().viewState,t,!0),S.addCount(p.RUFUS_PANEL_EXPANDED_BY_CX_ZEN,1)}},{key:"handleOverflowMenuStateChange",value:function(e){"open"===e?this.rufusFlyoutDiv.classList.add(ve):this.rufusFlyoutDiv.classList.remove(ve)}},{key:"setCursorForHeaderContentRow",value:function(e,t){this.isMovableCLEnabled&&t&&(t.querySelectorAll("*").forEach(function(e){e.style.cursor=""}),t.style.cursor="expanded"===e?de:"",this.overflowMenuContainer&&(this.overflowMenuContainer.style.cursor="default"))}},{key:"preserveBottomScrollPosition",value:function(){var e=document.getElementById(L);if(e){var t=e.scrollHeight-e.scrollTop-e.clientHeight;t<0||requestAnimationFrame(function(){var n=e.style.scrollBehavior;e.style.scrollBehavior="auto";var r=e.scrollHeight-e.clientHeight-t;e.scrollTop=Math.max(0,r),n?e.style.scrollBehavior=n:e.style.removeProperty("scroll-behavior")})}}},{key:"undockPanel",value:function(e){var t=this.calculateExpandedLeftPosition(),n=.5*window.innerHeight;this.newLeft=t,this.newBottom=0,this.newWidth=320,this.newHeight=n,this.rufusFlyoutDiv.style.setProperty("--expanded-container-left",t+"px"),this.rufusFlyoutDiv.style.setProperty("--expanded-container-bottom","0px"),this.rufusFlyoutDiv.style.setProperty("--expanded-container-width","320px"),this.rufusFlyoutDiv.style.setProperty("--expanded-container-height",n+"px"),this.dockedPanelResizeHandler&&this.dockedPanelResizeHandler.disable(),this.applyAnimationAndStateUpdate(this.currentState,"expanded");var r="".concat(p.RUFUS_PANEL_STATE_PREFIX).concat(e,"_UNDOCK");S.addCount(r,1),Jt(r),this.updateUndockButtonVisibility()}},{key:"handleCachedChatHistory",value:function(){this.handleDuplicateChatHistory();var e=document.getElementById(te);e&&(e.classList.add("aok-hidden"),this.closeChatHistoryContainer())}},{key:"initChatHistoryContainer",value:function(){var e=document.getElementById(te);e&&this.rufusFlyoutDiv.appendChild(e)}},{key:"handleDuplicateChatHistory",value:function(){var e=this.rufusPanelContent.querySelector("#".concat(te));e&&document.getElementsByClassName(te).length>1&&this.rufusPanelContent.removeChild(e)}},{key:"updateTruncateState",value:function(e){jh(e)&&(document.querySelectorAll("#rufus-conversation-container-inner .rufus-category-card-title .a-truncate").forEach(function(e){e.setAttribute("data-a-manual-update","true")}),window.P.when("A","a-truncate").execute(function(e,t){var n="#rufus-conversation-container-inner .rufus-category-card-title";t.manualTruncate(n),t.switchToAutoTruncate(n)}))}},{key:"handleLegacyWindowResize",value:function(){var e=$h(this.rufusFlyoutDiv),t=$h(this.navbar)+this.navbar.offsetHeight+12;if(e<t){var n=t-e;this.newHeight=Math.max(this.newHeight-n,ae),this.rufusFlyoutDiv.style.setProperty("--expanded-container-height",this.newHeight+"px")}}},{key:"handleMovableCLWindowResize",value:function(){var e=this.rufusFlyoutDiv.style.getPropertyValue("--expanded-container-width"),t=this.rufusFlyoutDiv.style.getPropertyValue("--expanded-container-height"),n=e?parseInt(e):this.rufusFlyoutDiv.offsetWidth,r=t?parseInt(t):this.rufusFlyoutDiv.offsetHeight,i=this.navbarmain.getBoundingClientRect().bottom,a=window.innerHeight-i-U,o=r;r>a&&(o=Math.max(a,ae),this.newHeight=o,this.rufusFlyoutDiv.style.setProperty("--expanded-container-height",this.newHeight+"px"));var s=(document.documentElement.clientWidth||window.innerWidth)-n-24,u=window.innerHeight-i-o-U;this.newLeft=Math.max(0,Math.min(this.newLeft,s)),this.newBottom=Math.min(this.newBottom,u),this.newBottom<0&&(this.newBottom=u),this.rufusFlyoutDiv.style.setProperty("--expanded-container-bottom",this.newBottom+"px"),this.rufusFlyoutDiv.style.setProperty("--expanded-container-left",this.newLeft+"px")}},{key:"logPanelFocusMetrics",value:function(){this.panelInFocus?(S.addCount(p.RUFUS_PANEL_INFOCUS,1),Jt(p.RUFUS_PANEL_INFOCUS)):(S.addCount(p.RUFUS_PANEL_OUTFOCUS,1),Jt(p.RUFUS_PANEL_OUTFOCUS))}},{key:"applyPanelAnimation",value:function(e,t){var n="".concat(e,"_").concat(t);this.isMovableCLEnabled&&"docked-right"===this.dockingSide&&("expanded"===e&&"closed"===t?n="expanded_closed_right_ingress":"closed"===e&&"expanded"===t&&(n="closed_expanded_right_ingress"));var r=(this.isMovableCLEnabled?ye:_e).get(n)||"";return""===r?(S.logErrorWithLevel(R.ERROR,"Error adding animation to panel due to invalid transitionKey: ".concat(n,", animationClass should not be empty")),!1):(this.rufusFlyoutDiv.classList.add(r),!0)}},{key:"setupResizeForZone",value:function(e){var t=this;if("none"===e)return!1;var n=nf.getActionsForZone(e);return this.unifiedResizeHandler=function(e){n.forEach(function(n){switch(n){case tf.RESIZE_HEIGHT:t.mousemoveHeight(e);break;case tf.RESIZE_WIDTH:t.mousemoveWidth(e);break;case tf.RESIZE_WIDTH_FROM_LEFT:t.mousemoveWidthFromLeft(e);break;case tf.RESIZE_HEIGHT_FROM_BOTTOM:t.mousemoveHeightFromBottom(e)}})},document.addEventListener("mousemove",this.unifiedResizeHandler),document.addEventListener("mouseup",this.mouseupHandler),!0}},{key:"initializeAccessibilityLabels",value:(r=a(s().mark(function e(){var t,n;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,Kc(document.documentElement.lang);case 1:t=e.sent,this.closeRufusPanelLabel=t.getMessage("rufus_panel_close"),this.openRufusPanelLabel=t.getMessage("rufus_panel_open"),this.undockRufusPanelLabel=t.getMessage("rufus_panel_undock"),this.dockRufusPanelLabel=t.getMessage("rufus_panel_dock"),e.next=3;break;case 2:e.prev=2,n=e.catch(0),S.logErrorWithLevel(R.ERROR,"Error initializing accessibility labels: ".concat(n instanceof Error?n.message:"")),this.closeRufusPanelLabel="Close Rufus panel",this.openRufusPanelLabel="Open Rufus panel",this.undockRufusPanelLabel="Undock Rufus panel",this.dockRufusPanelLabel="Dock Rufus panel";case 3:case"end":return e.stop()}},e,this,[[0,2]])})),function(){return r.apply(this,arguments)})},{key:"getCurrentPanelPosition",value:function(){var e=this.rufusFlyoutDiv.style.getPropertyValue("--expanded-container-bottom"),t=this.rufusFlyoutDiv.style.getPropertyValue("--expanded-container-left");return{bottom:e?parseInt(e):0,left:t?parseInt(t):0}}},{key:"trackMovableCLMetrics",value:function(){var e,t,n,r,i,a,o,s;this.isRepositioning&&(e=this.newLeft,t=this.newBottom,n=this.navbarmain.getBoundingClientRect().bottom,r=this.rufusFlyoutDiv.offsetWidth,i=this.rufusFlyoutDiv.offsetHeight,a=this.getPanelViewContext().pageType||"unknown",o=function(e,t,n,r,i){var a=window.innerWidth/2,o=n+(window.innerHeight-n)/2,s=e+r/2,u=window.innerHeight-t-i/2,c=s<a;return"".concat(u<o?"top":"bottom","_").concat(c?"left":"right")}(e,t,n,r,i),s="".concat(o,"_").concat(a.toLowerCase()),Jt(_.RUFUS_MOVABLE_CL_MOVED,s),S.addCount(p.RUFUS_MOVABLE_CL_MOVED,1)),this.isResizing&&function(e,t,n,r){var i=t>0?ef(e,t):"unchanged",a=r>0?ef(n,r):"unchanged";if("unchanged"!==i||"unchanged"!==a){var o="width_".concat(i,"_height_").concat(a);Jt(_.RUFUS_MOVABLE_CL_RESIZED,o),S.addCount(p.RUFUS_MOVABLE_CL_RESIZED,1)}}(this.rufusFlyoutDiv.clientWidth,this.startResizeWidth,this.rufusFlyoutDiv.clientHeight,this.startResizeHeight)}},{key:"isElementValidTarget",value:function(e,t){return e&&(t===e||e.contains(t))}}]);var r}(In),cf=function(){return c(function e(t){l(this,e),n(this,"RUFUS_PANEL_IMAGE_MODAL_IMAGE",".rufus-panel-image-modal-image"),n(this,"IMAGE_POPOVER_NAME","image-popover"),n(this,"RUFUS_PANEL_IMAGE_MODAL_CLOSE_WRAPPER",".rufus-panel-image-modal-close-wrapper"),n(this,"POPOVER_CLOSE_DATA_MODEL","data-a-popover-close"),this.A=t,this.initialize()},[{key:"initialize",value:function(){this.registerOnImagePopoverShow(this.A)}},{key:"registerOnImagePopoverShow",value:function(e){var t=this;e.on("a:popover:show:"+this.IMAGE_POPOVER_NAME,function(e){S.addCount(p.RUFUS_MULTIMODAL_POPOVER_SHOWN,1);var n=e.popover.getContent(),r=n.find(t.RUFUS_PANEL_IMAGE_MODAL_IMAGE)[0],i=n.find(t.RUFUS_PANEL_IMAGE_MODAL_CLOSE_WRAPPER)[0];t.handleDismissButton(i),r.src.includes(Kd)&&(r.onload=function(){S.widgetBodyEnd(g.RUFUS_HIGH_RESOLUTION_IMAGE_LOADED_LATENCY),S.widgetBodyBegin(g.RUFUS_HIGH_RESOLUTION_IMAGE_RENDERED_LATENCY),r.decode().then(function(){S.widgetBodyEnd(g.RUFUS_HIGH_RESOLUTION_IMAGE_RENDERED_LATENCY)})},r.src=function(e){var t=e.split(".");if(t.length>=2&&e.includes(Kd)&&e.includes(Xd)){var n=t[t.length-2],r=t[t.length-1];return e.replace("".concat(n,".").concat(r),r)}return S.logErrorWithLevel(R.ERROR,"Image has a non-media central url or is not low res url."),e}(r.src),S.widgetBodyBegin(g.RUFUS_HIGH_RESOLUTION_IMAGE_LOADED_LATENCY),r.onerror=function(e){Jd("HIGH","RENDER",e.toString())})})}},{key:"handleDismissButton",value:function(e){var t=this;e.addEventListener("click",function(){S.addCount(p.RUFUS_MULTIMODAL_DISMISS_BUTTON_CLICKED,1);var n=e.parentElement.getAttribute(t.POPOVER_CLOSE_DATA_MODEL);if(null!=n){var r,i,a=null!==(r=null===(i=JSON.parse(n))||void 0===i?void 0:i.actionId)&&void 0!==r?r:"";Jt(_.CLOSE_MEDIA,a)}})}}])}(),lf=function(){return c(function e(t){l(this,e),this.A=t,this.initialize()},[{key:"initialize",value:function(){this.registerOnContinueToSiteClick(this.A),this.registerOnLearnMoreClick(this.A)}},{key:"registerOnContinueToSiteClick",value:function(e){e.declarative("rufus-oam-open-external-link","click",function(e){var t=e&&e.data||{};t&&t.url&&(window.open(t.url,"_blank"),window.P.when("a-modal").execute(function(e){t.modalName&&e.get(t.modalName).hide()}),Jt("CONTINUE_TO_SITE_CLICKED",t.continueToSiteButtonActionId))})}},{key:"registerOnLearnMoreClick",value:function(e){e.declarative("rufus-oam-faq-link","click",function(e){var t=e&&e.data||{};if(t&&t.url){var n;window.open(t.url,"_blank");var r=null===(n=t.actionId)||void 0===n?void 0:n.split("_"),i="hyperlink_learn_more_oam_sd_open_url";Jt("OPEN_URL",r&&r.length>1?[i,r[r.length-2],r[r.length-1]].join("_"):i)}})}}])}();function df(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(df=function(){return!!e})()}var hf=function(e){function t(e){var r;return l(this,t),r=function(e,t,n){return t=h(t),d(e,df()?Reflect.construct(t,[],h(e).constructor):t.apply(e,n))}(this,t),n(r,"isComposing",!1),n(r,"selectedTextContextManager",null),n(r,"selectedTextPill",null),n(r,"setFocus",function(){r.elements.textArea.focus()}),n(r,"handleCompositionStart",function(){r.isComposing=!0}),n(r,"handleCompositionEnd",function(){r.isComposing=!1}),n(r,"handleInput",function(){r.adjustTextAreaHeight(),r.isInputEmpty()?(Jt(_.INPUT_TEXT_ERASE),r.elements.submitButton.classList.add("aok-hidden"),r.elements.submitButton.classList.remove("animate-in")):(r.elements.submitButton.classList.remove("aok-hidden"),r.elements.submitButton.classList.add("animate-in"))}),n(r,"adjustTextAreaHeight",function(){var e=window.getComputedStyle(r.elements.textArea),t=parseFloat(e.paddingTop),n=parseFloat(e.paddingBottom),i=parseFloat(e.lineHeight),a=t+n;r.elements.textArea.style.height="auto",r.elements.textArea.rows=1;var o=r.elements.textArea.scrollHeight,s=4*i+a;o>s?(r.elements.scrollButton.style.bottom="".concat(s+26,"px"),r.elements.textArea.style.overflowY="auto",r.elements.textArea.style.height="".concat(s,"px"),r.elements.textArea.scrollTop=r.elements.textArea.scrollHeight):(r.elements.scrollButton.style.bottom="".concat(o+26,"px"),r.elements.textArea.style.overflowY="hidden",r.elements.textArea.style.height="".concat(o,"px"));var u=r.elements.textArea.offsetWidth-r.elements.textArea.clientWidth,c=(r.panelContainer.isDockingEnabled()?26:20)+u;r.elements.submitButtonContainer.style.paddingRight="".concat(c,"px")}),n(r,"handleKeyDown",function(e){if("Enter"===e.key&&!e.shiftKey){if(r.isIMEComposing(e))return;e.preventDefault(),S.addCount(p.RUFUS_ENTER_PRESSED_ON_INPUT_TEXT,1),r.onQuery()}}),n(r,"handleSubmitMouseUp",function(){r.elements.submitButton.classList.remove("clicked")}),n(r,"handleSubmitMouseDown",function(){r.elements.submitButton.classList.add("clicked")}),n(r,"submitButtonClicked",function(){S.addCount(p.RUFUS_SUBMIT_ON_INPUT_TEXT,1),r.onQuery()}),n(r,"onQuery",function(){var e,t;if(!r.isInputEmpty()){Jt(_.INPUT_TEXT_TRIGGER);var n=r.elements.textArea.value,i=n;null!==(e=r.selectedTextContextManager)&&void 0!==e&&e.hasSelectedTextContext()&&(i=r.selectedTextContextManager.createCustomPrompt(n));var a={query:i};r.dispatch("onQuery",a),r.triggerSlideOutAnimation(),r.elements.textArea.value="",r.adjustTextAreaHeight(),null===(t=r.selectedTextContextManager)||void 0===t||t.clearSelectedTextContext()}}),n(r,"triggerSlideOutAnimation",function(){r.elements.submitButton.classList.remove("animate-in"),r.elements.submitButton.classList.add("animate-out"),setTimeout(function(){r.elements.submitButton.classList.add("aok-hidden"),r.elements.submitButton.classList.remove("animate-out")},200)}),n(r,"logTextFocus",function(){Jt(_.INPUT_TEXT_FOCUS)}),n(r,"isInputEmpty",function(){return""===r.elements.textArea.value.trim()}),n(r,"reset",function(){var e;r.elements.textArea.value="",r.elements.submitButton.classList.add("aok-hidden"),r.elements.submitButton.classList.remove("animate-in","animate-out"),null===(e=r.selectedTextContextManager)||void 0===e||e.clearSelectedTextContext()}),n(r,"initializeSelectedTextPill",function(){r.selectedTextPill&&r.selectedTextPill.initialize(".rufus-textarea-wrapper")}),n(r,"detectAnimatedSvgSupport",function(){if(hl(kt)&&r.elements.submitButton.querySelector(".rufus-arrow-svg")){var e=r.elements.submitButton.querySelector(".rufus-submit-bg"),t=r.elements.submitButton.querySelector(".rufus-arrow-container");e&&(e.style.display=""),t&&(t.style.display=""),r.elements.submitButton.classList.add("has-animated-svg")}}),r.panelContainer=e,r.elements=r.readHtmlElementsFromDom(),r.selectedTextContextManager=sd.getInstance(),r.selectedTextPill=$l.getInstance(),r.reset(),r.attachEventListeners(),r.initializeSelectedTextPill(),r.detectAnimatedSvgSupport(),r}return v(t,e),c(t,[{key:"refreshOnBfCacheNavigation",value:function(){Object.assign(this.elements,this.readHtmlElementsFromDom()),this.attachEventListeners()}},{key:"readHtmlElementsFromDom",value:function(){var e,t=document.querySelector(".nav-rufus-content");return{textArea:document.getElementById("rufus-text-area"),submitButton:document.getElementById("rufus-submit-button"),scrollButton:document.getElementById(D),submitButtonContainer:null!==(e=null==t?void 0:t.querySelector(".rufus-submit-icon-container"))&&void 0!==e?e:null==t?void 0:t.querySelector(".rufus-web-submit-icon-container")}}},{key:"attachEventListeners",value:function(){this.elements.textArea.addEventListener("keydown",this.handleKeyDown),this.elements.textArea.addEventListener("input",this.handleInput),this.elements.textArea.addEventListener("click",this.logTextFocus),this.elements.textArea.addEventListener("compositionstart",this.handleCompositionStart),this.elements.textArea.addEventListener("compositionend",this.handleCompositionEnd),this.elements.submitButton.addEventListener("click",this.submitButtonClicked),this.elements.submitButton.addEventListener("mousedown",this.handleSubmitMouseDown),this.elements.submitButton.addEventListener("mouseup",this.handleSubmitMouseUp),this.elements.submitButton.addEventListener("mouseleave",this.handleSubmitMouseUp)}},{key:"isIMEComposing",value:function(e){return e.isComposing||229===e.keyCode||this.isComposing}}])}(In),ff=function(e){return e.ShouldDelayThickClientInitialization="shouldDelayThickClientInitialization",e.ShouldDelayThickClientInitialStreaming="shouldDelayThickClientInitialStreaming",e}({}),vf=c(function e(){l(this,e)});function pf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function mf(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pf(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pf(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}n(vf,"RASIN_WIDGET_NAME","RufusAsinIngressButton"),n(vf,"RASIN_WIDGET_TYPE","AsinFaceoutComponent"),n(vf,"RASIN_WIDGET_LOCATION","actions-recipe"),n(vf,"RASIN_FEATURE_NAME","rasin");var Ef=function(){function e(){l(this,e)}return c(e,[{key:"buildEnhancedContext",value:function(e){var t,n,r,i=Fh.getInstance().getSearchFilterContext();return i?(this.logRasinQisMetric(null==e||null===(t=e.queryContext)||void 0===t?void 0:t.qis),mf(mf({},e),{},{queryContext:this.buildQueryContext(e.queryContext,i),pageContext:this.buildPageContext(e.pageContext,i,(null==e||null===(n=e.queryContext)||void 0===n?void 0:n.actionType)===rn.ASIN_CLICK),metaDataMap:this.buildMetaDataMap(null==e||null===(r=e.queryContext)||void 0===r?void 0:r.actionType)})):e}},{key:"buildQueryContext",value:function(e,t){if(void 0!==e)return(null==e?void 0:e.actionType)===rn.ASIN_CLICK?mf(mf({},e),{},{actionType:rn.ASIN_CLICK,clickedAsinId:t.asinId,query:"",qis:sn.NILE_ASIN_INGRESS}):mf(mf({},e),{},{actionType:rn.SEARCH,query:null==e?void 0:e.query,qis:null==e?void 0:e.qis})}},{key:"buildPageContext",value:function(e,t,n){if(void 0!==e){var r=[{type:"ASIN",value:t.asinId}],i=mn.extractBaseUrl(e.targetUrl),a=n?"?ref_=".concat(Pe.RASIN_INGRESS_BUTTON_CLICK):"",o="".concat(i,"/dp/").concat(t.asinId).concat(a);return mf(mf({},e),{},{pageType:gn.DETAIL_PAGE,targetPageType:gn.DETAIL_PAGE,originPageType:null==e?void 0:e.originPageType,targetUrl:o,pageMetadata:r,targetPageMetadata:r,originPageMetadata:r})}}},{key:"buildMetaDataMap",value:function(e){if(e){var t=e===rn.ASIN_CLICK;return{rawOriginPageType:gn.SEARCH_RESULTS,rawTargetPageType:gn.SEARCH_RESULTS,widgetName:vf.RASIN_WIDGET_NAME,widgetType:vf.RASIN_WIDGET_TYPE,widgetLocation:vf.RASIN_WIDGET_LOCATION,refmarker:t?Pe.RASIN_INGRESS_BUTTON_CLICK:"",featureName:vf.RASIN_FEATURE_NAME}}}},{key:"logRasinQisMetric",value:function(e){if(e&&Object.values(sn).includes(e))switch(e){case sn.NILE_CL_TEXT_INPUT:S.addCount(p.RASIN_CL_INPUT_QUERY,1);break;case sn.NILE_RELATED_QUESTION:case sn.NILE_DEALS_RELATED_QUESTION:case sn.NILE_NDSWDCS_RELATED_QUESTION:S.addCount(p.RASIN_RQ_PILL_CLICK,1)}}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}])}(),gf=function(){return c(function e(){l(this,e)},null,[{key:"buildContext",value:function(e,t,n,r,i,a,o,s,u,c){var l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",d=this.buildQueryContext(r,i,a,s,u,l),h=this.buildHistoryThreadContext(),f={queryContext:d,pageContext:this.buildPageContext(e,n,r,d.query,o,c,s),bottomSheetContext:this.buildBottomSheetContext(t,n,r),impressionsContext:this.buildImpressionsContext(e,i,o),requestCancellationTokens:this.buildRequestCancellationTokens(e),isDebug:"n",historyThreadContext:h};return Fh.getInstance().getSearchFilterContext()?Ef.getInstance().buildEnhancedContext(f):f}},{key:"buildQueryContext",value:function(e,t,n,r,i){var a,o,s,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",c=mn.extractQueryFromUrl(mn.getCurrentPageUrl());return void 0!==(a=r&&Object.values(un).includes(r)?t||i:t||c||u)&&(null===(o=a)||void 0===o?void 0:o.length)>fe&&(S.addCount(p.INPUT_QUERY_MAX_LIMIT_REACHED,1),a=null===(s=a)||void 0===s?void 0:s.slice(0,fe)),{query:a,actionType:e,qis:r||this.getQueryInputSourceByActionType(e,t),clickedAsinId:n}}},{key:"buildPageContext",value:function(e,t,n,r,i,a,o){var s,u,c,l,d=t.getPanelViewContext(),h=e.getPanelState(),f=mn.getCurrentPageUrl(),v=mn.setReftagAndQisInTargetUrl(f,null==a?void 0:a.url),p=mn.getOriginUrl(),m=yn(d.pageType),E=m!==gn.SEARCH_RESULTS||r?m:gn.UNKNOWN,g=yn(p&&null!=h&&h.originPageType?h.originPageType:""),_=null===(s=(u=mn.metadataParsers)[E])||void 0===s?void 0:s.call(u,f),y=null===(c=(l=mn.metadataParsers)[g])||void 0===c?void 0:c.call(l,p),C=this.isNavigationQuery(n,i,o);return{pageType:E,targetPageType:E,originPageType:C?g:E,targetUrl:v,originUrl:C?p:f,targetPageMetadata:_,pageMetadata:_,originPageMetadata:C?y:_}}},{key:"buildBottomSheetContext",value:function(e,t,n){var r=t.getPanelContainerState();return{bottomSheetEmpty:""===e.getActiveConversationContainerContent().trim()&&0===yl().getState().getAllTurns().length&&n===rn.SWIPE_UP,previousTurnsBottomSheetSize:this.mapPanelViewStateToBottomSheetSize(r.viewState)}}},{key:"buildImpressionsContext",value:function(e,t,n){var r={},i=wt(be);i&&(r[Oe]=i);var a=t&&t.length>0&&!n;return(e.hasCustomerSeenFTUX()||a)&&(e.markCustomerSeenFTUX(),r[an.FIRST_TIME_USER_MESSAGE_SEEN_STATUS]=on.SEEN),e.hasCustomerSeenMovablePanelTooltip()&&(e.markCustomerSeenMovablePanelTooltip(),r[an.MOVABLE_PANEL_TOOLTIP_SEEN_STATUS]=on.SEEN),r}},{key:"buildRequestCancellationTokens",value:function(e){var t,n=null===(t=e.getPanelState())||void 0===t?void 0:t.requestContext;if(n)return[n]}},{key:"getQueryInputSourceByActionType",value:function(e,t){switch(e){case rn.SEARCH:return t&&t.length>0?sn.NILE_CL_TEXT_INPUT:mn.extractQis(mn.getCurrentPageUrl());case rn.SWIPE_UP:return mn.extractQis(mn.getCurrentPageUrl());default:return}}},{key:"mapPanelViewStateToBottomSheetSize",value:function(e){switch(e){case"closed":return Le.HIDDEN;case"minimized":return Le.COLLAPSED;case"expanded":case"docked-left":case"docked-right":return Le.EXPANDED}}},{key:"isNavigationQuery",value:function(e){var t=arguments.length>2?arguments[2]:void 0;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(e===rn.SEARCH||e===rn.ASIN_CLICK)&&t!==un.NILE_OPTION_IN_AUTOCOMPLETE}},{key:"buildHistoryThreadContext",value:function(){return yl().getState().threadId?{threadId:yl().getState().threadId,threadState:yl().getState().threadState}:{threadId:null,threadState:rl}}}])}(),_f=function(){return c(function e(t,r,i){var a=this;l(this,e),n(this,"searchBarQuery",""),n(this,"setSearchBarQuery",function(e){a.searchBarQuery=e}),n(this,"setIsRufusStayBehaviorRequired",function(e){a.isRufusStayBehaviorRequired=""===e?void 0:"true"===e}),this.panelContainer=t,this.cacheManager=r,this.conversationList=i,this.searchFilterContextBuilder=Ef.getInstance()},[{key:"buildContext",value:function(e,t,n,r,i,a,o){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7])return gf.buildContext(this.cacheManager,this.conversationList,this.panelContainer,e,t,n,r,i,a,o,this.getSearchBarQuery());var s=this.buildQueryContext(e,t,n,i,a),u={queryContext:s,pageContext:this.buildPageContext(e,s.query,r,o,i),bottomSheetContext:this.buildBottomSheetContext(e),impressionsContext:this.buildImpressionsContext(t,r,i===sn.NILE_ASIN_INGRESS),requestCancellationTokens:this.buildRequestCancellationTokens(),isDebug:"n"};return Fh.getInstance().getSearchFilterContext()?this.searchFilterContextBuilder.buildEnhancedContext(u):u}},{key:"buildFeedbackPageContext",value:function(){var e,t,n=this.panelContainer.getPanelViewContext(),r=mn.getCurrentPageUrl(),i=yn(n.pageType),a=null===(e=(t=mn.metadataParsers)[i])||void 0===e?void 0:e.call(t,r);return{pageType:i,targetPageType:i,originPageType:i,targetUrl:mn.getCurrentPageUrl(),originUrl:r,targetPageMetadata:a,pageMetadata:a,originPageMetadata:a}}},{key:"getSearchBarQuery",value:function(){return this.searchBarQuery}},{key:"getIsRufusStayBehaviorRequired",value:function(){return this.isRufusStayBehaviorRequired}},{key:"buildQueryContext",value:function(e,t,n,r,i){var a,o,s,u=mn.extractQueryFromUrl(mn.getCurrentPageUrl()),c=this.getSearchBarQuery();return void 0!==(a=r&&Object.values(un).includes(r)?t||i:t||u||c)&&(null===(o=a)||void 0===o?void 0:o.length)>fe&&(S.addCount(p.INPUT_QUERY_MAX_LIMIT_REACHED,1),a=null===(s=a)||void 0===s?void 0:s.slice(0,fe)),{query:a,actionType:e,qis:r||this.getQueryInputSourceByActionType(e,t),clickedAsinId:n}}},{key:"buildPageContext",value:function(e,t,n,r,i){var a,o,s,u,c=this.panelContainer.getPanelViewContext(),l=this.cacheManager.getPanelState(),d=mn.getCurrentPageUrl(),h=mn.setReftagAndQisInTargetUrl(d,null==r?void 0:r.url),f=mn.getOriginUrl(),v=yn(c.pageType),p=v!==gn.SEARCH_RESULTS||t?v:gn.UNKNOWN,m=yn(f&&null!=l&&l.originPageType?l.originPageType:""),E=null===(a=(o=mn.metadataParsers)[p])||void 0===a?void 0:a.call(o,d),g=null===(s=(u=mn.metadataParsers)[m])||void 0===s?void 0:s.call(u,f),_=this.isNavigationQuery(e,n,i);return{pageType:p,targetPageType:p,originPageType:_?m:p,targetUrl:h,originUrl:_?f:d,targetPageMetadata:E,pageMetadata:E,originPageMetadata:_?g:E}}},{key:"buildBottomSheetContext",value:function(e){var t=this.panelContainer.getPanelContainerState();return{bottomSheetEmpty:""===this.conversationList.getActiveConversationContainerContent().trim()&&0===yl().getState().getAllTurns().length&&e===rn.SWIPE_UP,previousTurnsBottomSheetSize:this.mapPanelViewStateToBottomSheetSize(t.viewState)}}},{key:"buildImpressionsContext",value:function(e,t,n){var r={},i=wt(be);i&&(r[Oe]=i);var a=e&&e.length>0&&!t;return(this.cacheManager.hasCustomerSeenFTUX()||a||n)&&(this.cacheManager.markCustomerSeenFTUX(),r[an.FIRST_TIME_USER_MESSAGE_SEEN_STATUS]=on.SEEN),this.cacheManager.hasCustomerSeenMovablePanelTooltip()&&(this.cacheManager.markCustomerSeenMovablePanelTooltip(),r[an.MOVABLE_PANEL_TOOLTIP_SEEN_STATUS]=on.SEEN),r}},{key:"buildRequestCancellationTokens",value:function(){var e,t=null===(e=this.cacheManager.getPanelState())||void 0===e?void 0:e.requestContext;if(t)return[t]}},{key:"getQueryInputSourceByActionType",value:function(e,t){switch(e){case rn.SEARCH:return t&&t.length>0?sn.NILE_CL_TEXT_INPUT:mn.extractQis(mn.getCurrentPageUrl());case rn.SWIPE_UP:return mn.extractQis(mn.getCurrentPageUrl());default:return}}},{key:"mapPanelViewStateToBottomSheetSize",value:function(e){switch(e){case"closed":return Le.HIDDEN;case"minimized":return Le.COLLAPSED;case"expanded":case"docked-left":case"docked-right":return Le.EXPANDED}}},{key:"isNavigationQuery",value:function(e){var t=arguments.length>2?arguments[2]:void 0;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(e===rn.SEARCH||e===rn.ASIN_CLICK)&&t!==un.NILE_OPTION_IN_AUTOCOMPLETE}}])}(),yf=function(){return c(function e(t,r){var i=this;l(this,e),n(this,"RUFUS_EVENT_METRIC_SUFFIX",n({},Sh.HANDLE_EXPAND,"_expand_rufus")),this.panelContainer=t,this.conversationOrchestrator=r,this.events=n(n({},Sh.HANDLE_EXPAND,function(e){return i.handleExpand(e)}),Sh.HANDLE_STREAM,function(e){return i.handleStreamForCL(e)})},[{key:"init",value:function(){this.registerEvents(this.events)}},{key:"registerEvents",value:function(e){Object.entries(e).forEach(function(e){var t=xt(e,2),n=t[0],r=t[1];window.P&&P.declare(n,r)})}},{key:"handleExpand",value:function(e){if(e){var t=e+this.RUFUS_EVENT_METRIC_SUFFIX[Sh.HANDLE_EXPAND];S.addCount(t,1),this.updatePanelState("expanded")}else S.logErrorWithLevel(R.ERROR,"Error handling rufus panel expand with empty rufusClient name")}},{key:"handleStreamForCL",value:function(e){if(this.validateDataBeforeHandlingRufusStream(e))e.metricName&&S.addCount(e.metricName,1),this.conversationOrchestrator.stream(e),this.updatePanelState("expanded");else{var t="Error handling rufus stream with params: "+JSON.stringify(e);S.logErrorWithLevel(R.ERROR,t)}}},{key:"validateDataBeforeHandlingRufusStream",value:function(e){return!!(e.qis&&e.query&&e.metricName)}},{key:"updatePanelState",value:function(e){var t=this.panelContainer.getPanelContainerState().viewState;this.panelContainer.applyAnimationAndStateUpdate(t,e)}}])}(),Cf=function(){return c(function e(){l(this,e),n(this,"localStorage",!1),n(this,"sessionStorage",!1),n(this,"webCrypto",!1),n(this,"flexbox",!1),n(this,"browserName",""),this.checkCapabilities()},[{key:"areAllFeaturesSupported",value:function(){return this.localStorage&&this.sessionStorage&&this.webCrypto&&this.flexbox}},{key:"checkIsStreamingInterruptedBehaviorDifferent",value:function(){return this.browserName=Wt.getInstance().browserName,"Safari"===this.browserName}},{key:"checkCapabilities",value:function(){this.checkLocalStorage(),this.checkSessionStorage(),this.checkFlexbox(),this.checkWebCrypto()}},{key:"checkLocalStorage",value:function(){try{localStorage.setItem("test","test"),localStorage.removeItem("test"),this.localStorage=!0}catch(e){this.localStorage=!1}}},{key:"checkSessionStorage",value:function(){try{sessionStorage.setItem("test","test"),sessionStorage.removeItem("test"),this.sessionStorage=!0}catch(e){this.sessionStorage=!1}}},{key:"checkWebCrypto",value:function(){this.webCrypto=!(!window.crypto||!window.crypto.subtle)}},{key:"checkFlexbox",value:function(){var e=document.createElement("div");e.style.display="flex",this.flexbox="flex"===e.style.display}}])}();function Rf(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+e+(n.length?" "+n.map(function(e){return"'"+e+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Tf(e){return!!e&&!!e[uv]}function Sf(e){var t;return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===cv}(e)||Array.isArray(e)||!!e[sv]||!!(null===(t=e.constructor)||void 0===t?void 0:t[sv])||Lf(e)||Pf(e))}function If(e,t,n){void 0===n&&(n=!1),0===Af(e)?(n?Object.keys:lv)(e).forEach(function(r){n&&"symbol"==typeof r||t(r,e[r],e)}):e.forEach(function(n,r){return t(r,n,e)})}function Af(e){var t=e[uv];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:Lf(e)?2:Pf(e)?3:0}function Of(e,t){return 2===Af(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function bf(e,t,n){var r=Af(e);2===r?e.set(t,n):3===r?e.add(n):e[t]=n}function Lf(e){return rv&&e instanceof Map}function Pf(e){return iv&&e instanceof Set}function Nf(e){return e.o||e.t}function kf(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=dv(e);delete t[uv];for(var n=lv(t),r=0;r<n.length;r++){var i=n[r],a=t[i];!1===a.writable&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[i]})}return Object.create(Object.getPrototypeOf(e),t)}function Uf(e,t){return void 0===t&&(t=!1),Mf(e)||Tf(e)||!Sf(e)||(Af(e)>1&&(e.set=e.add=e.clear=e.delete=Df),Object.freeze(e),t&&If(e,function(e,t){return Uf(t,!0)},!0)),e}function Df(){Rf(2)}function Mf(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function wf(e){var t=hv[e];return t||Rf(18,e),t}function Ff(){return tv}function xf(e,t){t&&(wf("Patches"),e.u=[],e.s=[],e.v=t)}function Hf(e){Bf(e),e.p.forEach(Vf),e.p=null}function Bf(e){e===tv&&(tv=e.l)}function Wf(e){return tv={p:[],l:tv,h:e,m:!0,_:0}}function Vf(e){var t=e[uv];0===t.i||1===t.i?t.j():t.g=!0}function Gf(e,t){t._=t.p.length;var n=t.p[0],r=void 0!==e&&e!==n;return t.h.O||wf("ES5").S(t,e,r),r?(n[uv].P&&(Hf(t),Rf(4)),Sf(e)&&(e=zf(t,e),t.l||Yf(t,e)),t.u&&wf("Patches").M(n[uv].t,e,t.u,t.s)):e=zf(t,n,[]),Hf(t),t.u&&t.v(t.u,t.s),e!==ov?e:void 0}function zf(e,t,n){if(Mf(t))return t;var r=t[uv];if(!r)return If(t,function(i,a){return jf(e,r,t,i,a,n)},!0),t;if(r.A!==e)return t;if(!r.P)return Yf(e,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var i=4===r.i||5===r.i?r.o=kf(r.k):r.o,a=i,o=!1;3===r.i&&(a=new Set(i),i.clear(),o=!0),If(a,function(t,a){return jf(e,r,i,t,a,n,o)}),Yf(e,i,!1),n&&e.u&&wf("Patches").N(r,n,e.u,e.s)}return r.o}function jf(e,t,n,r,i,a,o){if(Tf(i)){var s=zf(e,i,a&&t&&3!==t.i&&!Of(t.R,r)?a.concat(r):void 0);if(bf(n,r,s),!Tf(s))return;e.m=!1}else o&&n.add(i);if(Sf(i)&&!Mf(i)){if(!e.h.D&&e._<1)return;zf(e,i),t&&t.A.l||Yf(e,i)}}function Yf(e,t,n){void 0===n&&(n=!1),!e.l&&e.h.D&&e.m&&Uf(t,n)}function Kf(e,t){var n=e[uv];return(n?Nf(n):e)[t]}function qf(e,t){if(t in e)for(var n=Object.getPrototypeOf(e);n;){var r=Object.getOwnPropertyDescriptor(n,t);if(r)return r;n=Object.getPrototypeOf(n)}}function Xf(e){e.P||(e.P=!0,e.l&&Xf(e.l))}function Zf(e){e.o||(e.o=kf(e.t))}function Qf(e,t,n){var r=Lf(t)?wf("MapSet").F(t,n):Pf(t)?wf("MapSet").T(t,n):e.O?function(e,t){var n=Array.isArray(e),r={i:n?1:0,A:t?t.A:Ff(),P:!1,I:!1,R:{},l:t,t:e,k:null,o:null,j:null,C:!1},i=r,a=fv;n&&(i=[r],a=vv);var o=Proxy.revocable(i,a),s=o.revoke,u=o.proxy;return r.k=u,r.j=s,u}(t,n):wf("ES5").J(t,n);return(n?n.A:Ff()).p.push(r),r}function Jf(e){return Tf(e)||Rf(22,e),function e(t){if(!Sf(t))return t;var n,r=t[uv],i=Af(t);if(r){if(!r.P&&(r.i<4||!wf("ES5").K(r)))return r.t;r.I=!0,n=$f(t,i),r.I=!1}else n=$f(t,i);return If(n,function(t,i){r&&function(e,t){return 2===Af(e)?e.get(t):e[t]}(r.t,t)===i||bf(n,t,e(i))}),3===i?new Set(n):n}(e)}function $f(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return kf(e)}var ev,tv,nv="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),rv="undefined"!=typeof Map,iv="undefined"!=typeof Set,av="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,ov=nv?Symbol.for("immer-nothing"):((ev={})["immer-nothing"]=!0,ev),sv=nv?Symbol.for("immer-draftable"):"__$immer_draftable",uv=nv?Symbol.for("immer-state"):"__$immer_state",cv=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),lv="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,dv=Object.getOwnPropertyDescriptors||function(e){var t={};return lv(e).forEach(function(n){t[n]=Object.getOwnPropertyDescriptor(e,n)}),t},hv={},fv={get:function(e,t){if(t===uv)return e;var n=Nf(e);if(!Of(n,t))return function(e,t,n){var r,i=qf(t,n);return i?"value"in i?i.value:null===(r=i.get)||void 0===r?void 0:r.call(e.k):void 0}(e,n,t);var r=n[t];return e.I||!Sf(r)?r:r===Kf(e.t,t)?(Zf(e),e.o[t]=Qf(e.A.h,r,e)):r},has:function(e,t){return t in Nf(e)},ownKeys:function(e){return Reflect.ownKeys(Nf(e))},set:function(e,t,n){var r=qf(Nf(e),t);if(null==r?void 0:r.set)return r.set.call(e.k,n),!0;if(!e.P){var i=Kf(Nf(e),t),a=null==i?void 0:i[uv];if(a&&a.t===n)return e.o[t]=n,e.R[t]=!1,!0;if(function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}(n,i)&&(void 0!==n||Of(e.t,t)))return!0;Zf(e),Xf(e)}return e.o[t]===n&&(void 0!==n||t in e.o)||Number.isNaN(n)&&Number.isNaN(e.o[t])||(e.o[t]=n,e.R[t]=!0),!0},deleteProperty:function(e,t){return void 0!==Kf(e.t,t)||t in e.t?(e.R[t]=!1,Zf(e),Xf(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var n=Nf(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},defineProperty:function(){Rf(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){Rf(12)}},vv={};If(fv,function(e,t){vv[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),vv.deleteProperty=function(e,t){return vv.set.call(this,e,t,void 0)},vv.set=function(e,t,n){return fv.set.call(this,e[0],t,n,e[0])};var pv=function(){function e(e){var t=this;this.O=av,this.D=!0,this.produce=function(e,n,r){if("function"==typeof e&&"function"!=typeof n){var i=n;n=e;var a=t;return function(e){var t=this;void 0===e&&(e=i);for(var r=arguments.length,o=Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];return a.produce(e,function(e){var r;return(r=n).call.apply(r,[t,e].concat(o))})}}var o;if("function"!=typeof n&&Rf(6),void 0!==r&&"function"!=typeof r&&Rf(7),Sf(e)){var s=Wf(t),u=Qf(t,e,void 0),c=!0;try{o=n(u),c=!1}finally{c?Hf(s):Bf(s)}return"undefined"!=typeof Promise&&o instanceof Promise?o.then(function(e){return xf(s,r),Gf(e,s)},function(e){throw Hf(s),e}):(xf(s,r),Gf(o,s))}if(!e||"object"!=typeof e){if(void 0===(o=n(e))&&(o=e),o===ov&&(o=void 0),t.D&&Uf(o,!0),r){var l=[],d=[];wf("Patches").M(e,o,l,d),r(l,d)}return o}Rf(21,e)},this.produceWithPatches=function(e,n){if("function"==typeof e)return function(n){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return t.produceWithPatches(n,function(t){return e.apply(void 0,[t].concat(i))})};var r,i,a=t.produce(e,n,function(e,t){r=e,i=t});return"undefined"!=typeof Promise&&a instanceof Promise?a.then(function(e){return[e,r,i]}):[a,r,i]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){Sf(e)||Rf(8),Tf(e)&&(e=Jf(e));var t=Wf(this),n=Qf(this,e,void 0);return n[uv].C=!0,Bf(t),n},t.finishDraft=function(e,t){var n=(e&&e[uv]).A;return xf(n,t),Gf(void 0,n)},t.setAutoFreeze=function(e){this.D=e},t.setUseProxies=function(e){e&&!av&&Rf(20),this.O=e},t.applyPatches=function(e,t){var n;for(n=t.length-1;n>=0;n--){var r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}n>-1&&(t=t.slice(n+1));var i=wf("Patches").$;return Tf(e)?i(e,t):this.produce(e,function(e){return i(e,t)})},e}(),mv=new pv,Ev=(mv.produce,mv.produceWithPatches.bind(mv),mv.setAutoFreeze.bind(mv),mv.setUseProxies.bind(mv),mv.applyPatches.bind(mv)),gv=(mv.createDraft.bind(mv),mv.finishDraft.bind(mv),function(){function t(){l(this,t),n(this,"pendingPageReload",!1)}return c(t,[{key:"executePendingActions",value:function(){this.pendingPageReload&&(window.location.reload(),this.pendingPageReload=!1,S.addCount(p.RUFUS_CART_PAGE_REFRESHED,1))}},{key:"handleActionChunk",value:function(e,n){if(null!=e&&e.action){var r=e.action,i=r.actionType,a=r.actionId,o=r.payload;a?i===nn.UPDATE_CART_COUNTER?this.handleUpdateCartCount(o,a,n):S.logErrorWithLevel(R.ERROR,"Unknown NTSActionType: ".concat(i)):S.logErrorWithLevel(R.ERROR,t.ERROR_MISSING_ACTION_ID)}else S.logErrorWithLevel(R.ERROR,t.ERROR_INVALID_ACTION_CHUNK)}},{key:"handleUpdateCartCount",value:function(e,n,r){try{var i,a,o=this.isUpdateCartCountPayload(e)?e:null,s=!1;r===gn.CART?(this.pendingPageReload=!0,s=!0):o&&null!==(i=window.navbar)&&void 0!==i&&i.setCartCount&&Number.isFinite(o.totalCartCount)&&(window.navbar.setCartCount(o.totalCartCount),S.addCount(p.RUFUS_CART_COUNT_UPDATED,1),s=!0),s&&Jt(t.UPDATE_CART_COUNTER_METRIC_NAME,n,null==o||null===(a=o.eventMetadata)||void 0===a?void 0:a.featureBIMetadata)}catch(e){S.logErrorWithLevel(R.ERROR,"Error updating cart count for ".concat(n,": ").concat(e))}}},{key:"isUpdateCartCountPayload",value:function(t){return null!=t&&"object"===e(t)&&"totalCartCount"in t&&"number"==typeof t.totalCartCount}}])}());n(gv,"UPDATE_CART_COUNTER_METRIC_NAME","UPDATE_CART_COUNTER"),n(gv,"ERROR_INVALID_ACTION_CHUNK","Invalid action chunk data"),n(gv,"ERROR_MISSING_ACTION_ID","Missing actionId in action chunk");var _v=function(){return c(function e(t,n){l(this,e),this.animationUtil=t,this.conversationList=n},[{key:"removeLoadingMessage",value:function(e,t){var n=this;this.animationUtil.enqueueAnimation(function(){return S.addCount(p.SECTION_REMOVED,1),Jt(_.REMOVE_SECTION),n.animateRemovalOfInterimLoadingMessage(e,t),null!=(null==e?void 0:e.querySelector(".rufus-loading-message-template"))&&e?e:void 0}),this.animationUtil.enqueueAnimation(function(){return S.addCount(p.BULLET_POINT_VERTICAL_COLLAPSE,1),Jt(_.BULLET_POINT_VERTICAL_COLLAPSE),n.handleBulletPointAnimation(e,t)})}},{key:"animateRemovalOfInterimLoadingMessage",value:function(e,t){var n=this;if(e){var r=e.getElementsByClassName("rufus-text-wrap"),i=setTimeout(function(){yl().getState().removeTurnsByGroupId("section_groupId_".concat(t)),n.updateReactCaches()},500);if(1===r.length)this.handleTextWrapAnimation(e,r.length,i,t);else for(var a=0;a<r.length;a++){var o=r[a];this.handleTextWrapAnimation(o,r.length,i,t)}}}},{key:"handleTextWrapAnimation",value:function(e,t,n,r){var i=this,a=function(o){o.target===e&&(e.removeEventListener("animationend",a),1===t&&setTimeout(function(){yl().getState().removeTurnsByGroupId("section_groupId_".concat(r)),i.updateReactCaches(),clearTimeout(n)},100))};if(t>1){var o=e.getBoundingClientRect().height;e.style.minHeight="".concat(o,"px")}setTimeout(function(){e.removeEventListener("animationend",a),clearTimeout(n)},510),e.addEventListener("animationend",a),e.classList.add("rufus-loading-message-fade-out")}},{key:"handleBulletPointAnimation",value:function(e,t){var n=this;if(e){var r=setTimeout(function(){yl().getState().removeTurnsByGroupId("section_groupId_".concat(t)),n.updateReactCaches()},600),i=e.getElementsByClassName("ellipse-pulse");if(i.length>1){for(var a=i.length-1,o=i[a],s=function(){var e=i[u];setTimeout(function(){e.style.opacity="0",e.style.transition="opacity 10ms ease"},150*(a-u))},u=i.length-2;u>=0;u--)s();var c=i[0].getBoundingClientRect().top,l=o.getBoundingClientRect().top,d=function(e){e.target===o&&(o.removeEventListener("animationend",d),setTimeout(function(){yl().getState().removeTurnsByGroupId("section_groupId_".concat(t)),n.updateReactCaches(),clearTimeout(r)},100))};return o.addEventListener("animationend",d),o.classList.add("ellipse-vertical-collapse"),o.style.setProperty("--y-position","-".concat(l-c,"px")),o.style.setProperty("--animation-duration","".concat(150*a,"ms")),o}setTimeout(function(){yl().getState().removeTurnsByGroupId("section_groupId_".concat(t)),n.updateReactCaches(),clearTimeout(r)},300)}}},{key:"updateReactCaches",value:function(){this.conversationList.updatePapyrusReactStateAndHTMLCache()}}])}(),yv=function(){function e(t,r){var i=this;l(this,e),n(this,"onDismissClick",function(e){e.preventDefault(),Jt(_.FILTER_PILL_DISMISS_CLICK,y.ASIN_REFINEMENT),S.addCount(p.RASIN_FILTER_PILL_DISMISS_CLICK,1),Fh.getInstance().setSearchFilterContext(null),i.hide()}),n(this,"onPillClick",function(){var e;Jt(_.FILTER_PILL_CLICK,y.ASIN_REFINEMENT),Jt(nn.OPEN_URL,"".concat(y.FILTER_PILL_INGRESS_PREFIX).concat(null===(e=Fh.getInstance())||void 0===e||null===(e=e.getSearchFilterContext())||void 0===e?void 0:e.asinId)),S.addCount(p.RASIN_FILTER_PILL_CLICK,1)}),this.elements={container:t,link:t.querySelector("#rufus-asin-filter-pill-content"),image:t.querySelector("#rufus-asin-filter-pill-preview-image"),title:t.querySelector(".rufus-asin-filter-pill-title"),dismissButton:t.querySelector(".rufus-asin-filter-pill-dismiss")},this.shade=document.querySelector(".".concat(St)),this.updateContent(r),this.show(),this.attachHandlers()}return c(e,[{key:"hide",value:function(){e.hideFilterPillAndShadeElements(this.elements.container,this.shade)}},{key:"updateContent",value:function(e){this.elements.link.href="/dp/".concat(e.asinId,"/").concat(Pe.DP_FROM_FILTER_PILL),this.elements.image.src=e.productImageUrl||"",this.elements.image.alt=e.asinTitle,this.elements.title.textContent=e.asinTitle}},{key:"show",value:function(){e.toggleElementVisibility(this.elements.container,!0,Rt,Tt),e.toggleElementVisibility(this.shade,!0,It,At),this.elements.container.setAttribute("aria-label","Conversation filter set to: ".concat(this.elements.title.textContent))}},{key:"attachHandlers",value:function(){this.elements.dismissButton.onclick=this.onDismissClick,this.elements.link.onclick=this.onPillClick}}],[{key:"createIfPossible",value:function(t){var n=document.getElementById(Ct);return n?new e(n,t):(S.logErrorWithLevel(R.WARN,"No filter pill element found in DOM"),null)}},{key:"cleanupRasinFilterPill",value:function(){var t=document.getElementById(Ct),n=document.querySelector(".".concat(St));t&&n&&!t.classList.contains(Ot)&&e.hideFilterPillAndShadeElements(t,n)}},{key:"toggleElementVisibility",value:function(e,t,n,r){e&&(t?(e.classList.remove(Ot,r),e.classList.add(n)):(e.classList.remove(n),e.classList.add(r),e.addEventListener("animationend",function(){e.classList.add(Ot),e.classList.remove(r)},{once:!0})))}},{key:"hideFilterPillAndShadeElements",value:function(t,n){e.toggleElementVisibility(t,!1,Rt,Tt),e.toggleElementVisibility(n,!1,It,At)}}])}(),Cv=function(){return c(function e(t,r){var i=this;l(this,e),n(this,"handleRufusAwareAsinCtaClick",function(e){i.panelContainer.applyAnimationAndStateUpdate(i.panelContainer.getPanelContainerState().viewState,"expanded");var t=Fh.getInstance().getSearchFilterContext();e.asinId!==(null==t?void 0:t.asinId)&&(Fh.getInstance().setSearchFilterContext({asinId:e.asinId,productImageUrl:e.productImageURL,asinTitle:e.asinTitle,dpLink:e.dpLink}),i.streamingClient.startStream({actionType:rn.ASIN_CLICK,inputQuery:"",isInitialStream:!1,qis:sn.NILE_ASIN_INGRESS}))}),n(this,"handleAsinContextChange",function(e){if(e){if(!yv.createIfPossible(e))return}else yv.cleanupRasinFilterPill(),i.streamForSearch()}),this.panelContainer=t,this.streamingClient=r},[{key:"initialize",value:function(){var e=Fh.getInstance(),t=!!document.getElementById("rufus-asin-filter-pill");return e&&t?(e.on("contextUpdated",this.handleAsinContextChange),this.registerRasinCtaClickHandler(),S.addCount(p.RASIN_INITIALIZE_SUCCESS,1),!0):(S.addCount(p.RASIN_INITIALIZATION_ERROR,1),!1)}},{key:"registerRasinCtaClickHandler",value:function(){var e=this;P.when("A").execute(function(t){t.on("rufus-asin-context",function(t){e.handleRufusAwareAsinCtaClick(t)})})}},{key:"streamForSearch",value:function(){var e=this.panelContainer.getPanelViewContext();this.streamingClient.startStream({actionType:rn.SEARCH,isInitialStream:!1,qis:e.qis,metadata:e.metadata,reftag:mn.extractNileReftagFromUrl(mn.getCurrentPageUrl())})}}])}(),Rv="rufus-ask-rufus-tooltip",Tv="rufus-text-selection-tooltip-visible",Sv=function(){function e(){var t=this;l(this,e),n(this,"tooltipElement",null),n(this,"showTimeoutId",null),n(this,"isListenerAttached",!1),n(this,"selectedTextContextManager",null),n(this,"onAskRufusClickCallback",null),n(this,"handleSelectionChange",function(){t.showTimeoutId&&(clearTimeout(t.showTimeoutId),t.showTimeoutId=null),t.showTimeoutId=setTimeout(function(){t.updateTooltipVisibility()},100)}),n(this,"handleMouseDown",function(e){t.tooltipElement&&t.tooltipElement.contains(e.target)||t.hideTooltip()}),n(this,"handleTooltipClick",function(e){e.preventDefault(),e.stopPropagation();var n=window.getSelection();if(n&&!n.isCollapsed){var r=n.toString().trim();if(0!==r.length)try{var i=t.isSelectionInsideRufusPanel(n);i?S.addCount(p.ASK_RUFUS_TOOLTIP_CLICK_INSIDE_PANEL,1):S.addCount(p.ASK_RUFUS_TOOLTIP_CLICK_OUTSIDE_PANEL,1);var a=i?y.INSIDE_PANEL:y.OUTSIDE_PANEL;Jt(_.ASK_RUFUS_TOOLTIP_CLICK,a),t.selectedTextContextManager&&t.selectedTextContextManager.setSelectedTextContext(r),t.onAskRufusClickCallback&&t.onAskRufusClickCallback(r),n.removeAllRanges(),t.hideTooltip()}catch(e){S.logErrorWithLevelWithException(R.ERROR,e,"".concat("TextSelectionTooltip"," - Error handling tooltip click"))}}}),n(this,"handleTooltipKeydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t.handleTooltipClick(e))}),this.selectedTextContextManager=sd.getInstance()}return c(e,[{key:"initialize",value:function(e){this.isListenerAttached||(this.onAskRufusClickCallback=e,this.createTooltipElement(),this.attachEventListeners(),this.isListenerAttached=!0)}},{key:"cleanup",value:function(){this.removeEventListeners(),this.removeTooltipElement(),this.isListenerAttached=!1}},{key:"createTooltipElement",value:function(){this.removeTooltipElement();var e=document.createElement("div");e.id=Rv,e.className="rufus-text-selection-tooltip",e.setAttribute("role","button"),e.setAttribute("tabindex","0"),e.setAttribute("aria-label","Ask Rufus about selected text");var t=document.createElement("span");t.className="rufus-tooltip-icon";var n=document.createElement("span");n.className="rufus-tooltip-text",n.textContent="Ask Rufus",e.appendChild(t),e.appendChild(n),e.addEventListener("click",this.handleTooltipClick),e.addEventListener("keydown",this.handleTooltipKeydown),document.body.appendChild(e),this.tooltipElement=e}},{key:"removeTooltipElement",value:function(){this.tooltipElement&&(this.tooltipElement.removeEventListener("click",this.handleTooltipClick),this.tooltipElement.removeEventListener("keydown",this.handleTooltipKeydown),this.tooltipElement.remove(),this.tooltipElement=null);var e=document.getElementById(Rv);e&&e.remove()}},{key:"attachEventListeners",value:function(){document.addEventListener("selectionchange",this.handleSelectionChange),document.addEventListener("mousedown",this.handleMouseDown)}},{key:"removeEventListeners",value:function(){document.removeEventListener("selectionchange",this.handleSelectionChange),document.removeEventListener("mousedown",this.handleMouseDown)}},{key:"updateTooltipVisibility",value:function(){var e=window.getSelection();if(e&&!e.isCollapsed&&e.toString().trim())if(0!==e.toString().trim().length){var t=e.getRangeAt(0).getBoundingClientRect();this.showTooltip(t)}else this.hideTooltip();else this.hideTooltip()}},{key:"showTooltip",value:function(e){if(this.tooltipElement){var t=this.tooltipElement.offsetWidth||120,n=e.left+e.width/2-t/2,r=e.bottom+window.scrollY+8,i=window.innerWidth,a=Math.max(10,Math.min(n,i-t-10));this.tooltipElement.style.left="".concat(a,"px"),this.tooltipElement.style.top="".concat(r,"px"),this.tooltipElement.classList.contains(Tv)||(S.addCount(p.ASK_RUFUS_TOOLTIP_SHOWN,1),dl.getInstance().isWeblabTreatmentEnabledAndRecordTrigger(ql)),this.tooltipElement.classList.add(Tv)}}},{key:"hideTooltip",value:function(){this.tooltipElement&&this.tooltipElement.classList.remove(Tv)}},{key:"isSelectionInsideRufusPanel",value:function(e){try{var t=document.getElementById("nav-flyout-rufus");if(!t)return!1;if(e.anchorNode){var n=e.anchorNode.nodeType===Node.ELEMENT_NODE?e.anchorNode:e.anchorNode.parentElement;if(n&&t.contains(n))return!0}return!1}catch(e){return!1}}}],[{key:"getInstance",value:function(){return e.isFeatureEnabled()?(e.instance||(e.instance=new e),e.instance):null}},{key:"isFeatureEnabled",value:function(){return"T1"===dl.getInstance().getWeblabTreatment(ql)}},{key:"resetInstance",value:function(){e.instance&&e.instance.cleanup(),e.instance=null}}])}();function Iv(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Av(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Av(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Av(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}n(Sv,"instance",null);var Ov=function(){return c(function e(){l(this,e),n(this,"asinFaceoutState",{expectAsinFaceoutChunkNext:!1})},[{key:"detectAsinFaceoutChunkReference",value:function(e){if(e.sections&&Array.isArray(e.sections)){var t,n=Iv(e.sections);try{for(n.s();!(t=n.n()).done;){var r,i,a=t.value,o=null===(r=a.content)||void 0===r?void 0:r.data;if("string"==typeof o&&o.startsWith("CHUNK_")&&"AsinFaceoutList"===(null===(i=a.target)||void 0===i?void 0:i.type))return this.asinFaceoutState={expectAsinFaceoutChunkNext:!0,faceoutAction:a.action},!0}}catch(e){n.e(e)}finally{n.f()}}return!1}},{key:"isExpectingAsinFaceout",value:function(){return this.asinFaceoutState.expectAsinFaceoutChunkNext}},{key:"handleAsinFaceoutHtmlUpdate",value:function(e){var t=e.htmlContent;if(!t)return this.asinFaceoutState={expectAsinFaceoutChunkNext:!1},!1;var n=this.extractGroupIdFromHtml(t);return this.asinFaceoutState={expectAsinFaceoutChunkNext:!1},!(!n||!t||(yl().getState().updateTurnContent(n,t),0))}},{key:"handleFooterReplace",value:function(e){var t,n,r=this,i=(null===(t=e.sections)||void 0===t?void 0:t.filter(function(e){return"REPLACE"===e.action}))||[],a=Iv(i);try{var o,s=function(){var e,t,i=n.value,a=null===(e=i.target)||void 0===e?void 0:e.groupId;if("AsinFaceoutFooter"===(null===(t=i.target)||void 0===t?void 0:t.type)&&null!=a&&a.includes("_asinFooter")){var o,s=(null===(o=i.content)||void 0===o?void 0:o.data)||"",u=a.replace("_asinFooter",""),c=yl().getState().getAllTurns().find(function(e){return e.groupId===u});if(c&&c.content){var l=r.insertFooterIntoAsinCard(c.content,a,s);yl().getState().updateTurnContent(u,l)}return i._processed=!0,{v:!0}}};for(a.s();!(n=a.n()).done;)if(o=s())return o.v}catch(e){a.e(e)}finally{a.f()}return!1}},{key:"insertFooterIntoAsinCard",value:function(e,t,n){var r=t,i=document.createElement("div");i.innerHTML=n;var a=i.querySelector("#".concat(r)),o=a?a.innerHTML:n,s=document.createElement("div");s.innerHTML=e;var u=s.querySelector("#".concat(r));return u?(u.innerHTML=o,s.innerHTML):e}},{key:"extractGroupIdFromHtml",value:function(e){var t=null==e?void 0:e.match(/id="(section_groupId_[^"]+)"/);return(null==t?void 0:t[1])||null}}])}(),bv=function(e){return e.COLLAPSED="collapsed",e.HALF="half",e.EXPANDED="expanded",e.TEASER="teaser",e.TEASER_AUTO_EXPAND="teaserAutoExpand",e}({}),Lv=function(e){return e.REPLACE="replace",e.ADD="add",e.REMOVE="remove",e}({}),Pv=r(8295),Nv="Customer question";Kc(document.documentElement.lang).then(function(e){Nv=e.getMessage("customer_question")}).catch(function(e){S.logErrorWithLevelWithException(R.ERROR,e,"Failed to load customer_question translation")});var kv=function(e,t){var n=sd.parsePromptWithContext(e);return n?Uv(n.userQuery,n.selectedText,t):Dv(e,t)},Uv=function(e,t,n){var r=ed(Mv(t,50),t);return'<div class="rufus-sections-container '.concat(n?"rufus-query-fade-in":"",'" data-section-class="CustomerText">\n        <div class="rufus-sr-only">').concat(Nv,'</div>\n        <div class="a-section rufus-conversation-branding-update rufus-customer-text rufus-dialog-customer rufus-customer-text-with-context">\n            ').concat(r,'\n            <div class="rufus-speech-bubble">\n                <span class="rufus-customer-text-wrap">').concat(e?(0,Pv.encoder)().encodeForHTML(e):"","</span>\n            </div>\n        </div>\n    </div>")},Dv=function(e,t){return'<div class="rufus-sections-container '.concat(t?"rufus-query-fade-in":"",'" data-section-class="CustomerText">\n        <div class="rufus-sr-only">').concat(Nv,'</div>\n        <div class="a-section rufus-conversation-branding-update rufus-customer-text rufus-dialog-customer">\n            <div class="rufus-speech-bubble">\n                <span class="rufus-customer-text-wrap">').concat(e?(0,Pv.encoder)().encodeForHTML(e):"","</span>\n            </div>\n        </div>\n    </div>")},Mv=function(e,t){return e.length<=t?e:e.substring(0,t-3)+"..."},wv=function(e,t){var n=kv(e,t);return{type:b.HTML_CONTENT_TURN_START,id:"customer-text-".concat(Date.now()),content:n,timestamp:Date.now()}},Fv=function(e,t){if(t&&e){var n=function(e){try{return JSON.parse(e)}catch(n){var t="Error parsing rufusTriggerMarkerMappingString: ".concat(e,". ").concat(n);return void S.logErrorWithLevel(R.ERROR,t)}}(e);return null==n?void 0:n[t]}},xv=function(){var e=a(s().mark(function e(t){var n,r,i,o,u,c=arguments;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:3e3,r=c.length>2?c[2]:void 0,i=!1,o=c.length>3?c[3]:void 0,u=function(){var e=a(s().mark(function e(){var n;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=4;break}return i=!0,e.prev=1,e.next=2,t();case 2:e.next=4;break;case 3:e.prev=3,n=e.catch(1),S.logErrorWithLevelWithException(R.ERROR,n);case 4:case"end":return e.stop()}},e,null,[[1,3]])}));return function(){return e.apply(this,arguments)}}(),Pd.startTimeout(o,u,n),!r){e.next=1;break}return e.next=1,new Promise(function(e){P.when(r).execute(a(s().mark(function t(){return s().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!Pd.hasTimeout(o)){t.next=1;break}return Pd.clear(o),t.next=1,u();case 1:e();case 2:case"end":return t.stop()}},t)})))});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();function Hv(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Hv=function(){return!!e})()}var Bv=function(e){return e.ActiveWithActiveContainerAnchor="ActiveWithActiveContainerAnchor",e.ActiveWithAnchor="ActiveWithAnchor",e.ActiveWithoutAnchor="ActiveWithoutAnchor",e.Inactive="Inactive",e}({}),Wv=function(e){function t(e){var r;return l(this,t),r=function(e,t,n){return t=h(t),d(e,Hv()?Reflect.construct(t,[],h(e).constructor):t.apply(e,n))}(this,t),n(r,"topAlignmentTolerance",1),n(r,"autoScrollAnchorTopOffset",12),n(r,"firstScrollEventLogged",!1),n(r,"isMixedRenderingEnabled",!1),n(r,"SHOW_SCROLL_BAR_CLASS","show-scroll-bar"),n(r,"autoScroll",function(){r.handleTurnsRenderingScrolling(),r.autoScrollingState!==Bv.Inactive&&r.toggleScrollBarVisibility(!1),r.autoScrollingState===Bv.ActiveWithoutAnchor?r.scrollToBottom():r.autoScrollingState===Bv.ActiveWithAnchor?r.scrollToLatestConversationTurn():r.autoScrollingState===Bv.ActiveWithActiveContainerAnchor&&r.scrollToTopOfActiveConversationContainer(),r.toggleScrollButtonVisibility()}),n(r,"scrollToBottom",function(){r.toggleScrollBarVisibility(!1),r.elements.container.scrollTop=r.elements.container.scrollHeight-r.elements.container.clientHeight}),n(r,"scrollToLatestConversationTurn",function(){var e=r.getLatestConversationTurnOrContainer(),t=r.calculateScrollPositionToLatestConversationTurnWithOffset(e);if(r.isMixedRenderingEnabled){var n,i=null!==(n=r.getLastActiveInteraction())&&void 0!==n?n:r.getLastHtmlTurnStart();if(i){var a=r.calculateScrollPositionWithOffset(i);return void(r.elements.container.scrollTop=Math.min(a,t))}}r.elements.container.scrollTop=t}),n(r,"scrollToTopOfActiveConversationContainer",function(){var e,t=r.isMixedRenderingEnabled?null!==(e=r.getLastActiveInteraction())&&void 0!==e?e:r.getLastHtmlTurnStart():r.elements.activeConversationContainer;t&&(r.elements.container.scrollTop=r.calculateScrollPositionWithOffset(t))}),n(r,"handleScroll",function(e){e.stopPropagation(),r.toggleScrollButtonVisibility()}),n(r,"toggleScrollButtonVisibility",function(){r.updateScrollButtonBottomPosition(),r.elements.scrollButton.style.display=r.shouldDisplayScrollButton()?"flex":"none"}),n(r,"shouldDisplayScrollButton",function(){if(!r.panelContainer.isPanelOpened()||r.panelContainer.isShowAnimationRunning())return!1;if(!(r.elements.container.clientHeight<r.elements.container.scrollHeight))return!1;var e=r.isAutoScrollingIdle(),t=r.isScrolledAwayFromBottom();return e&&t}),n(r,"calculateScrollPositionToShowScrollButton",function(e){var t=r.elements.container.scrollHeight-r.elements.container.clientHeight-75;return e?t-104:t}),n(r,"updateScrollButtonBottomPosition",function(){var e=r.elements.scrollButton,t=document.querySelector(".rufus-textarea-container");r.isRasinVisible()&&t?e.style.bottom="".concat(116,"px"):e.style.bottom=r.panelContainer.isDockingEnabled()?"".concat(80,"px"):"".concat(64,"px")}),n(r,"isRasinVisible",function(){var e=document.querySelector(".".concat(Ct)),t=document.querySelector(".".concat(St)),n=!!e&&e.classList.contains(Rt),r=!!t&&t.classList.contains(It);return n&&r}),n(r,"handleKeyDownOnContainer",function(e){vt.includes(e.key)&&r.onManualScroll()}),n(r,"handleKeyDown",function(e){"Enter"===e.key&&r.handleArrowDownButtonClick()}),n(r,"toggleScrollBarVisibility",function(e){r.elements.container.classList.toggle(r.SHOW_SCROLL_BAR_CLASS,e)}),n(r,"onManualScroll",function(){r.setAutoScrollingState(Bv.Inactive),r.toggleScrollBarVisibility(!0),r.firstScrollEventLogged||(Jt(_.SCROLL_VIEW),r.firstScrollEventLogged=!0),r.elements.container.scrollTop<100&&r.dispatch("onTopReached",void 0)}),n(r,"handleArrowDownButtonClick",function(){r.setAutoScrollingState(Bv.ActiveWithoutAnchor),r.elements.scrollButton.style.display="none",r.scrollToBottom(),Jt(_.SCROLL_VIEW_END),S.addCount(p.RUFUS_SCROLL_DOWN_CLICKED,1)}),r.missingElementsRecorder=new vd("ScrollingUtil"),r.elements=r.readHtmlElementsFromDom(),r.autoScrollingState=Bv.Inactive,r.panelContainer=e,r.attachEventListeners(),r}return v(t,e),c(t,[{key:"refreshOnBfCacheNavigation",value:function(){Object.assign(this.elements,this.readHtmlElementsFromDom()),this.attachEventListeners()}},{key:"readHtmlElementsFromDom",value:function(){var e={container:this.missingElementsRecorder.getElementOrRecordMissing(L),activeConversationContainer:this.missingElementsRecorder.getElementOrRecordMissing(M),scrollButton:this.missingElementsRecorder.getElementOrRecordMissing(D),reactContainer:this.missingElementsRecorder.getElementOrRecordMissing($e)};return this.missingElementsRecorder.logMissingElementsAndThrowError(),e}},{key:"setReactContainer",value:function(){var e;this.isMixedRenderingEnabled=null!==(e=hl(Pt))&&void 0!==e&&e,this.isMixedRenderingEnabled&&(this.elements.activeConversationContainer=this.missingElementsRecorder.getElementOrRecordMissing("rufus-react-renderer"))}},{key:"attachEventListeners",value:function(){var e=this;this.elements.container.addEventListener("wheel",this.onManualScroll),this.elements.container.addEventListener("touchstart",this.onManualScroll),this.elements.container.addEventListener("scroll",this.handleScroll),this.elements.container.addEventListener("keydown",this.handleKeyDownOnContainer),this.elements.container.addEventListener("pointerup",this.onManualScroll),this.elements.container.addEventListener("pointercancel",this.onManualScroll),new MutationObserver(function(){e.toggleScrollButtonVisibility()}).observe(this.elements.container,{childList:!0,subtree:!0}),this.elements.scrollButton.addEventListener("click",this.handleArrowDownButtonClick),this.elements.scrollButton.addEventListener("keydown",this.handleKeyDown),this.panelContainer.on("updateScrollButtonVisibility",this.toggleScrollButtonVisibility)}},{key:"scrollIntoView",value:function(e){this.setAutoScrollingState(Bv.Inactive);var t=document.getElementById(e);t&&t.scrollIntoView({block:"nearest"})}},{key:"setAutoScrollingState",value:function(e){this.autoScrollingState=e}},{key:"getAutoScrollingState",value:function(){return this.autoScrollingState}},{key:"isAutoScrollingIdle",value:function(){return this.autoScrollingState===Bv.Inactive||(this.autoScrollingState===Bv.ActiveWithActiveContainerAnchor||this.autoScrollingState===Bv.ActiveWithAnchor)&&this.isCurrentConversationContainerAtTopOfPanel()}},{key:"isScrolledAwayFromBottom",value:function(){return this.elements.container.scrollTop<this.calculateScrollPositionToShowScrollButton(this.isRasinVisible())}},{key:"getElementVerticalDistanceRelativeToScrollContainer",value:function(e){if(!e)return 0;var t=this.elements.container.getBoundingClientRect();return e.getBoundingClientRect().top-t.top}},{key:"isCurrentConversationContainerAtTopOfPanel",value:function(){if(this.isMixedRenderingEnabled){var e,t=null!==(e=this.getLastActiveInteraction())&&void 0!==e?e:this.getLastHtmlTurnStart();if(t){var n=this.calculateScrollPositionWithOffset(t);return this.isScrollPositionClose(this.elements.container.scrollTop,n)}}var r=this.getLatestConversationTurnOrContainer(),i=this.calculateScrollPositionToLatestConversationTurnWithOffset(r);return this.isScrollPositionClose(this.elements.container.scrollTop,i)}},{key:"calculateScrollPositionWithOffset",value:function(e){return e.offsetTop-this.autoScrollAnchorTopOffset}},{key:"getLastHtmlTurnStart",value:function(){var e,t=null===(e=this.elements.reactContainer)||void 0===e?void 0:e.querySelectorAll(".rufus-html-turn-start, .rufus-html-turn-contextual-pills");return null==t?void 0:t[t.length-1]}},{key:"getLastActiveInteraction",value:function(){if(this.elements.reactContainer){var e=this.elements.reactContainer.querySelectorAll(".rufus-papyrus-active-turn");if(0!==e.length)return e[e.length-1]}}},{key:"getLatestConversationTurnOrContainer",value:function(){if(this.isMixedRenderingEnabled)return this.getLatestTurnInMixedRendering();var e=this.elements.activeConversationContainer.children;return e.length>0?e[e.length-1]:this.elements.activeConversationContainer}},{key:"getLatestTurnInMixedRendering",value:function(){var e=this.getLastActiveInteraction();if(e)return e;var t=this.getLastHtmlTurnStart();if(t){var n=t.parentElement;if(!n)return t;var r=Array.from(n.children),i=r.indexOf(t),a=r.slice(i+1);return a.length>0?a[a.length-1]:t}}},{key:"calculateScrollPositionToLatestConversationTurnWithOffset",value:function(e){return e?this.getElementVerticalDistanceRelativeToScrollContainer(e)+this.elements.container.scrollTop-this.autoScrollAnchorTopOffset:this.elements.container.scrollTop}},{key:"isScrollPositionClose",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.topAlignmentTolerance;return Math.abs(e-t)<=n}},{key:"handleTurnsRenderingScrolling",value:function(){var e=yl().getState();if(e.getThreadState()===nl&&e.getThreadId()){var t=this.elements.container.style.scrollBehavior;return this.elements.container.style.scrollBehavior="auto",this.scrollToBottom(),void(this.elements.container.style.scrollBehavior=t)}}}])}(In);function Vv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Gv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function zv(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Gv(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gv(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function jv(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(jv=function(){return!!e})()}var Yv="ConversationOrchestrator",Kv=function(t){function r(t,i,o,u,c,f,v,m,E,g,y,C,T,I,A){var O,L,N,k;return l(this,r),k=function(e,t,n){return t=h(t),d(e,jv()?Reflect.construct(t,[],h(e).constructor):t.apply(e,n))}(this,r),n(k,"startInitialStreamingCallback",function(){if(!k.cacheManager.getHistoricalThreadId()){if(k.shouldSkipStreamingOnSearchResults())return P.declare("rufus-teaser-cx-bsr-teaser",!0),S.addCount(p.RUFUS_TEASER_RECOVERY_WIDGET_SENT_TO_SEARCH,1),void Jt(_.TEASER_RECOVERY_WIDGET_SENT_TO_SEARCH);if(k.isJSMigration){if(Oh(window.location.href))return;var e;if(P.now("rufus-cl-disable-default-initial-streaming").execute(function(t){e=t}),e)return}(k.needsRemovePartialFTUE()||k.needsRemoveEmptyConversationTurn())&&k.conversationList.modifyContent(Eh.RemoveLastActiveTurn),k.conversationList.isCustomerTextPresent()||k.conversationList.clearPapyrusReactCXAndCache(),k.streamingClient.startInitialStreamingCall(k.panelContainer.getPanelViewContext())}}),n(k,"handleInvokeHistoryAPI",function(){var e=a(s().mark(function e(t){var n,r,i;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return k.terminateOngoingStreaming(),k.isMixedRenderingEnabled?(yl().getState().clearConversation(),k.conversationList.clearPapyrusReactCache()):k.conversationList.modifyContent(Eh.ReplaceActive,""),k.historyClient.resetPagination(),yl().getState().resetTurnPagination(),k.panelContainer.closeChatHistoryContainer(),e.prev=1,e.next=2,k.historyClient.fetchHistory(0,"",Wl.TURN,t);case 2:"string"!=typeof(n=e.sent)&&(yl().getState().setTurns(n),yl().getState().setThreadContext(t,nl),k.cacheManager.setHistoryThreadContextCache(),r=k.historyClient.hasMoreHistory(),yl().getState().setHasMoreTurns(r),k.updateReactCaches()),e.next=4;break;case 3:e.prev=3,i=e.catch(1),S.logErrorWithLevelWithException(R.ERROR,i,"".concat(Yv," - Error fetching conversation turns")),yl().getState().setConversationErrorMessage(pt);case 4:case"end":return e.stop()}},e,null,[[1,3]])}));return function(t){return e.apply(this,arguments)}}()),n(k,"needsRemovePartialFTUE",function(){return!k.conversationList.isLastTurnAnimationComplete()&&!k.conversationList.isAffordancePresentInContainer()}),n(k,"needsRemoveEmptyConversationTurn",function(){return k.conversationList.isLastTurnContentEmpty()}),n(k,"handleRetryRequest",function(){var e=k.cacheManager.getRequestMetadata();e&&k.streamingClient.startStream(e)}),n(k,"saveRequestMetadataToPanelCache",function(e){k.cacheManager.setRequestMetadata(e)}),n(k,"handleThumbsDownClick",function(e){k.scrollingUtil.scrollIntoView(e)}),n(k,"handleOfflineError",function(){S.addCount(p.RUFUS_OFFLINE,1);var e=[gt,_t];(Pd.clearTimeouts(e),k.cacheManager.getRequestMetadata())?(k.streamingClient.getStreamingStatus().streamingStatus===Fd.OPEN||Fd.STREAMING,k.renderOfflineError()):k.renderOfflineError()}),n(k,"handleOnlineEvent",function(){pd.removeError(fd.OFFLINE)}),n(k,"renderOfflineError",function(){pd.renderError({errorCode:fd.OFFLINE,errorMessage:mt}),requestAnimationFrame(function(){k.scrollingUtil.scrollToBottom()})}),n(k,"onPageUnload",function(){k.isPageUnload=!0}),n(k,"handleStreamingStatusUpdate",function(){var e=a(s().mark(function e(t){var n,r,i,a,o,u,c,l,d,h;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.streamingStatus,r=t.isInitialStream,i=t.actionType,a=t.requestContext,o=k.capabilityManager.checkIsStreamingInterruptedBehaviorDifferent(),n!==Fd.OPEN&&n!==Fd.STREAMING||(k.conversationList.toggleLoaderAndUpdateAnnouncer(mh.VisibleWithAvatar),o&&n===Fd.STREAMING&&(window.removeEventListener("beforeunload",k.onPageUnload),window.addEventListener("beforeunload",k.onPageUnload))),n===Fd.STREAMING&&(k.isTopAnchoringEnabled||k.conversationList.removeTemporarySections(),k.animationUtil.stopAnimating(),k.isTopAnchoringEnabled||k.conversationList.createNewStreamContainer(r,i),r?(k.scrollingUtil.scrollToBottom(),k.scrollingUtil.setAutoScrollingState(Bv.ActiveWithActiveContainerAnchor)):(k.scrollingUtil.setAutoScrollingState(Bv.ActiveWithAnchor),!k.isMixedRenderingEnabled&&k.scrollingUtil.autoScroll(),k.conversationList.getInterruptionRecoveryHandler().getInterruptionRecoveryContainer()&&(k.conversationList.getInterruptionRecoveryHandler().moveInterruptionRecoveryContainerOutOfConversation(k.isTopAnchoringEnabled),k.updateCache())),a&&(null==a||null===(u=a.queryContext)||void 0===u?void 0:u.qis)===sn.NILE_CL_TEXT_INPUT&&""!==(l=null!==(c=a.queryContext.query)&&void 0!==c?c:"")))if(k.isMixedRenderingEnabled)try{d=wv(l,k.isTopAnchoringEnabled),yl().getState().addTurns([d]),k.updateReactCaches()}catch(e){S.logErrorWithLevelWithException(R.ERROR,e,"".concat(Yv," - Error adding customer text turn for mixed rendering"))}else h=kv(l),k.conversationList.modifyContent(Eh.InsertIntoLastActiveTurn,h);k.textInput.setFocus(),n!==Fd.CLOSED&&n!==Fd.ERROR||(window.removeEventListener("beforeunload",k.onPageUnload),k.animationUtil.getQueue().length<1&&k.conversationList.toggleLoaderAndUpdateAnnouncer(mh.Hidden),k.actionChunkHandler.executePendingActions(),o&&k.isPageUnload||k.cacheManager.setPanelRequestCompleted(!0));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),n(k,"removeLoader",function(){var e=k.streamingClient.getStreamingStatus().streamingStatus;e!==Fd.CLOSED&&e!==Fd.ERROR||k.conversationList.toggleLoaderAndUpdateAnnouncer(mh.Hidden),e===Fd.CLOSED&&k.streamingLifecycleEventLogger.emitStreamRenderEnd()}),n(k,"markAnimationComplete",function(){k.streamingClient.getStreamingStatus().streamingStatus===Fd.CLOSED&&k.conversationList.markLastTurnAnimationComplete()}),n(k,"stream",function(e){k.isMixedRenderingEnabled&&k.clearsNewChatMessage(),navigator.onLine?(k.chunkTypeToLatencyDataMap=new Map,k.streamingClient.startStream({actionType:rn.SEARCH,inputQuery:e.query,qis:e.qis,metadata:e.metadata,reftag:Pe.CUSTOMER_SUBMITTED_QUERY})):k.handleOfflineError()}),n(k,"handleEventReceived",function(e){var t,n;switch(null!==(t=e.streamingEventType)&&void 0!==t?t:e.event.type){case Md.CONTEXT:k.handleContextChunk(e.event);break;case Md.CONVERSATION_METADATA:k.handleConversationMetadataChunk(e.event);break;case Md.AFFORDANCE:if((null===(n=e.streamingStatusDetails.requestContext)||void 0===n||null===(n=n.queryContext)||void 0===n?void 0:n.qis)===sn.NILE_CL_TEXT_INPUT)return;k.isMixedRenderingEnabled?k.handleContentChunkInReact(e):k.handleContentChunk(e);break;case Md.REMOVE:k.isMixedRenderingEnabled?k.handleRemoveEventForReact(e):k.handleRemoveEvent(e.event);break;case Md.ACTION:k.handleActionChunk(e.event);break;default:k.isMixedRenderingEnabled?k.handleContentChunkInReact(e):k.handleContentChunk(e)}}),n(k,"onEventReceivedForPapyrusFlow",function(e){var t,n;try{n=JSON.parse(e.event.data)}catch(e){return void S.logErrorWithLevelWithException(R.ERROR,e,"".concat(Yv," - Error handling content chunk for Papyrus FTUX/RUX: ").concat(e instanceof Error?"(".concat(e.message,")"):""))}if(null!==(t=n)&&void 0!==t&&t.sections&&Array.isArray(n.sections)){var r=n.sections,i=k.conversationList.getPapyrusFtux(),a=r.filter(function(e){var t=k.isValidTurn(e);return t||S.logErrorWithLevel(R.ERROR,"".concat(Yv," - Invalid Turn object received: ").concat(JSON.stringify(e))),t}).filter(function(e){return!(!k.isPapyrusCachingEnabled&&i&&e.id.startsWith(nt))});yl().getState().addTurns(a),k.conversationList.updatePapyrusReactStateAndHTMLCache()}else S.logErrorWithLevel(R.ERROR,"".concat(Yv," - Invalid data structure: sections is missing or not an array: ").concat(JSON.stringify(n)))}),n(k,"isValidTurn",function(t){return t&&"object"===e(t)&&"string"==typeof t.type&&"string"==typeof t.id}),n(k,"handleEventReceivedV2",function(e){var t,n,r=null!==(t=e.streamingEventType)&&void 0!==t?t:e.event.type;switch(k.chunkTypeToLatencyDataMap.has(r)||k.chunkTypeToLatencyDataMap.set(r,Date.now()),e.chunkTypeToLatencyDataMap=k.chunkTypeToLatencyDataMap,r){case Md.CONTEXT:k.handleContextChunk(e.event);break;case Md.CONVERSATION_METADATA:k.handleConversationMetadataChunk(e.event);break;case Md.AFFORDANCE:if((null===(n=e.streamingStatusDetails.requestContext)||void 0===n||null===(n=n.queryContext)||void 0===n?void 0:n.qis)===sn.NILE_CL_TEXT_INPUT)return;k.isMixedRenderingEnabled?k.handleContentChunkInReact(e):k.handleContentChunkV2(e);break;case Md.REMOVE:k.isMixedRenderingEnabled?k.handleRemoveEventForReact(e):k.handleRemoveEventV2(e.event);break;case Md.ACTION:k.handleActionChunk(e.event);break;default:k.isMixedRenderingEnabled?k.handleContentChunkInReact(e):k.handleContentChunkV2(e)}}),n(k,"handleLoadMoreHistory",a(s().mark(function e(){var t;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!k.historyClient.isLoading()&&k.historyClient.hasMoreHistory()){e.next=1;break}return e.abrupt("return");case 1:return e.prev=1,e.next=2,k.fetchHistory(Eh.PrependHistory);case 2:e.next=4;break;case 3:e.prev=3,t=e.catch(1),S.logErrorWithLevelWithException(R.ERROR,t,"Could not load more history");case 4:case"end":return e.stop()}},e,null,[[1,3]])}))),n(k,"handleInterruptionRecoveryButtonClick",function(){var e=a(s().mark(function e(t){var n;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,k.recoverInterruptedConversationFromHistory(t);case 1:e.next=3;break;case 2:e.prev=2,n=e.catch(0),k.conversationList.getInterruptionRecoveryHandler().dismissInterruptionRecoverySpinnerAndShowButton(),S.logErrorWithLevelWithException(R.ERROR,n,"Failed to call history endpoint to load interrupted conversation"),S.addCount(p.INTERRUPTION_RECOVERY_FAILED,1);case 3:case"end":return e.stop()}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}()),n(k,"handleTopReached",function(){S.addCount(p.RUFUS_SCROLL_TO_TOP,1);var e=yl().getState();if(e.getThreadState()===nl&&e.getThreadId())k.handleLoadMoreTurns();else if(!k.historyClient.isLoading()){var t=k.historyClient.hasMoreHistory(),n=k.isMixedRenderingEnabled?dh.hasPapyrusFtuxOrRux():k.conversationList.isFtuxPresent(),r=k.isMixedRenderingEnabled?n:k.conversationList.isFtuxOrRuxOnScreen(),i=k.isMixedRenderingEnabled?dh.getCustomerTurnsCount():k.conversationList.getNumberOfConversationTurns(),a=!n&&i>=5&&t&&!k.conversationList.isSpinnerShowing(),o=!!document.getElementById(Ie),s=!t&&!r&&!o;k.conversationList.toggleLoadMoreHistoryButtonElementVisibility(a),k.conversationList.toggleBeginningOfHistoryElementVisibility(s)}}),n(k,"handleCompleteMovingActiveConversationTurnsToHistory",a(s().mark(function e(){return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,k.invalidateCache(!0);case 1:case"end":return e.stop()}},e)}))),n(k,"handleConversationListCompleteReplacingContent",function(){k.updateCache(),k.cacheManager.updateLastCacheInvalidatedTimestamp()}),n(k,"invalidateCache",function(){var e=a(s().mark(function e(t){var n;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!k.isInvalidatingCache){e.next=1;break}return e.abrupt("return");case 1:if(k.isInvalidatingCache=!0,k.conversationList.toggleLoadMoreHistoryButtonElementVisibility(!1),e.prev=2,k.cacheManager.shouldInvalidatePanelCache()){e.next=3;break}return S.addCount(p.RUFUS_PANEL_CACHE_VALID,1),e.abrupt("return");case 3:return e.next=4,k.replaceCache(t);case 4:k.cacheManager.setRequestMetadata(void 0),S.addCount(p.RUFUS_PANEL_CACHE_INVALID,1),e.next=6;break;case 5:e.prev=5,n=e.catch(2),S.logErrorWithLevelWithException(R.ERROR,n,"Could not invalidate cache");case 6:return e.prev=6,k.isInvalidatingCache=!1,e.finish(6);case 7:case"end":return e.stop()}},e,null,[[2,5,6,7]])}));return function(t){return e.apply(this,arguments)}}()),n(k,"convertHtmlToTurns",function(e,t){var n=[],r=e.sections||[];if(r.forEach(function(e,r){var i,a,o=null===(i=e.content)||void 0===i?void 0:i.data,s=null===(a=e.target)||void 0===a?void 0:a.groupId,u=e.action;k.isTopAnchoringEnabled&&s.startsWith("section_groupId_customer_text")&&(o=function(e){try{var t=(new DOMParser).parseFromString(e,"text/html"),n=t.querySelector(".rufus-sections-container");return n&&!n.classList.contains("rufus-query-fade-in")?(n.classList.add("rufus-query-fade-in"),t.body.innerHTML):e}catch(t){return S.logErrorWithLevelWithException(R.ERROR,t,"Failed to parse HTML for fade-in class addition"),e}}(o)),o?n.push({type:k.getHTMLSectionType(s,t),id:"html-turn-".concat(Date.now(),"-").concat(r),groupId:s,content:o,action:u,timestamp:Date.now()}):S.logErrorWithLevel(R.ERROR,"".concat(Yv," - No HTML Data found: Index ").concat(r,". Section ").concat(JSON.stringify(e)))}),0===r.length){var i=e.content||e.html||e.data||"";i?n.push({type:b.HTML_CONTENT,id:"html-turn-".concat(Date.now()),content:i,timestamp:Date.now()}):S.logErrorWithLevel(R.WARN,"".concat(Yv," - No HTML Data found for legacy data without sections"))}return n}),n(k,"updateCache",function(){k.cacheManager.setPanelContent(k.conversationList.getPanelContentSnapshot())}),n(k,"handlePanelStateChange",function(e){k.updateContainerStateCache(e),k.logInterruptStreamMetric(e)}),n(k,"handlePanelAnimationEnd",function(e){jh(e)&&k.textInput.setFocus()}),n(k,"logInterruptStreamMetric",function(e){"minimized"!==e.viewState&&"closed"!==e.viewState||k.streamingClient.getStreamingStatus().streamingStatus!==Fd.STREAMING&&k.streamingClient.getStreamingStatus().streamingStatus!==Fd.OPEN||(Jt(_.CONVERSATION_ABANDONMENT,"closed"===e.viewState?_.PANEL_CLOSE_CLICK:_.PANEL_MINIMIZE_CLICK),S.addCount(p.RUFUS_STREAM_INTERRUPT,1))}),n(k,"updateContainerStateCache",function(e){var t=k.cacheManager.getPanel();if(t){var n=zv(zv({},t.state),e);k.cacheManager.setPanelState(n)}}),n(k,"updatePanelContainerState",function(){var e,t,n,r=k.panelContainer.getPanelContainerState();r.originPageType=null===(e=k.cacheManager.getPanelState())||void 0===e?void 0:e.targetPageType,r.targetPageType=k.panelContainer.getPanelViewContext().pageType,r.autoMinimize=null!==(t=null===(n=k.cacheManager.getPanelState())||void 0===n?void 0:n.autoMinimize)&&void 0!==t&&t,k.updateContainerStateCache(r)}),n(k,"handleContextChunk",function(e){try{var t=JSON.parse(e.data);jt.getInstance().nileRequestId=t.requestContext.requestId,k.handleBSR(t.bsr.bottomSheetSize),Jt(_.INVOKE_NILE),k.cacheManager.setPanelRequestContext(zv(zv({},t.requestContext),{},{requestCompleted:!1}))}catch(e){pd.renderError({errorCode:fd.HANDLE_CONTEXT_CHUNK_ERROR}),S.logErrorWithLevelWithException(R.ERROR,e,"".concat(Yv," - Error handling context chunk ","(".concat(e.message,")")))}}),n(k,"handleConversationMetadataChunk",function(e){try{var t=JSON.parse(e.data).threadId;yl().getState().setThreadId(t),k.cacheManager.setHistoryThreadContextCache()}catch(e){pd.renderError({errorCode:fd.HANDLE_CONVERSATION_METADATA_CHUNK_ERROR}),S.logErrorWithLevelWithException(R.ERROR,e,"".concat(Yv," - Error handling conversation metadata chunk ","(".concat(e.message,")")))}}),n(k,"handleBSR",function(e){switch(e){case bv.TEASER:k.isEligibleToShowTeaser()&&(P.declare("rufus-teaser-cx-bsr-teaser",jt.getInstance().nileRequestId),S.addCount(p.RUFUS_TEASER_WIDGET_BSR_SENT_TO_SEARCH,1),Jt(_.TEASER_WIDGET_BSR_SENT_TO_SEARCH));break;case bv.TEASER_AUTO_EXPAND:if(k.isEligibleToShowTeaser()){var t=k.panelContainer.getPanelContainerState().viewState;k.panelContainer.applyAnimationAndStateUpdate(t,"expanded"),Jt(_.TEASER_AUTO_EXPANDS_CL),S.addCount(p.RUFUS_TEASER_AUTO_EXPANDS_CL,1)}break;default:k.panelContainer.handlePanelContainerViewStateUpdateWithCXZen(e)}}),n(k,"handleContentChunk",function(e){k.conversationList.updateHtmlSections(e),k.updateAnimationUtilPanelState(k.panelContainer.getPanelContainerState())}),n(k,"handleContentChunkV2",function(e){k.conversationList.updateHtmlSectionsV2(e),k.updateAnimationUtilPanelState(k.panelContainer.getPanelContainerState())}),n(k,"updateAnimationUtilPanelState",function(e){k.animationUtil.setViewState(e)}),n(k,"handleActionChunk",function(e){try{var t=JSON.parse(e.data),n=yn(k.panelContainer.getPanelViewContext().pageType);k.actionChunkHandler.handleActionChunk(t,n)}catch(e){S.logErrorWithLevelWithException(R.ERROR,e,"".concat(Yv," - Error handling action chunk: ").concat(e instanceof Error?"(".concat(e.message,")"):""))}}),n(k,"handleRemoveEvent",function(e){var t,n,r;try{r=JSON.parse(e.data)}catch(e){return void S.logErrorWithLevelWithException(R.ERROR,e,"".concat(Yv," - Error handling remove event: ").concat(e instanceof Error?"(".concat(e.message,")"):""))}k.conversationList.removeHtml(null===(t=r)||void 0===t?void 0:t.type,null===(n=r)||void 0===n?void 0:n.groupId)}),n(k,"handleRemoveEventV2",function(e){var t,n;try{n=JSON.parse(e.data)}catch(e){return void S.logErrorWithLevelWithException(R.ERROR,e,"".concat(Yv," - Error handling remove event: ").concat(e instanceof Error?"(".concat(e.message,")"):""))}n&&null!==(t=n.sections[0])&&void 0!==t&&t.target.groupId&&k.conversationList.removeHtml(n.sections[0].target.type,n.sections[0].target.groupId)}),n(k,"handleRemoveEventForReact",function(e){var t,n;try{n=JSON.parse(e.event.data)}catch(e){return void S.logErrorWithLevelWithException(R.ERROR,e,"".concat(Yv," - Error handling remove event for React: ").concat(e instanceof Error?"(".concat(e.message,")"):""))}var r=null===(t=n.sections)||void 0===t||null===(t=t[0])||void 0===t||null===(t=t.target)||void 0===t?void 0:t.groupId;if(r){var i=document.getElementById("section_groupId_".concat(r));null!=(null==i?void 0:i.querySelector(".rufus-loading-message-template"))&&i?k.loadingMessageAnimator.removeLoadingMessage(i,r):(yl().getState().removeTurnsByGroupId(r),k.updateReactCaches(),S.addCount(p.SECTION_REMOVED,1),Jt(_.REMOVE_SECTION))}else S.logErrorWithLevel(R.ERROR,"".concat(Yv," - Did not find the groupId to remove the chunk: ").concat(JSON.stringify(n)))}),n(k,"updateReactCaches",function(){k.conversationList.updatePapyrusReactStateAndHTMLCache()}),n(k,"clearsNewChatMessage",function(){var e=yl().getState();e.getAllTurns().filter(function(e){return e.type===b.HTML_CONTENT_NEW_CHAT}).forEach(function(t){return e.removeTurnsByGroupId(t.groupId)})}),n(k,"handleNewChatClick",function(){if(k.terminateOngoingStreaming(),yl().getState().resetThreadContext(),yl().getState().resetTurnPagination(),k.cacheManager.setHistoryThreadContextCache(),k.isMixedRenderingEnabled){k.clearsNewChatMessage();var e=yl().getState();e.clearConversation(),e.addTurn({type:b.HTML_CONTENT_NEW_CHAT,id:Ie,groupId:"".concat(Ie,"-").concat(Date.now()),content:"How can I help you today?"}),requestAnimationFrame(function(){document.querySelectorAll(".".concat("rufus-new-chat-title-line")).forEach(function(e){return e.classList.add("fade-in")})}),k.updateReactCaches()}k.cacheManager.setRequestMetadata(void 0),k.cacheManager.setPanelRequestCompleted(!0),k.textInput.setFocus(),S.addCount(p.RUFUS_NEW_CHAT_CLICK,1)}),n(k,"handleOverflowMenuGetStartedClick",function(){var e=k.cacheManager.getPanelState();zh(null==e?void 0:e.viewState)||!0!==(null==e?void 0:e.autoMinimize)||k.panelContainer.applyAnimationAndStateUpdate("expanded","minimized")}),n(k,"handleChatHistoryClicked",a(s().mark(function e(){var t,n,r;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return k.panelContainer.animateChatHistoryContainer(),k.historyClient.resetPagination(),yl().getState().clearChatHistoryConversation(),e.prev=1,e.next=2,k.historyClient.fetchHistory(0,"",Wl.THREAD);case 2:"string"!=typeof(t=e.sent)&&yl().getState().setChatHistoryTurns(t),n=k.historyClient.hasMoreThreads(),yl().getState().setHasMoreThreads(n),e.next=4;break;case 3:e.prev=3,r=e.catch(1),S.logErrorWithLevelWithException(R.ERROR,r,"".concat(Yv," - Error fetching chat history")),yl().getState().setChatHistoryErrorMessage(pt);case 4:case"end":return e.stop()}},e,null,[[1,3]])}))),n(k,"handleLoadMoreThreads",a(s().mark(function e(){var t,n,r;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=yl().getState()).isLoadingMoreThreads&&t.hasMoreThreads){e.next=1;break}return e.abrupt("return");case 1:return t.setIsLoadingMoreThreads(!0),e.prev=2,e.next=3,k.historyClient.fetchHistory(0,"",Wl.THREAD);case 3:"string"!=typeof(n=e.sent)&&yl().getState().addChatHistoryTurns(n),r=k.historyClient.hasMoreThreads(),yl().getState().setHasMoreThreads(r);case 4:return e.prev=4,yl().getState().setIsLoadingMoreThreads(!1),e.finish(4);case 5:case"end":return e.stop()}},e,null,[[2,,4,5]])}))),n(k,"handleLoadMoreTurns",a(s().mark(function e(){var t,n,r,i;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=yl().getState(),(n=t.getThreadId())&&!t.isLoadingMoreTurns&&t.hasMoreTurns){e.next=1;break}return e.abrupt("return");case 1:return t.setIsLoadingMoreTurns(!0),e.prev=2,e.next=3,k.historyClient.fetchHistory(0,"",Wl.TURN,n);case 3:"string"!=typeof(r=e.sent)&&yl().getState().prependHistoryTurns(r),i=k.historyClient.hasMoreHistory(),yl().getState().setHasMoreTurns(i);case 4:return e.prev=4,yl().getState().setIsLoadingMoreTurns(!1),e.finish(4);case 5:case"end":return e.stop()}},e,null,[[2,,4,5]])}))),n(k,"handleCloseChatHistory",function(){k.panelContainer.closeChatHistoryContainer()}),n(k,"handleAutoMinimizeToggleSwitchEvent",function(e){k.cacheManager.toggleAutoMinimize(e)}),n(k,"handleAutoMinimizeToggleSwitchStateChange",function(e){k.overflowMenu.handleAutoMinimizeToggleSwitchStateChange(e)}),n(k,"initializeAutoMinimizeToggleSwitch",function(){var e,t=k.cacheManager.getPanelState();k.handleAutoMinimizeToggleSwitchStateChange(null===(e=null==t?void 0:t.autoMinimize)||void 0===e||e)}),n(k,"handleOverflowMenuStateChange",function(e){k.panelContainer.handleOverflowMenuStateChange(e)}),n(k,"registerSearchPageAjaxEventHandler",function(){var e=k.cacheManager.getPreviousPageUrl()===mn.getCurrentPageUrl();P.when("Rush","s-actions").execute(function(t,n){t.on(n.LOAD_SEARCH_PAGE_STARTING,function(){var t=k.cacheManager.getPanelState();!0!==(null==t?void 0:t.autoMinimize)||"expanded"!==(null==t?void 0:t.viewState)||e||k.panelContainer.applyAnimationAndStateUpdate(null==t?void 0:t.viewState,"minimized"),e=!1}),t.on(n.LOAD_SEARCH_PAGE_COMPLETE,function(){k.cacheManager.setPreviousPageUrl()})})}),n(k,"handleNavigateOnClickFromRecoveryTeaserCX",function(){var e=mn.getCurrentPageUrl(),t=mn.getTeaserCXCustomerQueryFromURLQueryParam(e);t&&k.panelContainer.handleNavigateFromTeaserCX(t)}),n(k,"isEligibleToShowTeaser",function(){var e,t,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r="Search"===k.panelContainer.getPanelViewContext().pageType,i=k.panelContainer.isPanelOpened(),a=dl.getInstance().getWeblabTreatment(zl),o="T1"!==a&&"T2"!==a,s=!k.isBfcacheNavigation&&r&&!i&&o;if(!n)return s;var u=null!==(e=null===(t=k.cacheManager.getPanelState())||void 0===t||null===(t=t.requestMetadata)||void 0===t?void 0:t.isInitialStream)&&void 0!==e&&e;return s&&u}),n(k,"isEligibleForRasin",function(){var e=dl.getInstance().getWeblabTreatment(zl),t="T1"!==e&&"T2"!==e;return"T1"===dl.getInstance().getWeblabTreatment("SEARCH_RUFUS_ASIN_INGRESS_1207023")&&t}),n(k,"initializeTwisterStateChange",function(){P.when("A").execute(function(e){e.on("PageRefresh:ATF",function(){k.handleTwisterVariationSelection()})})}),n(k,"handleTwisterVariationSelection",function(){k.streamingClient.startInitialStreamingCall(k.panelContainer.getPanelViewContext()),S.addCount(p.RUFUS_TWISTER_STREAMING_REQUEST,1),Jt(_.RUFUS_TWISTER_STREAMING_REQUEST_SENT)}),n(k,"initializeTextSelectionTooltip",function(){var e=Sv.getInstance();e&&e.initialize(function(){k.panelContainer.openPanel(),setTimeout(function(){k.textInput.setFocus()},0)})}),k.cacheManager=t,k.historyClient=i,k.conversationList=o,k.panelContainer=u,k.streamingClient=c,k.textInput=f,k.overflowMenu=v,k.overlayContainer=m,k.feedbackControl=E,k.scrollingUtil=g,k.animationUtil=y,k.actions=C,k.actionsHandler=T,k.actionChunkHandler=new gv,k.streamingLifecycleEventLogger=I,k.isInvalidatingCache=!1,k.capabilityManager=A,k.isPageUnload=!1,k.isJSMigration=!1,k.chunkTypeToLatencyDataMap=new Map,k.isMixedRenderingEnabled=null!==(O=hl(Pt))&&void 0!==O&&O,k.isPapyrusCachingEnabled=null!==(L=hl(Nt))&&void 0!==L&&L,k.isTopAnchoringEnabled=null!==(N=hl(kt))&&void 0!==N&&N,k.loadingMessageAnimator=new _v(y,o),k.asinFaceoutHandler=new Ov,k}return v(r,t),c(r,[{key:"initialize",value:function(e){var t,n=this;this.isJSMigration=null!==(t=null==e?void 0:e.isJSMigration)&&void 0!==t&&t,this.textInput.on("onQuery",this.stream),this.scrollingUtil.on("onTopReached",this.handleTopReached),this.streamingClient.on("onEventReceived",this.handleEventReceived),this.streamingClient.on("onEventReceivedV2",this.handleEventReceivedV2),this.streamingClient.on("onEventReceivedForPapyrusFlow",this.onEventReceivedForPapyrusFlow),this.streamingClient.on("onStreamingStatusChange",this.handleStreamingStatusUpdate),this.streamingClient.on("submitRetryRequest",this.handleRetryRequest),this.panelContainer.on("onPanelContainerStateChange",this.handlePanelStateChange),this.panelContainer.on("onPanelAnimationEnd",this.handlePanelAnimationEnd),this.panelContainer.on("onAutoMinimizeToggleSwitchStateChange",this.handleAutoMinimizeToggleSwitchStateChange),this.overflowMenu.on("onGetStartedClicked",this.handleOverflowMenuGetStartedClick),this.overflowMenu.on("onAutoMinimizeClick",this.handleAutoMinimizeToggleSwitchEvent),this.overflowMenu.on("onOverflowMenuStateChange",this.handleOverflowMenuStateChange),this.overflowMenu.on("onNewChatClicked",this.handleNewChatClick),this.overflowMenu.on("onChatHistoryClicked",this.handleChatHistoryClicked),this.overlayContainer.on("onGoBackClicked",this.handleCloseChatHistory),this.overlayContainer.on("onNewChatClicked",function(){n.handleCloseChatHistory(),n.handleNewChatClick()}),this.overlayContainer.on("onScrollNearBottom",this.handleLoadMoreThreads),this.animationUtil.on("sectionAnimationComplete",this.updateCache),this.animationUtil.on("allAnimationsInQueueComplete",this.markAnimationComplete),this.animationUtil.on("animationQueueComplete",this.removeLoader),this.feedbackControl.on("onThumbsDownClick",this.handleThumbsDownClick),this.feedbackControl.on("onFeedbackSubmitted",this.updateCache),this.conversationList.on("onLoadMoreHistoryButtonClick",this.handleLoadMoreHistory),this.conversationList.on("onInterruptionRecoveryButtonClick",this.handleInterruptionRecoveryButtonClick),this.conversationList.on("lastActiveTurnContentUpdated",this.scrollingUtil.autoScroll),this.actions.on("onAction",this.actionsHandler.handleAction),this.isEligibleForRasin()&&new Cv(this.panelContainer,this.streamingClient).initialize(),this.initializeTextSelectionTooltip(),this.cacheManager.initialize(),this.cacheManager.restoreThreadContext();var r=this.cacheManager.getHistoricalThreadId();r?this.handleInvokeHistoryAPI(r):this.isPapyrusCachingEnabled&&this.cacheManager.restoreReactStateFromCache();var i=this.cacheManager.getPanelState();i&&i.requestContext&&i.requestContext.requestId&&(jt.getInstance().nileRequestId=i.requestContext.requestId,this.updateAnimationUtilPanelState(i)),this.handleNavigateOnClickFromRecoveryTeaserCX(),this.handleStreamingInterruption(),this.conversationList.on("completeMovingActiveConversationTurnsToHistory",this.handleCompleteMovingActiveConversationTurnsToHistory),this.conversationList.on("completeReplacingContentInContainer",this.handleConversationListCompleteReplacingContent),this.streamingClient.on("invalidatePanelCache",this.invalidateCache),this.streamingClient.on("saveRequestMetadataToPanelCache",this.saveRequestMetadataToPanelCache),this.actionsHandler.on("applyAnimationAndStateUpdateWithDefault",this.panelContainer.applyAnimationAndStateUpdateWithDefault),this.actionsHandler.on("handleInvokeHistoryAPI",this.handleInvokeHistoryAPI),this.dispatch("cacheInvalidated",void 0),this.updatePanelContainerState();var a=Fv(null==e?void 0:e.rufusTriggerMarkerMapping,null==e?void 0:e.pageType);(null==e?void 0:e.latencyRegressionMitigationStrategy)===ff.ShouldDelayThickClientInitialStreaming&&a&&"YourOrders"!==e.pageType?xv(this.startInitialStreamingCallback,e.rufusLatencyMarkerFallbackTimeout,a,ff.ShouldDelayThickClientInitialStreaming):this.startInitialStreamingCallback(),this.initializeAutoMinimizeToggleSwitch(),window.addEventListener("hashchange",function(){n.cacheManager.setPreviousPageUrl()}),yn(this.panelContainer.getPanelViewContext().pageType)===gn.SEARCH_RESULTS&&this.registerSearchPageAjaxEventHandler(),this.textInput.setFocus(),window.addEventListener("pagehide",function(){n.terminateOngoingStreaming(),Fh.getInstance().setSearchFilterContext(null)}),window.addEventListener("offline",this.handleOfflineError),window.addEventListener("online",this.handleOnlineEvent),this.initializeTwisterStateChange()}},{key:"handleBfCacheNavigation",value:function(){var e=this;this.isBfcacheNavigation=!0,this.streamingLifecycleEventLogger.setIsBfcacheNavigation(!0),this.streamingClient.setIsBfcacheNavigation(!0),this.conversationList.refreshOnBfCacheNavigation(),this.scrollingUtil.refreshOnBfCacheNavigation(),this.scrollingUtil.setReactContainer(),this.textInput.refreshOnBfCacheNavigation(),this.panelContainer.handleCachedChatHistory(),this.isTopAnchoringEnabled&&requestAnimationFrame(function(){e.scrollingUtil.scrollToBottom()})}},{key:"shouldSkipStreamingOnSearchResults",value:function(){var e=dl.getInstance().getWeblabTreatment("RUFUS_DESKTOP_TEASER_WIDGET_1017061"),t=dl.getInstance().getWeblabTreatment("RUFUS_DESKTOP_TEASER_RECOVERY_WIDGET_1148246");return this.isEligibleToShowTeaser(!1)&&!0===this.streamingClient.getIsRufusStayBehaviorRequired()&&"C"!==e&&"T1"===t}},{key:"handleContentChunkInReact",value:function(e){var t,n,r=this;if(this.asinFaceoutHandler.isExpectingAsinFaceout())this.asinFaceoutHandler.handleAsinFaceoutHtmlUpdate({htmlContent:e.event.data})&&this.updateReactCaches();else{var i;try{i=JSON.parse(e.event.data)}catch(e){return void S.logErrorWithLevelWithException(R.ERROR,e,"".concat(Yv," - Error handling content chunk for Papyrus Mixed rendering: ").concat(e instanceof Error?"(".concat(e.message,")"):""))}if((null===(t=i.sections)||void 0===t||null===(t=t[0])||void 0===t||null===(t=t.content)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.includes('data-section-class="LoadingMessageTemplate"'))&&this.conversationList.toggleLoaderAndUpdateAnnouncer(mh.HiddenBeforeComplete),this.asinFaceoutHandler.handleFooterReplace(i))this.updateReactCaches();else if(this.asinFaceoutHandler.detectAsinFaceoutChunkReference(i),"REMOVE"!==(null===(n=i.sections)||void 0===n||null===(n=n[0])||void 0===n?void 0:n.action)){var a=[];if(i.sections&&Array.isArray(i.sections)&&i.type)a=i.sections.map(function(e){var t;return zv(zv({},e),{},{groupId:(null===(t=e.target)||void 0===t?void 0:t.groupId)||e.groupId})});else if(i.rufusUI&&i.patches&&Array.isArray(i.patches)){if("T1"===dl.getInstance().getWeblabTreatment("RUFUS_PAPYRUS_DESKTOP_JSON_PATCHING_FRONTEND_1360443"))return void this.performRufusUIRunJsonPatching(i);this.processRufusUIPatchTurns(i,a)}else a=this.convertHtmlToTurns(i,e.streamingStatusDetails);var o,s=a.filter(function(e){var t=r.isValidTurn(e);return t||S.logErrorWithLevel(R.ERROR,"".concat(Yv," - Invalid Turn object received: ").concat(JSON.stringify(e))),t}),u=s.filter(function(e){var t;return(null===(t=e.action)||void 0===t?void 0:t.toLowerCase())===Lv.REPLACE})||[],c=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Vv(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Vv(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(u);try{for(c.s();!(o=c.n()).done;){var l=o.value,d=l.groupId;d&&yl().getState().replaceTurnByGroupId(d,l)}}catch(e){c.e(e)}finally{c.f()}var h=s.filter(function(e){return!u.includes(e)});h.length>0&&yl().getState().addTurns(h),this.updateReactCaches()}else this.handleRemoveEventForReact(e)}}},{key:"processRufusUIPatchTurns",value:function(e,t){e.patches.forEach(function(e){switch(e.op.toLowerCase()){case Lv.REPLACE:t.push.apply(t,[zv(zv({},e.value),{},{groupId:e.groupId,action:Lv.REPLACE})]);break;case Lv.ADD:t.push.apply(t,[zv(zv({},e.value),{},{groupId:e.groupId})]);break;default:S.logErrorWithLevel(R.ERROR,"".concat(Yv," - Error: Got unknown patch.op in processRufusUIPatchTurns: ").concat(JSON.stringify(e)))}})}},{key:"recoverInterruptedConversationFromHistory",value:(u=a(s().mark(function e(t){var n,r;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return S.addCount(p.FETCH_HISTORY_INTERRUPTION_RECOVERY,1),e.next=1,this.historyClient.fetchHistory(0,t);case 1:(n=e.sent)&&"string"==typeof n?this.conversationList.modifyContent(Eh.ReplaceInterruptedConversation,n):Array.isArray(n)?(r=ld.filterCustomerTextTurns(n),this.conversationList.modifyPapyrusContent(Eh.ReplaceInterruptedConversationPapyrus,r)):(this.conversationList.getInterruptionRecoveryHandler().dismissInterruptionRecoverySpinnerAndShowButton(),S.addCount(p.INTERRUPTION_RECOVERY_FAILED,1));case 2:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"fetchHistory",value:(o=a(s().mark(function e(t){var n,r,i;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return S.addCount(p.FETCH_HISTORY,1),this.conversationList.startTopLoading(),this.conversationList.toggleLoadMoreHistoryButtonElementVisibility(!1),(n=this.historyClient.isFirstTimeLoadHistory())&&S.addCount(p.FIRST_TIME_FETCH_HISTORY,1),r=this.getActiveConversationTurnsCount(n),e.next=1,this.historyClient.fetchHistory(r);case 1:"string"==typeof(i=e.sent)?this.conversationList.modifyContent(t,i,n):this.conversationList.modifyPapyrusContent(t,i,n);case 2:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"getActiveConversationTurnsCount",value:function(e){return e?this.isMixedRenderingEnabled?dh.getCustomerTurnsCount():this.conversationList.getNumberOfConversationTurns():0}},{key:"replaceCache",value:(i=a(s().mark(function e(t){var n,r;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.historyClient.fetchHistory(0);case 1:n=e.sent,r=t?Eh.ReplaceHistory:Eh.ReplaceActive,"string"==typeof n?this.conversationList.modifyContent(r,n):this.conversationList.modifyPapyrusContent(r,n);case 2:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"getHTMLSectionType",value:function(e,t){var n,r=t.actionType;return r&&(r===rn.SEARCH||r===rn.ASIN_CLICK)&&t.isInitialStream?b.HTML_CONTENT_CONTEXTUAL_PILLS:null!==(n=null==e?void 0:e.startsWith(ht))&&void 0!==n&&n?b.HTML_CONTENT_TURN_START:b.HTML_CONTENT}},{key:"terminateOngoingStreaming",value:function(){this.streamingClient.abortCurrentStream(gd.PAGE_NAVIGATION),this.conversationList.toggleLoaderAndUpdateAnnouncer(mh.Hidden)}},{key:"handleStreamingInterruption",value:function(){var e;this.conversationList.getInterruptionRecoveryHandler().getInterruptionRecoveryContainer()&&this.conversationList.getInterruptionRecoveryHandler().checkInterruptionRecoveryButtonVisibility()&&(this.conversationList.getInterruptionRecoveryHandler().moveInterruptionRecoveryContainerOutOfConversation(this.isTopAnchoringEnabled),this.updateCache());var t=null===(e=this.cacheManager.getPanelState())||void 0===e?void 0:e.requestContext;if(t&&!t.requestCompleted&&0===this.conversationList.getRemovableSectionsFromLatestActiveTurn().length){if(this.conversationList.getInterruptionRecoveryHandler().getInterruptionRecoveryContainer()){var n=t.requestId;n&&(this.conversationList.moveInterruptionRecoveryContainerToConversation(n),this.scrollingUtil.scrollToBottom())}else{var r=document.createElement("div");r.innerHTML="Response interrupted",r.className="rufus-interrupted-stream-text";var i=document.createElement("div");if(i.classList.add("rufus-interrupted-stream-affordance"),i.appendChild(r),this.isMixedRenderingEnabled)if(this.isTopAnchoringEnabled){var a={type:b.HTML_CONTENT,id:"interrupted-text-".concat(Date.now()),content:i.outerHTML,timestamp:Date.now()};yl().getState().addTurns([a])}else this.conversationList.modifyContent(Eh.AppendInner,i.outerHTML);else this.conversationList.modifyContent(Eh.InsertIntoLastActiveTurn,i.outerHTML)}this.cacheManager.setPanelRequestCompleted(!0),this.updateCache()}}},{key:"performRufusUIRunJsonPatching",value:function(t){t.patches.forEach(function(t){if(null!=t.groupId){var n=t.op.toLowerCase();if(n===Lv.REMOVE||null!=t.value){var r,i="/"===(r=t.path)||""===r;if(i&&n===Lv.REMOVE)yl().getState().removeTurnsByGroupId(t.groupId);else if(i&&n===Lv.ADD)yl().getState().addTurn(zv(zv({},t.value),{},{groupId:t.groupId}));else{var a=function(e){"/"===e.path[0]&&(e.path=e.path.slice(1));var t=""===e.path?[]:e.path.split("/").filter(function(e){return""!==e});return{op:e.op,value:e.value,path:t}}(t),o=yl().getState().getAllTurns().find(function(e){return e.groupId===t.groupId});if(o){(function(e){return e.op===Lv.REPLACE||e.op===Lv.REMOVE})(a)&&function(t,n){var r=t.path.length-1,i=t.path.slice(0,r);if("-"===t.path[r]){var a=i.reduce(function(t,n){if(t&&"object"===e(t)&&n in t)return t[n]},n);Array.isArray(a)&&a.length>0&&(t.path[r]=a.length-1)}}(a,o);var s=Ev(o,[a]);i&&(s=zv(zv({},s),{},{groupId:t.groupId})),yl().getState().replaceTurnByGroupId(t.groupId,s)}}}else S.logErrorWithLevel(R.WARN,"".concat(Yv," - No patch value present"))}else S.logErrorWithLevel(R.WARN,"".concat(Yv," - No group id present in patch"))}),this.updateReactCaches()}}]);var i,o,u}(In),qv=c(function e(){l(this,e)});function Xv(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Xv=function(){return!!e})()}n(qv,"recordAssetsLoad",function(){var e,t;if(null!==(e=window.performance)&&void 0!==e&&e.getEntriesByType){var n=["RufusPanelWebAssets","RufusCriticalAssets"];(null===(t=performance)||void 0===t?void 0:t.getEntriesByType("resource")).filter(function(e){return e.name.includes(".js")&&n.some(function(t){return e.name.includes(t)})}).forEach(function(e){var t=Date.now(),r=0===e.transferSize,i=e.transferSize<e.encodedBodySize,a=r||i,o=n.find(function(t){return e.name.includes(t)});o+=a?"Cached":"Cold",S.addCount("".concat(o,"JS"),1),S.widgetBodyBegin("".concat(o,"JSLoadTime"),t),S.widgetBodyEnd("".concat(o,"JSLoadTime"),!1,t+e.duration)})}});var Zv=["rufus-pulse-scale"],Qv=["rufus-fade-out-and-shrink"],Jv=function(e){function t(e){var r,i;return l(this,t),i=function(e,t,n){return t=h(t),d(e,Xv()?Reflect.construct(t,[],h(e).constructor):t.apply(e,n))}(this,t),n(i,"queue",[]),n(i,"isAnimating",!1),n(i,"typewriterAnimationDelay",125),n(i,"isMixedRenderingEnabled",!1),i.scrollingUtil=e,i.isMixedRenderingEnabled=null!==(r=hl(Pt))&&void 0!==r&&r,i}return v(t,e),c(t,[{key:"setViewState",value:function(e){this.panelState=e}},{key:"enqueueAnimation",value:function(e){this.queue.push(e),this.isAnimating||this.animateNextSection()}},{key:"getQueue",value:function(){return this.queue}},{key:"getIsAnimating",value:function(){return this.isAnimating}},{key:"stopAnimating",value:function(){this.isAnimating=!1,this.queue=[]}},{key:"prepareSectionForReplaceAnimation",value:function(e,t){var n=parseInt(e.dataset.currentAnimatedKey||"0"),r=t.querySelectorAll("key, .rufus-markdown-animation-support"),i=xt(Array.from(r).reduce(function(e,t,r){return(r>n-1?e[0]:e[1]).push(t),e},[[],[]]),2),a=i[0],o=i[1];this.hideElements(a),Yd(o)}},{key:"prepareSectionForAppendAnimation",value:function(e){var t=Array.from(e.querySelectorAll("key, .rufus-markdown-animation-support"));this.hideElements(t),e.classList.add(rt)}},{key:"animateNextSection",value:function(){var e=this,t=this.queue.shift();if(void 0!==t){this.isAnimating=!0;var n=t();0===this.queue.length&&this.dispatch("animationQueueComplete",void 0),n?nh(n,function(){e.animateSection(n),0===e.queue.length&&e.dispatch("allAnimationsInQueueComplete",void 0)}):this.animateNextSection()}else this.isAnimating=!1}},{key:"animateSection",value:function(e){var t=this,n=parseInt(e.dataset.currentAnimatedKey||"0"),r=this.panelState&&jh(this.panelState.viewState);r||(Yd([e]),zd(e)),Array.from(e.querySelectorAll("button.rufus-pill")).forEach(function(e){var t=dl.getInstance().getWeblabTreatment(Kl);t&&(S.recordTrigger(Kl,t),"T1"===t&&e.classList.add("rufus-related-question-pill-resize-experiment"))});var i=Array.from(e.querySelectorAll("key, .rufus-markdown-animation-support"));if(!this.isMixedRenderingEnabled&&this.scrollingUtil.autoScroll(),this.showElement(e),i.forEach(function(e){(e.classList.contains("rufus-related-question-pill")||e.classList.contains("rufus-web-related-question-pill"))&&fn(e,af())}),n<i.length)if(this.showElement(i[n]),n++,e.dataset.currentAnimatedKey=n.toString(),r)setTimeout(function(){return t.animateSection(e)},this.typewriterAnimationDelay);else{for(var a=n;a<i.length;a++)this.showElement(i[a]);this.cleanUpAnimationsAndDispatchCacheEvent(e,i),this.animateNextSection()}else{if(!r)return this.cleanUpAnimationsAndDispatchCacheEvent(e,i),void this.animateNextSection();var o;if(e&&"function"==typeof e.getAnimations?o=e.getAnimations({subtree:!0}).filter(function(e){var t=e.animationName;return Zv.indexOf(t)<0}):S.logErrorWithLevel(R.WARN,"The section element does not support getAnimations."),o&&o.length>0){var s=o[o.length-1],u=o.filter(function(e){var t=e.animationName;return Qv.indexOf(t)>=0}),c=[s].concat(O(u));if(c.some(function(e){var t=e.currentTime,n=e.effect,r=null==n?void 0:n.getTiming().duration;return null!=t&&null!=r&&t<r})){var l=c.map(function(e){return e.finished});Promise.all(l).catch(function(e){e&&"name"in e&&"AbortError"!==e.name&&S.logErrorWithLevelWithException(R.ERROR,e,"[AnimationUtil.animateSection] exception thrown from animation promises")}).finally(function(){t.cleanUpAnimationsAndDispatchCacheEvent(e,i),t.animateNextSection()})}else this.cleanUpAnimationsAndDispatchCacheEvent(e,i),this.animateNextSection()}else this.cleanUpAnimationsAndDispatchCacheEvent(e,i),this.animateNextSection()}}},{key:"cleanUpAnimationsAndDispatchCacheEvent",value:function(e,t){Yd([e]),Yd(t),this.dispatch("sectionAnimationComplete",void 0)}},{key:"showElement",value:function(e){e.classList.remove("rufus-visibility-hidden")}},{key:"hideElements",value:function(e){e.forEach(function(e){e.classList.add("rufus-visibility-hidden")})}}])}(In),$v=function(){return c(function e(){l(this,e)},null,[{key:"cleanup",value:function(){sessionStorage.removeItem(Rl[Tl].key),sessionStorage.removeItem(Rl[Sl].key);var e=document.getElementById(X),t=document.getElementById(q);null==e||e.remove(),null==t||t.remove()}}])}(),ep=function(){return c(function e(){l(this,e)},null,[{key:"recordLatencyStats",value:function(e,t,n){var r=this.calculateInterSectionLatencyStats(e),i=r.min,a=r.max,o=r.avg,s=r.median,u=Date.now();null!=i&&null!=a&&null!=o&&null!=s&&(S.widgetBodyBegin("".concat(t,"_MIN_").concat(n,"_LATENCY"),u),S.widgetBodyEnd("".concat(t,"_MIN_").concat(n,"_LATENCY"),!1,u+i),S.widgetBodyBegin("".concat(t,"_MAX_").concat(n,"_LATENCY"),u),S.widgetBodyEnd("".concat(t,"_MAX_").concat(n,"_LATENCY"),!1,u+a),S.widgetBodyBegin("".concat(t,"_AVG_").concat(n,"_LATENCY"),u),S.widgetBodyEnd("".concat(t,"_AVG_").concat(n,"_LATENCY"),!1,u+o),S.widgetBodyBegin("".concat(t,"_MEDIAN_").concat(n,"_LATENCY"),u),S.widgetBodyEnd("".concat(t,"_MEDIAN_").concat(n,"_LATENCY"),!1,u+s))}},{key:"calculateInterSectionLatencyStats",value:function(e){if(e.length<2)return{};e.sort(function(e,t){return e-t});for(var t=[],n=1;n<e.length;n++)t.push(e[n]-e[n-1]);t.sort(function(e,t){return e-t});var r=t.reduce(function(e,t){return e+t},0)/t.length;return{min:t[0],median:t[Math.ceil(.5*(t.length-1))],max:t[t.length-1],avg:r}}}])}(),tp=function(){return c(function e(){l(this,e)},null,[{key:"validateAndRecordLatencyStats",value:function(e,t,n,r){t&&e.length-1!==t||e.length>1&&ep.recordLatencyStats(e,n,r)}},{key:"recordAllLatencyStats",value:function(e,t,n,r){var i=this;this.validateAndRecordLatencyStats(e.renderingTimestamps,n,r,"RENDER"),this.validateAndRecordLatencyStats(e.networkTimestamps,n,r,"ROUND_TRIP_NETWORK"),this.validateAndRecordLatencyStats(e.backendTimestamps,n,r,"BACKEND"),t.forEach(function(e,t){i.validateAndRecordLatencyStats(e.renderingTimestamps,void 0,r,"".concat(t,"_RENDER")),i.validateAndRecordLatencyStats(e.networkTimestamps,void 0,r,"".concat(t,"_ROUND_TRIP_NETWORK")),i.validateAndRecordLatencyStats(e.backendTimestamps,void 0,r,"".concat(t,"_BACKEND"))})}},{key:"batchRecordLatencyMarkersMetrics",value:function(e){var t=this,n=new Ed,r=new Map,i=new Map,a=e.requestStartTime;if(a&&e.backendProcessingStartTime){n.renderingTimestamps.push(a),n.networkTimestamps.push(a),n.backendTimestamps.push(e.backendProcessingStartTime);var o=e.patchMap,s=e.cxType,u=0;return Object.entries(o).forEach(function(c){var l=xt(c,2),d=l[0],h=l[1],f=h.tagType,v="".concat(h.tagType,"_").concat(h.occurrenceCount);if(null!=f){var p,m,E,g,_,y=t.getSectionStartTime(Number(d),o),C=h.backendProcessingEndTime,R=e.backendProcessingStartTime,T=h.renderEndTime,S=null!==(p=r.get(f))&&void 0!==p?p:r.set(f,new Ed).get(f),I=i.set(String(u),new Ed).get(String(u));I&&(I.sectionType=f),null!=T&&(n.renderingTimestamps.push(T),null==S||S.renderingTimestamps.push(T),null==I||I.renderingTimestamps.push(T)),null!=y&&(n.networkTimestamps.push(y),null==S||S.networkTimestamps.push(y),null==I||I.networkTimestamps.push(y)),null!=C&&(n.backendTimestamps.push(C),null==S||S.backendTimestamps.push(C),null==I||I.backendTimestamps.push(C)),t.recordTagLevelLatency(v,s,a,y,T,R,C,null===(m=e.generationModelMetadata)||void 0===m?void 0:m.agentName),t.recordTagLevelLatency(f,s,a,y,T,R,C,null===(E=e.generationModelMetadata)||void 0===E?void 0:E.agentName),1!==h.occurrenceCount?t.recordTagLevelLatency("".concat(f,"_SUBSEQUENT"),s,a,y,T,R,C,null===(g=e.generationModelMetadata)||void 0===g?void 0:g.agentName):0==u&&t.recordTagLevelLatency("".concat(f,"_TOP_TAG"),s,a,y,T,R,C,null===(_=e.generationModelMetadata)||void 0===_?void 0:_.agentName),u++}}),this.recordAllLatencyStats(n,r,u,s),i}}},{key:"recordCsmTagLevelLatencyMetrics",value:function(e,t,n,r){if(S.widgetBodyBegin(e,t),S.widgetBodyEnd(e,!1,n),r){var i="".concat(r,"-").concat(e);S.widgetBodyBegin(i,t),S.widgetBodyEnd(i,!1,n)}}},{key:"recordTagLevelLatency",value:function(e,t,n,r,i,a,o,s){this.recordCsmTagLevelLatencyMetrics("".concat(e,"_").concat(t,"_RENDER_LATENCY"),n,i,s),this.recordCsmTagLevelLatencyMetrics("".concat(e,"_").concat(t,"_NETWORK_LATENCY"),n,r,s),this.recordCsmTagLevelLatencyMetrics("".concat(e,"_").concat(t,"_RENDER_NETWORK_LATENCY"),r,i,s),this.recordCsmTagLevelLatencyMetrics("".concat(e,"_").concat(t,"_BACKEND_LATENCY"),a,o,s),this.recordBackendFEDeltaLatency(e,t,n,r,a,o,s)}},{key:"getSectionStartTime",value:function(e,t){if(0==e)return t[String(e)].renderStartTime;for(var n=e,r=--n;null!=t[n]&&null==t[n].backendProcessingEndTime&&n>0;)r=n,n--;return null!=t[n]&&null==t[n].backendProcessingEndTime?t[String(n)].renderStartTime:null!=t[r]&&null==t[r].backendProcessingEndTime?t[String(r)].renderStartTime:t[String(e)].renderStartTime}},{key:"recordBackendFEDeltaLatency",value:function(e,t,n,r,i,a,o){if(r&&a&&i){var s=Date.now(),u=r-n-(a-i);this.recordCsmTagLevelLatencyMetrics("".concat(e,"_").concat(t,"_BACKEND_FE_DELTA"),s,s+u,o)}}}])}();function np(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function rp(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ip(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rp(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rp(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var ap=function(e){return e.REQUEST_START="request-start",e.REQUEST_INTERRUPTED="request-interrupted",e.RENDER_START="render-start",e.RENDER_END="render-end",e}({}),op=function(e){return e.INPUT_BOX="inputBox",e.SWIPE_UP="swipeUp",e.RELATED_QUESTION_PILLS="relatedQuestionPills",e.NAVIGATION="navigation",e.RETRY_BUTTON="retryButton",e.ASIN_CLICK="asinClick",e}({}),sp=function(e){return e.MESSAGE_FTUX="message-ftux",e.MESSAGE_RUX="message-rux",e.INFERENCE_PILLS="inference-pills",e.INFERENCE_ANSWERING="inference-answering",e.CURATED="curated",e.AFFORDANCE="affordance",e}({}),up=function(e){return e.ASIN_FACEOUT="AsinFaceout",e}(up||{}),cp=function(e){return e.ASIN_RECOMMENDATIONS="ASINRecommendations",e}(cp||{}),lp="StreamingLifecycleEventLogger",dp=function(){return c(function e(t){var r=this;l(this,e),n(this,"reset",function(){r.state=new _d(r.tabId)}),this.tabId=t,this.isBfcacheNavigation=!1,this.state=new _d(t)},[{key:"setIsBfcacheNavigation",value:function(e){this.isBfcacheNavigation=e}},{key:"startStreamingRequest",value:function(e){this.state.requestInterrupted&&this.sendCSA_BIMetric(this.state.activeChunkType),S.addCount(E.STREAM_START,1),this.reset(),null!=e?(this.state.trigger=e,this.state.latencyData.requestStartTime=Date.now()):S.addCount(E.STREAM_WITHOUT_ACTION,1)}},{key:"setStreamingEvent",value:function(e){this.state.streamingEvent=e}},{key:"getRequestState",value:function(){return this.state}},{key:"openStreamingRequest",value:function(){S.addCount(E.SSE_STREAM_OPEN,1),this.logCSMLatency(E.SSE_STREAM_OPEN)}},{key:"closeStreamingRequest",value:function(){S.addCount(E.SSE_STREAM_CLOSE,1),this.logCSMLatency(E.SSE_STREAM_CLOSE)}},{key:"handleRequestInterrupted",value:function(e){this.state.requestInterrupted||(S.addCount(E.STREAM_INTERRUPTION,1),this.state.interruptionReason=e,this.logCSMLatency(E.STREAM_INTERRUPTION),this.state.requestInterrupted=!0,this.state.latencyData.requestInterruptTime=Date.now(),Jt(_.CONVERSATION_ABANDONMENT,e))}},{key:"handleStreamError",value:function(e,t){this.state.requestInterrupted||(S.addCount(E.STREAM_ERROR,1),S.logErrorWithLevel(R.ERROR,"Stream closed due to error. InterruptionReason: ".concat(e,", ResponseCode: ").concat(t)),this.state.interruptionReason=e,this.logCSMLatency(E.STREAM_ERROR),this.state.requestInterrupted=!0,this.state.latencyData.requestInterruptTime=Date.now())}},{key:"setChunkReceived",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.data&&(this.state.latencyData.activeChunk.renderStartTime=Date.now(),this.state.activeChunkType=e.type,r&&(n=e.data,!/^\s*</.test(n))?this.updateStreamStateFromEventDataV2(e):this.updateStreamStateFromEventData(e),this.state.isUplChunk=this.getIsUplMeasure(e.type),this.state.isUplChunk)){var i=this.getUplType(e,t);i&&this.logCSMLatency(i+E.RECEIVE_SUFFIX,!0)}}},{key:"setChunkReceivedV2",value:function(e,t){if(e.data&&(this.state.latencyData.activeChunk.renderStartTime=Date.now(),this.state.activeChunkType=e.type,this.updateStreamStateFromEventDataV2(e),this.state.isUplChunk=this.getIsUplMeasure(e.type),this.state.isUplChunk)){var n=this.getUplType(e,t);n&&this.logCSMLatency(n+E.RECEIVE_SUFFIX,!0)}}},{key:"emitStreamRenderEnd",value:function(){this.logCSMLatency(E.STREAM_LAST_RENDERED_CHUNK,!0)}},{key:"recordSectionRenderEnd",value:function(e,t,n,r){var i=Date.now();if(this.recordFirstInferenceChunkRenderLatency(e),0===n&&this.emitChunkFirstSectionRenderEndMetrics(e,t,i),r&&(this.emitChunkLastSectionRenderEndMetric(e),this.recordPatchRenderEnd(i),this.batchRecordLatencyOnceLastPatchWasProcessed()),this.state.latencyData.eachSectionLatencyData){var a=this.state.latencyData.eachSectionLatencyData;return this.state.latencyData.eachSectionLatencyData=void 0,{eachSectionLatencyData:a,requestStartTime:this.state.latencyData.requestStartTime,generationModelMetadata:this.state.latencyData.generationModelMetadata}}}},{key:"recordFirstInferenceChunkRenderLatency",value:function(e){e.type!==Md.INFERENCE||this.state.latencyData.firstInferenceChunkProcessed||(this.logCSMLatency(E.FIRST_INFERENCE_CHUNK_RENDER_SUFFIX,!0),this.state.latencyData.firstInferenceChunkProcessed=!0)}},{key:"recordPatchRenderEnd",value:function(e){var t=this;this.state.activeChunkPatchIds.forEach(function(n){var r=t.state.latencyData.patchMap[n];r&&(r.renderEndTime=e)})}},{key:"emitChunkFirstSectionRenderEndMetrics",value:function(e,t,n){if(e.data){var r=this.isBfcacheNavigation?Dd.configName:Ud.configName,i=Nd.getInstance().getLogger(r);if(i&&!i.markerProcessed("initial_streaming_first_chunk_received")&&(i.setMarker("initial_streaming_first_chunk_received"),i.emitMetrics()),this.state.latencyData.activeChunk.renderEndTime=n,this.state.isUplChunk){var a=this.getUplType(e,t);a&&this.logCSMLatency(a+E.RENDER_SUFFIX,!0)}if(!this.state.isRequestTriggerUplLogged){var o=this.getRequestTriggerValue(t,e);o&&(this.state.isRequestTriggerUplLogged=!0,this.logCSMLatency(o+E.RENDER_SUFFIX,!0))}this.logCSMLatency(e.type+E.CHUNK_FIRST_SECTION_RENDER_SUFFIX,!0),this.sendCSA_BIMetric(e.type)}}},{key:"emitChunkLastSectionRenderEndMetric",value:function(e){e.data&&this.logCSMLatency(e.type+E.CHUNK_LAST_SECTION_RENDER_SUFFIX,!0)}},{key:"sendCSA_BIMetric",value:function(e){var t,n,r=function(e){if(window.csa)return window.csa("Content",{element:e})}({nileRequestId:jt.getInstance().nileRequestId,groupId:this.state.groupId,sequenceId:this.state.sequenceId,contentId:this.state.contentId,slotId:this.state.slotId,requestType:null!==(t=this.state.trigger)&&void 0!==t?t:rn.UNKNOWN,interruptionReason:null!==(n=this.state.interruptionReason)&&void 0!==n?n:"",chunkType:null!=e?e:"unknown"});r&&(r("mark",ap.REQUEST_START,this.state.latencyData.requestStartTime),r("mark",ap.RENDER_START,this.state.latencyData.activeChunk.renderStartTime),r("mark",ap.RENDER_END,this.state.latencyData.activeChunk.renderEndTime),this.state.latencyData.requestInterruptTime&&r("mark",ap.REQUEST_INTERRUPTED,this.state.latencyData.requestInterruptTime))}},{key:"logCSMLatency",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.state.latencyData.requestStartTime){S.widgetBodyBegin(e,this.state.latencyData.requestStartTime),S.widgetBodyEnd(e,!1);var r=null===(t=this.state.latencyData.generationModelMetadata)||void 0===t?void 0:t.agentName;if(n&&r){var i="".concat(r,"-").concat(e);S.widgetBodyBegin(i,this.state.latencyData.requestStartTime),S.widgetBodyEnd(i,!1)}}}},{key:"getUplType",value:function(e,t){var n;switch(e.type){case Md.MESSAGE:return"SEEN"===(null===(n=t.requestContext)||void 0===n||null===(n=n.impressionsContext)||void 0===n?void 0:n.FIRST_TIME_USER_MESSAGE_SEEN_STATUS)?sp.MESSAGE_RUX:sp.MESSAGE_FTUX;case Md.CURATED_ANSWER:return sp.CURATED;case Md.AFFORDANCE:return sp.AFFORDANCE;case Md.INFERENCE:return t.isInitialStream&&!0!==this.state.isQuestionAnswering?sp.INFERENCE_PILLS:sp.INFERENCE_ANSWERING}}},{key:"updateStreamStateFromEventData",value:function(e){var t=this.createTempElement(e.data);this.updateStateFromSection(t),this.handleTelemetryData(t,e),this.handleGenerationModelMetadata(t)}},{key:"handleGenerationModelMetadata",value:function(e){var t=e.querySelector('script[type="a-state"][data-a-state*="generationModelMetadata"]'),n=this.state.latencyData.generationModelMetadata;if(t&&(!n||!n.agentName))try{this.state.latencyData.generationModelMetadata=JSON.parse(t.innerHTML)}catch(e){S.logErrorWithLevelWithException(R.ERROR,e,"".concat(lp," - Error parsing event Generation Model Metadata:"))}}},{key:"handleTelemetryData",value:function(e,t){var n;t.type===Md.REMOVE&&(n={chunk:{2:{last:!1}}});var r=e.querySelector('script[type="a-state"][data-a-state*="telemetryInfo"]');if(r)try{n=JSON.parse(r.innerHTML)}catch(e){S.logErrorWithLevelWithException(R.ERROR,e,"".concat(lp," - Error parsing event telemetry data:"))}this.processEventTelemetryData(n)}},{key:"updateStateFromSection",value:function(e){var t,n,r,i,a=e.querySelector(Ne);a&&(this.state=ip(ip({},this.state),{},{groupId:null!==(t=a.getAttribute("data-csa-c-group-id"))&&void 0!==t?t:"",sequenceId:null!==(n=a.getAttribute("data-csa-c-sequence-id"))&&void 0!==n?n:"",contentId:null!==(r=a.getAttribute("data-csa-c-content-id"))&&void 0!==r?r:"",slotId:null!==(i=a.getAttribute("data-csa-c-slot-id"))&&void 0!==i?i:""}))}},{key:"createTempElement",value:function(e){var t=document.createElement("div");return t.innerHTML=e,t}},{key:"updateStreamStateFromEventDataV2",value:function(e){var t,n=this,r=rh.parseEventData(e);null==r||null===(t=r.sections)||void 0===t||t.forEach(function(t){var r;if("HTML"===(null==t||null===(r=t.content)||void 0===r?void 0:r.format)){var i=n.createTempElement(t.content.data);n.updateStateFromSection(i),n.handleTelemetryData(i,e),n.handleGenerationModelMetadata(i)}})}},{key:"isFtuxPlaceholderChunk",value:function(e){var t=document.createElement("div");t.innerHTML=e.data;var n=t.querySelector(Ne);return!!n&&n.getAttribute(Ue)===st}},{key:"getIsUplMeasure",value:function(e){switch(e){case Md.MESSAGE:if(!this.state.chunkFirstReceivedMap.has(Md.MESSAGE))return this.state.chunkFirstReceivedMap.set(Md.MESSAGE,!0),!0;break;case Md.CURATED_ANSWER:if(!this.state.chunkFirstReceivedMap.has(Md.CURATED_ANSWER))return this.state.chunkFirstReceivedMap.set(Md.CURATED_ANSWER,!0),!0;break;case Md.AFFORDANCE:if(!this.state.chunkFirstReceivedMap.has(Md.AFFORDANCE))return this.state.chunkFirstReceivedMap.set(Md.AFFORDANCE,!0),!0;break;case Md.INFERENCE:if(!this.state.chunkFirstReceivedMap.has(Md.INFERENCE))return this.state.chunkFirstReceivedMap.set(Md.INFERENCE,!0),!0}return!1}},{key:"getRequestTriggerValue",value:function(e,t){var n,r;if(Md.AFFORDANCE!==t.type){if(t.type!==Md.MESSAGE||!this.isFtuxPlaceholderChunk(t))switch(this.state.trigger){case rn.SEARCH:if(e.isInitialStream)return!0===this.state.isQuestionAnswering?op.NAVIGATION:op.ASIN_CLICK;var i;if((null===(n=e.requestContext)||void 0===n||null===(n=n.queryContext)||void 0===n?void 0:n.qis)===sn.NILE_RELATED_QUESTION||(null===(r=e.requestContext)||void 0===r||null===(r=r.queryContext)||void 0===r?void 0:r.qis)===sn.NILE_DEALS_RELATED_QUESTION)return(null===(i=e.requestContext)||void 0===i?void 0:i.queryContext.qis)===sn.NILE_DEALS_RELATED_QUESTION&&S.addCount(p.RUFUS_DEALS_PILL_PRESENTED,1),op.RELATED_QUESTION_PILLS;if(e.inputQuery&&e.inputQuery.length>0)return op.INPUT_BOX;break;case rn.SWIPE_UP:return op.SWIPE_UP;case rn.ASIN_CLICK:return op.ASIN_CLICK}}else this.state.isQuestionAnswering=!0}},{key:"processEventTelemetryData",value:function(e){e?(this.state.activeChunkPatchIds=Object.keys(e.chunk),this.processChunkTelemetryData(e.chunk),e.backfill&&this.processChunkBackfillData(e.backfill)):this.state.activeChunkPatchIds=[]}},{key:"processChunkTelemetryData",value:function(e){for(var t in e)if(!(t in this.state.latencyData.patchMap)){var n=e[t];this.state.latencyData.patchMap[t]={isLast:n.last,renderStartTime:this.state.latencyData.activeChunk.renderStartTime}}}},{key:"processChunkBackfillData",value:function(e){for(var t in e)if(t in this.state.latencyData.patchMap){var n=e[t],r=this.state.latencyData.patchMap[t];r.tagType=n.tagType,r.backendProcessingEndTime=n.lastCompletedPatchProcessedAt,r.occurrenceCount=n.occurrenceCount,this.state.latencyData.backendProcessingStartTime||(this.state.latencyData.backendProcessingStartTime=n.processingStartedAt),n.tagType==up.ASIN_FACEOUT&&(this.state.latencyData.cxType=cp.ASIN_RECOMMENDATIONS),this.state.latencyData.cxType||(this.state.latencyData.cxType=n.cxType)}else S.addCount(p.UNKNOWN_PATCH_ID_IN_BACKFILL_DATA,1)}},{key:"batchRecordLatencyOnceLastPatchWasProcessed",value:function(){var e,t=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return np(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?np(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(this.state.activeChunkPatchIds);try{for(t.s();!(e=t.n()).done;){var n=e.value,r=this.state.latencyData.patchMap[n];if(this.isLastJsonPatch(r)){var i=tp.batchRecordLatencyMarkersMetrics(this.state.latencyData);this.state.latencyData.eachSectionLatencyData=i,this.state.latencyData.patchMap={};break}}}catch(e){t.e(e)}finally{t.f()}}},{key:"isLastJsonPatch",value:function(e){return e&&e.isLast&&null!=e.backendProcessingEndTime}}])}();function hp(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function fp(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?hp(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hp(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var vp=function(){var e=a(s().mark(function e(t,n){var r,i,a,o,u,c,l,d,h,f,v,m,E,g,C,T,I,A,O,b,L,N,k,U,D;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((a=dl.getInstance().getWeblabTreatment(Vl))&&S.recordTrigger(Vl,a),o=function(e){return e===el.AUTHENTICATED},(u=tl.getInstance()).on("authStatusChanged",function(e){o(e)||$v.cleanup()}),o(u.checkAuthStatus())){e.next=1;break}return e.abrupt("return");case 1:if(pd.initialize(),document.getElementById("rufus-container")||S.logErrorWithLevel(R.ERROR,"RufusPanelWebAssets is initializing without rufus-container."),(c=new Cf).areAllFeaturesSupported()){e.next=2;break}return S.addCount(p.RUFUS_INSUFFICIENT_BROWSER_CAPABILITIES,1),pd.renderError({errorCode:fd.INSUFFICIENT_BROWSER_CAPABILITIES}),e.abrupt("return");case 2:if(n.hasRufusPanelAutoMinimized&&Jt(_.PANEL_RESIZE_RUFUS,y.EXPANDED_TO_MINIMIZED),l=new wl(n.uniqueId,n.cacheEnabled),zt.getInstance().tabId=l.getTabId(),Ht(),d=new Uh,h=new Mh,f=new uf(t,l),new Jc(f),v=new hd(t,l.getTabId()),m=new Wv(f),E=new Jv(m),g=new dp(l.getTabId()),C=new gh(E,g,l),T=new hf(f),I=new _f(f,l,C),A=mn.extractQueryFromUrl(mn.getCurrentPageUrl()),yn(f.getPanelViewContext().pageType)!==gn.SEARCH_RESULTS){e.next=3;break}return e.next=3,P.when("s-metadata").execute(function(e){I.setIsRufusStayBehaviorRequired(e.isRufusStayBehaviorRequired),A||I.setSearchBarQuery(e.keywords)});case 3:return O=new xd(t,I,l.getTabId(),g),b=new Th(t,I,f),new _h(t),L=new Bd(t),new cf(t),new lf(t),N=new Qc(t,O,f),k=new Kv(l,v,C,f,O,T,d,h,b,m,E,L,N,g,c),n.isJSMigration&&(new yf(f,k).init(),bh()),k.initialize(n),U=function(){window.P&&(P.declare("rufus-thick-client",!0),P.declare("rufus-stream",function(e){k.stream(e),pp(f,n)}),P.declare("rufus-expand",function(){pp(f,n)}),qv.recordAssetsLoad())},(null==n?void 0:n.thickClientLoaded)&&(null==n||n.thickClientLoaded()),D=Ud.configName,null===(r=Nd.getInstance().getLogger(D))||void 0===r||r.setMarker("initialized"),null===(i=Nd.getInstance().getLogger(D))||void 0===i||i.emitMetrics(),e.abrupt("return",{conversationOrchestrator:k,panelContainer:f,callback:U});case 4:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),pp=function(e,t){var n=e.getPanelContainerState().viewState,r=function(e,t){var n=Gh(e);return"docked-right"!==n&&"docked-left"!==n||"expanded"===t?"expanded":n}(t,n);e.applyAnimationAndStateUpdate(n,r)},mp=function(){var e=a(s().mark(function e(t,n){var r,i;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return P.now("rufus-panel-first-visible").execute(function(e){void 0!==e&&Nd.getInstance().initialize(Ud,e)}),P.declare(bt,!1),P.declare(Lt,!1),P.declare(Ut,Gh(n)),r=Wh(n),P.declare("rufus-adjustable-width-enabled",r),r&&document.body.classList.add("rufus-docked-adjustable"),e.next=1,vp(t,n);case 1:(i=e.sent)&&i.callback(),window.addEventListener("pageshow",function(e){e.persisted&&(null==i||i.panelContainer.updateStateAndContent(),(null==i?void 0:i.panelContainer.isPanelClosed())||Nd.getInstance().initialize(Dd),null==i||i.conversationOrchestrator.handleBfCacheNavigation(),null==i||i.conversationOrchestrator.startInitialStreamingCallback())});case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}();window.P&&(P.when("A","sp.load.rufus.critical.assets.js","sp.load.rufus.panel.assets.js","rufus-common-modules").execute(function(){var e=a(s().mark(function e(t,n,r,i){var a;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=fp(fp(fp({},n),r),{},{isJSMigration:!0},i),e.next=1,mp(t,a);case 1:case"end":return e.stop()}},e)}));return function(t,n,r,i){return e.apply(this,arguments)}}()),P.when("A","rufus-thin-client").execute(function(){var e=a(s().mark(function e(t,n){var r,i;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Fv(null==n?void 0:n.rufusTriggerMarkerMapping,null==n?void 0:n.pageType),"shouldDelayThickClientInitialization"!==n.latencyRegressionMitigationStrategy||!r||"YourOrders"===n.pageType){e.next=2;break}return i=function(){var e=a(s().mark(function e(){return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,mp(t,n);case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),e.next=1,xv(i,n.rufusLatencyMarkerFallbackTimeout,r,ff.ShouldDelayThickClientInitialization);case 1:e.next=3;break;case 2:return e.next=3,mp(t,n);case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()))}()}();
//# sourceMappingURL=legacy_bundle.js.map.json
/////////////////////////
// END FILE legacy_bundle.js
/////////////////////////
// END ASSET RufusPanelWebAssetsBuild@legacy - 1.0
}));
////////////////////////////////////////////