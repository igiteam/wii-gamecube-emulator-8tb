'use strict';mix_d("CerberusSharedCards__cerberus-shared:cerberus-shared__DnokWtzm","require exports tslib @p/A @c/metrics @c/aui-truncate @c/aui-utils @c/logger @c/pagemarker @c/remote-operations @c/scoped-dom @c/tracking @c/aui-feature-detect".split(" "),function(ca,Q,y,oa,U,pa,qa,v,ra,sa,ta,R,ua){function H(a){return a&&"object"===typeof a&&"default"in a?a:{"default":a}}function da(a){if(a&&a.__esModule)return a;var d=Object.create(null);a&&Object.keys(a).forEach(function(b){if("default"!==b){var c=
Object.getOwnPropertyDescriptor(a,b);Object.defineProperty(d,b,c.get?c:{enumerable:!0,get:function(){return a[b]}})}});d["default"]=a;return d}var E=H(oa),f=H(U),va=H(pa),wa=H(qa),ea=H(ra),xa=H(sa),I=H(ta),ya=H(ua),fa={},V=function(a,d,b){void 0===d&&(d="");void 0===b&&(b=1);d=a+d;fa.hasOwnProperty(d)||(fa[d]=!0,U.count(a,(U.count(a)||0)+b))},za=function(a){V(E["default"].capabilities.mobile?"Card:EERU:SharedLib:mobile:render":"Card:EERU:SharedLib:desktop:render");var d=function(c,e){c={$event:{preventDefault:E["default"].$.noop,
stopPropagation:E["default"].$.noop},$target:c.getContent().find('[data-a-tab-name="'+e+'"]'),data:{name:"energyEfficiencyTabSet"}};E["default"].trigger("a:declarative:a-tabs:click",c)},b=function(c,e){var h=c&&c.$event,l=c&&c.data||{},n=l.activeTabName,m=l.modalHeight,r=l.name;h&&h.preventDefault&&h.preventDefault();h&&h.stopPropagation&&h.stopPropagation();h=e.get(r);h||(E["default"].on("a:popover:beforeShow:"+r,function(k){k.popover&&k.popover.getContent&&(k=k.popover.getContent(),k.find(".a-manually-loaded").parent().css("min-height",
m),E["default"].loadDescendantImagesManually(k))}),h=e.create(c.$target,l));h.show();d(h,n)};a.when("a-secondary-view").execute("RegisterEnergyEfficiencyEventMobile",function(c){E["default"].declarative("card-energy-efficiency-secondary-view","click",function(e){V("Card:EERU:SharedLib:mobile:click",e&&e.data&&e.data.name||"");b(e,c)})});a.when("a-modal").execute("RegisterEnergyEfficiencyEventDesktop",function(c){E["default"].declarative("card-energy-efficiency-modal","click",function(e){V("Card:EERU:SharedLib:desktop:click",
e&&e.data&&e.data.name||"");b(e,c)})})},Aa=function(a){a.when("ready").execute("EEBadgeProductFicheResize",function(d){var b=E["default"].$;b(".energyEfficiencyContainer").each(function(c,e){c=b(e).find(".energyEfficiencyProductFicheLabel").first();e=b(e).find("svg").first();c.parent().outerHeight()>e.outerHeight()&&(c.removeClass("a-size-small"),c.addClass("a-size-micro"),c.parent().outerHeight()>e.outerHeight()&&c.parent().css("line-height","10px"))})})},Ba=function(){var a=window.P;za(a);Aa(a)},
S={wb:1},Ca=function(a){return{subsAsin:a.asin,subsAvgRating:a.reviewRating,subsCurrency:a.currencyCode,subsHighestPrice:parseFloat(a.priceRangeHigh||"")||void 0,subsIsParent:a.isParent,subsIsPrime:a.isPrime,subsIsPrimeBadgeLazy:a.isPrimeBadgeLazyEnabled,subsLowestPrice:parseFloat(a.priceRangeLow||"")||void 0,subsPosition:a.position-1,subsPrice:parseFloat(a.price||"")||0,subsPrimeEligible:a.isPrime,subsSourcesMap:a.substituteSourcesMap,subsTotalReviews:a.reviewCount,subsSource:null,subsSourceScore:null}},
Da=function(){f["default"].count("rsi.crb.dpmark.reg.auical",1);P.now("injectCalendarOnDetailPage").execute("cerberusSharedCardsAuiCalendarRegisterDpMarker",function(a){if(!a)try{P.register("injectCalendarOnDetailPage",function(){var d;return d={},d.injectCalendarOnDetailPage=1,d})}catch(d){}})},W=function(a,d,b){d=encodeURIComponent(d);a.classList.add("a-declarative");a.setAttribute("data-action",d);a.setAttribute("data-"+d.toLowerCase(),JSON.stringify(b))},ha=function(a,d,b){d=encodeURIComponent(d);
a.setAttribute("data-"+d.toLowerCase(),JSON.stringify(b))},ia=function(a,d){return{asin:d,buyingRuleId:a,existingRuleRedirectView:"delete",existingRuleTerminatedRedirectView:"edit",minFormActions:"true",noRuleRedirectToCreateAsin:d,source:"dpoosw"}},ja=function(a,d){return{asin:d,buyingRuleId:a,existingRuleRedirectView:"delete",existingRuleTerminatedRedirectView:"edit",minFormActions:"true",noRuleRedirectToCreateAsin:d,source:"dpoosw"}},Ea=function(){f["default"].count("rsi.crb.dpmark.reg.brdp",1);
P.now("useBuyingRulesDpAssets").execute("cerberusSharedCardsBuyingRulesCxRegisterDpMarker",function(a){if(!a)try{P.register("useBuyingRulesDpAssets",function(){return{useBuyingRulesDpAssets:1}})}catch(d){}})},Fa=function(a){f["default"].count("rsi.crb.brx.setup.pending",1);P.when("brx-dp-app-behavior").execute("cerberusSharedCardsBuyingRulesCx",function(d){f["default"].count("rsi.crb.brx.setup.start",1);var b=d.eventNames,c=d.viewNames,e=a.pageAsin;if(e){var h=I["default"].cardRoot.getElementsByClassName("_Y2VyY_idWidgetSubTitle_2fmXg")[0];
if(h){var l=I["default"].cardRoot.getElementsByClassName("_Y2VyY_idBuyingRuleSubTitleCreate_RX7tg")[0],n=I["default"].cardRoot.getElementsByClassName("_Y2VyY_idBuyingRuleSubTitleDelete_1jzas")[0],m=I["default"].cardRoot.getElementsByClassName("_Y2VyY_idBuyingRuleSubTitleEdit_aFklQ")[0];if(l&&n&&m){l=l.getElementsByTagName("a")[0];var r=n.getElementsByTagName("a")[0],k=m.getElementsByTagName("a")[0];if(l&&r&&k){var q=function(g){g===c.CREATE_BUYING_RULE_VIEW_NAME?h.setAttribute("data-buyingruleaction",
"create"):g===c.DELETE_BUYING_RULE_VIEW_NAME?h.setAttribute("data-buyingruleaction","delete"):g===c.EDIT_BUYING_RULE_VIEW_NAME&&h.setAttribute("data-buyingruleaction","edit")};n=d.localizedDataManager;n.setLocale(a.language,a.currency);m=a.localizedStrings;"object"===typeof m&&m?n.assignStrings(m):(v.log("CerberusSharedCards.BRX.Setup.strings not found in data attributes for asin("+e+")","ERROR"),f["default"].count("rsi.crb.brx.setup.nostrings",1));m=n.getString("create-buying-rule--a-modal--option--header");
var A={ajaxFailMsg:n.getString("create-buying-rule--view--load-failed--message"),closeMessage:n.getString("a-sheet--option--generic--closeMessage"),header:m,popoverLabel:m,sheetLabel:m};m=n.getString("delete-buying-rule--a-modal--option--header");var p={ajaxFailMsg:n.getString("delete-buying-rule--view--load-failed--message"),closeMessage:n.getString("a-sheet--option--generic--closeMessage"),header:m,popoverLabel:m,sheetLabel:m};m=n.getString("edit-buying-rule--a-modal--option--header");var x={ajaxFailMsg:n.getString("edit-buying-rule--view--load-failed--message"),
closeMessage:n.getString("a-sheet--option--generic--closeMessage"),header:m,popoverLabel:m,sheetLabel:m};d.addHook_SHOW_VIEW_BEFORE_SHOW_LOCALIZE_VIEW(c.CREATE_BUYING_RULE_VIEW_NAME,function(g){g.updateViewLanguage(c.CREATE_BUYING_RULE_VIEW_NAME,A);q(c.CREATE_BUYING_RULE_VIEW_NAME)});d.addHook_SHOW_VIEW_BEFORE_SHOW_LOCALIZE_VIEW(c.DELETE_BUYING_RULE_VIEW_NAME,function(g){g.updateViewLanguage(c.DELETE_BUYING_RULE_VIEW_NAME,p);q(c.DELETE_BUYING_RULE_VIEW_NAME)});d.addHook_SHOW_VIEW_BEFORE_SHOW_LOCALIZE_VIEW(c.EDIT_BUYING_RULE_VIEW_NAME,
function(g){g.updateViewLanguage(c.EDIT_BUYING_RULE_VIEW_NAME,x);q(c.EDIT_BUYING_RULE_VIEW_NAME)});d.addHook_SHOW_VIEW_REDIRECT_LOCALIZE_VIEW(c.CREATE_BUYING_RULE_VIEW_NAME,function(g,w,t,B){g.updateViewLanguage(c.CREATE_BUYING_RULE_VIEW_NAME,A);q(t)});d.addHook_SHOW_VIEW_REDIRECT_LOCALIZE_VIEW(c.DELETE_BUYING_RULE_VIEW_NAME,function(g,w,t,B){g.updateViewLanguage(c.DELETE_BUYING_RULE_VIEW_NAME,p);q(t)});d.addHook_SHOW_VIEW_REDIRECT_LOCALIZE_VIEW(c.EDIT_BUYING_RULE_VIEW_NAME,function(g,w,t,B){g.updateViewLanguage(c.EDIT_BUYING_RULE_VIEW_NAME,
x);q(t)});W(l,"brx-create-buying-rule-view",{buyingRuleId:a.buyingRuleId,asin:e,minFormActions:"true",existingRuleRedirectView:"delete",existingRuleTerminatedRedirectView:"edit",source:"dpoosw"});W(r,"brx-delete-buying-rule-view",ia(a.buyingRuleId,e));W(k,"brx-edit-buying-rule-view",ja(a.buyingRuleId,e));var u=!1;"create"===a.buyingRuleInitialAction?f["default"].count("rsi.crb.brx.initial.create.show",1):"delete"===a.buyingRuleInitialAction?f["default"].count("rsi.crb.brx.initial.delete.show",1):
"edit"===a.buyingRuleInitialAction&&f["default"].count("rsi.crb.brx.initial.edit.show",1);l.addEventListener("click",function(g){f["default"].count("rsi.crb.brx.create.click",1);u||"create"!==a.buyingRuleInitialAction||(u=!0,f["default"].count("rsi.crb.brx.initial.create.click",1))});r.addEventListener("click",function(g){f["default"].count("rsi.crb.brx.delete.click",1);u||"delete"!==a.buyingRuleInitialAction||(u=!0,f["default"].count("rsi.crb.brx.initial.delete.click",1))});k.addEventListener("click",
function(g){f["default"].count("rsi.crb.brx.edit.click",1);u||"edit"!==a.buyingRuleInitialAction||(u=!0,f["default"].count("rsi.crb.brx.initial.edit.click",1))});d.eventManager.subscribe([b.CREATE_BUYING_RULE_FORM_SEND_SUCCESS_EVENT,b.DEACTIVATE_BUYING_RULE_FORM_SEND_SUCCESS_EVENT,b.EDIT_BUYING_RULE_FORM_SEND_SUCCESS_EVENT],function(g,w){var t;if((null===(t=null===g||void 0===g?void 0:g.buyingRuleModel)||void 0===t?void 0:t.asin)===e){t=g.buyingRuleModel.id;g=g.buyingRuleModel.isTerminated;ha(r,"brx-delete-buying-rule-view",
ia(t,e));ha(k,"brx-edit-buying-rule-view",ja(t,e));var B=r.setAttribute;var D="/buying-rules?ref_="+encodeURIComponent("mobile"===a.deviceType?"rsi_br_brh_dpoosw_dbrl_mawd":"rsi_br_brh_dpoosw_dbrl_dstd")+"&action="+encodeURIComponent("delete-br")+"&source=dpoosw&buyingRuleId="+encodeURIComponent(t)+"&noRuleRedirectToCreateAsin="+encodeURIComponent(e||"")+"&existingRuleRedirectView=delete&existingRuleTerminatedRedirectView=edit&minFormActions=true";B.call(r,"href",D);B=k.setAttribute;t="/buying-rules?ref_="+
encodeURIComponent("mobile"===a.deviceType?"rsi_br_brh_dpoosw_ebrl_mawd":"rsi_br_brh_dpoosw_ebrl_dstd")+"&action="+encodeURIComponent("edit-br")+"&source=dpoosw&buyingRuleId="+encodeURIComponent(t)+"&noRuleRedirectToCreateAsin="+encodeURIComponent(e||"")+"&existingRuleRedirectView=delete&existingRuleTerminatedRedirectView=edit&minFormActions=true";B.call(k,"href",t);q(g?c.EDIT_BUYING_RULE_VIEW_NAME:c.DELETE_BUYING_RULE_VIEW_NAME);w===b.CREATE_BUYING_RULE_FORM_SEND_SUCCESS_EVENT?f["default"].count("rsi.crb.brx.create.complete",
1):(w===b.EDIT_BUYING_RULE_FORM_SEND_SUCCESS_EVENT||w===b.DEACTIVATE_BUYING_RULE_FORM_SEND_SUCCESS_EVENT)&&f["default"].count("rsi.crb.brx.edit.complete",1)}});d.eventManager.subscribe(b.DELETE_BUYING_RULE_FORM_SEND_SUCCESS_EVENT,function(g){var w;(null===(w=null===g||void 0===g?void 0:g.buyingRuleModel)||void 0===w?void 0:w.asin)===e&&(q(c.CREATE_BUYING_RULE_VIEW_NAME),f["default"].count("rsi.crb.brx.delete.complete",1))});f["default"].count("rsi.crb.brx.setup.end",1)}else v.log("CerberusSharedCards.BRX.Setup.create/delete/edit link element not found for asin("+
e+")","FATAL"),f["default"].count("rsi.crb.brx.setup.error",1)}else v.log("CerberusSharedCards.BRX.Setup.create/delete/edit sub title element not found for asin("+e+")","FATAL"),f["default"].count("rsi.crb.brx.setup.error",1)}else v.log("CerberusSharedCards.BRX.Setup.widget sub title element not found for asin("+e+")","FATAL"),f["default"].count("rsi.crb.brx.setup.error",1)}else v.log("CerberusSharedCards.BRX.Setup.page asin not found in data attributes","FATAL"),f["default"].count("rsi.crb.brx.setup.error",
1)})},Ga=function(a){return y.__awaiter(void 0,void 0,void 0,function(){var d,b;return y.__generator(this,function(c){switch(c.label){case 0:return ya["default"].isSupported("isAmazonApp")?[4,new Promise(function(e,h){ca(["@m/mash"],function(l){e(da(l))},h)})]:[3,2];case 1:return d=c.sent(),d.cart.didUpdate({newCartQuantity:a}),[3,4];case 2:return[4,new Promise(function(e,h){ca(["@p/nav.setCartCount"],function(l){e(da(l))},h)})];case 3:b=c.sent(),b.default(a),c.label=4;case 4:return[2]}})})},X=function(a,
d,b,c){var e="none",h="none",l="none";"undefined"===typeof c?e="block":c?h="block":l="block";a&&(a.style.display=e);d&&(d.style.display=h);b&&(b.style.display=l)},Ha=function(a){var d={cssGlobalClassName:"cerberusSharedCards-deviceTypeUnknown",isDesktop:!1,isMobile:!1,isTablet:!1,isUnknown:!1,metrics:{counterSuffix:".unknown"},origType:a,type:"unknown"};"desktop"===a?(d.cssGlobalClassName="cerberusSharedCards-deviceTypeDesktop",d.isDesktop=!0,d.type="desktop",d.metrics.counterSuffix=".desktop"):"mobile"===
a?(d.cssGlobalClassName="cerberusSharedCards-deviceTypeMobile",d.isMobile=!0,d.type="mobile",d.metrics.counterSuffix=".mobile"):"tablet"===a?(d.cssGlobalClassName="cerberusSharedCards-deviceTypeTablet",d.isTablet=!0,d.type="tablet",d.metrics.counterSuffix=".tablet"):d.isUnknown=!0;return d},Ia=function(a){if("object"!==typeof a||!a)throw Error("ASIN faceout element is not valid");a=a.dataset;return{asin:a.asin||"",currencyCode:a.currencycode||"",hasPriceRange:"true"===a.haspricerange,isMapSuppressed:"true"===
a.ismapsuppressed,isParent:"true"===a.isparent,isPrime:"true"===a.isprime,isPrimeBadgeLazyEnabled:"true"===a.isprimebadgelazyenabled,offerListingId:a.offerlistingid,position:Number(a.position)||-1,price:a.price||"",priceRangeHigh:a.pricerangehigh,priceRangeLow:a.pricerangelow,reviewCount:Number(a.reviewcount)||0,reviewRating:parseFloat(a.reviewrating||"")||0,substituteSourcesMap:a.substitutesourcesmap,kindleProgramType:a.kindleprogramtype||"",kindleProgramShortMessage:a.kindleprogramshortmessage||
""}},Ja=function(a){if("object"!==typeof a||!a)throw Error("Widget data element is not valid");a=a.dataset;var d=a.requestid,b=a.widgettype,c=a.widgettypevariant;if(!b||!d)throw Error("Required data attributes not found");return{buyingRuleId:a.buyingruleid,buyingRuleInitialAction:a.buyingruleinitialaction,currency:a.currency||"",customerId:a.customerid,deviceType:a.devicetype||"unknown",displayReason:a.displayreason||"UNKNOWN",isBuyingRuleTerminated:a.isbuyingruleterminated?"true"===a.isbuyingruleterminated:
void 0,isBuyingRulesReminderCxEnabled:"true"===a.isbuyingrulesremindercxenabled,isLazyLoadedATCButtonEnabled:"true"===a.islazyloadedatcbuttonenabled,isLazyPrimeBadgeEnabled:"true"===a.islazyprimebadgeenabled,language:a.language||"",localizedStrings:a.localizedstrings?JSON.parse(a.localizedstrings):{},marketplaceId:a.marketplaceid||"",pageAsin:a.pageasin,pageType:a.pagetype,producerId:a.producerid,reftag:a.reftag||"",renderPageType:a.renderpagetype||"unknown",requestId:d,sessionId:a.sessionid||"",
widgetType:b,widgetTypeVariant:c||"None"}},Ka=function(a,d,b,c){b={cssGlobalClassName:"cerberusSharedCards-widgetTypeUnknown",isCart:!1,isCompatibleProducts:!1,isCoos:!1,isFlex:!1,isFod:!1,isKufo:!1,isGemini:!1,isLpo:!1,isLpoFreeSearchVariant:!1,isLpoShoppingAdsVariant:!1,isOos:!1,isOosGlanceViewVariant:!1,isUnknown:!1,metrics:{typeClientCounter:"prs.crb.clnt.env.wgt.unknown",typeServerCounter:"prs.crb.srv.env.wgt.unknown",typeVariantClientCounter:"prs.crb.clnt.env.wgt.var.none",typeVariantServerCounter:"prs.crb.srv.env.wgt.var.none"},
origDisplayReason:b,type:a||"Unknown",typeVariant:"None"};"Cart"===a?("detail"===c?(b.metrics.typeClientCounter="prs.crb.clnt.env.wgt.cart.dp-oos",b.metrics.typeServerCounter="prs.crb.srv.env.wgt.cart.dp-oos"):(b.metrics.typeClientCounter="prs.crb.clnt.env.wgt.cart",b.metrics.typeServerCounter="prs.crb.srv.env.wgt.cart"),b.cssGlobalClassName="cerberusSharedCards-widgetTypeCart",b.isCart=!0):"CompatibleProducts"===a?(b.cssGlobalClassName="cerberusSharedCards-widgetTypeCompatibleProducts",b.isCompatibleProducts=
!0,b.metrics.typeClientCounter="prs.crb.clnt.env.wgt.compatible-products",b.metrics.typeServerCounter="prs.crb.srv.env.wgt.compatible-products"):"Coos"===a?(b.cssGlobalClassName="cerberusSharedCards-widgetTypeCoos",b.isCoos=!0,b.metrics.typeClientCounter="prs.crb.clnt.env.wgt.coos",b.metrics.typeServerCounter="prs.crb.srv.env.wgt.coos"):"Flex"===a?(b.cssGlobalClassName="cerberusSharedCards-widgetTypeFlex",b.isFlex=!0,b.metrics.typeClientCounter="prs.crb.clnt.env.wgt.flex",b.metrics.typeServerCounter=
"prs.crb.srv.env.wgt.flex"):"Fod"===a?(b.cssGlobalClassName="cerberusSharedCards-widgetTypeFod",b.isFod=!0,b.metrics.typeClientCounter="prs.crb.clnt.env.wgt.fod",b.metrics.typeServerCounter="prs.crb.srv.env.wgt.fod"):"Kufo"===a?(b.cssGlobalClassName="cerberusSharedCards-widgetTypeKufo",b.isKufo=!0,b.metrics.typeClientCounter="prs.crb.clnt.env.wgt.kufo",b.metrics.typeServerCounter="prs.crb.srv.env.wgt.kufo"):"Gemini"===a?(b.cssGlobalClassName="cerberusSharedCards-widgetTypeGemini",b.isGemini=!0,b.metrics.typeClientCounter=
"prs.crb.clnt.env.wgt.gemini",b.metrics.typeServerCounter="prs.crb.srv.env.wgt.gemini"):"Lpo"===a?(b.cssGlobalClassName="cerberusSharedCards-widgetTypeLpo",b.isLpo=!0,b.metrics.typeClientCounter="prs.crb.clnt.env.wgt.lpo",b.metrics.typeServerCounter="prs.crb.srv.env.wgt.lpo","LpoFreeSearch"===d?(b.isLpoFreeSearchVariant=!0,b.typeVariant=d,b.metrics.typeVariantClientCounter="prs.crb.clnt.env.wgt.var.lpo-free-search",b.metrics.typeVariantServerCounter="prs.crb.srv.env.wgt.var.lpo-free-search"):"LpoShoppingAds"===
d&&(b.isLpoShoppingAdsVariant=!0,b.typeVariant=d,b.metrics.typeVariantClientCounter="prs.crb.clnt.env.wgt.var.lpo-shopping-ads",b.metrics.typeVariantServerCounter="prs.crb.srv.env.wgt.var.lpo-shopping-ads")):"Oos"===a?(b.cssGlobalClassName="cerberusSharedCards-widgetTypeOos",b.isOos=!0,b.metrics.typeClientCounter="prs.crb.clnt.env.wgt.oos",b.metrics.typeServerCounter="prs.crb.srv.env.wgt.oos","OosGlanceView"===d&&(b.isOosGlanceViewVariant=!0,b.typeVariant=d,b.metrics.typeVariantClientCounter="prs.crb.clnt.env.wgt.var.oos-glance-view",
b.metrics.typeVariantServerCounter="prs.crb.srv.env.wgt.var.oos-glance-view")):"Odp"===a?(b.cssGlobalClassName="cerberusSharedCards-widgetTypeOdp",b.metrics.typeClientCounter="prs.crb.clnt.env.wgt.odp",b.metrics.typeServerCounter="prs.crb.srv.env.wgt.odp"):(b.cssGlobalClassName="cerberusSharedCards-widgetTypeUnknown",b.isUnknown=!0,b.type="Unknown");return b},La=function(a,d,b){var c,e=b.producerId;if(e){var h=b.customerId||null,l=b.marketplaceId,n=b.sessionId,m=b.requestId,r={deviceType:b.deviceType,
seedAsin:b.pageAsin,subsReason:b.displayReason};d=function(p){var x=p.imageLinkElement,u=p.titleLinkElement,g=Ca(p.dataAttributes);g=y.__assign(y.__assign({customerId:h,obfuscatedMarketplaceId:l,sessionId:n},r),g);f["default"].event(g,e,"prservices.SurfacedSubstituteEvent.6");var w=y.__assign({customerId:h,obfuscatedMarketplaceId:l,sessionId:n,subsAsin:p.asin,surfacedAsinRequestId:m},r);u?u.addEventListener("click",function(){f["default"].event(w,e,"prservices.ClickedSubstituteEvent.4")}):v.log("CerberusSharedCards.MissingElement.titleLink not found; asin: "+
p.asin,"ERROR");x?x.addEventListener("click",function(){f["default"].event(w,e,"prservices.ClickedSubstituteEvent.4")}):v.log("CerberusSharedCards.MissingElement.imageLink not found; asin: "+p.asin,"ERROR")};try{for(var k=y.__values(a),q=k.next();!q.done;q=k.next())d(q.value)}catch(p){var A={error:p}}finally{try{q&&!q.done&&(c=k.return)&&c.call(k)}finally{if(A)throw A.error;}}}else(!d.isCart&&!d.isLpo||d.isCart&&"detail"==b.pageType)&&v.log("CerberusSharedCards.NexusLogging.producerId not found",
"WARN")},Y=function(a,d,b,c,e){var h,l=d.reftag,n=b.isCart?"rsi.cart.":"rsi.oos.";f["default"].count(""+n+"atc.shown."+c,1);var m=-1;b=function(p){m++;var x=p.asin,u=p.dataAttributes.offerListingId;p=p.cartActionContainerElement;if(!p)return"continue";var g=l+"_oos_atcajx_"+c+"_"+m,w=l+"_oos_cartajx_"+c+"_"+m,t=p.querySelector("button");if(!t)return{value:void 0};if(!x||!u)return v.log("CerberusSharedCards.ATC.No offer listing ID to add to cart; asin: "+x+"; pageAsin: "+d.pageAsin),t.style.visibility=
"hidden","continue";var B=p.querySelector("._Y2VyY_afCartActionMessageLoading_NgVU3"),D=p.querySelector("._Y2VyY_afCartActionMessageSuccess_1Kidz"),J=p.querySelector("._Y2VyY_afCartActionMessageFail_2tBPW");t.addEventListener("click",function(){return y.__awaiter(void 0,void 0,void 0,function(){var L,M,F,G,K;return y.__generator(this,function(C){switch(C.label){case 0:f["default"].count(""+n+"atc.click."+c,1),X(B,D,J,void 0),C.label=1;case 1:return C.trys.push([1,3,,4]),L={asin:x,offerListingId:u},
[4,R.addTracking(e.addToCart,{},g||"")(L)];case 2:return C.sent(),[3,4];case 3:return M=C.sent(),v.log("CerberusSharedCards.ATC."+M.toString()+"; asin: "+x,"ERROR"),f["default"].count(""+n+"atc.fail."+c,1),X(B,D,J,!1),[2];case 4:f["default"].count(""+n+"atc.success."+c,1),F=null,C.label=5;case 5:return C.trys.push([5,7,,8]),[4,R.addTracking(e.getCartCount,{},w||"")()];case 6:return F=C.sent(),[3,8];case 7:return G=C.sent(),v.log("CerberusSharedCards.getCartCount."+G.toString()+"; asin: "+x,"ERROR"),
f["default"].count(""+n+"gcc.fail."+c,1),[2];case 8:return f["default"].count(""+n+"gcc.success."+c,1),X(B,D,J,!0),[4,Ga(F.items)];case 9:return C.sent(),K=I["default"].cardRoot.getElementsByClassName("_Y2VyY_idAddToCartClickedFlag_rhlYt"),0<K.length&&K[0].setAttribute("value","true"),[2]}})})})};try{for(var r=y.__values(a),k=r.next();!k.done;k=r.next()){var q=b(k.value);if("object"===typeof q)return q.value}}catch(p){var A={error:p}}finally{try{k&&!k.done&&(h=r.return)&&h.call(r)}finally{if(A)throw A.error;
}}},ka=function(a,d,b,c,e,h){setTimeout(function(){R.addTracking(a.getAddToCartButton)(d).then(function(l){var n,m=[];try{for(var r=y.__values(b),k=r.next();!k.done;k=r.next()){var q=k.value;if(q.asin in l){var A=q.dataAttributes,p=q.cartActionContainerElement;m.push(y.__assign(y.__assign({},q),{dataAttributes:y.__assign(y.__assign({},A),{offerListingId:l[q.asin].offerListingId}),cartActionContainerElement:p}));if(p&&l[q.asin].offerListingId){p.style.display="block";var x=p.querySelector("button");
x&&(x.textContent=l[q.asin].actionButtonText)}}}}catch(g){var u={error:g}}finally{try{k&&!k.done&&(n=r.return)&&n.call(r)}finally{if(u)throw u.error;}}Y(m,c,e,h,a)}).catch(function(l){v.log("CerberusSharedCards.ATC."+l,"ERROR")})},50)};Q._operationNames=["addToCart","getCartCount","getPrimeBadge","getAddToCartButton"];Q.card=function(){return y.__awaiter(void 0,void 0,void 0,function(){var a,d,b,c,e,h,l,n,m,r,k,q,A,p,x,u,g,w,t,B,D,J,L,M,F,G,K,C,la;return y.__generator(this,function(Na){a=Date.now();
d=!1;try{f["default"].count("prs.crb.clnt.eval.begin",1);f["default"].uet("bb","cerberus-shared",S);b=xa["default"].setup();try{c=Ja(I["default"].cardRoot.getElementsByClassName("_Y2VyY_idWidgetData_13wSW")[0])}catch(z){throw v.log("CerberusSharedCards.WidgetData."+z.message,"ERROR"),f["default"].count("rsi.gwdata.fail",1),f["default"].count("prs.crb.clnt.eval.fail.data-input",1),d=!0,z;}e=c.deviceType||"unknown";h=Ka(c.widgetType,c.widgetTypeVariant,void 0,c.pageType);l=Ha(e);n=c.renderPageType;
f["default"].count(h.metrics.typeClientCounter,1);f["default"].count(h.metrics.typeVariantClientCounter,1);f["default"].count(""+h.metrics.typeClientCounter+l.metrics.counterSuffix,1);f["default"].count(""+h.metrics.typeVariantClientCounter+l.metrics.counterSuffix,1);h.isOos?f["default"].count("prservices.ooswidget.shown."+e,1):h.isFod?f["default"].count("prservices.fodwidget.shown."+e,1):h.isCart?va["default"].refreshAutoTruncate():"Odp"===c.widgetType&&f["default"].count("prservices.odpwidget.client.time",
Date.now()-a);m=I["default"].cardRoot.getElementsByClassName("_Y2VyY_idAsinFaceoutContainer_1tA-V");r=[];k=[];q=[];A=[];p=[];for(x=0;x<m.length;x++)u=m[x],g=Ia(u),w=g.asin,t=u.getElementsByClassName("_Y2VyY_idAsinFaceoutImageLink_2gOXw")[0],B=g.isPrimeBadgeLazyEnabled?u.getElementsByClassName("_Y2VyY_idAsinFaceoutLazyPrimeBadge_3MnZp")[0]:void 0,D={asin:w,cartActionContainerElement:u.getElementsByClassName("_Y2VyY_idAsinFaceoutCartActionContainer_2iTcx")[0],cartActionLazyLoadedContainerElement:u.getElementsByClassName("_Y2VyY_idAsinFaceoutCartActionLazyContainer_28Jkk")[0],
containerElement:u,dataAttributes:g,imageElement:null===t||void 0===t?void 0:t.getElementsByTagName("img")[0],imageLinkElement:t,lazyPrimeBadgeElement:B,titleLinkElement:u.getElementsByClassName("_Y2VyY_idAsinFaceoutTitleLink_3_7-h")[0]},r.push(D),B&&(q.push(w),k.push(D)),c.isLazyLoadedATCButtonEnabled&&D.cartActionLazyLoadedContainerElement&&(p.push(w),A.push(D)),"Odp"===c.widgetType&&f["default"].count("prs.crb.odp.rendered."+g.kindleProgramType,1);!c.isLazyPrimeBadgeEnabled&&k.length&&v.log("CerberusSharedCards.UnexpectedState.lazyPrimeBadges found when not enabled",
"ERROR");c.isLazyLoadedATCButtonEnabled||Y(r,c,h,e,b);f["default"].uet("cf","cerberus-shared",S);J=function(){f["default"].uet("be","cerberus-shared",S);La(r,h,c);f["default"].uex("ld","cerberus-shared",S)};0<k.length?(L=R.addTracking(b.getPrimeBadge),L(q).then(function(z){var N;try{for(var T=y.__values(k),O=T.next();!O.done;O=T.next()){var Z=O.value,aa=Z.asin,ma=Z.containerElement,ba=Z.lazyPrimeBadgeElement;ba?z[aa]?(ba.classList.remove("_Y2VyY_hidden_2mxOy"),ma.dataset.isPrime="true"):(ba.classList.add("_Y2VyY_hidden_2mxOy"),
ma.dataset.isPrime="false"):v.log("CerberusSharedCards.MissingElement.lazyPrimeBadge not found; asin: "+aa+"; isPrime: "+z[aa],"ERROR")}}catch(Ma){var na={error:Ma}}finally{try{O&&!O.done&&(N=T.return)&&N.call(T)}finally{if(na)throw na.error;}}}).catch(function(z){v.log("CerberusSharedCards.getPrimeBadge failed: "+z,"ERROR")}).then(function(){return J()})):J();M=function(z){var N=z.imageElement;N?ea["default"].pageLoad.then(function(){return wa["default"].loadDynamicImage(N)}):v.log("CerberusSharedCards.MissingElement.image not found; asin: "+
z.asin,"ERROR")};try{for(F=y.__values(r),G=F.next();!G.done;G=F.next())K=G.value,M(K)}catch(z){C={error:z}}finally{try{G&&!G.done&&(la=F.return)&&la.call(F)}finally{if(C)throw C.error;}}Ba();if(c.isBuyingRulesReminderCxEnabled||c.isLazyLoadedATCButtonEnabled)f["default"].count("rsi.crb.brx.setup.init",1),ea["default"].pageReady.then(function(){"object"===typeof P?"dp"===n?P.when("dp-time-to-interactive").execute("cerberusSharedCardsBuyingRulesCxMarkerWait",function(z){z.getClickToCIPromise().then(function(){Da();
Ea();Fa(c);c.isLazyLoadedATCButtonEnabled&&ka(b,p,A,c,h,e)})}):v.log("Buying Rules CX loaded on non-DP page; renderPageType: "+c.renderPageType+"; displayReason: "+c.displayReason+"; reftag: "+c.reftag+";","FATAL"):v.log("P global not found when enabling Buying Rules CX; asin: "+c.pageAsin,"FATAL")});f["default"].count("prs.crb.clnt.eval.end",1)}catch(z){throw d||(v.log("Top level error in client.ts: "+z.message,"FATAL"),f["default"].count("prs.crb.clnt.eval.fail.unknown",1)),z;}return[2]})})};Q.setupCartAction=
Y;Q.setupLazyLoadedAddToCartButton=ka});
