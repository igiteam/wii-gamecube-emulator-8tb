"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[66077,32109],{269148:function(e,t,n){n.d(t,{R_:function(){return a},UZ:function(){return l},Z7:function(){return i}});const a={ADD_SELECTED_ITEMS:"addSelectedItems",ADD_ESSENTIALS_TO_YOUR_CART:"addEssentialsToYourCart",ADD_ITEMS:"addItems",SUBSCRIBE:"subscribe",MYITEMS:"myItems",CHECKOUT:"checkout",OVERLAY_VIEW:"overlayView",ONCLICK:"onClick",MODULE_VIEW:"moduleView",PREDICTIVE_BASKET_SKELETON:"predictiveBasketSkeleton",PREDICTIVE_BASKET_FE:"predictiveBasket",CHECKBOX:"checkBox",GET_IT_EVERY:"getItEvery",SELECT_All:"selectAll",DESELECT_All:"deselectAll",INCREMENT_ITEM_QTY:"incrementItemQty",DECREMENT_ITEM_QTY:"decrementItemQty",UNABLE_TO_ATC_SUBSCRIPTION:"UnableToAddItemsSubscription",NO_ITEMS_SELECTED:"Select at least 1 item to continue.",ADD_ITEM_ERROR:"addItemError",ITEM_CHECKBOX:"itemCheckBox",DISMISS:"dismiss",ADD_TO_CART:"addToCart",ITEMS_ADDED:"itemsAdded",ITEMS_VIEW_CART:"itemsViewCart",SUBSCRIPTIONS_VIEW_CART:"subscriptionsViewCart",THANK_YOU_PAGE:"thankYouPage",SUBSCRIPTION_BULK_ENROLLMENT_BANNER:"subscriptionBulkEnrollmentBanner"},i=(e,t,n)=>({co:{ov:a.ADD_SELECTED_ITEMS},ta:{ov:a.ADD_SELECTED_ITEMS},li:{nm:"".concat(e," ").concat(t)},nm:{nm:"".concat(a.GET_IT_EVERY," ").concat(e," ").concat(t)},pr:{us:n}}),l=(e,t,n)=>({context:a.SUBSCRIBE,action:a.ONCLICK,name:a.GET_IT_EVERY,payload:{co:{ov:a.ADD_SELECTED_ITEMS},li:{nm:"".concat(e," ").concat(t)},pr:{us:n},nm:{nm:"".concat(a.GET_IT_EVERY," ").concat(e," ").concat(t)}}})},684027:function(e,t,n){n.r(t),n.d(t,{BULKENROLLMENT_IDB_KEY:function(){return H},BULKENROLLMENT_OBJECT_STORE:function(){return Z},QUICKADDSELECTIONS_IDB_KEY:function(){return G},QUICKADDSELECTIONS_OBJECT_STORE:function(){return Y},default:function(){return ee}});var a=n(487954),i=n(522037),l=n(293168),r=n(682081),s=n(425443),c=n(297693),o=n(269148),d=n(128829),u=n(929880),m=n(632017),E=n(200421),h=n(976973),p=n(444002),_=n(221910),x=n(575393),v=n(194742),I=n(52676),S=n(630131),f=n(527153),b=n(155394),T=n(764766),C=n(974225),D=n(918099);const g=e=>{let{totalItems:t,totalPrice:n}=e;const{router:i}=(0,T.tv)(),{locale:l}=i,{isMobile:c}=(0,s.vP)();return(0,a.jsxs)("div",{className:"flex items-center justify-between w-100 mb3 dark-gray",children:[(0,a.jsx)("span",{className:"f5",children:(0,r.m)(I,"itemsSelectedMsg",{totalItems:t})}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"lh-copy mr2 ".concat(c?"f4 b":"f5"),children:(0,r.m)(I,"estimatedTotal")}),(0,a.jsx)("span",{className:"b nowrap ".concat(c?"f4":"f3"),"data-testid":"quick-add-total-price",children:(0,r.m)(I,"currency",{price:(0,C.mD)(n,l)})})]})]})};var y=e=>{let{togglePopup:t,totalPrice:n,totalItems:i,onAATCSuccess:l,clearSelections:s,onAATCError:d,addToCartProducts:u,addAllToCartAnalytics:m,moduleContext:h,isSubscriptionBulkEnroll:p,setNoItemsSelectedAlert:_,refetchMyItems:x}=e;const{router:S}=(0,T.tv)(),C=(0,c.wG)(),{0:y,1:R}=(0,v.useState)(!1);(0,v.useEffect)((()=>R(!i&&!p)),[p,i]);const{addSnack:N}=(0,b.useSnackbar)(),{onAddAllToCart:k,isSuccess:j,error:A,data:L,isLoading:M}=(0,f.JN)();(0,v.useEffect)((()=>{if(j){var e,n,a;const t=null===L||void 0===L||null===(e=L.data)||void 0===e||null===(n=e.updateItems)||void 0===n||null===(a=n.operationalErrors)||void 0===a?void 0:a.length;0===t&&(l&&l(),s&&s(),x&&x(),setTimeout((()=>N({message:"".concat((0,f.B$)(i,"item")," added to cart"),actionButtonProps:{children:(0,r.m)(I,"viewCart"),onClick:()=>{C({context:h,action:o.R_.ONCLICK,name:o.R_.ITEMS_ADDED,payload:{li:{nm:p?o.R_.SUBSCRIPTIONS_VIEW_CART:o.R_.ITEMS_VIEW_CART},nm:{nm:p?o.R_.SUBSCRIPTIONS_VIEW_CART:o.R_.ITEMS_VIEW_CART}}}),S.push("/cart")}},closeButtonProps:{onClick:()=>{C({context:h,action:o.R_.ONCLICK,name:o.R_.ITEMS_ADDED,payload:{li:{nm:o.R_.DISMISS},nm:{nm:o.R_.DISMISS},co:{ov:o.R_.ITEMS_ADDED}}})}}})),1e3),C({context:h,action:o.R_.OVERLAY_VIEW,name:o.R_.ITEMS_ADDED,payload:{nm:{nm:o.R_.ITEMS_ADDED}}})),t&&t<i&&(s&&s(),x&&x())}else A&&(null===d||void 0===d||d());(j||A)&&t()}),[j,A]);return(0,a.jsxs)("div",{className:"justify-center flex items-center flex-column w-100","data-testid":"basket-enroll-panel-bottom",children:[(0,a.jsx)(g,{totalItems:i,totalPrice:n}),(0,a.jsx)(E.Z,{disabled:y||M,onClick:()=>(_(!1),void(i?k(u):(_(!0),C({context:o.R_.SUBSCRIBE,action:o.R_.ONCLICK,name:"error",payload:{co:{ov:o.R_.ADD_SELECTED_ITEMS},er:{ms:o.R_.NO_ITEMS_SELECTED,ty:o.R_.ADD_ITEM_ERROR}}})))),type:"submit",className:"w-100 b",size:"medium",variant:"primary",onLinkName:o.R_.ADD_SELECTED_ITEMS,onLinkExtras:m,"data-testid":"basket-enroll-add-to-cart-button","data-dca-id":"B:43510A4C56","data-dca-intent":"__DCA_TBD__",children:p?M?(0,a.jsx)(D.$,{color:"white",size:"small"}):(0,r.m)(I,"addSubscriptionBtn"):(0,r.m)(I,"addSelectedItems",{count:i})})]})},R=n(385074),N=n(995433),k=n(408694),j=n(940833),A=n(73115),L=n(958597),M=n(442683),B=n(620769),w=n.n(B);const O=e=>{let{itemsLength:t,itemIndex:n,itemName:i,frequencyList:l,usItemId:d,handleFrequencyChange:u}=e;const{isMobile:m}=(0,s.vP)(),h=(0,c.wG)(),{0:_,1:x}=(0,v.useState)(!1),f=(0,v.useRef)(null),b=(0,v.useRef)(null),T=(0,v.useRef)([]);T.current=l.map((()=>(0,v.createRef)())),(0,M.t)(f,(()=>x(!1)));const C=e=>{var t;e.preventDefault(),x(!_),null===(t=b.current)||void 0===t||t.focus()},D=(e,t)=>{var n;const a=(0,S.Gu)(l,t,e);u(d,a),x(!_),null===(n=b.current)||void 0===n||n.focus(),h((0,o.UZ)(e,t,d))},{handleOptionKeyPress:g,handleButtonKeyPress:y}=(0,S.z8)(l,T,D,C);(0,v.useEffect)((()=>{var e;_&&(null===(e=T.current[0].current)||void 0===e||e.focus())}),[_]);const R=l.find((e=>!0===e.isSelected));let N=(0,r.m)(I,"weeksFrequency",{value:4});if(R){const e=R.unitOfMeasure.toLowerCase();N=(0,r.m)(I,"".concat(e,"Frequency"),{value:R.value})}return(0,a.jsxs)("div",{className:w()({"z-2":_}),ref:f,children:[(0,a.jsx)(E.Z,{"aria-haspopup":"listbox","aria-expanded":_,"aria-label":"".concat(N,", ").concat(i),className:"pl0 pr1 f6",variant:"tertiary",onClick:C,onKeyDown:e=>y(e),buttonRef:b,onLinkName:o.R_.GET_IT_EVERY,onLinkExtras:(0,o.Z7)(null===R||void 0===R?void 0:R.value,null===R||void 0===R?void 0:R.unitOfMeasure,d),"data-testid":"basket-enroll-frequency-selection-".concat(n),"data-dca-id":"B:01C046B69A","data-dca-intent":"__DCA_TBD__",children:N}),(0,a.jsx)(p.J,{"aria-hidden":!0,name:"CaretDown",size:"small",className:"pointer",onClick:C}),(0,a.jsx)("ul",{className:w()("bg-white absolute list ph3 br3 shadow-1 w-100 mv2 mb0",{dn:!_}),style:{bottom:n>=2&&n>=t-3?"30px":"",width:m?"260px":"388px",marginLeft:"-14px"},role:"listbox",tabIndex:_?0:-1,"aria-orientation":"vertical",children:l.map(((e,t)=>{const i=e.isSelected,l=e.unitOfMeasure.toLowerCase(),s=e.isMostCommon?" (".concat((0,r.m)(I,"recommended"),")"):"",c=T.current[t];return(0,a.jsxs)("li",{className:"dark-gray lh-solid pv3 f5 pointer ".concat(0===t?"":"bt b--near-white"," ").concat(i&&"b"),onClick:()=>D(e.value,e.unitOfMeasure),onKeyDown:e=>g(e,t),ref:c,role:"option","aria-selected":i,tabIndex:0===t?0:-1,"data-testid":"".concat(e.value,"-").concat(e.unitOfMeasure,"-").concat(n),children:[(0,r.m)(I,"".concat(l,"Frequency"),{value:e.value}),s]},"frequency-".concat(t))}))})]})};var P=v.memo(O);var q=e=>{let{product:t,item:n,handleCheckbox:i,handleQuantityChange:l,handleFrequencyChange:c,itemIndex:d,itemsLength:u,isSubscriptionBulkEnroll:m,enablePredictiveBasket:E=!1,authModule:h}=e;var p,_;const{router:x}=(0,T.tv)(),{locale:f}=x,{usItemId:D,isSelected:g,currentQuantity:y,defaultQuantity:M,title:B,flag:w,price:O,currentFrequencyList:q}=t,F=(null===(p=n.priceInfo)||void 0===p||null===(_=p.taxInfo)||void 0===_?void 0:_.isTaxable)||!1,Q="ld-checkbox-".concat(D),U="price-".concat(D),V="title-".concat(D),K="boughtX-".concat(D),z={us:D,dp:O,pl:B,pb:w,oq:M},Y={pr:{...z,qu:y+1},co:{ov:o.R_.ADD_SELECTED_ITEMS},nm:{nm:o.R_.INCREMENT_ITEM_QTY},ta:{ov:o.R_.ADD_SELECTED_ITEMS},atm:{athModule:h||""}},G={pr:{...z,qu:y-1},co:{ov:o.R_.ADD_SELECTED_ITEMS},nm:{nm:o.R_.DECREMENT_ITEM_QTY},ta:{ov:o.R_.ADD_SELECTED_ITEMS},atm:{athModule:h||""}},{isMobile:Z}=(0,s.vP)(),H=(0,v.useRef)(null),W=0!==d&&"bt b--near-white";return(0,a.jsx)("div",{className:"ph3 pb3 ".concat(0===d?"pt1":""),children:(0,a.jsx)("div",{className:"pa3 bg-white ".concat(E?W:"br3 shadow-1"),style:{height:"155px"},children:(0,a.jsxs)(j.LM,{item:n,children:[(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex b--light-gray items-center",children:(0,a.jsx)(R.Z,{checked:g,id:Q,a11yLabelledBy:"".concat(V," ").concat(U," ").concat(K),onLinkName:o.R_.ITEM_CHECKBOX,onLinkExtras:{pr:{us:t.usItemId},ic:{ic:!g},co:{ov:o.R_.ADD_SELECTED_ITEMS},ta:{ov:o.R_.ADD_SELECTED_ITEMS},nm:{nm:o.R_.ITEM_CHECKBOX},atm:{athModule:h||""},li:{ath:(0,S.zE)([n])}},onChange:()=>i(D)})}),(0,a.jsx)("div",{className:"flex-grow-1",children:(0,a.jsx)("div",{className:"pl3 b--light-gray flex-grow-1",children:(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("div",{className:"flex pt1",children:(0,a.jsx)(N.Z,{src:(0,k.P)({src:t.image,height:"71",width:"71"}),style:{objectFit:"contain",aspectRatio:1},className:"mr3 mw-none",alt:"",width:"71",height:"71",loading:"lazy",preload:!1})}),(0,a.jsxs)("div",{className:"flex flex-column flex-grow-1",children:[(0,a.jsx)("div",{className:"flex justify-between pb1 f6 mr3 dark-gray",children:(0,a.jsx)(b.LineClamp,{lines:3,id:V,children:t.title})}),t.flag&&(0,a.jsx)("div",{id:K,className:"".concat(Z?"f7":"f6"," blue"),children:t.flag})]}),(0,a.jsxs)("div",{className:"flex flex-column items-end",children:[(0,a.jsx)("div",{className:"f4 black b nowrap",id:U,children:(0,r.m)(I,"currency",{price:(0,C.mD)(t.price,f,void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})}),F&&(0,a.jsx)(A.o,{text:(0,r.m)(I,"taxLabel"),containerClassNames:"mt0",txtClassNames:"normal gray f7 f6-l"})]})]})})})]}),(0,a.jsxs)("div",{className:"flex flex-row mt2",children:[(0,a.jsx)("div",{className:"flex flex-grow-1",children:m&&q&&(0,a.jsx)(P,{usItemId:D,itemsLength:u,itemIndex:d,itemName:t.title,frequencyList:q,handleFrequencyChange:c})}),(0,a.jsx)("div",{className:"flex","data-testid":"basket-enroll-quantity-stepper-".concat(d),children:(0,a.jsx)(L.Z,{quantity:y,minLimit:t.orderMinLimit,maxLimit:t.quantityLimit,salesUnit:t.salesUnit,onChange:(e,n)=>((e,n)=>{var a;n===t.quantityLimit&&(null===(a=H.current)||void 0===a||a.focus()),l(e,n)})(D,n),itemName:t.title,decrementOnLinkName:o.R_.DECREMENT_ITEM_QTY,incrementOnLinkName:o.R_.INCREMENT_ITEM_QTY,cartAdditionBeaconData:Y,cartRemovalBeaconData:G,productHref:null===n||void 0===n?void 0:n.canonicalUrl,itemIndex:d,uid:"".concat(null===n||void 0===n?void 0:n.id,"PPT"),decButtonRef:H})})]})]})})})},F=n(822388);const Q=["//i5.walmartimages.com/dfw/63fd9f59-d90e/10fdc886-502e-4feb-a1ca-c4834f9cbe02/v1/error-generic-cat.svg","//i5.walmartimages.com/dfw/63fd9f59-d90e/10fdc886-502e-4feb-a1ca-c4834f9cbe02/v1/error-generic-dinosaur.svg","//i5.walmartimages.com/dfw/63fd9f59-d90e/10fdc886-502e-4feb-a1ca-c4834f9cbe02/v1/error-generic-toaster.svg"],U=e=>{let{headingText:t="Try again in a few minutes.",descriptionText:n="We couldn\u2019t retrieve your items",buttonText:i="Got it",onAcknowledge:l,image:r,moduleContext:s,errorType:o,beaconInstanceId:d}=e;return(0,a.jsx)(c.tp,{context:s,action:"error",name:"Error",instanceId:d||"",payload:{co:{ov:"predictiveBasket"},er:{ms:t,ty:o}},children:(0,a.jsx)("div",{className:"vh-75 flex items-center justify-center",children:(0,a.jsx)(b.ErrorMessage,{actions:(0,a.jsx)(E.Z,{size:"medium",variant:"primary",onClick:l,onLinkName:"gotIt",onLinkExtras:{co:{ov:"predictiveBasket"},nm:{nm:"gotIt"},er:{ms:t,ty:o}},"data-dca-id":"B:0B303B5E3B","data-dca-intent":"__DCA_TBD__",children:i}),media:(0,a.jsx)(F.L,{alt:"",className:"mb7",height:224,images:r?[r]:Q,preload:!1,width:224}),title:t,children:n})})})},V=e=>{let{togglePopup:t,beaconData:{ms:n="Try again in a few minutes.",ty:i}}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"bg-blue dn db-l",style:{height:"84px"},children:(0,a.jsx)("div",{className:"flex items-center justify-end h-100 w-100 pr3",children:(0,a.jsx)(E.Z,{"aria-label":(0,r.m)(I,"close"),onClick:t,className:"bg-transparent bn dib ma0 pa2 pointer white hover-white",size:"medium",onLinkName:"dismiss",onLinkExtras:{co:{ov:"predictiveBasket"},nm:{nm:"dismiss"},er:{ms:n,ty:i}},variant:"tertiary","data-dca-id":"B:7E66E61625","data-dca-intent":"__DCA_TBD__",children:(0,a.jsx)(p.J,{name:"Close",size:"medium"})})})}),(0,a.jsx)("div",{className:"db dn-l",style:{height:"84px"},children:(0,a.jsx)("div",{className:"flex items-center justify-end h-100 w-100 pr3",children:(0,a.jsx)(E.Z,{"aria-label":(0,r.m)(I,"close"),onClick:t,className:"bg-transparent bn dib ma0 pa2 pointer black hover-black",size:"medium",onLinkName:"dismiss",onLinkExtras:{co:{ov:"predictiveBasket"},nm:{nm:"dismiss"}},variant:"tertiary","data-dca-id":"B:1B71D88E62","data-dca-intent":"__DCA_TBD__",children:(0,a.jsx)(p.J,{name:"Close",size:"medium"})})})})]})},K=e=>{let{togglePopup:t}=e;const{isMobile:n}=(0,s.vP)();return(0,a.jsxs)("div",{className:"".concat(n?"br4 br--top":""," bg-near-white-blue"),children:[(0,a.jsxs)("div",{className:"flex items-center ".concat(n?"mt3 mb2":"mv4"),children:[(0,a.jsx)("div",{className:"".concat(n?"justify-center ml6":"justify-start ml3"," flex w-100"),children:(0,a.jsx)(b.Skeleton,{height:n?"30px":"40px",variant:"rectangle",width:"240px"})}),(0,a.jsx)("div",{className:"pr3",children:(0,a.jsx)(E.Z,{"aria-label":(0,r.m)(I,"close"),onClick:t,className:"bg-transparent bn dib ma0 pa2 pointer black hover-black",size:"medium",onLinkName:"dismiss",onLinkExtras:{co:{ov:"predictiveBasket"},nm:{nm:"dismiss"}},variant:"tertiary","data-dca-id":"B:A264D3EBDB","data-dca-intent":"__DCA_TBD__",children:(0,a.jsx)(p.J,{name:"Close",size:"medium"})})})]}),(0,a.jsx)(b.Divider,{UNSAFE_className:"".concat(n?"dn":"mb3 db")}),(0,a.jsxs)("div",{className:"flex flex-column",children:[(0,a.jsx)("div",{className:"mb2 ".concat(n?"flex justify-center":"ml3"),children:(0,a.jsx)(b.Skeleton,{height:n?"18px":"20px",variant:"rectangle",width:"345px"})}),(0,a.jsx)("div",{className:"mb3 ".concat(n?"mb2 flex justify-center":"ml3"),children:(0,a.jsx)(b.Skeleton,{height:n?"18px":"20px",width:n?"200px":"250px"})}),(0,a.jsx)("div",{className:"mb3 ml3",children:(0,a.jsx)(b.Skeleton,{height:"22px",variant:"rectangle",width:"66px"})})]})]})},z=(e,t)=>{let{isSubscriptionBulkEnroll:n}=e,{rows:i=10}=t;const{isMobile:l}=(0,s.vP)(),r=!(0,_.M)(600)&&l,c=l?r?"nr4 nb4 nl4":"nr3 nb3 nl3":"na4",o=[],d=(0,a.jsx)("div",{className:"h-100 flex items-center",children:(0,a.jsx)("div",{className:"mb3",children:(0,a.jsx)(b.Skeleton,{height:"18px",variant:"rectangle",width:"18px"})})}),u=(0,a.jsx)(b.Skeleton,{height:"72px",width:"72px",variant:"rectangle"}),m=(0,a.jsx)("div",{className:"mb1",children:(0,a.jsx)(b.Skeleton,{height:"16px",width:l?"140px":"170px",variant:"rectangle"})}),E=(0,a.jsxs)("div",{className:"flex mt3",children:[(0,a.jsx)("div",{className:"mr1",children:(0,a.jsx)(b.Skeleton,{height:"20px",width:"90px",variant:"rectangle"})}),(0,a.jsx)(b.Skeleton,{height:"20px",width:"20px",variant:"rectangle"})]});for(let s=0;s<i;s++)o.push((0,a.jsx)("div",{className:"ph3 pb3 ".concat(0===s?"pt1":""),children:(0,a.jsxs)("div",{className:"pa3 bg-white br3 ba b--lighter-gray",style:{height:"155px"},children:[(0,a.jsxs)(b.Grid,{children:[(0,a.jsx)(b.GridColumn,{sm:1,children:d}),(0,a.jsx)(b.GridColumn,{sm:3,children:u}),(0,a.jsx)(b.GridColumn,{sm:6,children:(0,a.jsxs)("div",{className:"flex flex-column ".concat(l?"ml2":""),children:[m,m,m,(0,a.jsx)("div",{className:"mt1",children:(0,a.jsx)(b.Skeleton,{height:"16px",width:l?"140px":"110px",variant:"rectangle"})})]})}),(0,a.jsx)(b.GridColumn,{sm:1,children:(0,a.jsx)("div",{className:"ml2",children:(0,a.jsx)(b.Skeleton,{height:"20px",variant:"rectangle",width:"48px"})})})]}),n&&E]})},s));return(0,a.jsx)("div",{className:"".concat(c," bg-near-white-blue"),children:o})},Y="quick_add_sel_store",G="quick_add_sel",Z="bulk_enrollment_store",H="bulk_enrollment_key",W=e=>{let{currentProducts:t,productItems:n,handleCheckbox:i,handleQuantityChange:l,handleFrequencyChange:r,isSubscriptionBulkEnroll:c,enablePredictiveBasket:o=!1,authModule:d}=e;const{isMobile:u}=(0,s.vP)(),m=(0,v.useRef)(null),{0:E,1:h}=(0,v.useState)();(0,v.useEffect)((()=>{var e;if(m.current&&(null===(e=m.current)||void 0===e?void 0:e.offsetHeight)){var t,n;const e=null===(t=m.current.parentElement)||void 0===t||null===(n=t.parentElement)||void 0===n?void 0:n.offsetHeight;h(e)}}),[]);const p=!(0,_.M)(600)&&u,x=u?p?"nr4 nb4 nl4":"nr3 nb3 nl3":"na4";return(0,a.jsx)("div",{className:"".concat(x," ").concat(o?"bg-white":"bg-near-white-blue"),style:{minHeight:E&&E>725?E:"725px"},ref:m,"data-testid":"basket-enroll-panel-content",children:t.map(((e,s)=>(0,a.jsx)(q,{product:e,item:n[s],handleCheckbox:i,handleQuantityChange:l,handleFrequencyChange:r,isLastItem:t.length===s+1,itemIndex:s,itemsLength:t.length,isSubscriptionBulkEnroll:c,enablePredictiveBasket:o,authModule:d},"popup-".concat(e.usItemId))))})},J=e=>e.reduce(((e,t)=>{let{isSelected:n,price:a,currentQuantity:i}=t;return e+(n?a*i:0)}),0),X=e=>e.reduce(((e,t)=>{let{currentQuantity:n,salesUnit:a,isSelected:i}=t;const l="WEIGHT"===a&&n>0?1:Math.ceil(n);return e+(i?l:0)}),0),$=(e,t)=>e.map((e=>{let{quantity:n,offerId:a,frequencyList:i,...l}=e;return{...l,offerId:null!==a&&void 0!==a?a:"",defaultQuantity:t?0:n,isSelected:!t,currentQuantity:t?0:n,currentFrequencyList:i}}));var ee=e=>{let{popupDescriptionText:t,products:n,productItems:_,togglePopup:f,popupIsOpen:b,popupHeadingText:T,onAATCSuccess:C,onAATCError:D,moduleContext:g,moduleViewExtras:R,showError:N,showLoading:k,showEmpty:j,errorDetail:A,isSubscriptionBulkEnroll:L,refetchMyItems:M,referencePage:B,authModule:w}=e;var O;const{isMobile:P}=(0,s.vP)(),q=null===(O=(0,l.iC)(d.v,u.T).repurchase.values)||void 0===O?void 0:O.enablePredictiveBasket,[F,Q]=v.useState($(n,L)),{0:ee,1:te}=(0,v.useState)(!L),{0:ne,1:ae}=(0,v.useState)(!1),ie=()=>{f(),ae(!1)},le=()=>{const e={ms:"Check back soon",ty:"noRecommendations"};return N&&(e.ms=null===A||void 0===A?void 0:A.headingText,e.ty=A?"personalizationError":"networkConnectionError"),e},re=v.useRef(null),se=v.useRef(null),ce=L?H:G;v.useEffect((()=>{let e=!0;const t=$(n,L);re.current=new x.yh("repurchase-quickadd",Y),se.current=new x.yh("subscription-bulkenroll",Z);const a=L?se.current:re.current;return(0,x.U2)(ce,a).then((n=>{if(e)if(n){const e={};for(const t of n)e[t.usItemId]={currentQuantity:t.currentQuantity,isSelected:t.isSelected,currentFrequencyList:t.currentFrequencyList};const a=t.map((t=>{var n,a,i,l;return t.currentQuantity=(null===(n=e[t.usItemId])||void 0===n?void 0:n.currentQuantity)>=0?e[t.usItemId].currentQuantity:t.currentQuantity,t.isSelected=e[t.usItemId]?e[t.usItemId].isSelected:t.isSelected,t.currentFrequencyList=(null===(a=e[t.usItemId])||void 0===a||null===(i=a.currentFrequencyList)||void 0===i?void 0:i.length)?null===(l=e[t.usItemId])||void 0===l?void 0:l.currentFrequencyList:t.currentFrequencyList,t}));Q(a)}else Q(t)})),()=>{e=!1}}),[n,L,ce]),(0,v.useEffect)((()=>{const e=F.some((e=>!e.isSelected));te(!e)}),[F]),(0,v.useEffect)((()=>{X(F)&&ae(!1)}),[F]);const oe=(0,v.useCallback)((e=>{const t=F.map((t=>(t.currentQuantity=e?0:L?1:t.defaultQuantity,t.isSelected=!e,t))),n=L?se.current:re.current;Q(t),te(!e),(0,x.t8)(ce,t,n)}),[F,ce,L]),de=()=>F.filter((e=>e.isSelected)),ue=e=>{const t=e?F:de();return{pr:t.map(((t,n)=>{let{price:a,usItemId:i,currentQuantity:l,title:r,flag:s,defaultQuantity:c,subscription:o,currentFrequencyList:d,sellerId:u,sellerName:m}=t;var E,h,p,_;const{id:x,value:v,unitOfMeasure:I}=(0,S.Iu)(d,null===o||void 0===o?void 0:o.enrollmentFrequency)||{};return{pb:s,dp:a,pl:r,us:i,qu:l,pdo:n+1,se:{id:(null===u||void 0===u?void 0:u.toString())||"",nm:m||""},oq:c,...e&&(null===o||void 0===o||null===(E=o.enrollmentFrequency)||void 0===E?void 0:E.id)?{pf:{fi:null===o||void 0===o||null===(h=o.enrollmentFrequency)||void 0===h?void 0:h.id,fv:null===o||void 0===o||null===(p=o.enrollmentFrequency)||void 0===p?void 0:p.value,fu:null===o||void 0===o||null===(_=o.enrollmentFrequency)||void 0===_?void 0:_.unitOfMeasure}}:{...L&&{su:{fi:x,fv:v,fu:I}}}}})),ca:{st:J(F)},ta:{pt:B||g,ov:o.R_.ADD_SELECTED_ITEMS},...e?{ath:(0,S.zE)(t)}:{li:{ath:(0,S.zE)(t)}},co:{ov:q?o.R_.ADD_ESSENTIALS_TO_YOUR_CART:o.R_.ADD_SELECTED_ITEMS,...q?{fe:o.R_.PREDICTIVE_BASKET_FE,est:J(F)}:{}},nm:{nm:o.R_.ADD_SELECTED_ITEMS},atm:{athModule:w}}},me={popupDescriptionText:t,currentProducts:F,productItems:_,handleQuantityChange:(e,t)=>{const n=F.map((n=>(n.usItemId===e&&(n.currentQuantity=t,n.isSelected=0!==t),n)));Q(n);const a=L?se.current:re.current;(0,x.t8)(ce,n,a)},handleFrequencyChange:(e,t)=>{const n=F.map((n=>(n.usItemId===e&&(n.currentFrequencyList=t),n)));Q(n),(0,x.t8)(H,n,se.current),ae(!1)},handleCheckbox:e=>{const t=F.map((t=>{if(t.usItemId===e){const e=t.isSelected;t.currentQuantity=e?0:L?1:t.defaultQuantity,t.isSelected=!e}return t}));Q(t);const n=L?se.current:re.current;(0,x.t8)(ce,t,n)},isSubscriptionBulkEnroll:L,enablePredictiveBasket:q,authModule:w};return(0,a.jsx)(i.ZP,{shouldSetOverlay:!1,shouldSuppressModuleView:!0,moduleContext:L?o.R_.SUBSCRIBE:g,name:o.R_.ADD_SELECTED_ITEMS,moduleViewExtras:{ath:(0,S.zE)(de()),atm:{athModule:w},...R},"data-dca-id":"M:824EE2579C","data-dca-type":"module",children:(0,a.jsx)(h.Z,{desktopComponent:"panel",isOpen:b,title:k?()=>(0,a.jsx)(K,{togglePopup:f}):N||j?()=>(0,a.jsx)(V,{togglePopup:f,beaconData:{...le()}}):(e=>{let{popupHeadingText:t,productsQty:n,popupDescriptionText:i,isMobile:l,isAllSelected:s,handleSelectAll:c,noItemsSelectedAlert:d,isSubscriptionBulkEnroll:u,currentProducts:h,handleOnClose:_,enablePredictiveBasket:x,authModule:v}=e;return e=>{let{titleId:f}=e;const b=x?l?"br4 br--top bg-white":"bg-white":l?"br4 br--top bg-near-white-blue":"bg-blue";return(0,a.jsxs)("div",{className:b,"data-testid":"basket-enroll-panel-header",children:[(0,a.jsxs)("div",{className:"flex justify-between ph3 items-center",style:{height:x?"56px":l?"65px":"88px"},children:[(0,a.jsxs)("h2",{className:"".concat(l?"black f4 tc ml5":x?"black f3 tl":"white f3 tl"," flex-auto"),id:f,children:[t,!x&&(0,a.jsxs)(a.Fragment,{children:[" ",(0,r.m)(I,"openParen"),n,(0,r.m)(I,"closeParen")]})]}),(0,a.jsx)(E.Z,{"aria-label":(0,r.m)(I,"close"),onClick:_,className:"bg-transparent bn dib ma0 pa2 pointer ".concat(x||l?"black hover-black":"white hover-white"),size:"medium",onLinkName:o.R_.DISMISS,onLinkExtras:{co:{ov:o.R_.ADD_SELECTED_ITEMS},ta:{ov:o.R_.ADD_SELECTED_ITEMS},nm:{nm:o.R_.DISMISS},atm:{athModule:v},li:{ath:(0,S.zE)(h)}},variant:"tertiary","data-dca-id":"B:10D146FBE8","data-dca-intent":"__DCA_TBD__",children:(0,a.jsx)(p.J,{name:"Close",size:"medium"})})]}),(0,a.jsxs)("div",{className:"".concat(l?"f6 pt0 tc":"f5 tl"," pa3 ").concat(x?"bg-white":"bg-near-white-blue"," bt b--near-white dark-gray"),children:[d&&u&&(0,a.jsx)("div",{className:"mb2","data-testid":"no-subscription-items-selected",children:(0,a.jsx)(m.Z,{variant:"error",role:"alert",children:(0,r.m)(I,"noSubscriptionItemsSelectedAlert")})}),i]}),(0,a.jsx)("div",{className:"".concat(x?"bg-white":"bg-near-white-blue"," pb2"),children:(0,a.jsx)(E.Z,{variant:"tertiary",className:"f5 dark-gray",onClick:()=>c(s),onLinkName:s?o.R_.DESELECT_All:o.R_.SELECT_All,onLinkExtras:{co:{ov:o.R_.ADD_SELECTED_ITEMS},ta:{ov:o.R_.ADD_SELECTED_ITEMS},nm:{nm:"".concat(s?o.R_.DESELECT_All:o.R_.SELECT_All)},atm:{athModule:v},li:{ath:(0,S.zE)(h)}},"data-testid":"basket-enroll-select-all-button","aria-label":s?(0,r.m)(I,"deselectAllItems"):(0,r.m)(I,"selectAllItems"),"data-dca-id":"B:F5BD008EE2","data-dca-intent":"__DCA_TBD__",children:(0,r.m)(I,"".concat(s?"deselectAll":"selectAll"))})})]})}})({popupHeadingText:T,productsQty:F.length,togglePopup:f,popupDescriptionText:t,isMobile:P,isAllSelected:ee,handleSelectAll:oe,noItemsSelectedAlert:ne,isSubscriptionBulkEnroll:L,setNoItemsSelectedAlert:ae,currentProducts:F,handleOnClose:ie,enablePredictiveBasket:q,authModule:w}),onClose:ie,position:"right",size:"medium",actions:!k&&!N&&!j&&(0,a.jsx)(y,{togglePopup:f,totalPrice:J(F),totalItems:X(F),onAATCSuccess:C,clearSelections:()=>{const e=L?se.current:re.current;(0,x.IV)(ce,e)},onAATCError:D,addToCartProducts:F.filter((e=>e.isSelected)).map((e=>{let{offerId:t,usItemId:n,currentQuantity:a,currentFrequencyList:i}=e;var l,r;return{offerId:t,lineItemId:n,isPharmacyPrescription:!1,quantity:a,additionalInfo:null,fulfillmentPreference:null,registryId:null,isGiftEligible:null,...L&&{subscription:{isSelected:!0,frequency:{value:null===(l=null===i||void 0===i?void 0:i.find((e=>e.isSelected)))||void 0===l?void 0:l.value,unitOfMeasure:null===(r=null===i||void 0===i?void 0:i.find((e=>e.isSelected)))||void 0===r?void 0:r.unitOfMeasure}}}}})),addAllToCartAnalytics:ue(!1),moduleContext:B===o.R_.THANK_YOU_PAGE?o.R_.CHECKOUT:g,isSubscriptionBulkEnroll:L,setNoItemsSelectedAlert:ae,refetchMyItems:M,"data-dca-id":"M:06574594D9","data-dca-type":"module"}),"data-testid":"basket-enroll-panel",children:k||F.length!==n.length?(0,a.jsx)(c.tp,{context:L?o.R_.SUBSCRIBE:g,action:o.R_.OVERLAY_VIEW,name:o.R_.PREDICTIVE_BASKET_SKELETON,instanceId:o.R_.PREDICTIVE_BASKET_SKELETON,payload:{ath:(0,S.zE)(F),atm:{athModule:w},nm:{nm:o.R_.PREDICTIVE_BASKET_SKELETON}},children:(0,a.jsx)(z,{isSubscriptionBulkEnroll:L})}):N?(0,a.jsx)(U,{headingText:null===A||void 0===A?void 0:A.headingText,descriptionText:null===A||void 0===A?void 0:A.descriptionText,buttonText:null===A||void 0===A?void 0:A.buttonText,image:null===A||void 0===A?void 0:A.imageSrc,onAcknowledge:f,moduleContext:L?o.R_.SUBSCRIBE:g,errorType:A?"personalizationError":"networkConnectionError",beaconInstanceId:null===A||void 0===A?void 0:A.descriptionText,"data-dca-id":"M:9C9A2D3F76","data-dca-type":"module"}):j?(0,a.jsx)(U,{headingText:"Check back soon",descriptionText:"Suggestions to build your cart will be shown here as you shop.",buttonText:"Got it",onAcknowledge:f,moduleContext:L?o.R_.SUBSCRIBE:g,errorType:"noRecommendations",beaconInstanceId:"noRecommendations","data-dca-id":"M:3274CCB423","data-dca-type":"module"}):(0,a.jsx)(c.tp,{context:L?o.R_.SUBSCRIBE:g,action:o.R_.OVERLAY_VIEW,name:o.R_.ADD_SELECTED_ITEMS,instanceId:"popup",payload:{...ue(!0)},children:(0,a.jsx)(W,{...me})})})})}},575393:function(e,t,n){n.d(t,{IV:function(){return c},U2:function(){return r},t8:function(){return s},yh:function(){return a}});class a{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._dbp=new Promise(((n,a)=>{const i=indexedDB.open(e,1);i.onerror=()=>a(i.error),i.onsuccess=()=>n(i.result),i.onupgradeneeded=()=>{i.result.createObjectStore(t)}}))}_withIDBStore(e,t){return this._dbp.then((n=>new Promise(((a,i)=>{const l=n.transaction(this.storeName,e);l.oncomplete=()=>a(),l.onabort=l.onerror=()=>i(l.error),t(l.objectStore(this.storeName))}))))}}let i;function l(){return i||(i=new a),i}function r(e,t=l()){let n;return t._withIDBStore("readonly",(t=>{n=t.get(e)})).then((()=>n.result))}function s(e,t,n=l()){return n._withIDBStore("readwrite",(n=>{n.put(t,e)}))}function c(e,t=l()){return t._withIDBStore("readwrite",(t=>{t.delete(e)}))}}}]);