"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2709],{336509:function(e,n,a){a.d(n,{Y:function(){return H}});var t={};a.r(t),a.d(t,{Add:function(){return b},AddInstructions:function(){return h},Edit:function(){return S},EditInstructions:function(){return C},Save:function(){return F},dontAddSpecialChars:function(){return j},ghostText:function(){return L},instructionLabel:function(){return V},modalContent:function(){return I},specialRequestLabel:function(){return E}});var r=a(487954),l=a(91440),i=a(686261),s=a(705770),o=a(465205),d=a(179404),c=a(784289);const u={type:"mutation",name:"updateItemInstructions",hash:"8c0286cf879c68bdc207f26466a75ac3ee154b31039e21947a3fd7d90086554f"};var m=a(701272),p=a(957799),x=a(326447);var y=a(573922),g=a(639762),w=a(293168),f=a(682081),A=a(141819),v=a(194742);const E=()=>"Include a special request",L=()=>"Please write 'Happy birthday Mom!\" with a heart next to it",b=()=>"Add",S=()=>"Edit",h=()=>"Add instructions",C=()=>"Edit instructions",F=()=>"Save",I=()=>"Add a custom message or special request for the store. The store will do its best to accommodate you.",V=()=>"Your message or request",j=()=>"Do not write special characters (ex: @?&)";var _=a(719650),M=a(155394),z=a(522037),N=a(425443),q=a(444002),P=a(91726),D=a(620769),R=a.n(D);const U=e=>{let{message:n="",onAddEditAction:a,actionStyleFlag:l=!0,analyticsContext:i="productPage",mpdModuleLinkExtras:s,isBYOD:o}=e;const{isMobile:d}=(0,N.vP)(),c=(0,_.WCA)(),u=(0,_.e0r)(),m=(0,_.S77)(),p=(0,_.Fnl)(),x=""===n?"Add":"Edit",y="shoppingCart"===i,g=o?"deliveryFromLocalStoreBYOD":"deliveryFromLocalStore",w="shoppingCart"===i?{co:{ty:g,id:g,nm:g}}:"productPage"===i?{li:{aa:{byod:o?1:0,seid:c,id:m,us:u}}}:{};return(0,r.jsxs)(z.ZP,{name:"specialRequest",moduleContext:i,moduleLinkExtras:s,"data-dca-id":"M:048C8F878F","data-dca-type":"module",children:[p&&d&&(0,r.jsx)(M.Divider,{UNSAFE_className:"mt3",id:"special-instructions-top-divider"}),(0,r.jsxs)("div",{className:R()("flex w-100 items-center",{pa3:d&&l,pv3:y}),children:[(0,r.jsxs)("div",{className:R()("flex flex-column",{"w-90":!l}),children:[(0,r.jsxs)("div",{className:R()("flex w-100 b",{f7:d,f6:!d}),children:[(0,r.jsx)(q.J,{className:"mr2",name:"Note","aria-hidden":"true"}),(0,f.m)(t,"specialRequestLabel")]}),""!==n&&(0,r.jsx)("div",{className:"ml4 f6","data-testid":"special-request-message",children:n})]}),(0,r.jsx)(P.ZP,{className:R()("pointer underline f6 dark-gray ph0 ml2",{mt4:""!==n,"ml-auto":!l}),onClick:a,"aria-label":(0,f.m)(t,"".concat(x,"Instructions")),onLinkName:"".concat(x.toLocaleLowerCase(),"SpecialRequestClick"),"data-testid":"".concat(x,"-special-request"),onLinkExtras:w,"data-dca-id":"B:787B326DEC","data-dca-intent":"__DCA_TBD__",role:"button",children:(0,f.m)(t,x)})]}),p&&!d&&(0,r.jsx)(M.Divider,{UNSAFE_className:"mt3",UNSAFE_style:{marginBottom:"12px"},id:"special-instructions-bottom-divider"})]})};var T=a(303067),k=a(297693),O=a(632017),G=a(200421),Y=a(976973),B=a(918099),W=a(640383),X=a(779280);const Z=e=>{let{isOpen:n,isLoading:a,isError:l,errorMessage:i,onClose:s,onSave:o,title:d,instructionsMessage:c,instructionsLength:u=100,setInstructions:m,analyticsContext:p="productPage"}=e;var x;const y=(0,w.iC)(X.w),{enableItemCommentValidation:g}=(null===y||void 0===y||null===(x=y.marketplace)||void 0===x?void 0:x.values)||{},{isMobile:A}=(0,N.vP)(),{0:E,1:L}=(0,v.useState)(c),{0:b,1:S}=(0,v.useState)(""),h={co:{tx:E,ov:"specialRequest"}};(0,v.useEffect)(()=>{L(c)},[c,n]);return(0,r.jsx)(z.ZP,{name:"specialRequest",moduleContext:p,"data-dca-id":"M:777AF6240F","data-dca-type":"module",children:(0,r.jsx)(Y.Z,{title:d,isOpen:n,onClose:s,size:"medium",onLinkName:"close",onLinkExtras:{co:{ov:"specialRequest",tx:E}},onLinkExtrasForClose:{co:{ov:"specialRequest"},li:{tx:E}},children:(0,r.jsx)(k.tp,{context:p,action:"overlayView",name:"specialRequest",payload:h,children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:R()({"mt2 mb7":A}),children:[l&&(0,r.jsx)("div",{className:"mb3",children:(0,r.jsx)(O.Z,{variant:"error",role:"alert",children:i||T.lQ})}),(0,r.jsxs)("div",{className:"flex-column",children:[(0,r.jsx)("div",{className:"f5 lh-copy mb3 dark-gray",children:(0,f.m)(t,"modalContent")}),(0,r.jsx)(W.Z,{label:"".concat((0,f.m)(t,"instructionLabel")),onChange:e=>{var n;L(e.target.value),g&&(n=e.target.value).length>0&&!/^\w[\w\s.,]*$/u.test(n)?S((0,f.m)(t,"dontAddSpecialChars")):S("")},maxLength:u,size:"large",placeholder:(0,f.m)(t,"ghostText"),value:E,error:b})]})]}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)(G.Z,{variant:"primary",className:"h4 f5 w-100 mt3",size:"medium",onClick:()=>{if(0===b.length){const e=E.trim();m(e),o(e)}},"aria-label":(0,f.m)(t,"Save"),onLinkName:"saveClick","data-testid":"save-special-request",onLinkExtras:{co:{ov:"specialRequest"},li:{tx:E}},"data-dca-id":"B:D3F742CDAB","data-dca-intent":"__DCA_TBD__",children:a?(0,r.jsx)(B.$,{color:"white",size:"small"}):(0,f.m)(t,"Save")})})]})})})})},H=e=>{let{moduleConfigsData:n,lineItem:a,handleOnSaveWithoutUpdate:E,actionStyleFlag:L,analyticsContext:b="productPage",offerId:S,mpdModuleLinkExtras:h,isBYOD:C}=e;const{setSpecialInstructionsText:F}=(0,g.Nh)(),I=(null===n||void 0===n?void 0:n.requestText)||(0,f.m)(t,"specialRequestLabel"),V=(null===n||void 0===n?void 0:n.messageLength)?parseInt(null===n||void 0===n?void 0:n.messageLength,10):100,{0:j,1:_}=(0,v.useState)(""),{0:M,1:z}=(0,v.useState)(!1),{0:N,1:q}=(0,v.useState)(!1),P=(0,l.wh)(),D=null!==a&&void 0!==a?a:P.find(e=>e.product.offerId===S),{personalizedItemDetails:R}=null!==D&&void 0!==D?D:{},T=null===R||void 0===R?void 0:R.editableInstructionAttributes,k=(0,l.cF)(),O=(0,w.iC)(i.Tg,A.YL),{enableVisionItems:G,enableFulfillmentMajorAppliances:Y,enableBYOD:B,enablePromiseDateRange:W}=O.cart.values,{enablePetRxManualRefill:X,enableItemLevelCheckout:H,enableDroneDeliveryPhase3:J}=O.shared.values,[Q,{isLoading:$}]=(()=>{const[e]=(0,p.t)(),{ccmValues:n={}}=(0,x.HZ)(),{onCartUpdate:a}=(0,m.er)(),t=(0,o.Zq)(),r=(0,d.Z)().getGqlFetch("cecxo");return(0,c.D)(e=>r(u,{...e,input:{...e.input},...n}),{onError:(e,n)=>{(0,s.cM)(["error","cart","update_item_instructions_from_cart","update item instructions mutation failure"],{type:"log",message:e})},onSuccess:(n,r)=>{var l;if((null===n||void 0===n||null===(l=n.errors)||void 0===l?void 0:l.length)&&!e(n.errors)){var i;(0,s.cM)(["error","cart","update_item_instructions_error"],{type:"log",errors:n.errors,variables:r,correlationId:null===(i=n.headers)||void 0===i?void 0:i.get("x-o-correlation-id")})}else{var o;const e=null===n||void 0===n||null===(o=n.data)||void 0===o?void 0:o.updateItemInstructions,r={data:{cart:e}};t.setQueryData(["cart-index-get-cart",{id:null===e||void 0===e?void 0:e.id}],r),a(e)}}})})();(0,v.useEffect)(()=>{var e;(null===T||void 0===T?void 0:T.length)&&_((null===(e=null===T||void 0===T?void 0:T.filter(e=>"SPECIAL_INSTRUCTIONS"===(null===e||void 0===e?void 0:e.type))[0])||void 0===e?void 0:e.value)||"")},[T]);const K=()=>{z(!1)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(U,{message:j,onAddEditAction:()=>{z(!0)},actionStyleFlag:L,analyticsContext:b,mpdModuleLinkExtras:h,isBYOD:C}),(0,r.jsx)(Z,{isOpen:M,isLoading:$,onClose:K,isError:N,onSave:async e=>{if(D&&(null===D||void 0===D?void 0:D.id)){var n;const a={cartId:k,items:[{lineItemId:null===D||void 0===D?void 0:D.id,itemInstructions:[{type:"SPECIAL_INSTRUCTIONS",value:e}]}],features:(0,y.N)({enableVisionItems:G,enablePetRxManualRefill:X,enableItemLevelCheckout:H,enableFulfillmentMajorAppliances:Y,enableBYOD:B,enablePromiseDateRange:W,enableDroneDeliveryPhase3:J})},t=await Q({input:a});(null===t||void 0===t||null===(n=t.data)||void 0===n?void 0:n.updateItemInstructions)&&!t.errors?(q(!1),K()):q(!0)}else F(e),null===E||void 0===E||E(e),K()},title:I,instructionsMessage:j,setInstructions:_,instructionsLength:V,analyticsContext:b})]})}}}]);